---
title: Consideraciones de datos para los microservicios
description: Consideraciones de datos para los microservicios
author: MikeWasson
ms.date: 10/23/2018
ms.openlocfilehash: 5ef2578820c3e02ac2293a5fcb5581bdccf96966
ms.sourcegitcommit: fdcacbfdc77370532a4dde776c5d9b82227dff2d
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/24/2018
ms.locfileid: "49962847"
---
# <a name="designing-microservices-data-considerations"></a><span data-ttu-id="3e043-103">Diseño de microservicios: consideraciones de datos</span><span class="sxs-lookup"><span data-stu-id="3e043-103">Designing microservices: Data considerations</span></span>

<span data-ttu-id="3e043-104">Este capítulo describe las consideraciones para administrar los datos en una arquitectura de microservicios.</span><span class="sxs-lookup"><span data-stu-id="3e043-104">This chapter describes considerations for managing data in a microservices architecture.</span></span> <span data-ttu-id="3e043-105">Como cada microservicio administra sus propios datos, la integridad y la coherencia de los datos son desafíos fundamentales.</span><span class="sxs-lookup"><span data-stu-id="3e043-105">Because every microservice manages its own data, data integrity and data consistency are critical challenges.</span></span>

![](./images/data-considerations.png)

<span data-ttu-id="3e043-106">Un principio básico de los microservicios es que cada servicio administra sus propios datos.</span><span class="sxs-lookup"><span data-stu-id="3e043-106">A basic principle of microservices is that each service manages its own data.</span></span> <span data-ttu-id="3e043-107">Dos servicios no deben compartir un mismo almacén de datos.</span><span class="sxs-lookup"><span data-stu-id="3e043-107">Two services should not share a data store.</span></span> <span data-ttu-id="3e043-108">En su lugar, cada servicio es responsable de su propio almacén de datos privado, al que otros servicios no pueden acceder directamente.</span><span class="sxs-lookup"><span data-stu-id="3e043-108">Instead, each service is responsible for its own private data store, which other services cannot access directly.</span></span>

<span data-ttu-id="3e043-109">La razón de esta regla es evitar el acoplamiento involuntario entre servicios, lo que puede suceder si los servicios comparten los mismos esquemas de datos subyacentes.</span><span class="sxs-lookup"><span data-stu-id="3e043-109">The reason for this rule is to avoid unintentional coupling between services, which can result if services share the same underlying data schemas.</span></span> <span data-ttu-id="3e043-110">Si hay un cambio en el esquema de datos, se debe coordinar en todos los servicios que utilizan esa base de datos.</span><span class="sxs-lookup"><span data-stu-id="3e043-110">If there is a change to the data schema, the change must be coordinated across every service that relies on that database.</span></span> <span data-ttu-id="3e043-111">Al aislar el almacén de datos de cada servicio, podemos limitar el ámbito del cambio y conservar la agilidad de las implementaciones realmente independientes.</span><span class="sxs-lookup"><span data-stu-id="3e043-111">By isolating each service's data store, we can limit the scope of change, and preserve the agility of truly independent deployments.</span></span> <span data-ttu-id="3e043-112">Otro motivo es que cada microservicio puede tener sus propios modelos de datos, consultas o patrones de lectura o escritura.</span><span class="sxs-lookup"><span data-stu-id="3e043-112">Another reason is that each microservice may have its own data models, queries, or read/write patterns.</span></span> <span data-ttu-id="3e043-113">Usar un almacén de datos compartido limita la capacidad de cada equipo para optimizar el almacenamiento de datos para su servicio en particular.</span><span class="sxs-lookup"><span data-stu-id="3e043-113">Using a shared data store limits each team's ability to optimize data storage for their particular service.</span></span> 

![](../guide/architecture-styles/images/cqrs-microservices-wrong.png)

<span data-ttu-id="3e043-114">Naturalmente, este enfoque da lugar a una [persistencia políglota](https://martinfowler.com/bliki/PolyglotPersistence.html), es decir, el uso de varias tecnologías de almacenamiento de datos dentro de una única aplicación.</span><span class="sxs-lookup"><span data-stu-id="3e043-114">This approach naturally leads to [polyglot persistence](https://martinfowler.com/bliki/PolyglotPersistence.html) &mdash; the use of multiple data storage technologies within a single application.</span></span> <span data-ttu-id="3e043-115">Un servicio podría necesitar las funcionalidades de lectura de esquema de una base de datos de documento.</span><span class="sxs-lookup"><span data-stu-id="3e043-115">One service might require the schema-on-read capabilities of a document database.</span></span> <span data-ttu-id="3e043-116">Otro podría requerir la integridad referencial que proporciona un RDBMS.</span><span class="sxs-lookup"><span data-stu-id="3e043-116">Another might need the referential integrity provided by an RDBMS.</span></span> <span data-ttu-id="3e043-117">Cada equipo tiene libertad para elegir la mejor opción para su servicio.</span><span class="sxs-lookup"><span data-stu-id="3e043-117">Each team is free to make the best choice for their service.</span></span> <span data-ttu-id="3e043-118">Para más información sobre el principio general de la persistencia políglota, consulte [Uso del mejor almacén de datos para el trabajo](../guide/design-principles/use-the-best-data-store.md).</span><span class="sxs-lookup"><span data-stu-id="3e043-118">For more about the general principle of polyglot persistence, see [Use the best data store for the job](../guide/design-principles/use-the-best-data-store.md).</span></span> 

> [!NOTE]
> <span data-ttu-id="3e043-119">Es apropiado para servicios que comparten el mismo servidor de base de datos físico.</span><span class="sxs-lookup"><span data-stu-id="3e043-119">It's fine for services to share the same physical database server.</span></span> <span data-ttu-id="3e043-120">El problema se produce cuando los servicios comparten el mismo esquema, o leen y escriben en el mismo conjunto de tablas de base de datos.</span><span class="sxs-lookup"><span data-stu-id="3e043-120">The problem occurs when services share the same schema, or read and write to the same set of database tables.</span></span>


## <a name="challenges"></a><span data-ttu-id="3e043-121">Desafíos</span><span class="sxs-lookup"><span data-stu-id="3e043-121">Challenges</span></span>

<span data-ttu-id="3e043-122">Este enfoque distribuido de administración de datos plantea algunos desafíos.</span><span class="sxs-lookup"><span data-stu-id="3e043-122">Some challenges arise from this distributed approach to managing data.</span></span> <span data-ttu-id="3e043-123">En primer lugar, puede haber redundancia a través de los almacenes de datos, con el mismo elemento de datos que aparece en varios lugares.</span><span class="sxs-lookup"><span data-stu-id="3e043-123">First, there may be redundancy across the data stores, with the same item of data appearing in multiple places.</span></span> <span data-ttu-id="3e043-124">Por ejemplo, se podrían almacenar los datos como parte de una transacción y, a continuación, almacenarse en otra ubicación para análisis, creación de informes o para archivarse.</span><span class="sxs-lookup"><span data-stu-id="3e043-124">For example, data might be stored as part of a transaction, then stored elsewhere for analytics, reporting, or archiving.</span></span> <span data-ttu-id="3e043-125">Los datos duplicados o con particiones pueden provocar problemas de coherencia e integridad de los datos.</span><span class="sxs-lookup"><span data-stu-id="3e043-125">Duplicated or partitioned data can lead to issues of data integrity and consistency.</span></span> <span data-ttu-id="3e043-126">Cuando las relaciones entre los datos abarcan varios servicios, no puede usar técnicas de administración de datos tradicionales para hacer que se cumplan las relaciones.</span><span class="sxs-lookup"><span data-stu-id="3e043-126">When data relationships span multiple services, you can't use traditional data management techniques to enforce the relationships.</span></span>

<span data-ttu-id="3e043-127">El modelado de datos tradicional usa la regla "un hecho en un solo lugar".</span><span class="sxs-lookup"><span data-stu-id="3e043-127">Traditional data modeling uses the rule of "one fact in one place."</span></span> <span data-ttu-id="3e043-128">Todas las entidades aparecen exactamente una vez en el esquema.</span><span class="sxs-lookup"><span data-stu-id="3e043-128">Every entity appears exactly once in the schema.</span></span> <span data-ttu-id="3e043-129">Otras entidades pueden contener referencias a él, pero no lo duplican.</span><span class="sxs-lookup"><span data-stu-id="3e043-129">Other entities may hold references to it but not duplicate it.</span></span> <span data-ttu-id="3e043-130">La ventaja obvia respecto al enfoque tradicional es que las actualizaciones se realizan en un único lugar, lo que evita problemas de coherencia de los datos.</span><span class="sxs-lookup"><span data-stu-id="3e043-130">The obvious advantage to the traditional approach is that updates are made in a single place, which avoids problems with data consistency.</span></span> <span data-ttu-id="3e043-131">En una arquitectura de microservicios, debe tener en cuenta cómo se propagan las actualizaciones a través de los servicios y cómo administrar la posible coherencia cuando los datos aparecen en varios lugares sin una coherencia fuerte.</span><span class="sxs-lookup"><span data-stu-id="3e043-131">In a microservices architecture, you have to consider how updates are propagated across services, and how to manage eventual consistency when data appears in multiple places without strong consistency.</span></span> 

## <a name="approaches-to-managing-data"></a><span data-ttu-id="3e043-132">Enfoques para la administración de datos</span><span class="sxs-lookup"><span data-stu-id="3e043-132">Approaches to managing data</span></span>

<span data-ttu-id="3e043-133">No existe un enfoque único que sea correcto en todos los casos, pero estas son algunas directrices generales para administrar los datos en una arquitectura de microservicios.</span><span class="sxs-lookup"><span data-stu-id="3e043-133">There is no single approach that's correct in all cases, but here are some general guidelines for managing data in a microservices architecture.</span></span>

- <span data-ttu-id="3e043-134">Adopte una coherencia final cuando sea posible.</span><span class="sxs-lookup"><span data-stu-id="3e043-134">Embrace eventual consistency where possible.</span></span> <span data-ttu-id="3e043-135">Conozca los lugares del sistema en los que necesita una coherencia estricta o transacciones ACID, y los lugares donde la posible coherencia es aceptable.</span><span class="sxs-lookup"><span data-stu-id="3e043-135">Understand the places in the system where you need strong consistency or ACID transactions, and the places where eventual consistency is acceptable.</span></span>

- <span data-ttu-id="3e043-136">Cuando se necesitan garantías de coherencia estricta, un servicio puede representar el origen de confianza de una entidad determinada, que se expone a través de una API.</span><span class="sxs-lookup"><span data-stu-id="3e043-136">When you need strong consistency guarantees, one service may represent the source of truth for a given entity, which is exposed through an API.</span></span> <span data-ttu-id="3e043-137">Otros servicios podrían mantener su propia copia de los datos, o un subconjunto de los datos, que posiblemente es coherente con los datos maestros pero no se considera el origen de confianza.</span><span class="sxs-lookup"><span data-stu-id="3e043-137">Other services might hold their own copy of the data, or a subset of the data, that is eventually consistent with the master data but not considered the source of truth.</span></span> <span data-ttu-id="3e043-138">Por ejemplo, imagine un sistema de comercio electrónico con un servicio de pedidos de cliente y un servicio de recomendaciones.</span><span class="sxs-lookup"><span data-stu-id="3e043-138">For example, imagine an e-commerce system with a customer order service and a recommendation service.</span></span> <span data-ttu-id="3e043-139">El servicio de recomendaciones podría escuchar los eventos del servicio de pedidos pero, si un cliente solicita un reembolso, es el servicio de pedidos y no el servicio de recomendaciones el que tiene el historial completo de la transacción.</span><span class="sxs-lookup"><span data-stu-id="3e043-139">The recommendation service might listen to events from the order service, but if a customer requests a refund, it is the order service, not the recommendation service, that has the complete transaction history.</span></span>

- <span data-ttu-id="3e043-140">Para las transacciones, use patrones como [Scheduler Agent Supervisor](../patterns/scheduler-agent-supervisor.md) (Supervisor del agente de Scheduler) y [Compensating Transaction](../patterns/compensating-transaction.md) (Transacción de compensación) para mantener la coherencia de los datos entre varios servicios.</span><span class="sxs-lookup"><span data-stu-id="3e043-140">For transactions, use patterns such as [Scheduler Agent Supervisor](../patterns/scheduler-agent-supervisor.md) and [Compensating Transaction](../patterns/compensating-transaction.md) to keep data consistent across several services.</span></span>  <span data-ttu-id="3e043-141">Debe almacenar una parte adicional de los datos que capturan el estado de una unidad de trabajo que abarca varios servicios con el fin de evitar este error parcial entre varios servicios.</span><span class="sxs-lookup"><span data-stu-id="3e043-141">You may need to store an additional piece of data that captures the state of a unit of work that spans multiple services, to avoid partial failure among multiple services.</span></span> <span data-ttu-id="3e043-142">Por ejemplo, mantenga un elemento de trabajo en una cola duradera mientras una transacción de varios pasos está en curso.</span><span class="sxs-lookup"><span data-stu-id="3e043-142">For example, keep a work item on a durable queue while a multi-step transaction is in progress.</span></span> 

- <span data-ttu-id="3e043-143">Almacene únicamente los datos que necesita un servicio.</span><span class="sxs-lookup"><span data-stu-id="3e043-143">Store only the data that a service needs.</span></span> <span data-ttu-id="3e043-144">Un servicio podría necesitar únicamente un subconjunto de información acerca de una entidad del dominio.</span><span class="sxs-lookup"><span data-stu-id="3e043-144">A service might only need a subset of information about a domain entity.</span></span> <span data-ttu-id="3e043-145">Por ejemplo, en el contexto limitado de envío, es necesario saber qué cliente está asociado a una entrega determinada.</span><span class="sxs-lookup"><span data-stu-id="3e043-145">For example, in the Shipping bounded context, we need to know which customer is associated to a particular delivery.</span></span> <span data-ttu-id="3e043-146">Pero no se necesita la dirección de facturación del cliente; eso lo administra el contexto delimitado de cuentas.</span><span class="sxs-lookup"><span data-stu-id="3e043-146">But we don't need the customer's billing address &mdash; that's managed by the Accounts bounded context.</span></span> <span data-ttu-id="3e043-147">Pensar detenidamente en el dominio y usar un enfoque DDD pueden ayudar en este punto.</span><span class="sxs-lookup"><span data-stu-id="3e043-147">Thinking carefully about the domain, and using a DDD approach, can help here.</span></span> 

- <span data-ttu-id="3e043-148">Tenga en cuenta si los servicios son coherentes y con acoplamiento flexible.</span><span class="sxs-lookup"><span data-stu-id="3e043-148">Consider whether your services are coherent and loosely coupled.</span></span> <span data-ttu-id="3e043-149">Si dos servicios intercambian información entre sí continuamente, dando lugar a API "conversadoras", deberá volver a dibujar los límites del servicio mediante la combinación de dos servicios o la refactorización de su funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="3e043-149">If two services are continually exchanging information with each other, resulting in chatty APIs, you may need to redraw your service boundaries, by merging two services or refactoring their functionality.</span></span>

- <span data-ttu-id="3e043-150">Utilice un [estilo de arquitectura basado en eventos](../guide/architecture-styles/event-driven.md).</span><span class="sxs-lookup"><span data-stu-id="3e043-150">Use an [event driven architecture style](../guide/architecture-styles/event-driven.md).</span></span> <span data-ttu-id="3e043-151">En este estilo de arquitectura, un servicio publica un evento cuando hay cambios en sus entidades o modelos públicos.</span><span class="sxs-lookup"><span data-stu-id="3e043-151">In this architecture style, a service publishes an event when there are changes to its public models or entities.</span></span> <span data-ttu-id="3e043-152">Los servicios interesados pueden suscribirse a estos eventos.</span><span class="sxs-lookup"><span data-stu-id="3e043-152">Interested services can subscribe to these events.</span></span> <span data-ttu-id="3e043-153">Por ejemplo, otro servicio puede utilizar los eventos para crear una vista materializada de los datos que son más adecuados para realizar consultas.</span><span class="sxs-lookup"><span data-stu-id="3e043-153">For example, another service could use the events to construct a materialized view of the data that is more suitable for querying.</span></span> 

- <span data-ttu-id="3e043-154">Un servicio que posee eventos debe publicar un esquema que pueda utilizarse para automatizar la serialización y deserialización de los eventos para evitar el acoplamiento rígido entre los anunciantes y los suscriptores.</span><span class="sxs-lookup"><span data-stu-id="3e043-154">A service that owns events should publish a schema that can be used to automate serializing and deserializing the events, to avoid tight coupling between publishers and subscribers.</span></span> <span data-ttu-id="3e043-155">Considere la posibilidad de usar un esquema JSON o un marco de trabajo como [Microsoft Bond](https://github.com/Microsoft/bond), Protobuf o Avro.</span><span class="sxs-lookup"><span data-stu-id="3e043-155">Consider JSON schema or a framework like [Microsoft Bond](https://github.com/Microsoft/bond), Protobuf, or Avro.</span></span>  
 
- <span data-ttu-id="3e043-156">A gran escala, los eventos pueden convertirse en un cuello de botella en el sistema, por lo que puede plantearse usar la agregación o el procesamiento por lotes para reducir la carga total.</span><span class="sxs-lookup"><span data-stu-id="3e043-156">At high scale, events can become a bottleneck on the system, so consider using aggregation or batching to reduce the total load.</span></span> 

## <a name="drone-delivery-choosing-the-data-stores"></a><span data-ttu-id="3e043-157">Drone Delivery: Elección de los almacenes de datos</span><span class="sxs-lookup"><span data-stu-id="3e043-157">Drone Delivery: Choosing the data stores</span></span> 

<span data-ttu-id="3e043-158">Incluso con solo unos pocos servicios, el contexto limitado de envío muestra algunos de los puntos que se tratan en esta sección.</span><span class="sxs-lookup"><span data-stu-id="3e043-158">Even with only a few services, the Shipping bounded context illustrates several of the points discussed in this section.</span></span> 

<span data-ttu-id="3e043-159">Cuando un usuario programa una entrega nueva, la solicitud del cliente incluye la información sobre el envío, como las ubicaciones de recogida y entrega, y otros aspectos acerca del paquete, como su tamaño y peso.</span><span class="sxs-lookup"><span data-stu-id="3e043-159">When a user schedules a new delivery, the client request includes information about the both the delivery, such as the pickup and dropoff locations, and about the package, such as the size and weight.</span></span> <span data-ttu-id="3e043-160">Esta información define una unidad de trabajo que el servicio de ingesta de datos envía a Event Hubs.</span><span class="sxs-lookup"><span data-stu-id="3e043-160">This information defines a unit of work, which the Ingestion service sends to Event Hubs.</span></span> <span data-ttu-id="3e043-161">Es importante que la unidad de trabajo permanezca en el almacenamiento persistente mientras el servicio Scheduler ejecuta el flujo de trabajo, con el fin de que no se pierda ninguna solicitud de entrega.</span><span class="sxs-lookup"><span data-stu-id="3e043-161">It's important that the unit of work stays in persistent storage while the Scheduler service is executing the workflow, so that no delivery requests are lost.</span></span> <span data-ttu-id="3e043-162">Para más información sobre el flujo de trabajo, consulte [Ingesta de datos y flujo de trabajo](./ingestion-workflow.md).</span><span class="sxs-lookup"><span data-stu-id="3e043-162">For more discussion of the workflow, see [Ingestion and workflow](./ingestion-workflow.md).</span></span> 

<span data-ttu-id="3e043-163">Los diversos servicios back-end se ocupan de las diferentes partes de la información en la solicitud, y también cuentan con diferentes perfiles de lectura y escritura.</span><span class="sxs-lookup"><span data-stu-id="3e043-163">The various backend services care about different portions of the information in the request, and also have different read and write profiles.</span></span> 

### <a name="delivery-service"></a><span data-ttu-id="3e043-164">Servicio de entrega</span><span class="sxs-lookup"><span data-stu-id="3e043-164">Delivery service</span></span>

<span data-ttu-id="3e043-165">El servicio de entrega almacena información acerca de cada entrega que actualmente está programada o en curso.</span><span class="sxs-lookup"><span data-stu-id="3e043-165">The Delivery service stores information about every delivery that is currently scheduled or in progress.</span></span> <span data-ttu-id="3e043-166">Escucha los eventos de los drones y realiza un seguimiento del estado de las entregas que están en curso.</span><span class="sxs-lookup"><span data-stu-id="3e043-166">It listens for events from the drones, and tracks the status of deliveries that are in progress.</span></span> <span data-ttu-id="3e043-167">También envía eventos de dominio con actualizaciones del estado de entrega.</span><span class="sxs-lookup"><span data-stu-id="3e043-167">It also sends domain events with delivery status updates.</span></span>

<span data-ttu-id="3e043-168">Se espera que los usuarios comprueben con frecuencia el estado de una entrega mientras esperan la llegada de su paquete.</span><span class="sxs-lookup"><span data-stu-id="3e043-168">It's expected that users will frequently check the status of a delivery while they are waiting for their package.</span></span> <span data-ttu-id="3e043-169">Por lo tanto, el servicio de entrega requiere un almacén de datos que enfatice el rendimiento (lectura y escritura) durante el almacenamiento a largo plazo.</span><span class="sxs-lookup"><span data-stu-id="3e043-169">Therefore, the Delivery service requires a data store that emphasizes throughput (read and write) over long-term storage.</span></span> <span data-ttu-id="3e043-170">Además, el servicio de entrega no lleva a cabo las consultas o los análisis complejos, simplemente captura el estado más reciente de una entrega determinada.</span><span class="sxs-lookup"><span data-stu-id="3e043-170">Also, the Delivery service does not perform any complex queries or analysis, it simply fetches the latest status for a given delivery.</span></span> <span data-ttu-id="3e043-171">El equipo del servicio de entrega eligió Azure Redis Cache por su alto rendimiento de lectura y escritura.</span><span class="sxs-lookup"><span data-stu-id="3e043-171">The Delivery service team chose Azure Redis Cache for its high read-write performance.</span></span> <span data-ttu-id="3e043-172">La información almacenada en Redis es de una duración relativamente corta.</span><span class="sxs-lookup"><span data-stu-id="3e043-172">The information stored in Redis is relatively short-lived.</span></span> <span data-ttu-id="3e043-173">Una vez completada una entrega, el servicio del historial de entrega es el sistema de registro.</span><span class="sxs-lookup"><span data-stu-id="3e043-173">Once a delivery is complete, the Delivery History service is the system of record.</span></span>

### <a name="delivery-history-service"></a><span data-ttu-id="3e043-174">Servicio del historial de entrega</span><span class="sxs-lookup"><span data-stu-id="3e043-174">Delivery History service</span></span>

<span data-ttu-id="3e043-175">El servicio del historial de entrega escucha los eventos de estado de entrega del servicio de entrega.</span><span class="sxs-lookup"><span data-stu-id="3e043-175">The Delivery History service listens for delivery status events from the Delivery service.</span></span> <span data-ttu-id="3e043-176">Almacena estos datos en el almacenamiento a largo plazo.</span><span class="sxs-lookup"><span data-stu-id="3e043-176">It stores this data in long-term storage.</span></span> <span data-ttu-id="3e043-177">Hay dos casos de uso diferentes para estos datos históricos, que tienen diversos requisitos de almacenamiento de datos.</span><span class="sxs-lookup"><span data-stu-id="3e043-177">There are two different use-cases for this historical data, which have different data storage requirements.</span></span> 

<span data-ttu-id="3e043-178">El primer escenario es agregar los datos para analizarlos, con el fin de optimizar el negocio o mejorar la calidad del servicio.</span><span class="sxs-lookup"><span data-stu-id="3e043-178">The first scenario is aggregating the data for the purpose of data analytics, in order to optimize the business or improve the quality of the service.</span></span> <span data-ttu-id="3e043-179">Tenga en cuenta que el servicio del historial de entrega no realiza el análisis real de los datos.</span><span class="sxs-lookup"><span data-stu-id="3e043-179">Note that the Delivery History service doesn't perform the actual analysis of the data.</span></span> <span data-ttu-id="3e043-180">Solo es responsable de la ingesta de datos y el almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="3e043-180">It's only responsible for the ingestion and storage.</span></span> <span data-ttu-id="3e043-181">En este escenario, se debe optimizar el almacenamiento para el análisis de datos a través de un conjunto grande de datos mediante un enfoque de lectura de esquema para dar cabida a una variedad de orígenes de datos.</span><span class="sxs-lookup"><span data-stu-id="3e043-181">For this scenario, the storage must be optimized for data analysis over a large set of data, using a schema-on-read approach to accommodate a variety of data sources.</span></span> <span data-ttu-id="3e043-182">[Azure Data Lake Store](/azure/data-lake-store/) es una buena elección para este escenario.</span><span class="sxs-lookup"><span data-stu-id="3e043-182">[Azure Data Lake Store](/azure/data-lake-store/) is a good fit for this scenario.</span></span> <span data-ttu-id="3e043-183">Data Lake Store es un sistema de archivos de Apache Hadoop compatible con el sistema de archivos distribuido de Hadoop (HDFS) y optimizado para obtener rendimiento en escenarios de análisis de datos.</span><span class="sxs-lookup"><span data-stu-id="3e043-183">Data Lake Store is an Apache Hadoop file system compatible with Hadoop Distributed File System (HDFS), and is tuned for performance for data analytics scenarios.</span></span> 

<span data-ttu-id="3e043-184">El otro escenario es permitir que los usuarios busquen el historial de una entrega una vez que se haya completado.</span><span class="sxs-lookup"><span data-stu-id="3e043-184">The other scenario is enabling users to look up the history of a delivery after the delivery is completed.</span></span> <span data-ttu-id="3e043-185">Azure Data Lake no está optimizado especialmente para este escenario.</span><span class="sxs-lookup"><span data-stu-id="3e043-185">Azure Data Lake is not particularly optimized for this scenario.</span></span> <span data-ttu-id="3e043-186">Para obtener un rendimiento óptimo, Microsoft recomienda almacenar los datos de serie temporal en Data Lake, en carpetas con particiones por fecha.</span><span class="sxs-lookup"><span data-stu-id="3e043-186">For optimal performance, Microsoft recommends storing time-series data in Data Lake in folders partitioned by date.</span></span> <span data-ttu-id="3e043-187">(Consulte [Ajuste del rendimiento de Azure Data Lake Store](/azure/data-lake-store/data-lake-store-performance-tuning-guidance)).</span><span class="sxs-lookup"><span data-stu-id="3e043-187">(See [Tuning Azure Data Lake Store for performance](/azure/data-lake-store/data-lake-store-performance-tuning-guidance)).</span></span> <span data-ttu-id="3e043-188">Sin embargo, esa estructura no es óptima para buscar los registros individuales por identificador.</span><span class="sxs-lookup"><span data-stu-id="3e043-188">However, that structure is not optimal for looking up individual records by ID.</span></span> <span data-ttu-id="3e043-189">A menos que también se conozca la marca de tiempo, una búsqueda por identificador requiere examinar toda la colección.</span><span class="sxs-lookup"><span data-stu-id="3e043-189">Unless you also know the timestamp, a lookup by ID requires scanning the entire collection.</span></span> <span data-ttu-id="3e043-190">Por lo tanto, el servicio del historial de entrega también almacena un subconjunto de los datos históricos en Cosmos DB para una búsqueda rápida.</span><span class="sxs-lookup"><span data-stu-id="3e043-190">Therefore, the Delivery History service also stores a subset of the historical data in Cosmos DB for quicker lookup.</span></span> <span data-ttu-id="3e043-191">Los registros no deben permanecer en Cosmos DB indefinidamente.</span><span class="sxs-lookup"><span data-stu-id="3e043-191">The records don't need to stay in Cosmos DB indefinitely.</span></span> <span data-ttu-id="3e043-192">Las entregas anteriores se pueden archivar &mdash; por ejemplo, después de un mes.</span><span class="sxs-lookup"><span data-stu-id="3e043-192">Older deliveries can be archived &mdash; say, after a month.</span></span> <span data-ttu-id="3e043-193">Puede hacerse mediante la ejecución de un proceso por lotes ocasionales.</span><span class="sxs-lookup"><span data-stu-id="3e043-193">This could be done by running an occasional batch process.</span></span>

### <a name="package-service"></a><span data-ttu-id="3e043-194">Servicio de paquete</span><span class="sxs-lookup"><span data-stu-id="3e043-194">Package service</span></span>

<span data-ttu-id="3e043-195">El servicio de paquete almacena información sobre todos los paquetes.</span><span class="sxs-lookup"><span data-stu-id="3e043-195">The Package service stores information about all of the packages.</span></span> <span data-ttu-id="3e043-196">Los requisitos de almacenamiento para el paquete son:</span><span class="sxs-lookup"><span data-stu-id="3e043-196">The storage requirements for the Package are:</span></span> 

- <span data-ttu-id="3e043-197">Almacenamiento a largo plazo.</span><span class="sxs-lookup"><span data-stu-id="3e043-197">Long-term storage.</span></span>
- <span data-ttu-id="3e043-198">Puede controlar un gran volumen de paquetes, para ello necesitará un rendimiento de escritura alto.</span><span class="sxs-lookup"><span data-stu-id="3e043-198">Able to handle a high volume of packages, requiring high write throughput.</span></span>
- <span data-ttu-id="3e043-199">Compatibilidad con consultas sencillas con el identificador del paquete.</span><span class="sxs-lookup"><span data-stu-id="3e043-199">Support simple queries by package ID.</span></span> <span data-ttu-id="3e043-200">No hay combinaciones complejas o requisitos para la integridad referencial.</span><span class="sxs-lookup"><span data-stu-id="3e043-200">No complex joins or requirements for referential integrity.</span></span>

<span data-ttu-id="3e043-201">Dado que los datos del paquete no son relacionales, es adecuada una base de datos orientada a documento, y Cosmos DB puede lograr un rendimiento muy alto mediante el uso de colecciones con particiones.</span><span class="sxs-lookup"><span data-stu-id="3e043-201">Because the package data is not relational, a document oriented database is appropriate, and Cosmos DB can achieve very high throughput by using sharded collections.</span></span> <span data-ttu-id="3e043-202">El equipo que funciona en el servicio de paquete está familiarizado con la pila MEAN (MongoDB, Express.js, AngularJS y Node.js), por lo que seleccionan la [API de MongoDB](/azure/cosmos-db/mongodb-introduction) para Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="3e043-202">The team that works on the Package service is familiar with the MEAN stack (MongoDB, Express.js, AngularJS, and Node.js), so they select the [MongoDB API](/azure/cosmos-db/mongodb-introduction) for Cosmos DB.</span></span> <span data-ttu-id="3e043-203">Les permite aprovechar su experiencia existente con MongoDB, al mismo tiempo que obtienen las ventajas de Cosmos DB, que es un servicio administrado de Azure.</span><span class="sxs-lookup"><span data-stu-id="3e043-203">That lets them leverage their existing experience with MongoDB, while getting the benefits of Cosmos DB, which is a managed Azure service.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="3e043-204">Comunicación entre servicios</span><span class="sxs-lookup"><span data-stu-id="3e043-204">Interservice communication</span></span>](./interservice-communication.md)