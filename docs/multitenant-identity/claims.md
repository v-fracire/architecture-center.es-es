---
title: Uso de identidades basadas en notificaciones en aplicaciones multiinquilino
description: Uso de las notificaciones para la autorización y validación del emisor
author: MikeWasson
ms:date: 07/21/2017
pnp.series.title: Manage Identity in Multitenant Applications
pnp.series.prev: authenticate
pnp.series.next: signup
ms.openlocfilehash: 46c43c9bfa4514f206b5e7eabd9223ad4c61628b
ms.sourcegitcommit: 94d50043db63416c4d00cebe927a0c88f78c3219
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 09/28/2018
ms.locfileid: "47429384"
---
# <a name="work-with-claims-based-identities"></a><span data-ttu-id="9d3cf-103">Uso de identidades basadas en notificaciones</span><span class="sxs-lookup"><span data-stu-id="9d3cf-103">Work with claims-based identities</span></span>

<span data-ttu-id="9d3cf-104">[![GitHub](../_images/github.png) Código de ejemplo][sample application]</span><span class="sxs-lookup"><span data-stu-id="9d3cf-104">[![GitHub](../_images/github.png) Sample code][sample application]</span></span>

## <a name="claims-in-azure-ad"></a><span data-ttu-id="9d3cf-105">Notificaciones en Azure AD</span><span class="sxs-lookup"><span data-stu-id="9d3cf-105">Claims in Azure AD</span></span>
<span data-ttu-id="9d3cf-106">Cuando un usuario inicia sesión, Azure AD envía un token de identificador que contiene un conjunto de notificaciones sobre el usuario.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-106">When a user signs in, Azure AD sends an ID token that contains a set of claims about the user.</span></span> <span data-ttu-id="9d3cf-107">Una notificación es simplemente un fragmento de información que se expresa como un par clave-valor.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-107">A claim is simply a piece of information, expressed as a key/value pair.</span></span> <span data-ttu-id="9d3cf-108">Por ejemplo, `email`=`bob@contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-108">For example, `email`=`bob@contoso.com`.</span></span>  <span data-ttu-id="9d3cf-109">Las notificaciones tienen un emisor &mdash; en este caso, Azure AD &mdash; que es la entidad que autentica al usuario y crea las notificaciones.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-109">Claims have an issuer &mdash; in this case, Azure AD &mdash; which is the entity that authenticates the user and creates the claims.</span></span> <span data-ttu-id="9d3cf-110">Usted confía en las notificaciones porque confía en el emisor.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-110">You trust the claims because you trust the issuer.</span></span> <span data-ttu-id="9d3cf-111">(Y a la inversa, ¡si no confía en el emisor, no confía en las notificaciones!)</span><span class="sxs-lookup"><span data-stu-id="9d3cf-111">(Conversely, if you don't trust the issuer, don't trust the claims!)</span></span>

<span data-ttu-id="9d3cf-112">En un alto nivel:</span><span class="sxs-lookup"><span data-stu-id="9d3cf-112">At a high level:</span></span>

1. <span data-ttu-id="9d3cf-113">El usuario autentica.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-113">The user authenticates.</span></span>
2. <span data-ttu-id="9d3cf-114">El IDP envía un conjunto de notificaciones.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-114">The IDP sends a set of claims.</span></span>
3. <span data-ttu-id="9d3cf-115">La aplicación normaliza o aumenta las notificaciones (opcionales).</span><span class="sxs-lookup"><span data-stu-id="9d3cf-115">The app normalizes or augments the claims (optional).</span></span>
4. <span data-ttu-id="9d3cf-116">La aplicación usa las notificaciones para tomar decisiones de autorización.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-116">The app uses the claims to make authorization decisions.</span></span>

<span data-ttu-id="9d3cf-117">En OpenID Connect, el [parámetro de ámbito] de la solicitud de autenticación controla el conjunto de notificaciones que se obtienen.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-117">In OpenID Connect, the set of claims that you get is controlled by the [scope parameter] of the authentication request.</span></span> <span data-ttu-id="9d3cf-118">Sin embargo, Azure AD emite un conjunto limitado de notificaciones a través de OpenID Connect; vea [Tipos de notificaciones y tokens admitidos].</span><span class="sxs-lookup"><span data-stu-id="9d3cf-118">However, Azure AD issues a limited set of claims through OpenID Connect; see [Supported Token and Claim Types].</span></span> <span data-ttu-id="9d3cf-119">Si desea obtener más información sobre el usuario, debe usar Graph API de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-119">If you want more information about the user, you'll need to use the Azure AD Graph API.</span></span>

<span data-ttu-id="9d3cf-120">Estas son algunas de las notificaciones de AAD de las que normalmente podría encargarse una aplicación:</span><span class="sxs-lookup"><span data-stu-id="9d3cf-120">Here are some of the claims from AAD that an app might typically care about:</span></span>

| <span data-ttu-id="9d3cf-121">Tipo de notificación en el token de identificador.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-121">Claim type in ID token</span></span> | <span data-ttu-id="9d3cf-122">DESCRIPCIÓN</span><span class="sxs-lookup"><span data-stu-id="9d3cf-122">Description</span></span> |
| --- | --- |
| <span data-ttu-id="9d3cf-123">aud</span><span class="sxs-lookup"><span data-stu-id="9d3cf-123">aud</span></span> |<span data-ttu-id="9d3cf-124">Para quién se emitió el token.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-124">Who the token was issued for.</span></span> <span data-ttu-id="9d3cf-125">Será el identificador de cliente de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-125">This will be the application's client ID.</span></span> <span data-ttu-id="9d3cf-126">Por lo general, no es necesario preocuparse por esta notificación porque el middleware la valida automáticamente.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-126">Generally, you shouldn't need to worry about this claim, because the middleware automatically validates it.</span></span> <span data-ttu-id="9d3cf-127">Ejemplo: `"91464657-d17a-4327-91f3-2ed99386406f"`</span><span class="sxs-lookup"><span data-stu-id="9d3cf-127">Example:  `"91464657-d17a-4327-91f3-2ed99386406f"`</span></span> |
| <span data-ttu-id="9d3cf-128">groups</span><span class="sxs-lookup"><span data-stu-id="9d3cf-128">groups</span></span> |<span data-ttu-id="9d3cf-129">Una lista de grupos de AAD de los que el usuario es miembro.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-129">A list of AAD groups of which the user is a member.</span></span> <span data-ttu-id="9d3cf-130">Ejemplo: `["93e8f556-8661-4955-87b6-890bc043c30f", "fc781505-18ef-4a31-a7d5-7d931d7b857e"]`</span><span class="sxs-lookup"><span data-stu-id="9d3cf-130">Example: `["93e8f556-8661-4955-87b6-890bc043c30f", "fc781505-18ef-4a31-a7d5-7d931d7b857e"]`</span></span> |
| <span data-ttu-id="9d3cf-131">iss</span><span class="sxs-lookup"><span data-stu-id="9d3cf-131">iss</span></span> |<span data-ttu-id="9d3cf-132">El [emisor] del token OIDC.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-132">The [issuer] of the OIDC token.</span></span> <span data-ttu-id="9d3cf-133">Ejemplo: `https://sts.windows.net/b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4/`</span><span class="sxs-lookup"><span data-stu-id="9d3cf-133">Example: `https://sts.windows.net/b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4/`</span></span> |
| <span data-ttu-id="9d3cf-134">Nombre</span><span class="sxs-lookup"><span data-stu-id="9d3cf-134">name</span></span> |<span data-ttu-id="9d3cf-135">Nombre para mostrar del usuario.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-135">The user's display name.</span></span> <span data-ttu-id="9d3cf-136">Ejemplo: `"Alice A."`</span><span class="sxs-lookup"><span data-stu-id="9d3cf-136">Example: `"Alice A."`</span></span> |
| <span data-ttu-id="9d3cf-137">oid</span><span class="sxs-lookup"><span data-stu-id="9d3cf-137">oid</span></span> |<span data-ttu-id="9d3cf-138">El identificador de objeto para el usuario en AAD.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-138">The object identifier for the user in AAD.</span></span> <span data-ttu-id="9d3cf-139">Este valor es el identificador inmutable y no reutilizable del usuario.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-139">This value is the immutable and non-reusable identifier of the user.</span></span> <span data-ttu-id="9d3cf-140">Utilice este valor, no el correo electrónico, como un identificador único para los usuarios; las direcciones de correo electrónico pueden cambiar.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-140">Use this value, not email, as a unique identifier for users; email addresses can change.</span></span> <span data-ttu-id="9d3cf-141">Si utiliza Graph API de Azure AD en su aplicación, el identificador de objeto es el valor que se usa para consultar la información de perfil.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-141">If you use the Azure AD Graph API in your app, object ID is that value used to query profile information.</span></span> <span data-ttu-id="9d3cf-142">Ejemplo: `"59f9d2dc-995a-4ddf-915e-b3bb314a7fa4"`</span><span class="sxs-lookup"><span data-stu-id="9d3cf-142">Example: `"59f9d2dc-995a-4ddf-915e-b3bb314a7fa4"`</span></span> |
| <span data-ttu-id="9d3cf-143">roles</span><span class="sxs-lookup"><span data-stu-id="9d3cf-143">roles</span></span> |<span data-ttu-id="9d3cf-144">Una lista de roles de aplicación para el usuario.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-144">A list of app roles for the user.</span></span>    <span data-ttu-id="9d3cf-145">Ejemplo: `["SurveyCreator"]`</span><span class="sxs-lookup"><span data-stu-id="9d3cf-145">Example: `["SurveyCreator"]`</span></span> |
| <span data-ttu-id="9d3cf-146">tid</span><span class="sxs-lookup"><span data-stu-id="9d3cf-146">tid</span></span> |<span data-ttu-id="9d3cf-147">Identificador de inquilino.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-147">Tenant ID.</span></span> <span data-ttu-id="9d3cf-148">Este valor es un identificador único para el inquilino en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-148">This value is a unique identifier for the tenant in Azure AD.</span></span> <span data-ttu-id="9d3cf-149">Ejemplo: `"b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4"`</span><span class="sxs-lookup"><span data-stu-id="9d3cf-149">Example: `"b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4"`</span></span> |
| <span data-ttu-id="9d3cf-150">unique_name</span><span class="sxs-lookup"><span data-stu-id="9d3cf-150">unique_name</span></span> |<span data-ttu-id="9d3cf-151">Un nombre del usuario para mostrar en lenguaje natural.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-151">A human readable display name of the user.</span></span> <span data-ttu-id="9d3cf-152">Ejemplo: `"alice@contoso.com"`</span><span class="sxs-lookup"><span data-stu-id="9d3cf-152">Example: `"alice@contoso.com"`</span></span> |
| <span data-ttu-id="9d3cf-153">upn</span><span class="sxs-lookup"><span data-stu-id="9d3cf-153">upn</span></span> |<span data-ttu-id="9d3cf-154">Nombre principal de usuario.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-154">User principal name.</span></span> <span data-ttu-id="9d3cf-155">Ejemplo: `"alice@contoso.com"`</span><span class="sxs-lookup"><span data-stu-id="9d3cf-155">Example: `"alice@contoso.com"`</span></span> |

<span data-ttu-id="9d3cf-156">Esta tabla enumera los tipos de notificación tal y como aparecen en el token de identificador.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-156">This table lists the claim types as they appear in the ID token.</span></span> <span data-ttu-id="9d3cf-157">En ASP.NET Core, el middleware OpenID Connect convierte algunos de los tipos de notificación cuando rellena la colección de notificaciones para la entidad de seguridad de usuario:</span><span class="sxs-lookup"><span data-stu-id="9d3cf-157">In ASP.NET Core, the OpenID Connect middleware converts some of the claim types when it populates the Claims collection for the user principal:</span></span>

* <span data-ttu-id="9d3cf-158">oid > `http://schemas.microsoft.com/identity/claims/objectidentifier`</span><span class="sxs-lookup"><span data-stu-id="9d3cf-158">oid > `http://schemas.microsoft.com/identity/claims/objectidentifier`</span></span>
* <span data-ttu-id="9d3cf-159">tid > `http://schemas.microsoft.com/identity/claims/tenantid`</span><span class="sxs-lookup"><span data-stu-id="9d3cf-159">tid > `http://schemas.microsoft.com/identity/claims/tenantid`</span></span>
* <span data-ttu-id="9d3cf-160">unique_name > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name`</span><span class="sxs-lookup"><span data-stu-id="9d3cf-160">unique_name > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name`</span></span>
* <span data-ttu-id="9d3cf-161">upn > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn`</span><span class="sxs-lookup"><span data-stu-id="9d3cf-161">upn > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn`</span></span>

## <a name="claims-transformations"></a><span data-ttu-id="9d3cf-162">Transformaciones de notificaciones</span><span class="sxs-lookup"><span data-stu-id="9d3cf-162">Claims transformations</span></span>
<span data-ttu-id="9d3cf-163">Durante el flujo de autenticación, puede que desee modificar las notificaciones que obtiene del IDP.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-163">During the authentication flow, you might want to modify the claims that you get from the IDP.</span></span> <span data-ttu-id="9d3cf-164">En ASP.NET Core, puede realizar la transformación de notificaciones dentro del evento **AuthenticationValidated** desde el middleware OpenID Connect.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-164">In ASP.NET Core, you can perform claims transformation inside of the **AuthenticationValidated** event from the OpenID Connect middleware.</span></span> <span data-ttu-id="9d3cf-165">Vea [Eventos de autenticación].</span><span class="sxs-lookup"><span data-stu-id="9d3cf-165">(See [Authentication events].)</span></span>

<span data-ttu-id="9d3cf-166">Todas las notificaciones que agregue durante **AuthenticationValidated** se almacenan en la cookie de autenticación de sesión.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-166">Any claims that you add during **AuthenticationValidated** are stored in the session authentication cookie.</span></span> <span data-ttu-id="9d3cf-167">No se hacen retroceder a Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-167">They don't get pushed back to Azure AD.</span></span>

<span data-ttu-id="9d3cf-168">Estos son algunos ejemplos de transformación de notificaciones:</span><span class="sxs-lookup"><span data-stu-id="9d3cf-168">Here are some examples of claims transformation:</span></span>

* <span data-ttu-id="9d3cf-169">**Normalización de notificaciones**, o hacer que las notificaciones sean coherentes entre los usuarios.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-169">**Claims normalization**, or making claims consistent across users.</span></span> <span data-ttu-id="9d3cf-170">Esto es especialmente importante si recibe notificaciones de varios IDP, que podrían usar diferentes tipos de notificación para información similar.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-170">This is particularly relevant if you are getting claims from multiple IDPs, which might use different claim types for similar information.</span></span>
  <span data-ttu-id="9d3cf-171">Por ejemplo, Azure AD envía una notificación "upn" que contiene el correo electrónico del usuario.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-171">For example, Azure AD sends a "upn" claim that contains the user's email.</span></span> <span data-ttu-id="9d3cf-172">Otros IDP podrían enviar una notificación "email".</span><span class="sxs-lookup"><span data-stu-id="9d3cf-172">Other IDPs might send an "email" claim.</span></span> <span data-ttu-id="9d3cf-173">El código siguiente convierte la notificación "upn" en una notificación "email":</span><span class="sxs-lookup"><span data-stu-id="9d3cf-173">The following code converts the "upn" claim into an "email" claim:</span></span>
  
  ```csharp
  var email = principal.FindFirst(ClaimTypes.Upn)?.Value;
  if (!string.IsNullOrWhiteSpace(email))
  {
      identity.AddClaim(new Claim(ClaimTypes.Email, email));
  }
  ```
* <span data-ttu-id="9d3cf-174">Agregue **valores de notificación predeterminados** para las notificaciones que no estén presentes &mdash; por ejemplo, asigne un rol predeterminado a un usuario.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-174">Add **default claim values** for claims that aren't present &mdash; for example, assigning a user to a default role.</span></span> <span data-ttu-id="9d3cf-175">En algunos casos esto puede simplificar la lógica de autorización.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-175">In some cases this can simplify authorization logic.</span></span>
* <span data-ttu-id="9d3cf-176">Agregar **tipos de notificación personalizados** con información específica de la aplicación sobre el usuario.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-176">Add **custom claim types** with application-specific information about the user.</span></span> <span data-ttu-id="9d3cf-177">Por ejemplo, podría almacenar información sobre el usuario en una base de datos.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-177">For example, you might store some information about the user in a database.</span></span> <span data-ttu-id="9d3cf-178">Podría agregar una notificación personalizada con esta información la incidencia de autenticación.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-178">You could add a custom claim with this information to the authentication ticket.</span></span> <span data-ttu-id="9d3cf-179">La notificación se almacena en una cookie, por lo que solo necesita obtenerla de la base de datos una vez por cada inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-179">The claim is stored in a cookie, so you only need to get it from the database once per login session.</span></span> <span data-ttu-id="9d3cf-180">Por otro lado, también desea evitar la creación de cookies excesivamente grandes, por lo que debe tener en cuenta el equilibrio entre el tamaño de las cookies y las búsquedas en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-180">On the other hand, you also want to avoid creating excessively large cookies, so you need to consider the trade-off between cookie size versus database lookups.</span></span>   

<span data-ttu-id="9d3cf-181">Una vez completado el flujo de autenticación, las notificaciones están disponibles en `HttpContext.User`.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-181">After the authentication flow is complete, the claims are available in `HttpContext.User`.</span></span> <span data-ttu-id="9d3cf-182">En ese momento, debe tratarlas como una colección de solo lectura &mdash; por ejemplo, usarlas para tomar decisiones de autorización.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-182">At that point, you should treat them as a read-only collection &mdash; e.g., use them to make authorization decisions.</span></span>

## <a name="issuer-validation"></a><span data-ttu-id="9d3cf-183">Validación del emisor</span><span class="sxs-lookup"><span data-stu-id="9d3cf-183">Issuer validation</span></span>
<span data-ttu-id="9d3cf-184">En OpenID Connect, la notificación del emisor ("iss") identifica el IDP que emitió el token de identificador.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-184">In OpenID Connect, the issuer claim ("iss") identifies the IDP that issued the ID token.</span></span> <span data-ttu-id="9d3cf-185">Parte del flujo de autenticación de OIDC es comprobar que la notificación del emisor coincide con el emisor real.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-185">Part of the OIDC authentication flow is to verify that the issuer claim matches the actual issuer.</span></span> <span data-ttu-id="9d3cf-186">El middleware OIDC se encarga de ello.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-186">The OIDC middleware handles this for you.</span></span>

<span data-ttu-id="9d3cf-187">En Azure AD, el valor de emisor es único por inquilino de AD (`https://sts.windows.net/<tenantID>`).</span><span class="sxs-lookup"><span data-stu-id="9d3cf-187">In Azure AD, the issuer value is unique per AD tenant (`https://sts.windows.net/<tenantID>`).</span></span> <span data-ttu-id="9d3cf-188">Por lo tanto, una aplicación debe hacer una comprobación adicional para asegurarse de que el emisor representa a un inquilino al que se le permite iniciar sesión en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-188">Therefore, an application should do an additional check, to make sure the issuer represents a tenant that is allowed to sign in to the app.</span></span>

<span data-ttu-id="9d3cf-189">Para una aplicación de un solo inquilino, basta con comprobar que el emisor es su propio inquilino.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-189">For a single-tenant application, you can just check that the issuer is your own tenant.</span></span> <span data-ttu-id="9d3cf-190">De hecho, el middleware OIDC hace esto automáticamente de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-190">In fact, the OIDC middleware does this automatically by default.</span></span> <span data-ttu-id="9d3cf-191">En una aplicación de varios inquilinos, necesita permitir varios emisores, correspondientes a los diferentes inquilinos.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-191">In a multi-tenant app, you need to allow for multiple issuers, corresponding to the different tenants.</span></span> <span data-ttu-id="9d3cf-192">A continuación se expone un enfoque general para usar:</span><span class="sxs-lookup"><span data-stu-id="9d3cf-192">Here is a general approach to use:</span></span>

* <span data-ttu-id="9d3cf-193">En las opciones de middleware OIDC, establezca **ValidateIssuer** en false.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-193">In the OIDC middleware options, set **ValidateIssuer** to false.</span></span> <span data-ttu-id="9d3cf-194">Esto desactiva la comprobación automática.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-194">This turns off the automatic check.</span></span>
* <span data-ttu-id="9d3cf-195">Cuando un inquilino se suscriba, almacene el inquilino y el emisor en la base de datos de usuario.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-195">When a tenant signs up, store the tenant and the issuer in your user DB.</span></span>
* <span data-ttu-id="9d3cf-196">Cada vez que un usuario inicie sesión, busque el emisor en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-196">Whenever a user signs in, look up the issuer in the database.</span></span> <span data-ttu-id="9d3cf-197">Si no se encuentra el emisor, significa que el inquilino no se ha suscrito.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-197">If the issuer isn't found, it means that tenant hasn't signed up.</span></span> <span data-ttu-id="9d3cf-198">Es posible redirigirlos a una página de suscripción.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-198">You can redirect them to a sign up page.</span></span>
* <span data-ttu-id="9d3cf-199">También puede generar una lista de bloqueados de determinados inquilinos; por ejemplo, para los clientes que no pagaron su suscripción.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-199">You could also blacklist certain tenants; for example, for customers that didn't pay their subscription.</span></span>

<span data-ttu-id="9d3cf-200">Para obtener una explicación más detallada, consulte [Registro e incorporación de un inquilino en una aplicación multiinquilino][signup].</span><span class="sxs-lookup"><span data-stu-id="9d3cf-200">For a more detailed discussion, see [Sign-up and tenant onboarding in a multitenant application][signup].</span></span>

## <a name="using-claims-for-authorization"></a><span data-ttu-id="9d3cf-201">Uso de notificaciones para la autorización</span><span class="sxs-lookup"><span data-stu-id="9d3cf-201">Using claims for authorization</span></span>
<span data-ttu-id="9d3cf-202">Con las notificaciones, una identidad de usuario ya no es una entidad monolítica.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-202">With claims, a user's identity is no longer a monolithic entity.</span></span> <span data-ttu-id="9d3cf-203">Por ejemplo, un usuario podría tener una dirección de correo electrónico, un número de teléfono, su cumpleaños, sexo, etc. Quizá en el IDP del usuario se almacena toda esta información.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-203">For example, a user might have an email address, phone number, birthday, gender, etc. Maybe the user's IDP stores all of this information.</span></span> <span data-ttu-id="9d3cf-204">Pero cuando se autentica al usuario, por lo general se obtiene un subconjunto de estos datos en forma de notificaciones.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-204">But when you authenticate the user, you'll typically get a subset of these as claims.</span></span> <span data-ttu-id="9d3cf-205">En este modelo, la identidad del usuario es simplemente una agrupación de notificaciones.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-205">In this model, the user's identity is simply a bundle of claims.</span></span> <span data-ttu-id="9d3cf-206">Cuando se toman decisiones sobre un usuario, se busca un conjunto determinado de notificaciones.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-206">When you make authorization decisions about a user, you will look for particular sets of claims.</span></span> <span data-ttu-id="9d3cf-207">En otras palabras, la pregunta "¿Puede un usuario X realizar la acción Y?" se convierte en última instancia en "¿Tiene el usuario X notificaciones Z?".</span><span class="sxs-lookup"><span data-stu-id="9d3cf-207">In other words, the question "Can user X perform action Y" ultimately becomes "Does user X have claim Z".</span></span>

<span data-ttu-id="9d3cf-208">Estos son algunos patrones básicos para la comprobación de notificaciones.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-208">Here are some basic patterns for checking claims.</span></span>

* <span data-ttu-id="9d3cf-209">Para comprobar que el usuario tiene una notificación determinada con un valor concreto:</span><span class="sxs-lookup"><span data-stu-id="9d3cf-209">To check that the user has a particular claim with a particular value:</span></span>
  
   ```csharp
   if (User.HasClaim(ClaimTypes.Role, "Admin")) { ... }
   ```
   <span data-ttu-id="9d3cf-210">Este código comprueba si el usuario tiene una notificación de rol con el valor "Admin".</span><span class="sxs-lookup"><span data-stu-id="9d3cf-210">This code checks whether the user has a Role claim with the value "Admin".</span></span> <span data-ttu-id="9d3cf-211">Administra correctamente el caso donde el usuario no tiene notificación de rol o varias notificaciones de rol.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-211">It correctly handles the case where the user has no Role claim or multiple Role claims.</span></span>
  
   <span data-ttu-id="9d3cf-212">La clase **ClaimTypes** clase define las constantes para los tipos de notificación usados con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-212">The **ClaimTypes** class defines constants for commonly-used claim types.</span></span> <span data-ttu-id="9d3cf-213">Sin embargo, puede usar cualquier valor de cadena para el tipo de notificación.</span><span class="sxs-lookup"><span data-stu-id="9d3cf-213">However, you can use any string value for the claim type.</span></span>
* <span data-ttu-id="9d3cf-214">Para obtener un único valor para un tipo de notificación, cuando se espera que haya como máximo un valor:</span><span class="sxs-lookup"><span data-stu-id="9d3cf-214">To get a single value for a claim type, when you expect there to be at most one value:</span></span>
  
  ```csharp
  string email = User.FindFirst(ClaimTypes.Email)?.Value;
  ```
* <span data-ttu-id="9d3cf-215">Para obtener todos los valores para un tipo de notificación:</span><span class="sxs-lookup"><span data-stu-id="9d3cf-215">To get all the values for a claim type:</span></span>
  
  ```csharp
  IEnumerable<Claim> groups = User.FindAll("groups");
  ```

<span data-ttu-id="9d3cf-216">Para más información, consulte [Autorización basada en recursos y roles en aplicaciones multiinquilino][authorization].</span><span class="sxs-lookup"><span data-stu-id="9d3cf-216">For more information, see [Role-based and resource-based authorization in multitenant applications][authorization].</span></span>

<span data-ttu-id="9d3cf-217">[**Siguiente**][signup]</span><span class="sxs-lookup"><span data-stu-id="9d3cf-217">[**Next**][signup]</span></span>


<!-- Links -->

[parámetro de ámbito]: https://nat.sakimura.org/2012/01/26/scopes-and-claims-in-openid-connect/
[scope parameter]: https://nat.sakimura.org/2012/01/26/scopes-and-claims-in-openid-connect/
[Tipos de notificaciones y tokens admitidos]: /azure/active-directory/active-directory-token-and-claims/
[Supported Token and Claim Types]: /azure/active-directory/active-directory-token-and-claims/
[emisor]: https://openid.net/specs/openid-connect-core-1_0.html#IDToken
[issuer]: https://openid.net/specs/openid-connect-core-1_0.html#IDToken
[Eventos de autenticación]: authenticate.md#authentication-events
[Authentication events]: authenticate.md#authentication-events
[signup]: signup.md
[Claims-Based Authorization]: /aspnet/core/security/authorization/claims
[sample application]: https://github.com/mspnp/multitenant-saas-guidance
[authorization]: authorize.md
