---
title: Scheduler Agent Supervisor
description: Coordina un conjunto de acciones en un conjunto distribuido de servicios y otros recursos remotos.
keywords: Patrón de diseño
author: dragon119
ms.date: 06/23/2017
pnp.series.title: Cloud Design Patterns
pnp.pattern.categories:
- messaging
- resiliency
ms.openlocfilehash: 7914708413d68689e2326df28ced00e5fc3a5dd8
ms.sourcegitcommit: 94d50043db63416c4d00cebe927a0c88f78c3219
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 09/28/2018
ms.locfileid: "47428676"
---
# <a name="scheduler-agent-supervisor-pattern"></a><span data-ttu-id="de0b6-104">Patrón Scheduler Agent Supervisor</span><span class="sxs-lookup"><span data-stu-id="de0b6-104">Scheduler Agent Supervisor pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="de0b6-105">Coordine un conjunto de acciones distribuidas como una única operación.</span><span class="sxs-lookup"><span data-stu-id="de0b6-105">Coordinate a set of distributed actions as a single operation.</span></span> <span data-ttu-id="de0b6-106">Si se produce un error en cualquiera de las acciones, intente controlar de forma transparente los errores o deshaga el trabajo realizado para que la operación se realice o produzca un error de mantera integral.</span><span class="sxs-lookup"><span data-stu-id="de0b6-106">If any of the actions fail, try to handle the failures transparently, or else undo the work that was performed, so the entire operation succeeds or fails as a whole.</span></span> <span data-ttu-id="de0b6-107">De este modo se agrega resistencia al sistema distribuido y se permite que se recupere y que repita las acciones que produjeron errores duraderos, de proceso o a causa de excepciones transitorias.</span><span class="sxs-lookup"><span data-stu-id="de0b6-107">This can add resiliency to a distributed system, by enabling it to recover and retry actions that fail due to transient exceptions, long-lasting faults, and process failures.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="de0b6-108">Contexto y problema</span><span class="sxs-lookup"><span data-stu-id="de0b6-108">Context and problem</span></span>

<span data-ttu-id="de0b6-109">Una aplicación realiza tareas con una serie de pasos, algunos de los cuales podrían invocar servicios remotos o acceder a recursos remotos.</span><span class="sxs-lookup"><span data-stu-id="de0b6-109">An application performs tasks that include a number of steps, some of which might invoke remote services or access remote resources.</span></span> <span data-ttu-id="de0b6-110">Los pasos individuales podrían ser independientes entre sí, pero están organizados por la lógica de la aplicación que implementa la tarea.</span><span class="sxs-lookup"><span data-stu-id="de0b6-110">The individual steps might be independent of each other, but they are orchestrated by the application logic that implements the task.</span></span>

<span data-ttu-id="de0b6-111">Siempre que sea posible, la aplicación debe asegurarse de que la tarea se ejecuta por completo y resuelve los errores que puedan producirse al acceder a servicios o recursos remotos.</span><span class="sxs-lookup"><span data-stu-id="de0b6-111">Whenever possible, the application should ensure that the task runs to completion and resolve any failures that might occur when accessing remote services or resources.</span></span> <span data-ttu-id="de0b6-112">Pueden producirse errores por diversos motivos.</span><span class="sxs-lookup"><span data-stu-id="de0b6-112">Failures can occur for many reasons.</span></span> <span data-ttu-id="de0b6-113">Por ejemplo, la red podría estar inactiva o las comunicaciones, interrumpidas; un servicio remoto podría no responder o encontrarse en estado inestable; o un recurso remoto podría estar inaccesible temporalmente, quizás por restricciones.</span><span class="sxs-lookup"><span data-stu-id="de0b6-113">For example, the network might be down, communications could be interrupted, a remote service might be unresponsive or in an unstable state, or a remote resource might be temporarily inaccessible, perhaps due to resource constraints.</span></span> <span data-ttu-id="de0b6-114">En muchos casos, los errores serán transitorios y se podrán controlar mediante el [patrón Retry][retry-pattern].</span><span class="sxs-lookup"><span data-stu-id="de0b6-114">In many cases the failures will be transient and can be handled by using the [Retry pattern][retry-pattern].</span></span>

<span data-ttu-id="de0b6-115">Si la aplicación detecta un error más permanente o que no se puede recuperar fácilmente, debe ser capaz de restaurar el sistema a un estado coherente y garantizar la integridad de toda la operación.</span><span class="sxs-lookup"><span data-stu-id="de0b6-115">If the application detects a more permanent fault it can't easily recover from, it must be able to restore the system to a consistent state and ensure integrity of the entire operation.</span></span>

## <a name="solution"></a><span data-ttu-id="de0b6-116">Solución</span><span class="sxs-lookup"><span data-stu-id="de0b6-116">Solution</span></span>

<span data-ttu-id="de0b6-117">El patrón Scheduler Agent Supervisor define los actores siguientes.</span><span class="sxs-lookup"><span data-stu-id="de0b6-117">The Scheduler Agent Supervisor pattern defines the following actors.</span></span> <span data-ttu-id="de0b6-118">Estos actores orquestan los pasos necesarios que se deben incluir como parte de la tarea global.</span><span class="sxs-lookup"><span data-stu-id="de0b6-118">These actors orchestrate the steps to be performed as part of the overall task.</span></span>

- <span data-ttu-id="de0b6-119">El componente **Scheduler** organiza la ejecución de los pasos que forman la tarea y orquesta su funcionamiento.</span><span class="sxs-lookup"><span data-stu-id="de0b6-119">The **Scheduler** arranges for the steps that make up the task to be executed and orchestrates their operation.</span></span> <span data-ttu-id="de0b6-120">Estos pasos se pueden combinar en una canalización o un flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="de0b6-120">These steps can be combined into a pipeline or workflow.</span></span> <span data-ttu-id="de0b6-121">El componente Scheduler es responsable de garantizar que se realicen los pasos de este flujo de trabajo en el orden correcto.</span><span class="sxs-lookup"><span data-stu-id="de0b6-121">The Scheduler is responsible for ensuring that the steps in this workflow are performed in the right order.</span></span> <span data-ttu-id="de0b6-122">A medida que se realiza cada paso, el componente Scheduler registra el estado del flujo de trabajo, como "paso aún no iniciado", "paso en ejecución" o "paso completado".</span><span class="sxs-lookup"><span data-stu-id="de0b6-122">As each step is performed, the Scheduler records the state of the workflow, such as "step not yet started," "step running," or "step completed."</span></span> <span data-ttu-id="de0b6-123">La información de estado también debe incluir un límite superior de tiempo permitido para que finalice el paso, se denomina "tiempo de vigencia".</span><span class="sxs-lookup"><span data-stu-id="de0b6-123">The state information should also include an upper limit of the time allowed for the step to finish, called the complete-by time.</span></span> <span data-ttu-id="de0b6-124">Si un paso requiere acceso a un recurso o servicio remoto, el componente Scheduler invoca al componente Agent adecuado y le pasa los detalles del trabajo que se debe realizar.</span><span class="sxs-lookup"><span data-stu-id="de0b6-124">If a step requires access to a remote service or resource, the Scheduler invokes the appropriate Agent, passing it the details of the work to be performed.</span></span> <span data-ttu-id="de0b6-125">Normalmente, el componente Scheduler se comunica con un componente Agent a través de la mensajería de solicitud/respuesta asincrónica.</span><span class="sxs-lookup"><span data-stu-id="de0b6-125">The Scheduler typically communicates with an Agent using asynchronous request/response messaging.</span></span> <span data-ttu-id="de0b6-126">Esto se puede implementar mediante colas, aunque también se pueden usar otras tecnologías de mensajería distribuidas.</span><span class="sxs-lookup"><span data-stu-id="de0b6-126">This can be implemented using queues, although other distributed messaging technologies could be used instead.</span></span>

    > <span data-ttu-id="de0b6-127">El componente Scheduler realiza una función similar a la de Process Manager del [patrón Process Manager](https://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html).</span><span class="sxs-lookup"><span data-stu-id="de0b6-127">The Scheduler performs a similar function to the Process Manager in the [Process Manager pattern](https://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html).</span></span> <span data-ttu-id="de0b6-128">El flujo de trabajo real normalmente lo define e implementa un motor de flujo de trabajo que el componente Scheduler controla.</span><span class="sxs-lookup"><span data-stu-id="de0b6-128">The actual workflow is typically defined and implemented by a workflow engine that's controlled by the Scheduler.</span></span> <span data-ttu-id="de0b6-129">Este enfoque separa la lógica de negocios del flujo de trabajo del componente Scheduler.</span><span class="sxs-lookup"><span data-stu-id="de0b6-129">This approach decouples the business logic in the workflow from the Scheduler.</span></span>

- <span data-ttu-id="de0b6-130">El componente **Agent** contienen lógica que encapsula una llamada a un servicio remoto o acceso a un recurso remoto a los cuales hace referencia un paso de una tarea.</span><span class="sxs-lookup"><span data-stu-id="de0b6-130">The **Agent** contains logic that encapsulates a call to a remote service, or access to a remote resource referenced by a step in a task.</span></span> <span data-ttu-id="de0b6-131">Normalmente, cada componente Agent encapsula las llamadas a un único servicio o recurso, al implementar el control de errores y la lógica de reintento adecuados (de acuerdo con una restricción de tiempo de espera, que se describe más adelante).</span><span class="sxs-lookup"><span data-stu-id="de0b6-131">Each Agent typically wraps calls to a single service or resource, implementing the appropriate error handling and retry logic (subject to a timeout constraint, described later).</span></span> <span data-ttu-id="de0b6-132">Si los pasos del flujo de trabajo que ejecuta el componente Scheduler utilizan varios servicios y recursos en pasos diferentes, cada paso puede hacer referencia a una instancia de Agent diferente (es un detalle de implementación del patrón).</span><span class="sxs-lookup"><span data-stu-id="de0b6-132">If the steps in the workflow being run by the Scheduler use several services and resources across different steps, each step might reference a different Agent (this is an implementation detail of the pattern).</span></span>

- <span data-ttu-id="de0b6-133">**Supervisor** supervisa el estado de los pasos de la tarea que realiza el componente Scheduler.</span><span class="sxs-lookup"><span data-stu-id="de0b6-133">The **Supervisor** monitors the status of the steps in the task being performed by the Scheduler.</span></span> <span data-ttu-id="de0b6-134">Se ejecuta periódicamente (la frecuencia será específica del sistema) y examina el estado de pasos que mantiene el componente Scheduler.</span><span class="sxs-lookup"><span data-stu-id="de0b6-134">It runs periodically (the frequency will be system specific), and examines the status of steps maintained by the Scheduler.</span></span> <span data-ttu-id="de0b6-135">Si detecta alguno con tiempo de espera agotado o error, organiza la instancia de Agent adecuada para recuperar el paso o ejecutar la acción correctiva correspondiente (esto puede implicar modificar el estado de un paso).</span><span class="sxs-lookup"><span data-stu-id="de0b6-135">If it detects any that have timed out or failed, it arranges for the appropriate Agent to recover the step or execute the appropriate remedial action (this might involve modifying the status of a step).</span></span> <span data-ttu-id="de0b6-136">Tenga en cuenta que la recuperación o las acciones correctivas las implementan el componente Scheduler y el componente Agent.</span><span class="sxs-lookup"><span data-stu-id="de0b6-136">Note that the recovery or remedial actions are implemented by the Scheduler and Agents.</span></span> <span data-ttu-id="de0b6-137">El componente Supervisor solo tiene que solicitar que estas acciones se realicen.</span><span class="sxs-lookup"><span data-stu-id="de0b6-137">The Supervisor should simply request that these actions be performed.</span></span>

<span data-ttu-id="de0b6-138">Scheduler, Agent y Supervisor son componentes lógicos y su implementación física depende de la tecnología utilizada.</span><span class="sxs-lookup"><span data-stu-id="de0b6-138">The Scheduler, Agent, and Supervisor are logical components and their physical implementation depends on the technology being used.</span></span> <span data-ttu-id="de0b6-139">Por ejemplo, se pueden implementar varios agentes lógicos como parte de un servicio web.</span><span class="sxs-lookup"><span data-stu-id="de0b6-139">For example, several logical agents might be implemented as part of a single web service.</span></span>

<span data-ttu-id="de0b6-140">El componente Scheduler conserva la información sobre el progreso de la tarea y el estado de cada paso en un almacén de datos durable que se conoce como el almacén de estado.</span><span class="sxs-lookup"><span data-stu-id="de0b6-140">The Scheduler maintains information about the progress of the task and the state of each step in a durable data store, called the state store.</span></span> <span data-ttu-id="de0b6-141">El componente Supervisor puede utilizar esta información para ayudar a determinar si se produjo un error en un paso.</span><span class="sxs-lookup"><span data-stu-id="de0b6-141">The Supervisor can use this information to help determine whether a step has failed.</span></span> <span data-ttu-id="de0b6-142">En la ilustración se muestra la relación entre el componente Scheduler, los componentes Agent, el componente Supervisor y el almacén de estado.</span><span class="sxs-lookup"><span data-stu-id="de0b6-142">The figure illustrates the relationship between the Scheduler, the Agents, the Supervisor, and the state store.</span></span>

![Figura 1: actores del patrón Scheduler Agent Supervisor](./_images/scheduler-agent-supervisor-pattern.png)


> <span data-ttu-id="de0b6-144">En este diagrama se muestra una versión simplificada del patrón.</span><span class="sxs-lookup"><span data-stu-id="de0b6-144">This diagram shows a simplified version of the pattern.</span></span> <span data-ttu-id="de0b6-145">En una implementación real, puede haber varias instancias del componente Scheduler que ejecuten un subconjunto de tareas distinto cada una al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="de0b6-145">In a real implementation, there might be many instances of the Scheduler running concurrently, each a subset of tasks.</span></span> <span data-ttu-id="de0b6-146">De igual forma, el sistema puede ejecutar varias instancias de cada instancia del componente Agent, o incluso varias instancias del componente Supervisor.</span><span class="sxs-lookup"><span data-stu-id="de0b6-146">Similarly, the system could run multiple instances of each Agent, or even multiple Supervisors.</span></span> <span data-ttu-id="de0b6-147">En este caso, las instancias de Supervisor deben coordinar su trabajo entre ellos con atención para garantizar que no compiten por recuperar las mismas tareas y pasos con error.</span><span class="sxs-lookup"><span data-stu-id="de0b6-147">In this case, Supervisors must coordinate their work with each other carefully to ensure that they don’t compete to recover the same failed steps and tasks.</span></span> <span data-ttu-id="de0b6-148">El [patrón Leader Election](leader-election.md) proporciona una posible solución a este problema.</span><span class="sxs-lookup"><span data-stu-id="de0b6-148">The [Leader Election pattern](leader-election.md) provides one possible solution to this problem.</span></span>

<span data-ttu-id="de0b6-149">Cuando la aplicación está preparada ejecutar una tarea, envía una solicitud al componente Scheduler.</span><span class="sxs-lookup"><span data-stu-id="de0b6-149">When the application is ready to run a task, it submits a request to the Scheduler.</span></span> <span data-ttu-id="de0b6-150">El componente Scheduler registra la información de estado de la tarea y sus pasos (por ejemplo, paso aún no iniciado) en el almacén de estado e inicia las operaciones que se definieron en el flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="de0b6-150">The Scheduler records initial state information about the task and its steps (for example, step not yet started) in the state store and then starts performing the operations defined by the workflow.</span></span> <span data-ttu-id="de0b6-151">Al iniciar cada paso, el componente Scheduler actualiza la información de estado del paso en el almacén de estado (por ejemplo, paso en ejecución).</span><span class="sxs-lookup"><span data-stu-id="de0b6-151">As the Scheduler starts each step, it updates the information about the state of that step in the state store (for example, step running).</span></span>

<span data-ttu-id="de0b6-152">Si un paso hace referencia a un servicio o recurso remoto, el componente Scheduler envía un mensaje al componente Agent adecuado.</span><span class="sxs-lookup"><span data-stu-id="de0b6-152">If a step references a remote service or resource, the Scheduler sends a message to the appropriate Agent.</span></span> <span data-ttu-id="de0b6-153">El mensaje contiene la información que el componente Agent necesita para pasarla al servicio o acceder al recurso, además del tiempo de vigencia de la operación.</span><span class="sxs-lookup"><span data-stu-id="de0b6-153">The message contains the information that the Agent needs to pass to the service or access the resource, in addition to the complete-by time for the operation.</span></span> <span data-ttu-id="de0b6-154">Si el componente Agent completa la operación correctamente, devuelve una respuesta al componente Scheduler.</span><span class="sxs-lookup"><span data-stu-id="de0b6-154">If the Agent completes its operation successfully, it returns a response to the Scheduler.</span></span> <span data-ttu-id="de0b6-155">Entonces, el componente Scheduler actualiza la información de estado en el almacén de estado (por ejemplo, paso completado) y realiza el paso siguiente.</span><span class="sxs-lookup"><span data-stu-id="de0b6-155">The Scheduler can then update the state information in the state store (for example, step completed) and perform the next step.</span></span> <span data-ttu-id="de0b6-156">Este proceso continúa hasta que la tarea se haya completado.</span><span class="sxs-lookup"><span data-stu-id="de0b6-156">This process continues until the entire task is complete.</span></span>

<span data-ttu-id="de0b6-157">El componente Agent puede implementar cualquier lógica de reintento necesaria para realizar su trabajo.</span><span class="sxs-lookup"><span data-stu-id="de0b6-157">An Agent can implement any retry logic that's necessary to perform its work.</span></span> <span data-ttu-id="de0b6-158">Sin embargo, si el componente Agent no completa su trabajo antes de que expire el tiempo de vigencia, el componente Scheduler presupone que se ha producido un error en la operación.</span><span class="sxs-lookup"><span data-stu-id="de0b6-158">However, if the Agent doesn't complete its work before the complete-by period expires, the Scheduler will assume that the operation has failed.</span></span> <span data-ttu-id="de0b6-159">En este caso, el componente Agent debe detener su trabajo y no intentar devolver nada a Scheduler (ni siquiera un mensaje de error), ni tampoco intentar cualquier forma de recuperación.</span><span class="sxs-lookup"><span data-stu-id="de0b6-159">In this case, the Agent should stop its work and not try to return anything to the Scheduler (not even an error message), or try any form of recovery.</span></span> <span data-ttu-id="de0b6-160">La razón de esta restricción es que, cuando se agota el tiempo de espera de un paso o este último produce un error, otra instancia de Agent puede programarse para ejecutar el paso con error (este proceso se describe después).</span><span class="sxs-lookup"><span data-stu-id="de0b6-160">The reason for this restriction is that, after a step has timed out or failed, another instance of the Agent might be scheduled to run the failing step (this process is described later).</span></span>

<span data-ttu-id="de0b6-161">Si se produce un error en la instancia del componente Agent, el componente Scheduler no recibirá respuesta.</span><span class="sxs-lookup"><span data-stu-id="de0b6-161">If the Agent fails, the Scheduler won't receive a response.</span></span> <span data-ttu-id="de0b6-162">El patrón no distingue entre un paso cuyo tiempo de espera se haya agotado y otro que haya producido un error real.</span><span class="sxs-lookup"><span data-stu-id="de0b6-162">The pattern doesn't make a distinction between a step that has timed out and one that has genuinely failed.</span></span>

<span data-ttu-id="de0b6-163">Si se agota el tiempo de espera de un paso o este produce un error, el almacén de estado contendrá un registro que indique que el paso está en ejecución, pero que su tiempo de vigencia ha expirado.</span><span class="sxs-lookup"><span data-stu-id="de0b6-163">If a step times out or fails, the state store will contain a record that indicates that the step is running, but the complete-by time will have passed.</span></span> <span data-ttu-id="de0b6-164">Supervisor busca este tipo de pasos y los intenta recuperar.</span><span class="sxs-lookup"><span data-stu-id="de0b6-164">The Supervisor looks for steps like this and tries to recover them.</span></span> <span data-ttu-id="de0b6-165">Una posible estrategia es que el componente Supervisor actualice el valor de vigencia para aumentar el tiempo disponible para completar el paso y que envíe un mensaje al componente Scheduler con la identificación del paso cuyo tiempo de espera se ha agotado. Entonces, el componente Scheduler intentará repetir el paso.</span><span class="sxs-lookup"><span data-stu-id="de0b6-165">One possible strategy is for the Supervisor to update the complete-by value to extend the time available to complete the step, and then send a message to the Scheduler identifying the step that has timed out. The Scheduler can then try to repeat this step.</span></span> <span data-ttu-id="de0b6-166">Sin embargo, este diseño requiere que las tareas sean idempotentes.</span><span class="sxs-lookup"><span data-stu-id="de0b6-166">However, this design requires the tasks to be idempotent.</span></span>

<span data-ttu-id="de0b6-167">Puede que el componente Supervisor necesite impedir que se intente realizar el mismo paso, en caso de que produzca errores o su tiempo de espera se agote continuamente. Para ello, el componente Supervisor puede conservar un recuento de reintentos de los pasos junto con la información de estado en el almacén de estado.</span><span class="sxs-lookup"><span data-stu-id="de0b6-167">The Supervisor might need to prevent the same step from being retried if it continually fails or times out. To do this, the Supervisor could maintain a retry count for each step, along with the state information, in the state store.</span></span> <span data-ttu-id="de0b6-168">Si este número supera un umbral predefinido, el componente Supervisor adopta una estrategia de espera durante un tiempo prolongado antes de notificar al componente Scheduler que debe reintentar el paso, con la expectativa de que el error se resuelva durante este tiempo.</span><span class="sxs-lookup"><span data-stu-id="de0b6-168">If this count exceeds a predefined threshold the Supervisor can adopt a strategy of waiting for an extended period before notifying the Scheduler that it should retry the step, in the expectation that the fault will be resolved during this period.</span></span> <span data-ttu-id="de0b6-169">Como alternativa, el componente Supervisor puede enviar un mensaje al componente Scheduler para solicitar que se deshaga toda la tarea mediante la implementación de un [patrón Compensating Transaction](compensating-transaction.md).</span><span class="sxs-lookup"><span data-stu-id="de0b6-169">Alternatively, the Supervisor can send a message to the Scheduler to request the entire task be undone by implementing a [Compensating Transaction pattern](compensating-transaction.md).</span></span> <span data-ttu-id="de0b6-170">Este enfoque dependerá de que el componente Scheduler y las instancias del componente Agent proporcionen la información necesaria para implementar las operaciones de compensación para cada paso que se completara correctamente.</span><span class="sxs-lookup"><span data-stu-id="de0b6-170">This approach will depend on the Scheduler and Agents providing the information necessary to implement the compensating operations for each step that completed successfully.</span></span>

> <span data-ttu-id="de0b6-171">El componente Supervisor no está diseñado para supervisar el componente Scheduler y las instancias del componente Agent y reiniciarlos si se produce un error.</span><span class="sxs-lookup"><span data-stu-id="de0b6-171">It isn't the purpose of the Supervisor to monitor the Scheduler and Agents, and restart them if they fail.</span></span> <span data-ttu-id="de0b6-172">Este aspecto del sistema debe controlarse desde la infraestructura donde se ejecutan estos componentes.</span><span class="sxs-lookup"><span data-stu-id="de0b6-172">This aspect of the system should be handled by the infrastructure these components are running in.</span></span> <span data-ttu-id="de0b6-173">De forma similar, el componente Supervisor no debería conocer las operaciones empresariales reales que ejecutan las tareas del componente Scheduler (incluida la compensación en caso de error en estas tareas).</span><span class="sxs-lookup"><span data-stu-id="de0b6-173">Similarly, the Supervisor shouldn't have knowledge of the actual business operations that the tasks being performed by the Scheduler are running (including how to compensate should these tasks fail).</span></span> <span data-ttu-id="de0b6-174">De esto se ocupa la lógica del flujo de trabajo que implementó el componente Scheduler.</span><span class="sxs-lookup"><span data-stu-id="de0b6-174">This is the purpose of the workflow logic implemented by the Scheduler.</span></span> <span data-ttu-id="de0b6-175">La única responsabilidad del componente Supervisor consiste en determinar si se ha producido un error en un paso y organizarlo para que se repita o para que la tarea que contenga el paso con error se deshaga.</span><span class="sxs-lookup"><span data-stu-id="de0b6-175">The sole responsibility of the Supervisor is to determine whether a step has failed and arrange either for it to be repeated or for the entire task containing the failed step to be undone.</span></span>

<span data-ttu-id="de0b6-176">Si el componente Scheduler se reinicia tras un error o si su flujo de trabajo en ejecución finaliza inesperadamente, el componente Scheduler debe ser capaz de determinar el estado de las tareas en proceso que estaba controlando cuando se produjo el error y estar preparado para reanudarlas desde ese punto.</span><span class="sxs-lookup"><span data-stu-id="de0b6-176">If the Scheduler is restarted after a failure, or the workflow being performed by the Scheduler terminates unexpectedly, the Scheduler should be able to determine the status of any inflight task that it was handling when it failed, and be prepared to resume this task from that point.</span></span> <span data-ttu-id="de0b6-177">Los detalles de la implementación de este proceso suelen ser específicas del sistema.</span><span class="sxs-lookup"><span data-stu-id="de0b6-177">The implementation details of this process are likely to be system specific.</span></span> <span data-ttu-id="de0b6-178">Si no se puede recuperar la tarea, podría ser necesario deshacer el trabajo que la tarea ya haya realizado.</span><span class="sxs-lookup"><span data-stu-id="de0b6-178">If the task can't be recovered, it might be necessary to undo the work already performed by the task.</span></span> <span data-ttu-id="de0b6-179">También podría ser necesario implementar un patrón [Compensating Transaction](compensating-transaction.md).</span><span class="sxs-lookup"><span data-stu-id="de0b6-179">This might also require implementing a [compensating transaction](compensating-transaction.md).</span></span>

<span data-ttu-id="de0b6-180">La principal ventaja de este patrón es que el sistema es resistente a errores temporales inesperados o irrecuperables.</span><span class="sxs-lookup"><span data-stu-id="de0b6-180">The key advantage of this pattern is that the system is resilient in the event of unexpected temporary or unrecoverable failures.</span></span> <span data-ttu-id="de0b6-181">El sistema se puede construir para que se repare automáticamente.</span><span class="sxs-lookup"><span data-stu-id="de0b6-181">The system can be constructed to be self healing.</span></span> <span data-ttu-id="de0b6-182">Por ejemplo, si se produce un error en una instancia de Agent o Scheduler, se puede iniciar otra y Supervisor puede organizar la reanudación de una tarea.</span><span class="sxs-lookup"><span data-stu-id="de0b6-182">For example, if an Agent or the Scheduler fails, a new one can be started and the Supervisor can arrange for a task to be resumed.</span></span> <span data-ttu-id="de0b6-183">Si se produce un error en la instancia de Supervisor, otra puede iniciarse y retomarlo desde ese punto.</span><span class="sxs-lookup"><span data-stu-id="de0b6-183">If the Supervisor fails, another instance can be started and can take over from where the failure occurred.</span></span> <span data-ttu-id="de0b6-184">Si la instancia de Supervisor está programada para ejecutarse periódicamente, se puede iniciar automáticamente una nueva después de un intervalo predefinido.</span><span class="sxs-lookup"><span data-stu-id="de0b6-184">If the Supervisor is scheduled to run periodically, a new instance can be automatically started after a predefined interval.</span></span> <span data-ttu-id="de0b6-185">El almacén de estado se puede replicar hasta alcanzar un mayor grado de resistencia.</span><span class="sxs-lookup"><span data-stu-id="de0b6-185">The state store can be replicated to reach an even greater degree of resiliency.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="de0b6-186">Problemas y consideraciones</span><span class="sxs-lookup"><span data-stu-id="de0b6-186">Issues and considerations</span></span>

<span data-ttu-id="de0b6-187">A la hora de decidir cómo implementar este patrón, debe considerar los siguientes puntos:</span><span class="sxs-lookup"><span data-stu-id="de0b6-187">You should consider the following points when deciding how to implement this pattern:</span></span>

- <span data-ttu-id="de0b6-188">Este patrón puede ser difícil de implementar y requiere una comprobación exhaustiva de los posibles modos de error del sistema.</span><span class="sxs-lookup"><span data-stu-id="de0b6-188">This pattern can be difficult to implement and requires thorough testing of each possible failure mode of the system.</span></span>

- <span data-ttu-id="de0b6-189">La lógica de recuperación/reintento implementada por Scheduler es compleja y depende de la información de estado que se conserva en el almacén de estado.</span><span class="sxs-lookup"><span data-stu-id="de0b6-189">The recovery/retry logic implemented by the Scheduler is complex and dependent on state information held in the state store.</span></span> <span data-ttu-id="de0b6-190">También podría ser necesario registrar la información de implementación de una transacción de compensación en un almacén de datos durables.</span><span class="sxs-lookup"><span data-stu-id="de0b6-190">It might also be necessary to record the information required to implement a compensating transaction in a durable data store.</span></span>

- <span data-ttu-id="de0b6-191">La frecuencia de ejecución de Supervisor es importante.</span><span class="sxs-lookup"><span data-stu-id="de0b6-191">How often the Supervisor runs will be important.</span></span> <span data-ttu-id="de0b6-192">Debe ejecutarse con la frecuencia suficiente como para evitar que los pasos con error bloqueen una aplicación durante mucho tiempo, pero no demasiada como para sobrecargar.</span><span class="sxs-lookup"><span data-stu-id="de0b6-192">It should run often enough to prevent any failed steps from blocking an application for an extended period, but it shouldn't run so often that it becomes an overhead.</span></span>

- <span data-ttu-id="de0b6-193">Los pasos que realiza una instancia de Agent pueden ejecutarse más de una vez.</span><span class="sxs-lookup"><span data-stu-id="de0b6-193">The steps performed by an Agent could be run more than once.</span></span> <span data-ttu-id="de0b6-194">La lógica que implementa estos pasos debe ser idempotente.</span><span class="sxs-lookup"><span data-stu-id="de0b6-194">The logic that implements these steps should be idempotent.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="de0b6-195">Cuándo usar este patrón</span><span class="sxs-lookup"><span data-stu-id="de0b6-195">When to use this pattern</span></span>

<span data-ttu-id="de0b6-196">Utilice este patrón cuando un proceso que se ejecuta en un entorno distribuido, como la nube, debe ser resistente a los errores de comunicación u operativos.</span><span class="sxs-lookup"><span data-stu-id="de0b6-196">Use this pattern when a process that runs in a distributed environment, such as the cloud, must be resilient to communications failure and/or operational failure.</span></span>

<span data-ttu-id="de0b6-197">Este patrón puede no ser adecuado para las tareas que no invocan servicios remotos o acceden a recursos remotos.</span><span class="sxs-lookup"><span data-stu-id="de0b6-197">This pattern might not be suitable for tasks that don't invoke remote services or access remote resources.</span></span>

## <a name="example"></a><span data-ttu-id="de0b6-198">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="de0b6-198">Example</span></span>

<span data-ttu-id="de0b6-199">Una aplicación web que implementa un sistema de comercio electrónico se ha implementado en Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="de0b6-199">A web application that implements an ecommerce system has been deployed on Microsoft Azure.</span></span> <span data-ttu-id="de0b6-200">Los usuarios pueden ejecutar esta aplicación para examinar los productos disponibles y realizar pedidos.</span><span class="sxs-lookup"><span data-stu-id="de0b6-200">Users can run this application to browse the available products and to place orders.</span></span> <span data-ttu-id="de0b6-201">La interfaz de usuario se ejecuta como un rol web y los elementos de procesamiento de pedidos de la aplicación se implementan como conjunto de roles de trabajo.</span><span class="sxs-lookup"><span data-stu-id="de0b6-201">The user interface runs as a web role, and the order processing elements of the application are implemented as a set of worker roles.</span></span> <span data-ttu-id="de0b6-202">Parte de la lógica de procesamiento de pedidos implica el acceso a un servicio remoto y este aspecto del sistema podría ser propenso a errores transitorios o más duraderos.</span><span class="sxs-lookup"><span data-stu-id="de0b6-202">Part of the order processing logic involves accessing a remote service, and this aspect of the system could be prone to transient or more long-lasting faults.</span></span> <span data-ttu-id="de0b6-203">Por este motivo, los diseñadores utilizaron el patrón Scheduler Agent Supervisor para implementar los elementos de procesamiento de pedidos del sistema.</span><span class="sxs-lookup"><span data-stu-id="de0b6-203">For this reason, the designers used the Scheduler Agent Supervisor pattern to implement the order processing elements of the system.</span></span>

<span data-ttu-id="de0b6-204">Cuando un cliente realiza un pedido, la aplicación construye un mensaje que lo describe y envía este mensaje a una cola.</span><span class="sxs-lookup"><span data-stu-id="de0b6-204">When a customer places an order, the application constructs a message that describes the order and posts this message to a queue.</span></span> <span data-ttu-id="de0b6-205">Un proceso de envío independiente, que se ejecuta en un rol de trabajo, recupera el mensaje, inserta los detalles del pedido en la base de datos de pedidos y crea un registro para el proceso de pedido en el almacén de estado.</span><span class="sxs-lookup"><span data-stu-id="de0b6-205">A separate submission process, running in a worker role, retrieves the message, inserts the order details into the orders database, and creates a record for the order process in the state store.</span></span> <span data-ttu-id="de0b6-206">Tenga en cuenta que las inserciones en la base de datos de pedidos y el almacén de estado se realizan como parte de la misma operación.</span><span class="sxs-lookup"><span data-stu-id="de0b6-206">Note that the inserts into the orders database and the state store are performed as part of the same operation.</span></span> <span data-ttu-id="de0b6-207">El proceso de envío está diseñado para garantizar que ambas inserciones se realizan juntas.</span><span class="sxs-lookup"><span data-stu-id="de0b6-207">The submission process is designed to ensure that both inserts complete together.</span></span>

<span data-ttu-id="de0b6-208">La información de estado que crea el proceso de envío para el pedido incluye:</span><span class="sxs-lookup"><span data-stu-id="de0b6-208">The state information that the submission process creates for the order includes:</span></span>

- <span data-ttu-id="de0b6-209">**OrderID**.</span><span class="sxs-lookup"><span data-stu-id="de0b6-209">**OrderID**.</span></span> <span data-ttu-id="de0b6-210">Identificador del pedido en la base de datos de pedidos.</span><span class="sxs-lookup"><span data-stu-id="de0b6-210">The ID of the order in the orders database.</span></span>

- <span data-ttu-id="de0b6-211">**LockedBy**.</span><span class="sxs-lookup"><span data-stu-id="de0b6-211">**LockedBy**.</span></span> <span data-ttu-id="de0b6-212">Identificador de la instancia del rol de trabajo que controla el pedido.</span><span class="sxs-lookup"><span data-stu-id="de0b6-212">The instance ID of the worker role handling the order.</span></span> <span data-ttu-id="de0b6-213">Puede haber varias instancias actuales del rol de trabajo que ejecuten la instancia de Scheduler, pero solo una controla el pedido.</span><span class="sxs-lookup"><span data-stu-id="de0b6-213">There might be multiple current instances of the worker role running the Scheduler, but each order should only be handled by a single instance.</span></span>

- <span data-ttu-id="de0b6-214">**CompleteBy**.</span><span class="sxs-lookup"><span data-stu-id="de0b6-214">**CompleteBy**.</span></span> <span data-ttu-id="de0b6-215">Tiempo en el que se debe procesar el pedido.</span><span class="sxs-lookup"><span data-stu-id="de0b6-215">The time the order should be processed by.</span></span>

- <span data-ttu-id="de0b6-216">**ProcessState**.</span><span class="sxs-lookup"><span data-stu-id="de0b6-216">**ProcessState**.</span></span> <span data-ttu-id="de0b6-217">Estado actual de la tarea de control del pedido.</span><span class="sxs-lookup"><span data-stu-id="de0b6-217">The current state of the task handling the order.</span></span> <span data-ttu-id="de0b6-218">Los estados posibles son:</span><span class="sxs-lookup"><span data-stu-id="de0b6-218">The possible states are:</span></span>

    - <span data-ttu-id="de0b6-219">**Pending**.</span><span class="sxs-lookup"><span data-stu-id="de0b6-219">**Pending**.</span></span> <span data-ttu-id="de0b6-220">El pedido se ha creado, pero aún no se ha iniciado el procesamiento.</span><span class="sxs-lookup"><span data-stu-id="de0b6-220">The order has been created but processing hasn't yet been started.</span></span>
    - <span data-ttu-id="de0b6-221">**Processing**.</span><span class="sxs-lookup"><span data-stu-id="de0b6-221">**Processing**.</span></span> <span data-ttu-id="de0b6-222">El pedido se está procesando en este momento.</span><span class="sxs-lookup"><span data-stu-id="de0b6-222">The order is currently being processed.</span></span>
    - <span data-ttu-id="de0b6-223">**Processed**.</span><span class="sxs-lookup"><span data-stu-id="de0b6-223">**Processed**.</span></span> <span data-ttu-id="de0b6-224">El pedido se ha procesado correctamente.</span><span class="sxs-lookup"><span data-stu-id="de0b6-224">The order has been processed successfully.</span></span>
    - <span data-ttu-id="de0b6-225">**Error**.</span><span class="sxs-lookup"><span data-stu-id="de0b6-225">**Error**.</span></span> <span data-ttu-id="de0b6-226">Se ha producido un error en el procesamiento del pedido.</span><span class="sxs-lookup"><span data-stu-id="de0b6-226">The order processing has failed.</span></span>

- <span data-ttu-id="de0b6-227">**FailureCount**.</span><span class="sxs-lookup"><span data-stu-id="de0b6-227">**FailureCount**.</span></span> <span data-ttu-id="de0b6-228">Número de veces que se ha intentado procesar el pedido.</span><span class="sxs-lookup"><span data-stu-id="de0b6-228">The number of times that processing has been tried for the order.</span></span>

<span data-ttu-id="de0b6-229">En esta información de estado, el campo `OrderID` se copia desde el identificador de pedido del pedido nuevo.</span><span class="sxs-lookup"><span data-stu-id="de0b6-229">In this state information, the `OrderID` field is copied from the order ID of the new order.</span></span> <span data-ttu-id="de0b6-230">Los campos `LockedBy` y `CompleteBy` están establecidos en `null`, el campo `ProcessState`, en `Pending` y el campo `FailureCount`, en 0.</span><span class="sxs-lookup"><span data-stu-id="de0b6-230">The `LockedBy` and `CompleteBy` fields are set to `null`, the `ProcessState` field is set to `Pending`, and the `FailureCount` field is set to 0.</span></span>

> <span data-ttu-id="de0b6-231">En este ejemplo, la lógica de control de pedidos es relativamente sencilla y solo tiene un único paso que invoca un servicio remoto.</span><span class="sxs-lookup"><span data-stu-id="de0b6-231">In this example, the order handling logic is relatively simple and only has a single step that invokes a remote service.</span></span> <span data-ttu-id="de0b6-232">En un escenario de varios pasos más complejo, el proceso de envío puede implicar varios pasos, por lo que se crearán varios registros en el almacén de estado, que describirán cada uno el estado de un paso.</span><span class="sxs-lookup"><span data-stu-id="de0b6-232">In a more complex multistep scenario, the submission process would likely involve several steps, and so several records would be created in the state store—each one describing the state of an individual step.</span></span>

<span data-ttu-id="de0b6-233">Scheduler también se ejecuta como parte de un rol de trabajo e implementa la lógica de negocios que controla el pedido.</span><span class="sxs-lookup"><span data-stu-id="de0b6-233">The Scheduler also runs as part of a worker role and implements the business logic that handles the order.</span></span> <span data-ttu-id="de0b6-234">Una instancia de Scheduler que sondea nuevos pedidos examina el almacén de estado en busca de los registros donde el valor del campo `LockedBy` sea Null, mientras que el del campo `ProcessState` sea Pending.</span><span class="sxs-lookup"><span data-stu-id="de0b6-234">An instance of the Scheduler polling for new orders examines the state store for records where the `LockedBy` field is null and the `ProcessState` field is pending.</span></span> <span data-ttu-id="de0b6-235">Cuando Scheduler encuentra un nuevo pedido, inmediatamente rellena el campo `LockedBy` con su propio identificador de instancia, establece el campo `CompleteBy` en la hora adecuada y el campo `ProcessState` en Processing.</span><span class="sxs-lookup"><span data-stu-id="de0b6-235">When the Scheduler finds a new order, it immediately populates the `LockedBy` field with its own instance ID, sets the `CompleteBy` field to an appropriate time, and sets the `ProcessState` field to processing.</span></span> <span data-ttu-id="de0b6-236">El código está diseñado como exclusivo y atómico para garantizar que dos instancias simultáneas de Scheduler no pueden controlar el mismo pedido a la vez.</span><span class="sxs-lookup"><span data-stu-id="de0b6-236">The code is designed to be exclusive and atomic to ensure that two concurrent instances of the Scheduler can't try to handle the same order simultaneously.</span></span>

<span data-ttu-id="de0b6-237">A continuación, Scheduler ejecuta el flujo de trabajo empresarial para procesar el pedido de forma asincrónica, al pasar el valor del campo `OrderID` del almacén de estado.</span><span class="sxs-lookup"><span data-stu-id="de0b6-237">The Scheduler then runs the business workflow to process the order asynchronously, passing it the value in the `OrderID` field from the state store.</span></span> <span data-ttu-id="de0b6-238">El flujo de trabajo que controla el pedido recupera los detalles de este de la base de datos de pedidos y realiza su trabajo.</span><span class="sxs-lookup"><span data-stu-id="de0b6-238">The workflow handling the order retrieves the details of the order from the orders database and performs its work.</span></span> <span data-ttu-id="de0b6-239">Cuando un paso del flujo de trabajo de procesamiento del pedido necesita invocar el servicio remoto, utiliza una instancia de Agent.</span><span class="sxs-lookup"><span data-stu-id="de0b6-239">When a step in the order processing workflow needs to invoke the remote service, it uses an Agent.</span></span> <span data-ttu-id="de0b6-240">El paso del flujo de trabajo se comunica con Agent mediante un par de colas de mensajes de Azure Service Bus que actúan como canal de solicitud/respuesta.</span><span class="sxs-lookup"><span data-stu-id="de0b6-240">The workflow step communicates with the Agent using a pair of Azure Service Bus message queues acting as a request/response channel.</span></span> <span data-ttu-id="de0b6-241">En la ilustración se muestra una vista de alto nivel de la solución.</span><span class="sxs-lookup"><span data-stu-id="de0b6-241">The figure shows a high level view of the solution.</span></span>

![Figura 2: uso del patrón Scheduler Agent Supervisor para controlar los pedidos en una solución de Azure](./_images/scheduler-agent-supervisor-solution.png)

<span data-ttu-id="de0b6-243">El mensaje enviado a la instancia de Agent desde un paso del flujo de trabajo describe el pedido e incluye el tiempo de vigencia.</span><span class="sxs-lookup"><span data-stu-id="de0b6-243">The message sent to the Agent from a workflow step describes the order and includes the complete-by time.</span></span> <span data-ttu-id="de0b6-244">Si Agent recibe respuesta desde el servicio remoto antes de que expire el tiempo de vigencia, envía un mensaje de respuesta a la cola de Service Bus donde escucha el flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="de0b6-244">If the Agent receives a response from the remote service before the complete-by time expires, it posts a reply message on the Service Bus queue on which the workflow is listening.</span></span> <span data-ttu-id="de0b6-245">Cuando el paso del flujo de trabajo recibe el mensaje de respuesta válido, completa el procesamiento y Scheduler establece el campo "ProcessState" del estado de pedido en Processed.</span><span class="sxs-lookup"><span data-stu-id="de0b6-245">When the workflow step receives the valid reply message, it completes its processing and the Scheduler sets the \`ProcessState field of the order state to processed.</span></span> <span data-ttu-id="de0b6-246">En este momento, el procesamiento del pedido se ha completado correctamente.</span><span class="sxs-lookup"><span data-stu-id="de0b6-246">At this point, the order processing has completed successfully.</span></span>

<span data-ttu-id="de0b6-247">Si el tiempo de vigencia expira antes de que Agent reciba respuesta del servicio remoto, la instancia simplemente detiene el procesamiento y deja de controlar el pedido.</span><span class="sxs-lookup"><span data-stu-id="de0b6-247">If the complete-by time expires before the Agent receives a response from the remote service, the Agent simply halts its processing and terminates handling the order.</span></span> <span data-ttu-id="de0b6-248">De forma similar, si el flujo de trabajo que controla el pedido supera el tiempo de vigencia, también termina.</span><span class="sxs-lookup"><span data-stu-id="de0b6-248">Similarly, if the workflow handling the order exceeds the complete-by time, it also terminates.</span></span> <span data-ttu-id="de0b6-249">En ambos casos, el estado del pedido en el almacén de estado sigue como Processing, pero el tiempo de vigencia indica que ha transcurrido el tiempo de procesamiento del pedido y se considera que se ha producido un error.</span><span class="sxs-lookup"><span data-stu-id="de0b6-249">In both cases, the state of the order in the state store remains set to processing, but the complete-by time indicates that the time for processing the order has passed and the process is deemed to have failed.</span></span> <span data-ttu-id="de0b6-250">Tenga en cuenta que si la instancia de Agent que accede al servicio remoto o el flujo de trabajo que controla el pedido finalizan inesperadamente, la información del almacén de estado permanecerá como Processing y finalmente tendrá un valor de tiempo de vigencia expirado.</span><span class="sxs-lookup"><span data-stu-id="de0b6-250">Note that if the Agent that's accessing the remote service, or the workflow that's handling the order (or both) terminate unexpectedly, the information in the state store will again remain set to processing and eventually will have an expired complete-by value.</span></span>

<span data-ttu-id="de0b6-251">Si Agent detecta un error irrecuperable y permanente al intentar ponerse en contacto con el servicio remoto, puede enviar una respuesta de error al flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="de0b6-251">If the Agent detects an unrecoverable, nontransient fault while it's trying to contact the remote service, it can send an error response back to the workflow.</span></span> <span data-ttu-id="de0b6-252">Scheduler puede establecer el estado del pedido en Error y generar un evento que avise a un operador.</span><span class="sxs-lookup"><span data-stu-id="de0b6-252">The Scheduler can set the status of the order to error and raise an event that alerts an operator.</span></span> <span data-ttu-id="de0b6-253">Entonces, el operador puede intentar resolver manualmente la causa del error y volver a enviar el paso de procesamiento con error.</span><span class="sxs-lookup"><span data-stu-id="de0b6-253">The operator can then try to resolve the reason for the failure manually and resubmit the failed processing step.</span></span>

<span data-ttu-id="de0b6-254">Supervisor examina periódicamente el almacén de estado en busca de pedidos con valor de tiempo de vigencia expirado.</span><span class="sxs-lookup"><span data-stu-id="de0b6-254">The Supervisor periodically examines the state store looking for orders with an expired complete-by value.</span></span> <span data-ttu-id="de0b6-255">Si encuentra un registro, incrementa el campo `FailureCount`.</span><span class="sxs-lookup"><span data-stu-id="de0b6-255">If the Supervisor finds a record, it increments the `FailureCount` field.</span></span> <span data-ttu-id="de0b6-256">Si el valor de FailureCount está por debajo de un umbral determinado, Supervisor restablece el campo `LockedBy` en Null, actualiza el campo `CompleteBy` con un nuevo tiempo de vigencia y establece el campo `ProcessState` en Pending.</span><span class="sxs-lookup"><span data-stu-id="de0b6-256">If the failure count value is below a specified threshold value, the Supervisor resets the `LockedBy` field to null, updates the `CompleteBy` field with a new expiration time, and sets the `ProcessState` field to pending.</span></span> <span data-ttu-id="de0b6-257">Una instancia de Scheduler puede recoger este pedido y procesarlo como antes.</span><span class="sxs-lookup"><span data-stu-id="de0b6-257">An instance of the Scheduler can pick up this order and perform its processing as before.</span></span> <span data-ttu-id="de0b6-258">Si el valor de FailureCount supera un umbral determinado, se presupone que el error no es transitorio.</span><span class="sxs-lookup"><span data-stu-id="de0b6-258">If the failure count value exceeds a specified threshold, the reason for the failure is assumed to be nontransient.</span></span> <span data-ttu-id="de0b6-259">Supervisor establece el estado del pedido en Error y genera un evento que avisa a un operador.</span><span class="sxs-lookup"><span data-stu-id="de0b6-259">The Supervisor sets the status of the order to error and raises an event that alerts an operator.</span></span>

> <span data-ttu-id="de0b6-260">En este ejemplo, la instancia de Supervisor se implementa en un rol de trabajo independiente.</span><span class="sxs-lookup"><span data-stu-id="de0b6-260">In this example, the Supervisor is implemented in a separate worker role.</span></span> <span data-ttu-id="de0b6-261">Puede usar una variedad de estrategias para organizar la ejecución de la tarea de Supervisor, como el servicio Azure Scheduler (que no debe confundirse con el componente Scheduler de este patrón).</span><span class="sxs-lookup"><span data-stu-id="de0b6-261">You can use a variety of strategies to arrange for the Supervisor task to be run, including using the Azure Scheduler service (not to be confused with the Scheduler component in this pattern).</span></span> <span data-ttu-id="de0b6-262">Para obtener más información sobre el servicio Azure Scheduler, visite la página de [Scheduler](https://azure.microsoft.com/services/scheduler/).</span><span class="sxs-lookup"><span data-stu-id="de0b6-262">For more information about the Azure Scheduler service, visit the [Scheduler](https://azure.microsoft.com/services/scheduler/) page.</span></span>

<span data-ttu-id="de0b6-263">Aunque no se muestra en este ejemplo, Scheduler puede necesitar mantener informada a la aplicación que envió el pedido sobre el progreso y el estado de este.</span><span class="sxs-lookup"><span data-stu-id="de0b6-263">Although it isn't shown in this example, the Scheduler might need to keep the application that submitted the order informed about the progress and status of the order.</span></span> <span data-ttu-id="de0b6-264">La aplicación y Scheduler están aislados entre ellos para que no dependan el uno del otro.</span><span class="sxs-lookup"><span data-stu-id="de0b6-264">The application and the Scheduler are isolated from each other to eliminate any dependencies between them.</span></span> <span data-ttu-id="de0b6-265">La aplicación no sabe qué instancia de Scheduler controla el pedido y Scheduler desconoce la instancia de aplicación que lo envió.</span><span class="sxs-lookup"><span data-stu-id="de0b6-265">The application has no knowledge of which instance of the Scheduler is handling the order, and the Scheduler is unaware of which specific application instance posted the order.</span></span>

<span data-ttu-id="de0b6-266">Para permitir informar del estado del pedido, la aplicación puede usar su propia cola de respuestas privada.</span><span class="sxs-lookup"><span data-stu-id="de0b6-266">To allow the order status to be reported, the application could use its own private response queue.</span></span> <span data-ttu-id="de0b6-267">Los detalles de esta cola de respuestas se incluiría como parte de la solicitud al proceso de envío, que incluiría esta información en el almacén de estado.</span><span class="sxs-lookup"><span data-stu-id="de0b6-267">The details of this response queue would be included as part of the request sent to the submission process, which would include this information in the state store.</span></span> <span data-ttu-id="de0b6-268">Scheduler publicaría mensajes en esta cola que indicaran el estado del pedido (solicitud recibida, pedido completado, error en el pedido, etc.).</span><span class="sxs-lookup"><span data-stu-id="de0b6-268">The Scheduler would then post messages to this queue indicating the status of the order (request received, order completed, order failed, and so on).</span></span> <span data-ttu-id="de0b6-269">En estos mensajes debe incluirse el identificador de pedido para que la aplicación los pueda correlacionar con la solicitud original.</span><span class="sxs-lookup"><span data-stu-id="de0b6-269">It should include the order ID in these messages so they can be correlated with the original request by the application.</span></span>

## <a name="related-patterns-and-guidance"></a><span data-ttu-id="de0b6-270">Orientación y patrones relacionados</span><span class="sxs-lookup"><span data-stu-id="de0b6-270">Related patterns and guidance</span></span>

<span data-ttu-id="de0b6-271">Los patrones y las directrices siguientes también pueden ser importantes a la hora de implementar este modelo:</span><span class="sxs-lookup"><span data-stu-id="de0b6-271">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>
- <span data-ttu-id="de0b6-272">[Patrón Retry][retry-pattern].</span><span class="sxs-lookup"><span data-stu-id="de0b6-272">[Retry pattern][retry-pattern].</span></span> <span data-ttu-id="de0b6-273">Las instancias de Agent pueden usar este patrón para reintentar una operación con acceso a un servicio o recurso remoto que haya producido un error previamente de forma transparente.</span><span class="sxs-lookup"><span data-stu-id="de0b6-273">An Agent can use this pattern to transparently retry an operation that accesses a remote service or resource that has previously failed.</span></span> <span data-ttu-id="de0b6-274">Se utiliza cuando se cree que la causa del error es transitoria y se puede corregir.</span><span class="sxs-lookup"><span data-stu-id="de0b6-274">Use when the expectation is that the cause of the failure is transient and can be corrected.</span></span>
- <span data-ttu-id="de0b6-275">[Patrón Circuit Breaker](circuit-breaker.md).</span><span class="sxs-lookup"><span data-stu-id="de0b6-275">[Circuit Breaker pattern](circuit-breaker.md).</span></span> <span data-ttu-id="de0b6-276">Una instancia de Agent puede utilizar este patrón para controlar errores que tardan un tiempo variable en solucionarse durante la conexión a un recurso o servicio remoto.</span><span class="sxs-lookup"><span data-stu-id="de0b6-276">An Agent can use this pattern to handle faults that take a variable amount of time to correct when connecting to a remote service or resource.</span></span>
- <span data-ttu-id="de0b6-277">[Patrón Compensating Transaction](compensating-transaction.md).</span><span class="sxs-lookup"><span data-stu-id="de0b6-277">[Compensating Transaction pattern](compensating-transaction.md).</span></span> <span data-ttu-id="de0b6-278">Si el flujo de trabajo que realiza una instancia de Scheduler no se puede completar correctamente, podría ser necesario deshacer el trabajo anterior.</span><span class="sxs-lookup"><span data-stu-id="de0b6-278">If the workflow being performed by a Scheduler can't be completed successfully, it might be necessary to undo any work it's previously performed.</span></span> <span data-ttu-id="de0b6-279">El patrón Compensating Transaction describe la manera de lograrlo para las operaciones que siguen el modelo de coherencia final.</span><span class="sxs-lookup"><span data-stu-id="de0b6-279">The Compensating Transaction pattern describes how this can be achieved for operations that follow the eventual consistency model.</span></span> <span data-ttu-id="de0b6-280">Estos tipos de operaciones las implementa normalmente una instancia de Scheduler que realiza flujos de trabajo y procesos empresariales complejos.</span><span class="sxs-lookup"><span data-stu-id="de0b6-280">These types of operations are commonly implemented by a Scheduler that performs complex business processes and workflows.</span></span>
- <span data-ttu-id="de0b6-281">[Manual de mensajería asincrónica](https://msdn.microsoft.com/library/dn589781.aspx).</span><span class="sxs-lookup"><span data-stu-id="de0b6-281">[Asynchronous Messaging Primer](https://msdn.microsoft.com/library/dn589781.aspx).</span></span> <span data-ttu-id="de0b6-282">En general, los componentes del patrón Scheduler Agent Supervisor se ejecutan desacoplados entre ellos y se comunican de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="de0b6-282">The components in the Scheduler Agent Supervisor pattern typically run decoupled from each other and communicate asynchronously.</span></span> <span data-ttu-id="de0b6-283">Describe algunos de los posibles enfoques para implementar la comunicación asincrónica basada en colas de mensajes.</span><span class="sxs-lookup"><span data-stu-id="de0b6-283">Describes some of the approaches that can be used to implement asynchronous communication based on message queues.</span></span>
- <span data-ttu-id="de0b6-284">[Patrón Leader Election](leader-election.md).</span><span class="sxs-lookup"><span data-stu-id="de0b6-284">[Leader Election pattern](leader-election.md).</span></span> <span data-ttu-id="de0b6-285">Podría ser necesario coordinar las acciones de varias instancias de Supervisor para impedir que intenten recuperar el mismo proceso con error.</span><span class="sxs-lookup"><span data-stu-id="de0b6-285">It might be necessary to coordinate the actions of multiple instances of a Supervisor to prevent them from attempting to recover the same failed process.</span></span> <span data-ttu-id="de0b6-286">El patrón Leader Election describe cómo hacerlo.</span><span class="sxs-lookup"><span data-stu-id="de0b6-286">The Leader Election pattern describes how to do this.</span></span>
- <span data-ttu-id="de0b6-287">[Cloud Architecture: The Scheduler-Agent-Supervisor Pattern](https://blogs.msdn.microsoft.com/clemensv/2010/09/27/cloud-architecture-the-scheduler-agent-supervisor-pattern/) (Arquitectura en la nube: patrón Scheduler-Agent-Supervisor) en el blog de Clemens Vasters</span><span class="sxs-lookup"><span data-stu-id="de0b6-287">[Cloud Architecture: The Scheduler-Agent-Supervisor Pattern](https://blogs.msdn.microsoft.com/clemensv/2010/09/27/cloud-architecture-the-scheduler-agent-supervisor-pattern/) on Clemens Vasters' blog</span></span>
- [<span data-ttu-id="de0b6-288">Patrón Process Manager</span><span class="sxs-lookup"><span data-stu-id="de0b6-288">Process Manager pattern</span></span>](https://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html)
- <span data-ttu-id="de0b6-289">[Reference 6: A Saga on Sagas](https://msdn.microsoft.com/library/jj591569.aspx) (Referencia 6: una saga sobre sagas).</span><span class="sxs-lookup"><span data-stu-id="de0b6-289">[Reference 6: A Saga on Sagas](https://msdn.microsoft.com/library/jj591569.aspx).</span></span> <span data-ttu-id="de0b6-290">Ejemplo que muestra el uso de un administrador de procesos por el patrón CQRS (parte de la guía de viaje de CQRS).</span><span class="sxs-lookup"><span data-stu-id="de0b6-290">An example showing how the CQRS pattern uses a process manager (part of the CQRS Journey guidance).</span></span>
- [<span data-ttu-id="de0b6-291">Microsoft Azure Scheduler</span><span class="sxs-lookup"><span data-stu-id="de0b6-291">Microsoft Azure Scheduler</span></span>](https://azure.microsoft.com/services/scheduler/)

[retry-pattern]: ./retry.md
