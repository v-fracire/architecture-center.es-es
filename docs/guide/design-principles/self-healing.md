---
title: Diseño para la recuperación automática
description: Las aplicaciones resistentes pueden recuperarse de errores sin intervención manual.
author: MikeWasson
ms.date: 08/30/2018
ms.openlocfilehash: f85e3881fe7753f0551d1d31dd64b4631b441686
ms.sourcegitcommit: ae8a1de6f4af7a89a66a8339879843d945201f85
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 08/31/2018
ms.locfileid: "43325815"
---
# <a name="design-for-self-healing"></a><span data-ttu-id="446ac-103">Diseño para la recuperación automática</span><span class="sxs-lookup"><span data-stu-id="446ac-103">Design for self healing</span></span>

## <a name="design-your-application-to-be-self-healing-when-failures-occur"></a><span data-ttu-id="446ac-104">Diseñe la aplicación para que se recupere automáticamente cuando esto suceda.</span><span class="sxs-lookup"><span data-stu-id="446ac-104">Design your application to be self healing when failures occur</span></span>

<span data-ttu-id="446ac-105">En un sistema distribuido, se producen errores.</span><span class="sxs-lookup"><span data-stu-id="446ac-105">In a distributed system, failures happen.</span></span> <span data-ttu-id="446ac-106">Pueden producirse errores de hardware.</span><span class="sxs-lookup"><span data-stu-id="446ac-106">Hardware can fail.</span></span> <span data-ttu-id="446ac-107">La red puede tener errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="446ac-107">The network can have transient failures.</span></span> <span data-ttu-id="446ac-108">En raras ocasiones, todo un servicio o toda una región pueden experimentar interrupciones, pero incluso estas deben planificarse.</span><span class="sxs-lookup"><span data-stu-id="446ac-108">Rarely, an entire service or region may experience a disruption, but even those must be planned for.</span></span>

<span data-ttu-id="446ac-109">Por tanto, diseñe una aplicación para que se recupere automáticamente cuando esto suceda.</span><span class="sxs-lookup"><span data-stu-id="446ac-109">Therefore, design an application to be self healing when failures occur.</span></span> <span data-ttu-id="446ac-110">Esto requiere un enfoque basado en tres puntos:</span><span class="sxs-lookup"><span data-stu-id="446ac-110">This requires a three-pronged approach:</span></span>

- <span data-ttu-id="446ac-111">Detectar errores.</span><span class="sxs-lookup"><span data-stu-id="446ac-111">Detect failures.</span></span>
- <span data-ttu-id="446ac-112">Responder a los errores correctamente.</span><span class="sxs-lookup"><span data-stu-id="446ac-112">Respond to failures gracefully.</span></span>
- <span data-ttu-id="446ac-113">Registrar y supervisar los errores a fin de conseguir una perspectiva operativa.</span><span class="sxs-lookup"><span data-stu-id="446ac-113">Log and monitor failures, to give operational insight.</span></span>

<span data-ttu-id="446ac-114">La manera de responder a un determinado tipo de error puede depender de los requisitos de disponibilidad de su aplicación.</span><span class="sxs-lookup"><span data-stu-id="446ac-114">How you respond to a particular type of failure may depend on your application's availability requirements.</span></span> <span data-ttu-id="446ac-115">Por ejemplo, si necesita una disponibilidad muy alta, puede conmutar por error automáticamente a una región secundaria durante una interrupción regional del sistema.</span><span class="sxs-lookup"><span data-stu-id="446ac-115">For example, if you require very high availability, you might automatically fail over to a secondary region during a regional outage.</span></span> <span data-ttu-id="446ac-116">Sin embargo, con esto incurrirá en un costo mayor que el de una implementación en una sola región.</span><span class="sxs-lookup"><span data-stu-id="446ac-116">However, that will incur a higher cost than a single-region deployment.</span></span> 

<span data-ttu-id="446ac-117">Además, no piense solo en grandes eventos como interrupciones regionales, que suelen ser poco frecuentes.</span><span class="sxs-lookup"><span data-stu-id="446ac-117">Also, don't just consider big events like regional outages, which are generally rare.</span></span> <span data-ttu-id="446ac-118">Debe centrarse igualmente, si no más, en la gestión de los errores locales y de corta duración, como los errores de conectividad de red o los errores en la conexión a una base de datos.</span><span class="sxs-lookup"><span data-stu-id="446ac-118">You should focus as much, if not more, on handling local, short-lived failures, such as network connectivity failures or failed database connections.</span></span>

## <a name="recommendations"></a><span data-ttu-id="446ac-119">Recomendaciones</span><span class="sxs-lookup"><span data-stu-id="446ac-119">Recommendations</span></span>

<span data-ttu-id="446ac-120">**Vuelva a intentar las operaciones que den error**.</span><span class="sxs-lookup"><span data-stu-id="446ac-120">**Retry failed operations**.</span></span> <span data-ttu-id="446ac-121">Los errores transitorios pueden deberse a una pérdida momentánea de conectividad de red, una conexión de base de datos caída o un tiempo de espera agotado cuando un servicio está ocupado.</span><span class="sxs-lookup"><span data-stu-id="446ac-121">Transient failures may occur due to momentary loss of network connectivity, a dropped database connection, or a timeout when a service is busy.</span></span> <span data-ttu-id="446ac-122">Cree la lógica de reintento en la aplicación para controlar los errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="446ac-122">Build retry logic into your application to handle transient failures.</span></span> <span data-ttu-id="446ac-123">En muchos de los servicios de Azure, el SDK de cliente implementa los reintentos automáticos.</span><span class="sxs-lookup"><span data-stu-id="446ac-123">For many Azure services, the client SDK implements automatic retries.</span></span> <span data-ttu-id="446ac-124">Para obtener más información, consulte [Transient fault handling][transient-fault-handling] (Control de errores transitorios) y [Retry Pattern][retry] (Patron de reintento).</span><span class="sxs-lookup"><span data-stu-id="446ac-124">For more information, see [Transient fault handling][transient-fault-handling] and [Retry Pattern][retry].</span></span>

<span data-ttu-id="446ac-125">**Proteja los servicios remotos defectuosos (Circuit Breaker)**.</span><span class="sxs-lookup"><span data-stu-id="446ac-125">**Protect failing remote services (Circuit Breaker)**.</span></span> <span data-ttu-id="446ac-126">Es conveniente hacer un reintento después de un error transitorio, pero si el error persiste, puede acabar con demasiados llamadores agolpándose en un servicio con errores.</span><span class="sxs-lookup"><span data-stu-id="446ac-126">It's good to retry after a transient failure, but if the failure persists, you can end up with too many callers hammering a failing service.</span></span> <span data-ttu-id="446ac-127">Esto puede provocar errores en cascada, ya que se hace una copia de seguridad de las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="446ac-127">This can lead to cascading failures, as requests back up.</span></span> <span data-ttu-id="446ac-128">Use el [patrón Circuit Breaker][circuit-breaker] para fracasar y responder rápido a los errores (sin realizar la llamada remota) cuando es probable que una operación genere un error.</span><span class="sxs-lookup"><span data-stu-id="446ac-128">Use the [Circuit Breaker Pattern][circuit-breaker] to fail fast (without making the remote call) when an operation is likely to fail.</span></span>  

<span data-ttu-id="446ac-129">**Aísle recursos críticos (Bulkhead)**.</span><span class="sxs-lookup"><span data-stu-id="446ac-129">**Isolate critical resources (Bulkhead)**.</span></span> <span data-ttu-id="446ac-130">Los errores de un subsistema a veces pueden reproducirse en cascada.</span><span class="sxs-lookup"><span data-stu-id="446ac-130">Failures in one subsystem can sometimes cascade.</span></span> <span data-ttu-id="446ac-131">Esto puede ocurrir si un error provoca que algunos recursos, como subprocesos o sockets, no se liberen a tiempo, lo que conduce a un agotamiento de estos.</span><span class="sxs-lookup"><span data-stu-id="446ac-131">This can happen if a failure causes some resources, such as threads or sockets, not to get freed in a timely manner, leading to resource exhaustion.</span></span> <span data-ttu-id="446ac-132">Para evitarlo, realice una partición de un sistema en grupos aislados, de modo que un error en una partición no destruya todo el sistema.</span><span class="sxs-lookup"><span data-stu-id="446ac-132">To avoid this, partition a system into isolated groups, so that a failure in one partition does not bring down the entire system.</span></span>  

<span data-ttu-id="446ac-133">**Realice una redistribución de la carga**.</span><span class="sxs-lookup"><span data-stu-id="446ac-133">**Perform load leveling**.</span></span> <span data-ttu-id="446ac-134">Las aplicaciones pueden experimentar picos repentinos en el tráfico, lo que puede sobrecargar los servicios en el back-end.</span><span class="sxs-lookup"><span data-stu-id="446ac-134">Applications may experience sudden spikes in traffic that can overwhelm services on the backend.</span></span> <span data-ttu-id="446ac-135">Para evitarlo, utilice el [patrón Queue-Based Load Leveling][load-level] para poner en cola los elementos de trabajo que se ejecutan de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="446ac-135">To avoid this, use the [Queue-Based Load Leveling Pattern][load-level] to queue work items to run asynchronously.</span></span> <span data-ttu-id="446ac-136">La cola actúa como un búfer que suaviza los picos de carga.</span><span class="sxs-lookup"><span data-stu-id="446ac-136">The queue acts as a buffer that smooths out peaks in the load.</span></span> 

<span data-ttu-id="446ac-137">**Realice una conmutación por error**.</span><span class="sxs-lookup"><span data-stu-id="446ac-137">**Fail over**.</span></span> <span data-ttu-id="446ac-138">Si no se puede tener acceso a una instancia, aplique una conmutación por error a otra instancia.</span><span class="sxs-lookup"><span data-stu-id="446ac-138">If an instance can't be reached, fail over to another instance.</span></span> <span data-ttu-id="446ac-139">En el caso de los elementos que no tienen estado, como un servidor web, coloque varias instancias detrás de un equilibrador de carga o el administrador de tráfico.</span><span class="sxs-lookup"><span data-stu-id="446ac-139">For things that are stateless, like a web server, put several instances behind a load balancer or traffic manager.</span></span> <span data-ttu-id="446ac-140">En el caso de los elementos que almacenan el estado, como una base de datos, use réplicas y la conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="446ac-140">For things that store state, like a database, use replicas and fail over.</span></span> <span data-ttu-id="446ac-141">En función del almacén de datos y del modo en que se replique, esto puede requerir que la aplicación adopte la coherencia final.</span><span class="sxs-lookup"><span data-stu-id="446ac-141">Depending on the data store and how it replicates, this may require the application to deal with eventual consistency.</span></span> 

<span data-ttu-id="446ac-142">**Compense las transacciones con error**.</span><span class="sxs-lookup"><span data-stu-id="446ac-142">**Compensate failed transactions**.</span></span> <span data-ttu-id="446ac-143">En general, evite las transacciones distribuidas, ya que requieren coordinación a través de servicios y recursos.</span><span class="sxs-lookup"><span data-stu-id="446ac-143">In general, avoid distributed transactions, as they require coordination across services and resources.</span></span> <span data-ttu-id="446ac-144">En su lugar, componga una operación a partir de transacciones individuales más pequeñas.</span><span class="sxs-lookup"><span data-stu-id="446ac-144">Instead, compose an operation from smaller individual transactions.</span></span> <span data-ttu-id="446ac-145">Si la operación genera un error a mitad del proceso, use [las transacciones de compensación][compensating-transactions] para deshacer cualquier paso que ya haya completado.</span><span class="sxs-lookup"><span data-stu-id="446ac-145">If the operation fails midway through, use [Compensating Transactions][compensating-transactions] to undo any step that already completed.</span></span> 

<span data-ttu-id="446ac-146">**Aplique puntos de control a las transacciones de ejecución prolongada**.</span><span class="sxs-lookup"><span data-stu-id="446ac-146">**Checkpoint long-running transactions**.</span></span> <span data-ttu-id="446ac-147">Los puntos de control pueden proporcionar resistencia si se produce un error en una operación de ejecución prolongada.</span><span class="sxs-lookup"><span data-stu-id="446ac-147">Checkpoints can provide resiliency if a long-running operation fails.</span></span> <span data-ttu-id="446ac-148">Cuando la operación se reinicia (por ejemplo, si la recoge otra máquina virtual), es posible reanudar desde el último punto de control.</span><span class="sxs-lookup"><span data-stu-id="446ac-148">When the operation restarts (for example, it is picked up by another VM), it can be resumed from the last checkpoint.</span></span>

<span data-ttu-id="446ac-149">**Degrade de manera correcta**.</span><span class="sxs-lookup"><span data-stu-id="446ac-149">**Degrade gracefully**.</span></span> <span data-ttu-id="446ac-150">En ocasiones no es posible solucionar un problema, pero puede proporcionar una funcionalidad reducida que sigue siendo útil.</span><span class="sxs-lookup"><span data-stu-id="446ac-150">Sometimes you can't work around a problem, but you can provide reduced functionality that is still useful.</span></span> <span data-ttu-id="446ac-151">Piense en una aplicación que muestre un catálogo de libros.</span><span class="sxs-lookup"><span data-stu-id="446ac-151">Consider an application that shows a catalog of books.</span></span> <span data-ttu-id="446ac-152">Si la aplicación no puede recuperar la imagen en miniatura de la portada, puede que muestre una imagen de marcador de posición.</span><span class="sxs-lookup"><span data-stu-id="446ac-152">If the application can't retrieve the thumbnail image for the cover, it might show a placeholder image.</span></span> <span data-ttu-id="446ac-153">Es posible que para la aplicación no sea esencial contar con subsistemas completos.</span><span class="sxs-lookup"><span data-stu-id="446ac-153">Entire subsystems might be noncritical for the application.</span></span> <span data-ttu-id="446ac-154">Por ejemplo, en un sitio de comercio electrónico, mostrar las recomendaciones de productos es probablemente menos crítico que procesar los pedidos.</span><span class="sxs-lookup"><span data-stu-id="446ac-154">For example, in an e-commerce site, showing product recommendations is probably less critical than processing orders.</span></span>

<span data-ttu-id="446ac-155">**Limite los clientes**.</span><span class="sxs-lookup"><span data-stu-id="446ac-155">**Throttle clients**.</span></span> <span data-ttu-id="446ac-156">En ocasiones, un número reducido de usuarios crea una carga excesiva, lo que puede reducir la disponibilidad de la aplicación para otros usuarios.</span><span class="sxs-lookup"><span data-stu-id="446ac-156">Sometimes a small number of users create excessive load, which can reduce your application's availability for other users.</span></span> <span data-ttu-id="446ac-157">En esta situación, limite el cliente durante un período de tiempo determinado.</span><span class="sxs-lookup"><span data-stu-id="446ac-157">In this situation, throttle the client for a certain period of time.</span></span> <span data-ttu-id="446ac-158">Vea el [patrón de limitación][throttle].</span><span class="sxs-lookup"><span data-stu-id="446ac-158">See [Throttling Pattern][throttle].</span></span>

<span data-ttu-id="446ac-159">**Bloquee a los actores no válidos**.</span><span class="sxs-lookup"><span data-stu-id="446ac-159">**Block bad actors**.</span></span> <span data-ttu-id="446ac-160">El hecho de que limite a un cliente no significa que ese cliente estuviera actuando de manera malintencionada.</span><span class="sxs-lookup"><span data-stu-id="446ac-160">Just because you throttle a client, it doesn't mean client was acting maliciously.</span></span> <span data-ttu-id="446ac-161">Simplemente significa que el cliente ha superado su cuota de servicio.</span><span class="sxs-lookup"><span data-stu-id="446ac-161">It just means the client exceeded their service quota.</span></span> <span data-ttu-id="446ac-162">Pero si un cliente supera constantemente su cuota o se comporta de manera incorrecta, tiene la posibilidad de bloquearlo.</span><span class="sxs-lookup"><span data-stu-id="446ac-162">But if a client consistently exceeds their quota or otherwise behaves badly, you might block them.</span></span> <span data-ttu-id="446ac-163">Defina un proceso fuera de banda para que el usuario solicite ser desbloqueado.</span><span class="sxs-lookup"><span data-stu-id="446ac-163">Define an out-of-band process for user to request getting unblocked.</span></span>

<span data-ttu-id="446ac-164">**Use Leader Election**.</span><span class="sxs-lookup"><span data-stu-id="446ac-164">**Use leader election**.</span></span> <span data-ttu-id="446ac-165">Cuando necesite coordinar una tarea, use [Leader Election][leader-election] para seleccionar un coordinador.</span><span class="sxs-lookup"><span data-stu-id="446ac-165">When you need to coordinate a task, use [Leader Election][leader-election] to select a coordinator.</span></span> <span data-ttu-id="446ac-166">De este modo, el coordinador no es un único punto de error.</span><span class="sxs-lookup"><span data-stu-id="446ac-166">That way, the coordinator is not a single point of failure.</span></span> <span data-ttu-id="446ac-167">Si se produce un error en el coordinador, se selecciona uno nuevo.</span><span class="sxs-lookup"><span data-stu-id="446ac-167">If the coordinator fails, a new one is selected.</span></span> <span data-ttu-id="446ac-168">En lugar de implementar un algoritmo de elección de líder desde el principio, considere la posibilidad de una solución inmediata, como Zookeeper.</span><span class="sxs-lookup"><span data-stu-id="446ac-168">Rather than implement a leader election algorithm from scratch, consider an off-the-shelf solution such as Zookeeper.</span></span>  

<span data-ttu-id="446ac-169">**Realice pruebas con inserción de errores**.</span><span class="sxs-lookup"><span data-stu-id="446ac-169">**Test with fault injection**.</span></span> <span data-ttu-id="446ac-170">Con demasiada frecuencia, la ruta de acceso correcta está bien probada, pero no así la ruta de acceso para errores.</span><span class="sxs-lookup"><span data-stu-id="446ac-170">All too often, the success path is well tested but not the failure path.</span></span> <span data-ttu-id="446ac-171">Un sistema podría ejecutarse en producción durante mucho tiempo antes de que se utilice una ruta de acceso para errores.</span><span class="sxs-lookup"><span data-stu-id="446ac-171">A system could run in production for a long time before a failure path is exercised.</span></span> <span data-ttu-id="446ac-172">Use la inserción de errores para probar la resistencia del sistema a los errores, ya sea mediante la activación de errores reales o mediante su simulación.</span><span class="sxs-lookup"><span data-stu-id="446ac-172">Use fault injection to test the resiliency of the system to failures, either by triggering actual failures or by simulating them.</span></span> 

<span data-ttu-id="446ac-173">**Adopte la ingeniería del caos**.</span><span class="sxs-lookup"><span data-stu-id="446ac-173">**Embrace chaos engineering**.</span></span> <span data-ttu-id="446ac-174">La ingeniería del caos amplía la noción de inserción de errores mediante la inserción aleatoria de errores o condiciones irregulares en instancias de producción.</span><span class="sxs-lookup"><span data-stu-id="446ac-174">Chaos engineering extends the notion of fault injection, by randomly injecting failures or abnormal conditions into production instances.</span></span> 

<span data-ttu-id="446ac-175">Para consultar un enfoque estructurado que haga que sus aplicaciones se recuperen de manera automática, consulte [Diseño de aplicaciones resistentes de Azure][resiliency-overview].</span><span class="sxs-lookup"><span data-stu-id="446ac-175">For a structured approach to making your applications self healing, see [Design resilient applications for Azure][resiliency-overview].</span></span>  

[circuit-breaker]: ../../patterns/circuit-breaker.md
[compensating-transactions]: ../../patterns/compensating-transaction.md
[leader-election]: ../../patterns/leader-election.md
[load-level]: ../../patterns/queue-based-load-leveling.md
[resiliency-overview]: ../../resiliency/index.md
[retry]: ../../patterns/retry.md
[throttle]: ../../patterns/throttling.md
[transient-fault-handling]: ../../best-practices/transient-faults.md

