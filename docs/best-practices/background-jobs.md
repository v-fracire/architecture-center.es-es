---
title: Orientación sobre los trabajos de segundo plano
description: Orientación sobre las tareas en segundo plano que se ejecutan independientemente de la interfaz de usuario.
author: dragon119
ms.date: 05/24/2017
pnp.series.title: Best Practices
ms.openlocfilehash: 57fd7a6cc400b53e51e08fb5a1377dce4ae61327
ms.sourcegitcommit: e9eb2b895037da0633ef3ccebdea2fcce047620f
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/30/2018
ms.locfileid: "50251930"
---
# <a name="background-jobs"></a><span data-ttu-id="88be9-103">Trabajos en segundo plano</span><span class="sxs-lookup"><span data-stu-id="88be9-103">Background jobs</span></span>
[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="88be9-104">Muchos tipos de aplicaciones requieren tareas en segundo plano que se ejecutan independientemente de la interfaz de usuario (UI).</span><span class="sxs-lookup"><span data-stu-id="88be9-104">Many types of applications require background tasks that run independently of the user interface (UI).</span></span> <span data-ttu-id="88be9-105">Algunos ejemplos incluyen trabajos por lotes, tareas de procesamiento intensivas y procesos de ejecución prolongada, como flujos de trabajo.</span><span class="sxs-lookup"><span data-stu-id="88be9-105">Examples include batch jobs, intensive processing tasks, and long-running processes such as workflows.</span></span> <span data-ttu-id="88be9-106">Los trabajos en segundo plano pueden ejecutarse sin intervención del usuario. La aplicación puede iniciar el trabajo y seguir procesando las solicitudes interactivas de los usuarios.</span><span class="sxs-lookup"><span data-stu-id="88be9-106">Background jobs can be executed without requiring user interaction--the application can start the job and then continue to process interactive requests from users.</span></span> <span data-ttu-id="88be9-107">Esto puede ayudar a reducir la carga en la interfaz de usuario de la aplicación, lo que puede mejorar la disponibilidad y reducir los tiempos de respuesta interactiva.</span><span class="sxs-lookup"><span data-stu-id="88be9-107">This can help to minimize the load on the application UI, which can improve availability and reduce interactive response times.</span></span>

<span data-ttu-id="88be9-108">Por ejemplo, si una aplicación necesita generar miniaturas de imágenes cargadas por los usuarios, puede hacerlo como un trabajo en segundo plano y guardar la miniatura en el almacenamiento una vez completado el proceso, sin que el usuario tenga que esperar hasta que el proceso se complete.</span><span class="sxs-lookup"><span data-stu-id="88be9-108">For example, if an application is required to generate thumbnails of images that are uploaded by users, it can do this as a background job and save the thumbnail to storage when it is complete--without the user needing to wait for the process to be completed.</span></span> <span data-ttu-id="88be9-109">Del mismo modo, un usuario que haga un pedido puede iniciar un flujo de trabajo en segundo plano que procese el pedido, mientras que la interfaz de usuario permite al usuario seguir explorando la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="88be9-109">In the same way, a user placing an order can initiate a background workflow that processes the order, while the UI allows the user to continue browsing the web app.</span></span> <span data-ttu-id="88be9-110">Cuando se complete el trabajo en segundo plano, puede actualizar los datos de pedidos almacenados y enviar un correo electrónico al usuario que confirma el pedido.</span><span class="sxs-lookup"><span data-stu-id="88be9-110">When the background job is complete, it can update the stored orders data and send an email to the user that confirms the order.</span></span>

<span data-ttu-id="88be9-111">Cuando considere si una tarea se debe implementar como un trabajo en segundo plano, el criterio principal es si la tarea se puede ejecutar sin la interacción del usuario y sin que la interfaz de usuario tenga que esperar a que el trabajo se complete.</span><span class="sxs-lookup"><span data-stu-id="88be9-111">When you consider whether to implement a task as a background job, the main criteria is whether the task can run without user interaction and without the UI needing to wait for the job to be completed.</span></span> <span data-ttu-id="88be9-112">Las tareas que requieran que la interacción del usuario o de la interfaz de usuario espere mientras se completan, podrían no ser adecuadas como trabajos en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-112">Tasks that require the user or the UI to wait while they are completed might not be appropriate as background jobs.</span></span>

## <a name="types-of-background-jobs"></a><span data-ttu-id="88be9-113">Tipos de trabajos en segundo plano</span><span class="sxs-lookup"><span data-stu-id="88be9-113">Types of background jobs</span></span>
<span data-ttu-id="88be9-114">Los trabajos en segundo plano suelen incluir uno o más de los siguientes tipos de trabajos:</span><span class="sxs-lookup"><span data-stu-id="88be9-114">Background jobs typically include one or more of the following types of jobs:</span></span>

* <span data-ttu-id="88be9-115">Trabajos de uso intensivo de la CPU, tales como cálculos matemáticos o análisis de modelo estructural.</span><span class="sxs-lookup"><span data-stu-id="88be9-115">CPU-intensive jobs, such as mathematical calculations or structural model analysis.</span></span>
* <span data-ttu-id="88be9-116">Trabajos E/S intensivos, tales como la ejecución de una serie de transacciones de almacenamiento o la indexación de archivos.</span><span class="sxs-lookup"><span data-stu-id="88be9-116">I/O-intensive jobs, such as executing a series of storage transactions or indexing files.</span></span>
* <span data-ttu-id="88be9-117">Trabajos por lotes, tales como actualizaciones de datos por la noche o procesamiento programado.</span><span class="sxs-lookup"><span data-stu-id="88be9-117">Batch jobs, such as nightly data updates or scheduled processing.</span></span>
* <span data-ttu-id="88be9-118">Flujos de trabajo de ejecución prolongada, tales como la realización de pedidos o el aprovisionamiento de servicios y sistemas.</span><span class="sxs-lookup"><span data-stu-id="88be9-118">Long-running workflows, such as order fulfillment, or provisioning services and systems.</span></span>
* <span data-ttu-id="88be9-119">Procesamiento de datos confidenciales en el que la tarea se entrega a una ubicación más segura para su procesamiento.</span><span class="sxs-lookup"><span data-stu-id="88be9-119">Sensitive-data processing where the task is handed off to a more secure location for processing.</span></span> <span data-ttu-id="88be9-120">Por ejemplo, quizás no quiera procesar datos confidenciales en una aplicación web.</span><span class="sxs-lookup"><span data-stu-id="88be9-120">For example, you might not want to process sensitive data within a web app.</span></span> <span data-ttu-id="88be9-121">En su lugar, puede usar un patrón como [Gatekeeper](https://msdn.microsoft.com/library/dn589793.aspx) para transferir los datos a un proceso en segundo plano aislado que tenga acceso al almacenamiento protegido.</span><span class="sxs-lookup"><span data-stu-id="88be9-121">Instead, you might use a pattern such as [Gatekeeper](https://msdn.microsoft.com/library/dn589793.aspx) to transfer the data to an isolated background process that has access to protected storage.</span></span>

## <a name="triggers"></a><span data-ttu-id="88be9-122">Desencadenadores</span><span class="sxs-lookup"><span data-stu-id="88be9-122">Triggers</span></span>
<span data-ttu-id="88be9-123">Los trabajos en segundo plano se pueden iniciar de varias maneras diferentes.</span><span class="sxs-lookup"><span data-stu-id="88be9-123">Background jobs can be initiated in several different ways.</span></span> <span data-ttu-id="88be9-124">Se dividen en una de las siguientes categorías:</span><span class="sxs-lookup"><span data-stu-id="88be9-124">They fall into one of the following categories:</span></span>

* <span data-ttu-id="88be9-125">[**Desencadenadores impulsados por eventos**](#event-driven-triggers).</span><span class="sxs-lookup"><span data-stu-id="88be9-125">[**Event-driven triggers**](#event-driven-triggers).</span></span> <span data-ttu-id="88be9-126">La tarea se inicia en respuesta a un evento, normalmente una acción realizada por un usuario o un paso de un flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="88be9-126">The task is started in response to an event, typically an action taken by a user or a step in a workflow.</span></span>
* <span data-ttu-id="88be9-127">[**Desencadenadores impulsados por programación**](#schedule-driven-triggers).</span><span class="sxs-lookup"><span data-stu-id="88be9-127">[**Schedule-driven triggers**](#schedule-driven-triggers).</span></span> <span data-ttu-id="88be9-128">La tarea se invoca según una programación basada en un temporizador.</span><span class="sxs-lookup"><span data-stu-id="88be9-128">The task is invoked on a schedule based on a timer.</span></span> <span data-ttu-id="88be9-129">Esto podría ser una programación periódica o una invocación única que se especifica para una fecha posterior.</span><span class="sxs-lookup"><span data-stu-id="88be9-129">This might be a recurring schedule or a one-off invocation that is specified for a later time.</span></span>

### <a name="event-driven-triggers"></a><span data-ttu-id="88be9-130">Desencadenadores impulsados por eventos</span><span class="sxs-lookup"><span data-stu-id="88be9-130">Event-driven triggers</span></span>
<span data-ttu-id="88be9-131">La invocación impulsada por eventos usa un desencadenador para iniciar la tarea en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-131">Event-driven invocation uses a trigger to start the background task.</span></span> <span data-ttu-id="88be9-132">Entre algunos ejemplos del uso de desencadenadores impulsados por eventos se incluyen:</span><span class="sxs-lookup"><span data-stu-id="88be9-132">Examples of using event-driven triggers include:</span></span>

* <span data-ttu-id="88be9-133">La interfaz de usuario u otro trabajo coloca un mensaje en una cola.</span><span class="sxs-lookup"><span data-stu-id="88be9-133">The UI or another job places a message in a queue.</span></span> <span data-ttu-id="88be9-134">El mensaje contiene datos sobre una acción que se ha producido, por ejemplo, el usuario realiza un pedido.</span><span class="sxs-lookup"><span data-stu-id="88be9-134">The message contains data about an action that has taken place, such as the user placing an order.</span></span> <span data-ttu-id="88be9-135">La tarea en segundo plano escucha en esta cola y detecta la llegada de un nuevo mensaje.</span><span class="sxs-lookup"><span data-stu-id="88be9-135">The background task listens on this queue and detects the arrival of a new message.</span></span> <span data-ttu-id="88be9-136">Lee el mensaje y usa los datos que este contiene como la entrada para el trabajo en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-136">It reads the message and uses the data in it as the input to the background job.</span></span>
* <span data-ttu-id="88be9-137">La interfaz de usuario u otro trabajo guarda o actualiza un valor en el almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="88be9-137">The UI or another job saves or updates a value in storage.</span></span> <span data-ttu-id="88be9-138">La tarea en segundo plano supervisa el almacenamiento y detecta los cambios.</span><span class="sxs-lookup"><span data-stu-id="88be9-138">The background task monitors the storage and detects changes.</span></span> <span data-ttu-id="88be9-139">Lee los datos y los usa como la entrada para el trabajo en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-139">It reads the data and uses it as the input to the background job.</span></span>
* <span data-ttu-id="88be9-140">La interfaz de usuario u otro trabajo realiza una solicitud a un punto de conexión, como un identificador URI HTTPS o una API que está expuesta como servicio web.</span><span class="sxs-lookup"><span data-stu-id="88be9-140">The UI or another job makes a request to an endpoint, such as an HTTPS URI, or an API that is exposed as a web service.</span></span> <span data-ttu-id="88be9-141">Pasa los datos necesarios para completar la tarea en segundo plano como parte de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="88be9-141">It passes the data that is required to complete the background task as part of the request.</span></span> <span data-ttu-id="88be9-142">El punto de conexión o servicio web invoca la tarea en segundo plano, que usa los datos como entrada.</span><span class="sxs-lookup"><span data-stu-id="88be9-142">The endpoint or web service invokes the background task, which uses the data as its input.</span></span>

<span data-ttu-id="88be9-143">Entre algunos ejemplos típicos de las tareas adecuadas para la invocación impulsada por eventos se incluyen procesamiento de imágenes, flujos de trabajo, envío de información a servicios remotos, envío de mensajes de correo electrónico y aprovisionamiento de nuevos usuarios en aplicaciones de varios inquilinos.</span><span class="sxs-lookup"><span data-stu-id="88be9-143">Typical examples of tasks that are suited to event-driven invocation include image processing, workflows, sending information to remote services, sending email messages, and provisioning new users in multitenant applications.</span></span>

### <a name="schedule-driven-triggers"></a><span data-ttu-id="88be9-144">Desencadenadores impulsados por programación</span><span class="sxs-lookup"><span data-stu-id="88be9-144">Schedule-driven triggers</span></span>
<span data-ttu-id="88be9-145">La invocación impulsada por programación usa un temporizador para iniciar la tarea en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-145">Schedule-driven invocation uses a timer to start the background task.</span></span> <span data-ttu-id="88be9-146">Entre algunos ejemplos del uso de desencadenadores impulsados por programación se incluyen:</span><span class="sxs-lookup"><span data-stu-id="88be9-146">Examples of using schedule-driven triggers include:</span></span>

* <span data-ttu-id="88be9-147">Un temporizador que se ejecuta localmente en la aplicación o como parte del sistema operativo de la aplicación invoca una tarea en segundo plano de forma periódica.</span><span class="sxs-lookup"><span data-stu-id="88be9-147">A timer that is running locally within the application or as part of the application’s operating system invokes a background task on a regular basis.</span></span>
* <span data-ttu-id="88be9-148">Un temporizador que se ejecuta en otra aplicación o un servicio de temporizador, tal como Azure Scheduler, envía una solicitud a una API o a un servicio web de forma periódica.</span><span class="sxs-lookup"><span data-stu-id="88be9-148">A timer that is running in a different application, or a timer service such as Azure Scheduler, sends a request to an API or web service on a regular basis.</span></span> <span data-ttu-id="88be9-149">La API o servicio web invoca la tarea en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-149">The API or web service invokes the background task.</span></span>
* <span data-ttu-id="88be9-150">Un proceso o aplicación independiente inicia un temporizador que provoca la invocación de tarea en segundo plano después de un retraso de tiempo especificado o en un momento determinado.</span><span class="sxs-lookup"><span data-stu-id="88be9-150">A separate process or application starts a timer that causes the background task to be invoked once after a specified time delay, or at a specific time.</span></span>

<span data-ttu-id="88be9-151">Entre algunos ejemplos típicos de las tareas adecuadas para la invocación impulsada por programación se incluyen rutinas de procesamiento por lotes (como la actualización de listas de productos relacionados con los usuarios basadas en su comportamiento reciente), tareas rutinarias de procesamiento de datos (como la actualización de índices o la generación de resultados acumulados), análisis de datos para informes diarios, limpieza de retención de datos y comprobaciones de coherencia de datos.</span><span class="sxs-lookup"><span data-stu-id="88be9-151">Typical examples of tasks that are suited to schedule-driven invocation include batch-processing routines (such as updating related-products lists for users based on their recent behavior), routine data processing tasks (such as updating indexes or generating accumulated results), data analysis for daily reports, data retention cleanup, and data consistency checks.</span></span>

<span data-ttu-id="88be9-152">Si usa una tarea impulsada por programación que se debe ejecutar como una sola instancia, tenga en cuenta lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="88be9-152">If you use a schedule-driven task that must run as a single instance, be aware of the following:</span></span>

* <span data-ttu-id="88be9-153">Si se escala la instancia de proceso que ejecuta el programador (por ejemplo, una máquina virtual que usa tareas programadas de Windows), tendrá varias instancias del programador en ejecución.</span><span class="sxs-lookup"><span data-stu-id="88be9-153">If the compute instance that is running the scheduler (such as a virtual machine using Windows scheduled tasks) is scaled, you will have multiple instances of the scheduler running.</span></span> <span data-ttu-id="88be9-154">Estas podrían iniciar varias instancias de la tarea.</span><span class="sxs-lookup"><span data-stu-id="88be9-154">These could start multiple instances of the task.</span></span>
* <span data-ttu-id="88be9-155">Si las tareas se ejecutan durante más tiempo que el período entre eventos del programador, el programador puede iniciar otra instancia de la tarea mientras se siga ejecutando la anterior.</span><span class="sxs-lookup"><span data-stu-id="88be9-155">If tasks run for longer than the period between scheduler events, the scheduler may start another instance of the task while the previous one is still running.</span></span>

## <a name="returning-results"></a><span data-ttu-id="88be9-156">Devolución de resultados</span><span class="sxs-lookup"><span data-stu-id="88be9-156">Returning results</span></span>
<span data-ttu-id="88be9-157">Los trabajos en segundo plano se ejecutan de forma asincrónica en un proceso independiente o incluso en una ubicación independiente, desde la interfaz de usuario o desde el proceso que invocó la tarea en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-157">Background jobs execute asynchronously in a separate process, or even in a separate location, from the UI or the process that invoked the background task.</span></span> <span data-ttu-id="88be9-158">Idealmente, las tareas en segundo plano son operaciones tipo "desencadenar y olvidar" y su progreso de ejecución no tiene ningún impacto en la interfaz de usuario o el proceso de llamada.</span><span class="sxs-lookup"><span data-stu-id="88be9-158">Ideally, background tasks are “fire and forget” operations, and their execution progress has no impact on the UI or the calling process.</span></span> <span data-ttu-id="88be9-159">Esto significa que el proceso de llamada no espera a la finalización de las tareas.</span><span class="sxs-lookup"><span data-stu-id="88be9-159">This means that the calling process does not wait for completion of the tasks.</span></span> <span data-ttu-id="88be9-160">Por lo tanto, no puede detectar automáticamente cuándo finaliza la tarea.</span><span class="sxs-lookup"><span data-stu-id="88be9-160">Therefore, it cannot automatically detect when the task ends.</span></span>

<span data-ttu-id="88be9-161">Si necesita que una tarea de segundo plano comunique con la tarea de llamada para indicar el progreso o la finalización, debe implementar un mecanismo para ello.</span><span class="sxs-lookup"><span data-stu-id="88be9-161">If you require a background task to communicate with the calling task to indicate progress or completion, you must implement a mechanism for this.</span></span> <span data-ttu-id="88be9-162">A continuación, se indican algunos ejemplos:</span><span class="sxs-lookup"><span data-stu-id="88be9-162">Some examples are:</span></span>

* <span data-ttu-id="88be9-163">Escriba un valor del indicador de estado en el almacenamiento que sea accesible para la tarea de interfaz de usuario o de llamada, que puede supervisar o comprobar este valor cuando sea necesario.</span><span class="sxs-lookup"><span data-stu-id="88be9-163">Write a status indicator value to storage that is accessible to the UI or caller task, which can monitor or check this value when required.</span></span> <span data-ttu-id="88be9-164">Otros datos que la tarea en segundo plano debe devolver a la llamada se pueden colocar en el mismo almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="88be9-164">Other data that the background task must return to the caller can be placed into the same storage.</span></span>
* <span data-ttu-id="88be9-165">Establecer una cola de respuesta en la que escucha la interfaz de usuario o la llamada.</span><span class="sxs-lookup"><span data-stu-id="88be9-165">Establish a reply queue that the UI or caller listens on.</span></span> <span data-ttu-id="88be9-166">La tarea en segundo plano puede enviar mensajes a la cola que indica el estado y la finalización.</span><span class="sxs-lookup"><span data-stu-id="88be9-166">The background task can send messages to the queue that indicate status and completion.</span></span> <span data-ttu-id="88be9-167">Los datos que la tarea en segundo plano debe devolver a la llamada pueden colocarse en los mensajes.</span><span class="sxs-lookup"><span data-stu-id="88be9-167">Data that the background task must return to the caller can be placed into the messages.</span></span> <span data-ttu-id="88be9-168">Si usa Azure Service Bus, puede usar las propiedades **ReplyTo** y **CorrelationId** para implementar esta funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="88be9-168">If you are using Azure Service Bus, you can use the **ReplyTo** and **CorrelationId** properties to implement this capability.</span></span>
* <span data-ttu-id="88be9-169">Exponer una API o punto de conexión desde la tarea en segundo plano a la que pueda acceder la interfaz de usuario o la llamada para obtener información sobre el estado.</span><span class="sxs-lookup"><span data-stu-id="88be9-169">Expose an API or endpoint from the background task that the UI or caller can access to obtain status information.</span></span> <span data-ttu-id="88be9-170">Los datos que la tarea en segundo plano debe devolver a la llamada pueden incluirse en la respuesta.</span><span class="sxs-lookup"><span data-stu-id="88be9-170">Data that the background task must return to the caller can be included in the response.</span></span>
* <span data-ttu-id="88be9-171">Haga que la tarea en segundo plano realice una devolución de llamada a la interfaz de usuario o llamada a través de una API para indicar el estado en puntos predefinidos o en el momento de finalización.</span><span class="sxs-lookup"><span data-stu-id="88be9-171">Have the background task call back to the UI or caller through an API to indicate status at predefined points or on completion.</span></span> <span data-ttu-id="88be9-172">Esto podría hacerse a través de eventos generados localmente o a través de un mecanismo de publicación y suscripción.</span><span class="sxs-lookup"><span data-stu-id="88be9-172">This might be through events raised locally or through a publish-and-subscribe mechanism.</span></span> <span data-ttu-id="88be9-173">Los datos que debe devolver la tarea en segundo plano a la llamada se pueden incluir en la carga de la solicitud o evento.</span><span class="sxs-lookup"><span data-stu-id="88be9-173">Data that the background task must return to the caller can be included in the request or event payload.</span></span>

## <a name="hosting-environment"></a><span data-ttu-id="88be9-174">Entorno de hospedaje</span><span class="sxs-lookup"><span data-stu-id="88be9-174">Hosting environment</span></span>
<span data-ttu-id="88be9-175">Puede hospedar tareas en segundo plano usando una variedad de diferentes servicios de la plataforma de Azure:</span><span class="sxs-lookup"><span data-stu-id="88be9-175">You can host background tasks by using a range of different Azure platform services:</span></span>

* <span data-ttu-id="88be9-176">[**Azure Web Apps y WebJobs**](#azure-web-apps-and-webjobs).</span><span class="sxs-lookup"><span data-stu-id="88be9-176">[**Azure Web Apps and WebJobs**](#azure-web-apps-and-webjobs).</span></span> <span data-ttu-id="88be9-177">Puede usar WebJobs para ejecutar trabajos personalizados basados en una variedad de distintos tipos de scripts o programas ejecutables en el contexto de una aplicación web.</span><span class="sxs-lookup"><span data-stu-id="88be9-177">You can use WebJobs to execute custom jobs based on a range of different types of scripts or executable programs within the context of a web app.</span></span>
* <span data-ttu-id="88be9-178">[**Azure Virtual Machines**](#azure-virtual-machines).</span><span class="sxs-lookup"><span data-stu-id="88be9-178">[**Azure Virtual Machines**](#azure-virtual-machines).</span></span> <span data-ttu-id="88be9-179">Si tiene un servicio de Windows o quiere usar el Programador de tareas de Windows, es común hospedar las tareas en segundo plano dentro de una máquina virtual dedicada.</span><span class="sxs-lookup"><span data-stu-id="88be9-179">If you have a Windows service or want to use the Windows Task Scheduler, it is common to host your background tasks within a dedicated virtual machine.</span></span>
* <span data-ttu-id="88be9-180">[**Azure Batch**](#azure-batch).</span><span class="sxs-lookup"><span data-stu-id="88be9-180">[**Azure Batch**](#azure-batch).</span></span> <span data-ttu-id="88be9-181">Batch es un servicio de plataforma que programa el trabajo que hace un uso intensivo de los recursos de proceso para que se ejecute en una colección administrada de máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="88be9-181">Batch is a platform service that schedules compute-intensive work to run on a managed collection of virtual machines.</span></span> <span data-ttu-id="88be9-182">Puede escalar automáticamente los recursos de proceso.</span><span class="sxs-lookup"><span data-stu-id="88be9-182">It can automatically scale compute resources.</span></span>
* <span data-ttu-id="88be9-183">[**Azure Container Service**](#azure-container-service).</span><span class="sxs-lookup"><span data-stu-id="88be9-183">[**Azure Container Service**](#azure-container-service).</span></span> <span data-ttu-id="88be9-184">Azure Container Service es un entorno de hospedaje de contenedores en Azure.</span><span class="sxs-lookup"><span data-stu-id="88be9-184">Azure Container Service provides a container hosting environment on Azure.</span></span> 
* <span data-ttu-id="88be9-185">[**Azure Cloud Services**](#azure-cloud-services).</span><span class="sxs-lookup"><span data-stu-id="88be9-185">[**Azure Cloud Services**](#azure-cloud-services).</span></span> <span data-ttu-id="88be9-186">Puede escribir código dentro de un rol que se ejecuta como una tarea en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-186">You can write code within a role that executes as a background task.</span></span>

<span data-ttu-id="88be9-187">En las siguientes secciones se describe cada una de estas opciones con más detalle y se incluyen consideraciones para ayudarle a elegir la opción adecuada.</span><span class="sxs-lookup"><span data-stu-id="88be9-187">The following sections describe each of these options in more detail, and include considerations to help you choose the appropriate option.</span></span>

### <a name="azure-web-apps-and-webjobs"></a><span data-ttu-id="88be9-188">Azure Web Apps y WebJobs</span><span class="sxs-lookup"><span data-stu-id="88be9-188">Azure Web Apps and WebJobs</span></span>

<span data-ttu-id="88be9-189">Puede usar Azure WebJobs para ejecutar trabajos personalizados como tareas en segundo plano dentro de una aplicación web de Azure.</span><span class="sxs-lookup"><span data-stu-id="88be9-189">You can use Azure WebJobs to execute custom jobs as background tasks within an Azure Web App.</span></span> <span data-ttu-id="88be9-190">WebJobs se ejecuta en el contexto de su aplicación web como un proceso continuo.</span><span class="sxs-lookup"><span data-stu-id="88be9-190">WebJobs run within the context of your web app as a continuous process.</span></span> <span data-ttu-id="88be9-191">WebJobs también se ejecuta en respuesta a un evento desencadenador desde Azure Scheduler o factores externos, como cambios en los blobs de almacenamiento y en las colas de mensajes.</span><span class="sxs-lookup"><span data-stu-id="88be9-191">WebJobs also run in response to a trigger event from Azure Scheduler or external factors, such as changes to storage blobs and message queues.</span></span> <span data-ttu-id="88be9-192">Los trabajos se pueden iniciar y detener a petición, y cerrarse correctamente.</span><span class="sxs-lookup"><span data-stu-id="88be9-192">Jobs can be started and stopped on demand, and shut down gracefully.</span></span> <span data-ttu-id="88be9-193">Si se produce un error continuamente al ejecutar un trabajo web, este se reinicia automáticamente.</span><span class="sxs-lookup"><span data-stu-id="88be9-193">If a continuously running WebJob fails, it is automatically restarted.</span></span> <span data-ttu-id="88be9-194">Las acciones de error y reintento son configurables.</span><span class="sxs-lookup"><span data-stu-id="88be9-194">Retry and error actions are configurable.</span></span>

<span data-ttu-id="88be9-195">Cuando configura un WebJob:</span><span class="sxs-lookup"><span data-stu-id="88be9-195">When you configure a WebJob:</span></span>

* <span data-ttu-id="88be9-196">Si quiere que el trabajo responda a un desencadenador impulsado por eventos, debería configurarlo como **Ejecutar continuamente**.</span><span class="sxs-lookup"><span data-stu-id="88be9-196">If you want the job to respond to an event-driven trigger, you should configure it as **Run continuously**.</span></span> <span data-ttu-id="88be9-197">El script o programa se almacena en la carpeta denominada site/wwwroot/app_data/jobs/continuous.</span><span class="sxs-lookup"><span data-stu-id="88be9-197">The script or program is stored in the folder named site/wwwroot/app_data/jobs/continuous.</span></span>
* <span data-ttu-id="88be9-198">Si quiere que el trabajo responda a un desencadenador controlado por programación, debería configurarlo como **Ejecutar de acuerdo con una programación**.</span><span class="sxs-lookup"><span data-stu-id="88be9-198">If you want the job to respond to a schedule-driven trigger, you should configure it as **Run on a schedule**.</span></span> <span data-ttu-id="88be9-199">El script o programa se almacena en la carpeta denominada site/wwwroot/app_data/jobs/triggered.</span><span class="sxs-lookup"><span data-stu-id="88be9-199">The script or program is stored in the folder named site/wwwroot/app_data/jobs/triggered.</span></span>
* <span data-ttu-id="88be9-200">Si elige la opción **Ejecutar a petición** al configurar un trabajo, se ejecutará el mismo código que la opción **Ejecutar de acuerdo con una programación** cuando se inicia.</span><span class="sxs-lookup"><span data-stu-id="88be9-200">If you choose the **Run on demand** option when you configure a job, it will execute the same code as the **Run on a schedule** option when you start it.</span></span>

<span data-ttu-id="88be9-201">Azure WebJobs se ejecuta en el espacio aislado de la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="88be9-201">Azure WebJobs run within the sandbox of the web app.</span></span> <span data-ttu-id="88be9-202">Esto significa que pueden tener acceso a las variables de entorno y compartir información, como cadenas de conexión, con la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="88be9-202">This means that they can access environment variables and share information, such as connection strings, with the web app.</span></span> <span data-ttu-id="88be9-203">El trabajo tiene acceso al identificador único de la máquina que está ejecutando el trabajo.</span><span class="sxs-lookup"><span data-stu-id="88be9-203">The job has access to the unique identifier of the machine that is running the job.</span></span> <span data-ttu-id="88be9-204">La cadena de conexión denominada **AzureWebJobsStorage** proporciona acceso a las colas, los blobs y las tablas de Azure Storage para los datos de la aplicación, y acceso a Service Bus para la comunicación y la mensajería.</span><span class="sxs-lookup"><span data-stu-id="88be9-204">The connection string named **AzureWebJobsStorage** provides access to Azure storage queues, blobs, and tables for application data, and access to Service Bus for messaging and communication.</span></span> <span data-ttu-id="88be9-205">La cadena de conexión denominada **AzureWebJobsDashboard** proporciona acceso a los archivos de registro de acciones del trabajo.</span><span class="sxs-lookup"><span data-stu-id="88be9-205">The connection string named **AzureWebJobsDashboard** provides access to the job action log files.</span></span>

<span data-ttu-id="88be9-206">Azure WebJobs tiene las siguientes características:</span><span class="sxs-lookup"><span data-stu-id="88be9-206">Azure WebJobs have the following characteristics:</span></span>

* <span data-ttu-id="88be9-207">**Seguridad**: los trabajos web se protegen mediante las credenciales de implementación de la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="88be9-207">**Security**: WebJobs are protected by the deployment credentials of the web app.</span></span>
* <span data-ttu-id="88be9-208">**Tipos de archivo admitidos**: puede definir WebJobs con scripts de comandos (.cmd), archivos por lotes (.bat), scripts de PowerShell (. ps1), scripts de shell de bash (.sh), scripts de PHP (.php), scripts de Python (.py), código JavaScript (.js) y programas ejecutables (.exe y .jar entre otros).</span><span class="sxs-lookup"><span data-stu-id="88be9-208">**Supported file types**: You can define WebJobs by using command scripts (.cmd), batch files (.bat), PowerShell scripts (.ps1), bash shell scripts (.sh), PHP scripts (.php), Python scripts (.py), JavaScript code (.js), and executable programs (.exe, .jar, and more).</span></span>
* <span data-ttu-id="88be9-209">**Implementación**: puede implementar los scripts y ejecutables mediante [Azure Portal](/azure/app-service-web/web-sites-create-web-jobs), [Visual Studio](/azure/app-service-web/websites-dotnet-deploy-webjobs) o [Azure WebJobs SDK](/azure/app-service/webjobs-sdk-get-started), o copiándolos directamente en las siguientes ubicaciones:</span><span class="sxs-lookup"><span data-stu-id="88be9-209">**Deployment**: You can deploy scripts and executables by using the [Azure portal](/azure/app-service-web/web-sites-create-web-jobs), by using [Visual Studio](/azure/app-service-web/websites-dotnet-deploy-webjobs), by using the [Azure WebJobs SDK](/azure/app-service/webjobs-sdk-get-started), or by copying them directly to the following locations:</span></span>
  * <span data-ttu-id="88be9-210">Para la ejecución desencadenada: site/wwwroot/app_data/jobs/triggered/{nombre del trabajo}</span><span class="sxs-lookup"><span data-stu-id="88be9-210">For triggered execution: site/wwwroot/app_data/jobs/triggered/{job name}</span></span>
  * <span data-ttu-id="88be9-211">Para la ejecución continua: site/wwwroot/app_data/jobs/continuous/{nombre del trabajo}</span><span class="sxs-lookup"><span data-stu-id="88be9-211">For continuous execution: site/wwwroot/app_data/jobs/continuous/{job name}</span></span>
* <span data-ttu-id="88be9-212">**Registro**: Console.Out se considera (marca) como INFO.</span><span class="sxs-lookup"><span data-stu-id="88be9-212">**Logging**: Console.Out is treated (marked) as INFO.</span></span> <span data-ttu-id="88be9-213">Console.Error se trata como ERROR.</span><span class="sxs-lookup"><span data-stu-id="88be9-213">Console.Error is treated as ERROR.</span></span> <span data-ttu-id="88be9-214">Puede tener acceso a la información de diagnóstico y supervisión mediante el Portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="88be9-214">You can access monitoring and diagnostics information by using the Azure portal.</span></span> <span data-ttu-id="88be9-215">Puede descargar los archivos de registro directamente del sitio.</span><span class="sxs-lookup"><span data-stu-id="88be9-215">You can download log files directly from the site.</span></span> <span data-ttu-id="88be9-216">Se guardan en las siguientes ubicaciones:</span><span class="sxs-lookup"><span data-stu-id="88be9-216">They are saved in the following locations:</span></span>
  * <span data-ttu-id="88be9-217">Para la ejecución desencadenada: Vfs/data/jobs/triggered/jobName</span><span class="sxs-lookup"><span data-stu-id="88be9-217">For triggered execution: Vfs/data/jobs/triggered/jobName</span></span>
  * <span data-ttu-id="88be9-218">Para la ejecución continua: Vfs/data/jobs/continuous/jobName</span><span class="sxs-lookup"><span data-stu-id="88be9-218">For continuous execution: Vfs/data/jobs/continuous/jobName</span></span>
* <span data-ttu-id="88be9-219">**Configuración**: puede configurar WebJobs mediante el portal, la API de REST y PowerShell.</span><span class="sxs-lookup"><span data-stu-id="88be9-219">**Configuration**: You can configure WebJobs by using the portal, the REST API, and PowerShell.</span></span> <span data-ttu-id="88be9-220">Puede usar un archivo de configuración denominado settings.job en el mismo directorio raíz que el script de trabajo para proporcionar la información de configuración de un trabajo.</span><span class="sxs-lookup"><span data-stu-id="88be9-220">You can use a configuration file named settings.job in the same root directory as the job script to provide configuration information for a job.</span></span> <span data-ttu-id="88be9-221">Por ejemplo: </span><span class="sxs-lookup"><span data-stu-id="88be9-221">For example:</span></span>
  * <span data-ttu-id="88be9-222">{ "stopping_wait_time": 60 }</span><span class="sxs-lookup"><span data-stu-id="88be9-222">{ "stopping_wait_time": 60 }</span></span>
  * <span data-ttu-id="88be9-223">{ "is_singleton": true }</span><span class="sxs-lookup"><span data-stu-id="88be9-223">{ "is_singleton": true }</span></span>

#### <a name="considerations"></a><span data-ttu-id="88be9-224">Consideraciones</span><span class="sxs-lookup"><span data-stu-id="88be9-224">Considerations</span></span>

* <span data-ttu-id="88be9-225">De forma predeterminada, los trabajos web se escalan con la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="88be9-225">By default, WebJobs scale with the web app.</span></span> <span data-ttu-id="88be9-226">Sin embargo, puede configurar los trabajos para que se ejecuten en una instancia única; para ello, establezca la propiedad de configuración **is_singleton** en **true**.</span><span class="sxs-lookup"><span data-stu-id="88be9-226">However, you can configure jobs to run on single instance by setting the **is_singleton** configuration property to **true**.</span></span> <span data-ttu-id="88be9-227">Los WebJobs de instancia única son útiles para las tareas que no quiera escalar o ejecutar como varias instancias simultáneas, por ejemplo, la reindexación, el análisis de datos y tareas similares.</span><span class="sxs-lookup"><span data-stu-id="88be9-227">Single instance WebJobs are useful for tasks that you do not want to scale or run as simultaneous multiple instances, such as reindexing, data analysis, and similar tasks.</span></span>
* <span data-ttu-id="88be9-228">Para minimizar el impacto de los trabajos en el rendimiento de la aplicación web, considere la posibilidad de crear una instancia vacía de aplicación web de Azure en un nuevo plan de App Service para hospedar WebJobs que pueden tardar tiempo en ejecutarse o que consumen muchos recursos.</span><span class="sxs-lookup"><span data-stu-id="88be9-228">To minimize the impact of jobs on the performance of the web app, consider creating an empty Azure Web App instance in a new App Service plan to host WebJobs that may be long running or resource intensive.</span></span>

### <a name="more-information"></a><span data-ttu-id="88be9-229">Más información</span><span class="sxs-lookup"><span data-stu-id="88be9-229">More information</span></span>
* <span data-ttu-id="88be9-230">[recursos recomendados de Azure WebJobs](/azure/app-service-web/websites-webjobs-resources) se indican varios recursos, descargas y ejemplos útiles para WebJobs.</span><span class="sxs-lookup"><span data-stu-id="88be9-230">[Azure WebJobs recommended resources](/azure/app-service-web/websites-webjobs-resources) lists the many useful resources, downloads, and samples for WebJobs.</span></span>

### <a name="azure-virtual-machines"></a><span data-ttu-id="88be9-231">Azure Virtual Machines</span><span class="sxs-lookup"><span data-stu-id="88be9-231">Azure Virtual Machines</span></span>
<span data-ttu-id="88be9-232">Las tareas en segundo plano se podrían implementar de forma que se les impida implementarse en Azure Web Apps o Cloud Services, o puede que estas opciones no sean convenientes.</span><span class="sxs-lookup"><span data-stu-id="88be9-232">Background tasks might be implemented in a way that prevents them from being deployed to Azure Web Apps or Cloud Services, or these options might not be convenient.</span></span> <span data-ttu-id="88be9-233">Entre algunos ejemplos típicos se incluyen los servicios de Windows y las utilidades y programas ejecutables de terceros.</span><span class="sxs-lookup"><span data-stu-id="88be9-233">Typical examples are Windows services, and third-party utilities and executable programs.</span></span> <span data-ttu-id="88be9-234">Otro ejemplo podrían ser programas escritos para un entorno de ejecución diferente del que hospeda la aplicación.</span><span class="sxs-lookup"><span data-stu-id="88be9-234">Another example might be programs written for an execution environment that is different than that hosting the application.</span></span> <span data-ttu-id="88be9-235">Por ejemplo, podría ser un programa de Unix o Linux que quiere ejecutar desde una aplicación de Windows o .NET.</span><span class="sxs-lookup"><span data-stu-id="88be9-235">For example, it might be a Unix or Linux program that you want to execute from a Windows or .NET application.</span></span> <span data-ttu-id="88be9-236">Puede elegir entre una variedad de sistemas operativos para una máquina virtual de Azure y ejecutar el servicio o ejecutable en esa máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="88be9-236">You can choose from a range of operating systems for an Azure virtual machine, and run your service or executable on that virtual machine.</span></span>

<span data-ttu-id="88be9-237">Para ayudarle a elegir cuándo usar Virtual Machines, consulte [Comparación de Azure App Services, Cloud Services y Virtual Machines](/azure/app-service-web/choose-web-site-cloud-service-vm/).</span><span class="sxs-lookup"><span data-stu-id="88be9-237">To help you choose when to use Virtual Machines, see [Azure App Services, Cloud Services and Virtual Machines comparison](/azure/app-service-web/choose-web-site-cloud-service-vm/).</span></span> <span data-ttu-id="88be9-238">Para más información sobre las opciones de las máquinas virtuales, vea [Tamaños de las máquinas virtuales Windows en Azure](/azure/virtual-machines/windows/sizes).</span><span class="sxs-lookup"><span data-stu-id="88be9-238">For information about the options for Virtual Machines, see [Sizes for Windows virtual machines in Azure](/azure/virtual-machines/windows/sizes).</span></span> <span data-ttu-id="88be9-239">Para más información sobre los sistemas operativos y las imágenes preconfiguradas que están disponibles para las máquinas virtuales, consulte [Marketplace de Azure Virtual Machines](https://azure.microsoft.com/gallery/virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="88be9-239">For more information about the operating systems and prebuilt images that are available for Virtual Machines, see [Azure Virtual Machines Marketplace](https://azure.microsoft.com/gallery/virtual-machines/).</span></span>

<span data-ttu-id="88be9-240">Para iniciar la tarea en segundo plano en una máquina virtual independiente, tiene varias opciones:</span><span class="sxs-lookup"><span data-stu-id="88be9-240">To initiate the background task in a separate virtual machine, you have a range of options:</span></span>

* <span data-ttu-id="88be9-241">Puede ejecutar la tarea a petición directamente desde la aplicación mediante el envío de una solicitud a un punto de conexión que exponga la tarea.</span><span class="sxs-lookup"><span data-stu-id="88be9-241">You can execute the task on demand directly from your application by sending a request to an endpoint that the task exposes.</span></span> <span data-ttu-id="88be9-242">Esto pasa en cualquier dato que requiera la tarea.</span><span class="sxs-lookup"><span data-stu-id="88be9-242">This passes in any data that the task requires.</span></span> <span data-ttu-id="88be9-243">Este punto de conexión invoca la tarea.</span><span class="sxs-lookup"><span data-stu-id="88be9-243">This endpoint invokes the task.</span></span>
* <span data-ttu-id="88be9-244">Puede configurar la tarea para que se ejecute según una programación con un programador o temporizador que esté disponible en el sistema operativo elegido.</span><span class="sxs-lookup"><span data-stu-id="88be9-244">You can configure the task to run on a schedule by using a scheduler or timer that is available in your chosen operating system.</span></span> <span data-ttu-id="88be9-245">Por ejemplo, en Windows puede usar el Programador de tareas de Windows para ejecutar scripts y tareas.</span><span class="sxs-lookup"><span data-stu-id="88be9-245">For example, on Windows you can use Windows Task Scheduler to execute scripts and tasks.</span></span> <span data-ttu-id="88be9-246">O bien, si tiene SQL Server instalado en la máquina virtual, puede usar el Agente SQL Server para ejecutar scripts y tareas.</span><span class="sxs-lookup"><span data-stu-id="88be9-246">Or, if you have SQL Server installed on the virtual machine, you can use the SQL Server Agent to execute scripts and tasks.</span></span>
* <span data-ttu-id="88be9-247">Puede usar Azure Scheduler para iniciar la tarea al agregar un mensaje a una cola en la que escucha la tarea o al enviar una solicitud a una API que la tarea expone.</span><span class="sxs-lookup"><span data-stu-id="88be9-247">You can use Azure Scheduler to initiate the task by adding a message to a queue that the task listens on, or by sending a request to an API that the task exposes.</span></span>

<span data-ttu-id="88be9-248">Consulte la sección anterior [Desencadenadores](#triggers) para más información sobre cómo iniciar tareas en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-248">See the earlier section [Triggers](#triggers) for more information about how you can initiate background tasks.</span></span>  

#### <a name="considerations"></a><span data-ttu-id="88be9-249">Consideraciones</span><span class="sxs-lookup"><span data-stu-id="88be9-249">Considerations</span></span>
<span data-ttu-id="88be9-250">Tenga en cuenta los siguientes puntos cuando decida si va a implementar tareas en segundo plano en una máquina virtual de Azure:</span><span class="sxs-lookup"><span data-stu-id="88be9-250">Consider the following points when you are deciding whether to deploy background tasks in an Azure virtual machine:</span></span>

* <span data-ttu-id="88be9-251">El hospedaje de tareas en segundo plano en una máquina virtual de Azure diferente proporciona flexibilidad y permite un control preciso sobre la iniciación, ejecución, programación y asignación de recursos.</span><span class="sxs-lookup"><span data-stu-id="88be9-251">Hosting background tasks in a separate Azure virtual machine provides flexibility and allows precise control over initiation, execution, scheduling, and resource allocation.</span></span> <span data-ttu-id="88be9-252">Sin embargo, aumentará el costo de tiempo de ejecución si una máquina virtual se debe implementar solo para ejecutar tareas en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-252">However, it will increase runtime cost if a virtual machine must be deployed just to run background tasks.</span></span>
* <span data-ttu-id="88be9-253">No existe ninguna utilidad que permita supervisar las tareas en Azure Portal ni ninguna funcionalidad de reinicio automatizado para las tareas con error; sin embargo, puede supervisar el estado básico de la máquina virtual y administrarla con los [cmdlets de Azure Service Management](https://msdn.microsoft.com/library/mt125356.aspx).</span><span class="sxs-lookup"><span data-stu-id="88be9-253">There is no facility to monitor the tasks in the Azure portal and no automated restart capability for failed tasks--although you can monitor the basic status of the virtual machine and manage it by using the  [Azure Resource Manager Cmdlets](https://msdn.microsoft.com/library/mt125356.aspx).</span></span> <span data-ttu-id="88be9-254">No obstante, no hay funcionalidad para controlar los procesos y subprocesos en los nodos de proceso.</span><span class="sxs-lookup"><span data-stu-id="88be9-254">However, there are no facilities to control processes and threads in compute nodes.</span></span> <span data-ttu-id="88be9-255">Normalmente, el uso de una máquina virtual requiere un esfuerzo adicional para implementar un mecanismo que recopile datos de instrumentación en la tarea y del sistema operativo en la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="88be9-255">Typically, using a virtual machine will require additional effort to implement a mechanism that collects data from instrumentation in the task, and from the operating system in the virtual machine.</span></span> <span data-ttu-id="88be9-256">Una solución que podría ser adecuada es usar el [paquete de administración de System Center para Azure](https://www.microsoft.com/download/details.aspx?id=50013).</span><span class="sxs-lookup"><span data-stu-id="88be9-256">One solution that might be appropriate is to use the [System Center Management Pack for Azure](https://www.microsoft.com/download/details.aspx?id=50013).</span></span>
* <span data-ttu-id="88be9-257">Considere la posibilidad de crear sondeos de supervisión que se exponen a través de puntos de conexión HTTP.</span><span class="sxs-lookup"><span data-stu-id="88be9-257">You might consider creating monitoring probes that are exposed through HTTP endpoints.</span></span> <span data-ttu-id="88be9-258">El código para estos sondeos podría realizar comprobaciones de estado, recopilar información operativa y estadísticas o intercalar información de error y devolverla a una aplicación de administración.</span><span class="sxs-lookup"><span data-stu-id="88be9-258">The code for these probes could perform health checks, collect operational information and statistics--or collate error information and return it to a management application.</span></span> <span data-ttu-id="88be9-259">Para más información, consulte el artículo sobre el [patrón de supervisión del extremo de estado](../patterns/health-endpoint-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="88be9-259">For more information, see [Health Endpoint Monitoring Pattern](../patterns/health-endpoint-monitoring.md).</span></span>

#### <a name="more-information"></a><span data-ttu-id="88be9-260">Más información</span><span class="sxs-lookup"><span data-stu-id="88be9-260">More information</span></span>
* <span data-ttu-id="88be9-261">[Máquinas virtuales](https://azure.microsoft.com/services/virtual-machines/) en Azure</span><span class="sxs-lookup"><span data-stu-id="88be9-261">[Virtual Machines](https://azure.microsoft.com/services/virtual-machines/) on Azure</span></span>
* [<span data-ttu-id="88be9-262">Preguntas más frecuentes sobre Azure Virtual Machines</span><span class="sxs-lookup"><span data-stu-id="88be9-262">Azure Virtual Machines FAQ</span></span>](/azure/virtual-machines/virtual-machines-linux-classic-faq?toc=%2fazure%2fvirtual-machines%2flinux%2fclassic%2ftoc.json)

### <a name="azure-batch"></a><span data-ttu-id="88be9-263">Azure Batch</span><span class="sxs-lookup"><span data-stu-id="88be9-263">Azure Batch</span></span> 

<span data-ttu-id="88be9-264">Considere la posibilidad de usar [Azure Batch](/azure/batch/) si debe ejecutar cargas de trabajo de informática de alto rendimiento (HPC) de gran tamaño y en paralelo, en decenas, cientos o miles de máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="88be9-264">Consider [Azure Batch](/azure/batch/) if you need to run large, parallel high-performance computing (HPC) workloads across tens, hundreds, or thousands of VMs.</span></span>  

<span data-ttu-id="88be9-265">El servicio Batch aprovisiona las máquinas virtuales, asigna las tareas a las máquinas virtuales, ejecuta las tareas y supervisa el progreso.</span><span class="sxs-lookup"><span data-stu-id="88be9-265">The Batch service provisions the VMs, assign tasks to the VMs, runs the tasks, and monitors the progress.</span></span> <span data-ttu-id="88be9-266">Batch puede escalar horizontalmente las máquinas virtuales de forma automática en respuesta a la carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="88be9-266">Batch can automatically scale out the VMs in response to the workload.</span></span> <span data-ttu-id="88be9-267">Batch también proporciona la programación de trabajos.</span><span class="sxs-lookup"><span data-stu-id="88be9-267">Batch also provides job scheduling.</span></span> <span data-ttu-id="88be9-268">Azure Batch admite máquinas virtuales Windows y Linux.</span><span class="sxs-lookup"><span data-stu-id="88be9-268">Azure Batch supports both Linux and Windows VMs.</span></span>

#### <a name="considerations"></a><span data-ttu-id="88be9-269">Consideraciones</span><span class="sxs-lookup"><span data-stu-id="88be9-269">Considerations</span></span> 

<span data-ttu-id="88be9-270">Batch funciona bien con cargas de trabajo intrínsecamente paralelas.</span><span class="sxs-lookup"><span data-stu-id="88be9-270">Batch works well with intrinsically parallel workloads.</span></span> <span data-ttu-id="88be9-271">También puede realizar cálculos en paralelo con un paso reducido al final, o ejecutar [aplicaciones de Message Passing Interface (MPI)](/azure/batch/batch-mpi) para las tareas en paralelo que requieren el paso de mensajes entre los nodos.</span><span class="sxs-lookup"><span data-stu-id="88be9-271">It can also perform parallel calculations with a reduce step at the end, or run [Message Passing Interface (MPI) applications](/azure/batch/batch-mpi) for parallel tasks that require message passing between nodes.</span></span> 

<span data-ttu-id="88be9-272">Un trabajo de Azure Batch se ejecuta en un grupo de nodos (máquinas virtuales).</span><span class="sxs-lookup"><span data-stu-id="88be9-272">An Azure Batch job runs on a pool of nodes (VMs).</span></span> <span data-ttu-id="88be9-273">Un enfoque es asignar un grupo solo cuando sea necesario y eliminarlo una vez completado el trabajo.</span><span class="sxs-lookup"><span data-stu-id="88be9-273">One approach is to allocate a pool only when needed and then delete it after the job completes.</span></span> <span data-ttu-id="88be9-274">Esto permite maximizar el uso porque los nodos no están inactivos, pero el trabajo debe esperar a que se asignen los nodos.</span><span class="sxs-lookup"><span data-stu-id="88be9-274">This maximizes utilization, because nodes are not idle, but the job must wait for nodes to be allocated.</span></span> <span data-ttu-id="88be9-275">También puede crear un grupo de antemano.</span><span class="sxs-lookup"><span data-stu-id="88be9-275">Alternatively, you can create a pool ahead of time.</span></span> <span data-ttu-id="88be9-276">Esto permite minimizar el tiempo que un trabajo tarda en iniciarse, pero el resultado puede ser tener nodos inactivos.</span><span class="sxs-lookup"><span data-stu-id="88be9-276">That approach minimizes the time that it takes for a job to start, but can result in having nodes that sit idle.</span></span> <span data-ttu-id="88be9-277">Para más información, consulte [Vigencia de grupo y nodo de proceso](/azure/batch/batch-api-basics#pool-and-compute-node-lifetime).</span><span class="sxs-lookup"><span data-stu-id="88be9-277">For more information, see [Pool and compute node lifetime](/azure/batch/batch-api-basics#pool-and-compute-node-lifetime).</span></span>

#### <a name="more-information"></a><span data-ttu-id="88be9-278">Más información</span><span class="sxs-lookup"><span data-stu-id="88be9-278">More information</span></span> 

* [<span data-ttu-id="88be9-279">Ejecución de cargas de trabajo intrínsecamente paralelas con Batch</span><span class="sxs-lookup"><span data-stu-id="88be9-279">Run intrinsically parallel workloads with Batch</span></span>](/azure/batch/batch-technical-overview) 
* [<span data-ttu-id="88be9-280">Desarrollo de soluciones de procesos paralelos a gran escala con Batch</span><span class="sxs-lookup"><span data-stu-id="88be9-280">Develop large-scale parallel compute solutions with Batch</span></span>](/azure/batch/batch-api-basics) 
* [<span data-ttu-id="88be9-281">Soluciones de Batch y HPC para cargas de trabajo de procesos a gran escala</span><span class="sxs-lookup"><span data-stu-id="88be9-281">Batch and HPC solutions for large-scale computing workloads</span></span>](/azure/batch/batch-hpc-solutions)

### <a name="azure-container-service"></a><span data-ttu-id="88be9-282">Azure Container Service</span><span class="sxs-lookup"><span data-stu-id="88be9-282">Azure Container Service</span></span> 

<span data-ttu-id="88be9-283">Azure Container Service permite configurar y administrar un clúster de máquinas virtuales en Azure para ejecutar aplicaciones en contenedor.</span><span class="sxs-lookup"><span data-stu-id="88be9-283">Azure Container Service lets you configure and manage a cluster of VMs in Azure to run containerized applications.</span></span> <span data-ttu-id="88be9-284">Permite elegir los orquestadores Docker Swarm, DC/OS o Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="88be9-284">It provides a choice of Docker Swarm, DC/OS, or Kubernetes for orchestration.</span></span> 

<span data-ttu-id="88be9-285">Los contenedores pueden ser útiles para ejecutar trabajos en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-285">Containers can be useful for running background jobs.</span></span> <span data-ttu-id="88be9-286">Estas son algunas de las ventajas:</span><span class="sxs-lookup"><span data-stu-id="88be9-286">Some of the benefits include:</span></span> 

- <span data-ttu-id="88be9-287">Los contenedores admiten el hospedaje de alta densidad.</span><span class="sxs-lookup"><span data-stu-id="88be9-287">Containers support high-density hosting.</span></span> <span data-ttu-id="88be9-288">Puede aislar una tarea en segundo plano en un contenedor y colocar varios contenedores en cada máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="88be9-288">You can isolate a background task in a container, while placing multiple containers in each VM.</span></span>
- <span data-ttu-id="88be9-289">El orquestador de contenedores controla el equilibrio de carga interno, configura la red interna y realiza otras tareas de configuración.</span><span class="sxs-lookup"><span data-stu-id="88be9-289">The container orchestrator handles internal load balancing, configuring the internal network, and other configuration tasks.</span></span>
- <span data-ttu-id="88be9-290">Los contenedores se pueden iniciar y detener cuando sea necesario.</span><span class="sxs-lookup"><span data-stu-id="88be9-290">Containers can be started and stopped as needed.</span></span> 
- <span data-ttu-id="88be9-291">Azure Container Registry permite registrar los contenedores dentro de los límites de Azure.</span><span class="sxs-lookup"><span data-stu-id="88be9-291">Azure Container Registry allows you to register your containers inside Azure boundaries.</span></span> <span data-ttu-id="88be9-292">Esto aporta ventajas en cuanto a seguridad, privacidad y proximidad.</span><span class="sxs-lookup"><span data-stu-id="88be9-292">This comes with security, privacy, and proximity benefits.</span></span> 

#### <a name="considerations"></a><span data-ttu-id="88be9-293">Consideraciones</span><span class="sxs-lookup"><span data-stu-id="88be9-293">Considerations</span></span>

- <span data-ttu-id="88be9-294">Requiere conocer cómo se usa un orquestador de contenedores.</span><span class="sxs-lookup"><span data-stu-id="88be9-294">Requires an understanding of how to use a container orchestrator.</span></span> <span data-ttu-id="88be9-295">Según las habilidades de su equipo de DevOps, esto puede ser un problema o no.</span><span class="sxs-lookup"><span data-stu-id="88be9-295">Depending on the skillset of your DevOps team, this may or may not be an issue.</span></span>  
- <span data-ttu-id="88be9-296">Container Service se ejecuta en un entorno IaaS.</span><span class="sxs-lookup"><span data-stu-id="88be9-296">Container Service runs in an IaaS environment.</span></span> <span data-ttu-id="88be9-297">Aprovisiona un clúster de máquinas virtuales dentro de una red virtual dedicada.</span><span class="sxs-lookup"><span data-stu-id="88be9-297">It provisions a cluster of VMs inside a dedicated VNet.</span></span> 

#### <a name="more-information"></a><span data-ttu-id="88be9-298">Más información</span><span class="sxs-lookup"><span data-stu-id="88be9-298">More information</span></span> 

* [<span data-ttu-id="88be9-299">Introducción a las soluciones de hospedaje de contenedores de Docker mediante Azure Container Service</span><span class="sxs-lookup"><span data-stu-id="88be9-299">Introduction to Docker container hosting solutions with Azure Container Service</span></span>](/azure/container-service/container-service-intro) 
* [<span data-ttu-id="88be9-300">Introducción a los registros de contenedores privados de Docker</span><span class="sxs-lookup"><span data-stu-id="88be9-300">Introduction to private Docker container registries</span></span>](/azure/container-registry/container-registry-intro) 

### <a name="azure-cloud-services"></a><span data-ttu-id="88be9-301">Azure Cloud Services</span><span class="sxs-lookup"><span data-stu-id="88be9-301">Azure Cloud Services</span></span> 
<span data-ttu-id="88be9-302">Puede ejecutar tareas en segundo plano dentro de un rol web o en un rol de trabajo independiente.</span><span class="sxs-lookup"><span data-stu-id="88be9-302">You can execute background tasks within a web role or in a separate worker role.</span></span> <span data-ttu-id="88be9-303">Cuando decida si debe usar un rol de trabajo, considere los requisitos de elasticidad y escalabilidad, la duración de la tarea, la cadencia de la versión, la seguridad, la tolerancia a errores, la contención, la complejidad y la arquitectura lógica.</span><span class="sxs-lookup"><span data-stu-id="88be9-303">When you are deciding whether to use a worker role, consider scalability and elasticity requirements, task lifetime, release cadence, security, fault tolerance, contention, complexity, and the logical architecture.</span></span> <span data-ttu-id="88be9-304">Para más información, consulte el artículo sobre el [patrón de consolidación de recursos de proceso](../patterns/compute-resource-consolidation.md).</span><span class="sxs-lookup"><span data-stu-id="88be9-304">For more information, see [Compute Resource Consolidation Pattern](../patterns/compute-resource-consolidation.md).</span></span>

<span data-ttu-id="88be9-305">Hay varias maneras de implementar tareas en segundo plano dentro de un rol de Cloud Services:</span><span class="sxs-lookup"><span data-stu-id="88be9-305">There are several ways to implement background tasks within a Cloud Services role:</span></span>

* <span data-ttu-id="88be9-306">Crear una implementación de la clase **RoleEntryPoint** en el rol y usar sus métodos para ejecutar tareas en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-306">Create an implementation of the **RoleEntryPoint** class in the role and use its methods to execute background tasks.</span></span> <span data-ttu-id="88be9-307">Las tareas se ejecutan en el contexto de WaIISHost.exe.</span><span class="sxs-lookup"><span data-stu-id="88be9-307">The tasks run in the context of WaIISHost.exe.</span></span> <span data-ttu-id="88be9-308">Pueden usar el método **GetSetting** de la clase **CloudConfigurationManager** para cargar las opciones de configuración.</span><span class="sxs-lookup"><span data-stu-id="88be9-308">They can use the **GetSetting** method of the **CloudConfigurationManager** class to load configuration settings.</span></span> <span data-ttu-id="88be9-309">Para más información, consulte [Ciclo de vida](#lifecycle).</span><span class="sxs-lookup"><span data-stu-id="88be9-309">For more information, see [Lifecycle](#lifecycle).</span></span>
* <span data-ttu-id="88be9-310">Use las tareas de inicio para ejecutar tareas en segundo plano al iniciarse la aplicación.</span><span class="sxs-lookup"><span data-stu-id="88be9-310">Use startup tasks to execute background tasks when the application starts.</span></span> <span data-ttu-id="88be9-311">Para forzar que las tareas sigan ejecutándose en segundo plano, establezca la propiedad **taskType** en **background** (si no lo hace, el proceso de inicio de la aplicación se detendrá y esperará a que finalice la tarea).</span><span class="sxs-lookup"><span data-stu-id="88be9-311">To force the tasks to continue to run in the background, set the **taskType** property to **background** (if you do not do this, the application startup process will halt and wait for the task to finish).</span></span> <span data-ttu-id="88be9-312">Para más información, consulte [Ejecutar tareas de inicio en Azure](/azure/cloud-services/cloud-services-startup-tasks).</span><span class="sxs-lookup"><span data-stu-id="88be9-312">For more information, see [Run startup tasks in Azure](/azure/cloud-services/cloud-services-startup-tasks).</span></span>
* <span data-ttu-id="88be9-313">Use el SDK de WebJobs para implementar tareas en segundo plano como WebJobs que se inician como tarea de inicio.</span><span class="sxs-lookup"><span data-stu-id="88be9-313">Use the WebJobs SDK to implement background tasks such as WebJobs that are initiated as a startup task.</span></span> <span data-ttu-id="88be9-314">Para más información, consulte cómo [crear un trabajo web de .NET en Azure App Service](/azure/app-service-web/websites-dotnet-webjobs-sdk-get-started).</span><span class="sxs-lookup"><span data-stu-id="88be9-314">For more information, see [Create a .NET WebJob in Azure App Service](/azure/app-service-web/websites-dotnet-webjobs-sdk-get-started).</span></span>
* <span data-ttu-id="88be9-315">Use una tarea de inicio para instalar un servicio de Windows que ejecuta una o más tareas en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-315">Use a startup task to install a Windows service that executes one or more background tasks.</span></span> <span data-ttu-id="88be9-316">Debe establecer la propiedad **taskType** en **background** para que el servicio se ejecute en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-316">You must set the **taskType** property to **background** so that the service executes in the background.</span></span> <span data-ttu-id="88be9-317">Para más información, consulte [Ejecutar tareas de inicio en Azure](/azure/cloud-services/cloud-services-startup-tasks).</span><span class="sxs-lookup"><span data-stu-id="88be9-317">For more information, see [Run startup tasks in Azure](/azure/cloud-services/cloud-services-startup-tasks).</span></span>

<span data-ttu-id="88be9-318">La principal ventaja de ejecutar tareas en segundo plano en el rol web es el ahorro en costos de hospedaje porque no hay ningún requisito que exige implementar funciones adicionales.</span><span class="sxs-lookup"><span data-stu-id="88be9-318">The main advantage of running background tasks in the web role is the saving in hosting costs because there is no requirement to deploy additional roles.</span></span>

<span data-ttu-id="88be9-319">Ejecutar tareas en segundo plano en un rol de trabajo tiene varias ventajas:</span><span class="sxs-lookup"><span data-stu-id="88be9-319">Running background tasks in a worker role has several advantages:</span></span>

* <span data-ttu-id="88be9-320">Permite administrar el escalado por separado para cada tipo de rol.</span><span class="sxs-lookup"><span data-stu-id="88be9-320">It allows you to manage scaling separately for each type of role.</span></span> <span data-ttu-id="88be9-321">Por ejemplo, puede que necesite más instancias de un rol web para admitir la carga actual, pero menos instancias del rol de trabajo que ejecuta tareas en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-321">For example, you might need more instances of a web role to support the current load, but fewer instances of the worker role that executes background tasks.</span></span> <span data-ttu-id="88be9-322">Al escalar instancias de proceso de tarea de segundo plano por separado desde los roles de la interfaz de usuario, puede reducir los costos de hospedaje, al mismo tiempo que mantiene un rendimiento aceptable.</span><span class="sxs-lookup"><span data-stu-id="88be9-322">By scaling background task compute instances separately from the UI roles, you can reduce hosting costs, while maintaining acceptable performance.</span></span>
* <span data-ttu-id="88be9-323">Descarga la sobrecarga de procesamiento de las tareas en segundo plano del rol web.</span><span class="sxs-lookup"><span data-stu-id="88be9-323">It offloads the processing overhead for background tasks from the web role.</span></span> <span data-ttu-id="88be9-324">El rol web que proporciona la interfaz de usuario puede seguir respondiendo y es posible que implique la necesidad de un menor número de instancias para admitir un volumen determinado de las solicitudes de usuarios.</span><span class="sxs-lookup"><span data-stu-id="88be9-324">The web role that provides the UI can remain responsive, and it may mean fewer instances are required to support a given volume of requests from users.</span></span>
* <span data-ttu-id="88be9-325">Permite implementar la separación de preocupaciones.</span><span class="sxs-lookup"><span data-stu-id="88be9-325">It allows you to implement separation of concerns.</span></span> <span data-ttu-id="88be9-326">Cada tipo de rol puede implementar un conjunto específico de tareas claramente definidas y relacionadas.</span><span class="sxs-lookup"><span data-stu-id="88be9-326">Each role type can implement a specific set of clearly defined and related tasks.</span></span> <span data-ttu-id="88be9-327">Esto facilita el diseño y mantenimiento del código porque hay menos interdependencia de código y funcionalidad entre cada rol.</span><span class="sxs-lookup"><span data-stu-id="88be9-327">This makes designing and maintaining the code easier because there is less interdependence of code and functionality between each role.</span></span>
* <span data-ttu-id="88be9-328">Puede ayudar a aislar los datos y procesos confidenciales.</span><span class="sxs-lookup"><span data-stu-id="88be9-328">It can help to isolate sensitive processes and data.</span></span> <span data-ttu-id="88be9-329">Por ejemplo, los roles de web que implementan la interfaz de usuario no necesitan tener acceso a los datos que administra y controla un rol de trabajo.</span><span class="sxs-lookup"><span data-stu-id="88be9-329">For example, web roles that implement the UI do not need to have access to data that is managed and controlled by a worker role.</span></span> <span data-ttu-id="88be9-330">Esto puede ser útil al reforzar la seguridad, especialmente cuando usa un patrón como el [patrón Gatekeeper](../patterns/gatekeeper.md).</span><span class="sxs-lookup"><span data-stu-id="88be9-330">This can be useful in strengthening security, especially when you use a pattern such as the [Gatekeeper Pattern](../patterns/gatekeeper.md).</span></span>  

#### <a name="considerations"></a><span data-ttu-id="88be9-331">Consideraciones</span><span class="sxs-lookup"><span data-stu-id="88be9-331">Considerations</span></span>
<span data-ttu-id="88be9-332">Tenga en cuenta los siguientes puntos a la hora de elegir cómo y dónde implementar tareas en segundo plano cuando se usan los roles web y de trabajo de Cloud Services:</span><span class="sxs-lookup"><span data-stu-id="88be9-332">Consider the following points when choosing how and where to deploy background tasks when using Cloud Services web and worker roles:</span></span>

* <span data-ttu-id="88be9-333">Hospedar tareas en segundo plano en un rol web existente puede ahorrar el costo de la ejecución de un rol de trabajo independiente solo para estas tareas.</span><span class="sxs-lookup"><span data-stu-id="88be9-333">Hosting background tasks in an existing web role can save the cost of running a separate worker role just for these tasks.</span></span> <span data-ttu-id="88be9-334">Sin embargo, es probable que afecten al rendimiento y la disponibilidad de la aplicación si existe contención de procesos y otros recursos.</span><span class="sxs-lookup"><span data-stu-id="88be9-334">However, it is likely to affect the performance and availability of the application if there is contention for processing and other resources.</span></span> <span data-ttu-id="88be9-335">El uso de un rol de trabajo independiente protege al rol web ante el impacto de las tareas en segundo plano de larga ejecución o que hacen un uso intensivo de los recursos.</span><span class="sxs-lookup"><span data-stu-id="88be9-335">Using a separate worker role protects the web role from the impact of long-running or resource-intensive background tasks.</span></span>
* <span data-ttu-id="88be9-336">Si hospeda tareas en segundo plano con la clase **RoleEntryPoint** , puede moverlo fácilmente a otro rol.</span><span class="sxs-lookup"><span data-stu-id="88be9-336">If you host background tasks by using the **RoleEntryPoint** class, you can easily move this to another role.</span></span> <span data-ttu-id="88be9-337">Por ejemplo, si crea la clase en un rol web y más adelante decide que necesita ejecutar las tareas en un rol de trabajo, puede mover la implementación de la clase **RoleEntryPoint** al rol de trabajo.</span><span class="sxs-lookup"><span data-stu-id="88be9-337">For example, if you create the class in a web role and later decide that you need to run the tasks in a worker role, you can move the **RoleEntryPoint** class implementation into the worker role.</span></span>
* <span data-ttu-id="88be9-338">Las tareas de inicio están diseñadas para ejecutar un programa o un script.</span><span class="sxs-lookup"><span data-stu-id="88be9-338">Startup tasks are designed to execute a program or a script.</span></span> <span data-ttu-id="88be9-339">La implementación de un trabajo en segundo plano como un programa ejecutable podría ser más difícil, especialmente si también requiere la implementación de ensamblados dependientes.</span><span class="sxs-lookup"><span data-stu-id="88be9-339">Deploying a background job as an executable program might be more difficult, especially if it also requires deployment of dependent assemblies.</span></span> <span data-ttu-id="88be9-340">Podría ser más fácil implementar y usar un script para definir un trabajo en segundo plano si usa tareas de inicio.</span><span class="sxs-lookup"><span data-stu-id="88be9-340">It might be easier to deploy and use a script to define a background job when you use startup tasks.</span></span>
* <span data-ttu-id="88be9-341">Las excepciones que provocan un error en una tarea en segundo plano tienen un impacto diferente, según la manera en que se hospedan:</span><span class="sxs-lookup"><span data-stu-id="88be9-341">Exceptions that cause a background task to fail have a different impact, depending on the way that they are hosted:</span></span>
  * <span data-ttu-id="88be9-342">Si usa el método de la clase **RoleEntryPoint** , una tarea con error hará que el rol se reinicie para que la tarea se reinicie automáticamente.</span><span class="sxs-lookup"><span data-stu-id="88be9-342">If you use the **RoleEntryPoint** class approach, a failed task will cause the role to restart so that the task automatically restarts.</span></span> <span data-ttu-id="88be9-343">Esto puede afectar a la disponibilidad de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="88be9-343">This can affect availability of the application.</span></span> <span data-ttu-id="88be9-344">Para evitar esto, asegúrese de incluir una gestión sólida de excepciones dentro de la clase **RoleEntryPoint** y todas las tareas en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-344">To prevent this, ensure that you include robust exception handling within the **RoleEntryPoint** class and all the background tasks.</span></span> <span data-ttu-id="88be9-345">Use código para reiniciar las tareas con error cuando resulte adecuado y lance la excepción para reiniciar el rol únicamente si no puede recuperarse correctamente tras un error dentro del código.</span><span class="sxs-lookup"><span data-stu-id="88be9-345">Use code to restart tasks that fail where this is appropriate, and throw the exception to restart the role only if you cannot gracefully recover from the failure within your code.</span></span>
  * <span data-ttu-id="88be9-346">Si usa tareas de inicio, es su responsabilidad administrar la ejecución de la tarea y de la comprobación cuando si se produce un error.</span><span class="sxs-lookup"><span data-stu-id="88be9-346">If you use startup tasks, you are responsible for managing the task execution and checking if it fails.</span></span>
* <span data-ttu-id="88be9-347">La administración y supervisión de tareas de inicio son más difíciles que usar el método de la clase **RoleEntryPoint** .</span><span class="sxs-lookup"><span data-stu-id="88be9-347">Managing and monitoring startup tasks is more difficult than using the **RoleEntryPoint** class approach.</span></span> <span data-ttu-id="88be9-348">Sin embargo, el SDK de Azure WebJobs incluye un panel para facilitar la administración de WebJobs que se inician a través de las tareas de inicio.</span><span class="sxs-lookup"><span data-stu-id="88be9-348">However, the Azure WebJobs SDK includes a dashboard to make it easier to manage WebJobs that you initiate through startup tasks.</span></span>

#### <a name="lifecycle"></a><span data-ttu-id="88be9-349">Ciclo de vida</span><span class="sxs-lookup"><span data-stu-id="88be9-349">Lifecycle</span></span> 
 <span data-ttu-id="88be9-350">Si decide implementar trabajos en segundo plano para aplicaciones de Cloud Services que usan roles web y de trabajo mediante la clase **RoleEntryPoint** , es importante comprender el ciclo de vida de esta clase para poder usarla correctamente.</span><span class="sxs-lookup"><span data-stu-id="88be9-350">If you decide to implement background jobs for Cloud Services applications that use web and worker roles by using the **RoleEntryPoint** class, it is important to understand the lifecycle of this class in order to use it correctly.</span></span>

<span data-ttu-id="88be9-351">Los roles web y de trabajo pasan por un conjunto de fases como al iniciarse, ejecutarse y detenerse.</span><span class="sxs-lookup"><span data-stu-id="88be9-351">Web and worker roles go through a set of distinct phases as they start, run, and stop.</span></span> <span data-ttu-id="88be9-352">La clase **RoleEntryPoint** expone una serie de eventos que indican cuándo se producen estas fases.</span><span class="sxs-lookup"><span data-stu-id="88be9-352">The **RoleEntryPoint** class exposes a series of events that indicate when these stages are occurring.</span></span> <span data-ttu-id="88be9-353">Estos se usan para inicializar, ejecutar y detener las tareas en segundo plano personalizadas.</span><span class="sxs-lookup"><span data-stu-id="88be9-353">You use these to initialize, run, and stop your custom background tasks.</span></span> <span data-ttu-id="88be9-354">El ciclo completo es el siguiente:</span><span class="sxs-lookup"><span data-stu-id="88be9-354">The complete cycle is:</span></span>

* <span data-ttu-id="88be9-355">Azure carga el ensamblado de roles y busca en él una clase que deriva de **RoleEntryPoint**.</span><span class="sxs-lookup"><span data-stu-id="88be9-355">Azure loads the role assembly and searches it for a class that derives from **RoleEntryPoint**.</span></span>
* <span data-ttu-id="88be9-356">Si encuentra esta clase, llama a **RoleEntryPoint.OnStart()**.</span><span class="sxs-lookup"><span data-stu-id="88be9-356">If it finds this class, it calls **RoleEntryPoint.OnStart()**.</span></span> <span data-ttu-id="88be9-357">Invalide este método para inicializar las tareas en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-357">You override this method to initialize your background tasks.</span></span>
* <span data-ttu-id="88be9-358">Una vez que el método **OnStart** se ha completado, Azure llama a **Application_Start()** en el archivo Global de la aplicación, si está presente (por ejemplo, Global.asax en un rol web que ejecuta ASP.NET).</span><span class="sxs-lookup"><span data-stu-id="88be9-358">After the **OnStart** method has completed, Azure calls **Application_Start()** in the application’s Global file if this is present (for example, Global.asax in a web role running ASP.NET).</span></span>
* <span data-ttu-id="88be9-359">Azure llama a **RoleEntryPoint.Run()** en un nuevo subproceso en primer plano que se ejecuta en paralelo con **OnStart()**.</span><span class="sxs-lookup"><span data-stu-id="88be9-359">Azure calls **RoleEntryPoint.Run()** on a new foreground thread that executes in parallel with **OnStart()**.</span></span> <span data-ttu-id="88be9-360">Invalide este método para iniciar las tareas en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-360">You override this method to start your background tasks.</span></span>
* <span data-ttu-id="88be9-361">Cuando finalice el método Run, Azure llama primero a **Application_End()** en el archivo Global de la aplicación si está presente y luego a **RoleEntryPoint.OnStop()**.</span><span class="sxs-lookup"><span data-stu-id="88be9-361">When the Run method ends, Azure first calls **Application_End()** in the application’s Global file if this is present, and then calls **RoleEntryPoint.OnStop()**.</span></span> <span data-ttu-id="88be9-362">Invalide el método **OnStop** para detener las tareas en segundo plano, limpiar los recursos, eliminar objetos y cerrar las conexiones que las tareas podrían haber usado.</span><span class="sxs-lookup"><span data-stu-id="88be9-362">You override the **OnStop** method to stop your background tasks, clean up resources, dispose of objects, and close connections that the tasks may have used.</span></span>
* <span data-ttu-id="88be9-363">Se detiene el proceso de host del rol de trabajo de Azure.</span><span class="sxs-lookup"><span data-stu-id="88be9-363">The Azure worker role host process is stopped.</span></span> <span data-ttu-id="88be9-364">En este punto, el rol se reciclará y se reiniciará.</span><span class="sxs-lookup"><span data-stu-id="88be9-364">At this point, the role will be recycled and will restart.</span></span>

<span data-ttu-id="88be9-365">Para obtener más detalles y un ejemplo del uso de los métodos de la clase **RoleEntryPoint** , consulte el artículo sobre el [patrón de consolidación de recursos de proceso](../patterns/compute-resource-consolidation.md).</span><span class="sxs-lookup"><span data-stu-id="88be9-365">For more details and an example of using the methods of the **RoleEntryPoint** class, see [Compute Resource Consolidation Pattern](../patterns/compute-resource-consolidation.md).</span></span>

#### <a name="implementation-considerations"></a><span data-ttu-id="88be9-366">Consideraciones de implementación</span><span class="sxs-lookup"><span data-stu-id="88be9-366">Implementation considerations</span></span>

<span data-ttu-id="88be9-367">Tenga en cuenta los siguientes puntos si está implementando tareas en segundo plano en un rol web o de trabajo:</span><span class="sxs-lookup"><span data-stu-id="88be9-367">Consider the following points if you are implementing background tasks in a web or worker role:</span></span>

* <span data-ttu-id="88be9-368">La implementación predeterminada del método **Run** en la clase **RoleEntryPoint** contiene una llamada a **Thread.Sleep(Timeout.Infinite)** que mantiene el rol activo de manera indefinida.</span><span class="sxs-lookup"><span data-stu-id="88be9-368">The default **Run** method implementation in the **RoleEntryPoint** class contains a call to **Thread.Sleep(Timeout.Infinite)** that keeps the role alive indefinitely.</span></span> <span data-ttu-id="88be9-369">Si invalida el método **Run** (esto suele ser necesario para ejecutar tareas en segundo plano), no debe permitir que el código salga del método, a menos que quiera reciclar la instancia de rol.</span><span class="sxs-lookup"><span data-stu-id="88be9-369">If you override the **Run** method (which is typically necessary to execute background tasks), you must not allow your code to exit from the method unless you want to recycle the role instance.</span></span>
* <span data-ttu-id="88be9-370">En una implementación típica del método **Run** se incluye código para iniciar cada una de las tareas en segundo plano, así como una construcción de bucle que comprueba periódicamente el estado de todas las tareas en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-370">A typical implementation of the **Run** method includes code to start each of the background tasks and a loop construct that periodically checks the state of all the background tasks.</span></span> <span data-ttu-id="88be9-371">Puede reiniciar las que tengan errores o supervisar en búsqueda de tokens de cancelación que indican que los trabajos se han completado.</span><span class="sxs-lookup"><span data-stu-id="88be9-371">It can restart any that fail or monitor for cancellation tokens that indicate that jobs have completed.</span></span>
* <span data-ttu-id="88be9-372">Si una tarea en segundo plano lanza una excepción no controlada, dicha tarea debería reciclarse a la vez que permite que las otras tareas en segundo plano del rol sigan en ejecución.</span><span class="sxs-lookup"><span data-stu-id="88be9-372">If a background task throws an unhandled exception, that task should be recycled while allowing any other background tasks in the role to continue running.</span></span> <span data-ttu-id="88be9-373">Sin embargo, si la excepción se debe a daños en los objetos fuera de la tarea, como en el almacenamiento compartido, la excepción debería controlarla la clase **RoleEntryPoint**, se deberían cancelar todas las tareas y se debería permitir que el método **Run** finalice.</span><span class="sxs-lookup"><span data-stu-id="88be9-373">However, if the exception is caused by corruption of objects outside the task, such as shared storage, the exception should be handled by your **RoleEntryPoint** class, all tasks should be cancelled, and the **Run** method should be allowed to end.</span></span> <span data-ttu-id="88be9-374">Azure entonces reiniciará el rol.</span><span class="sxs-lookup"><span data-stu-id="88be9-374">Azure will then restart the role.</span></span>
* <span data-ttu-id="88be9-375">Use el método **OnStop** para pausar o detener las tareas en segundo plano y limpiar los recursos.</span><span class="sxs-lookup"><span data-stu-id="88be9-375">Use the **OnStop** method to pause or kill background tasks and clean up resources.</span></span> <span data-ttu-id="88be9-376">Esto puede implicar la interrupción de tareas de ejecución prolongada o de varios pasos.</span><span class="sxs-lookup"><span data-stu-id="88be9-376">This might involve stopping long-running or multistep tasks.</span></span> <span data-ttu-id="88be9-377">Es esencial tener en cuenta cómo puede realizarse esto para evitar incoherencias en los datos.</span><span class="sxs-lookup"><span data-stu-id="88be9-377">It is vital to consider how this can be done to avoid data inconsistencies.</span></span> <span data-ttu-id="88be9-378">Si una instancia de rol se detiene por algún motivo que no sea un cierre iniciado por el usuario, el código que se ejecuta en el método **OnStop** debe completarse en un plazo de cinco minutos antes de que se finalice forzosamente.</span><span class="sxs-lookup"><span data-stu-id="88be9-378">If a role instance stops for any reason other than a user-initiated shutdown, the code running in the **OnStop** method must be completed within five minutes before it is forcibly terminated.</span></span> <span data-ttu-id="88be9-379">Asegúrese de que el código pueda completarse en ese tiempo o que pueda tolerar que no se ejecute hasta completarse.</span><span class="sxs-lookup"><span data-stu-id="88be9-379">Ensure that your code can be completed in that time or can tolerate not running to completion.</span></span>  
* <span data-ttu-id="88be9-380">Azure Load Balancer comienza a dirigir el tráfico a la instancia de rol cuando el método **RoleEntryPoint.OnStart** devuelve el valor **true**.</span><span class="sxs-lookup"><span data-stu-id="88be9-380">The Azure load balancer starts directing traffic to the role instance when the **RoleEntryPoint.OnStart** method returns the value **true**.</span></span> <span data-ttu-id="88be9-381">Por lo tanto, considere la posibilidad de colocar el código de inicialización en el método **OnStart** para que las instancias de rol que no se inicializan correctamente no reciban tráfico.</span><span class="sxs-lookup"><span data-stu-id="88be9-381">Therefore, consider putting all your initialization code in the **OnStart** method so that role instances that do not successfully initialize will not receive any traffic.</span></span>
* <span data-ttu-id="88be9-382">Puede usar tareas de inicio además de los métodos de la clase **RoleEntryPoint** .</span><span class="sxs-lookup"><span data-stu-id="88be9-382">You can use startup tasks in addition to the methods of the **RoleEntryPoint** class.</span></span> <span data-ttu-id="88be9-383">Debería usar tareas de inicio para inicializar las opciones de configuración que necesite cambiar en el equilibrador de carga de Azure porque estas tareas se ejecutarán antes de que el rol reciba cualquier solicitud.</span><span class="sxs-lookup"><span data-stu-id="88be9-383">You should use startup tasks to initialize any settings that you need to change in the Azure load balancer because these tasks will execute before the role receives any requests.</span></span> <span data-ttu-id="88be9-384">Para más información, consulte [Ejecutar tareas de inicio en Azure](/azure/cloud-services/cloud-services-startup-tasks/).</span><span class="sxs-lookup"><span data-stu-id="88be9-384">For more information, see [Run startup tasks in Azure](/azure/cloud-services/cloud-services-startup-tasks/).</span></span>
* <span data-ttu-id="88be9-385">Si se produce un error en una tarea de inicio, es posible que obligue al rol a reiniciarse continuamente.</span><span class="sxs-lookup"><span data-stu-id="88be9-385">If there is an error in a startup task, it might force the role to continually restart.</span></span> <span data-ttu-id="88be9-386">Esto puede impedir la realización de un intercambio de dirección IP virtual (VIP) a una versión de ensayo anterior porque el intercambio requiere acceso exclusivo al rol.</span><span class="sxs-lookup"><span data-stu-id="88be9-386">This can prevent you from performing a virtual IP (VIP) address swap back to a previously staged version because the swap requires exclusive access to the role.</span></span> <span data-ttu-id="88be9-387">Esto no se puede obtener mientras se reinicia el rol.</span><span class="sxs-lookup"><span data-stu-id="88be9-387">This cannot be obtained while the role is restarting.</span></span> <span data-ttu-id="88be9-388">Para resolver este problema:</span><span class="sxs-lookup"><span data-stu-id="88be9-388">To resolve this:</span></span>
  
  * <span data-ttu-id="88be9-389">Agregue el siguiente código al principio de los métodos **OnStart** y **Run** en el rol:</span><span class="sxs-lookup"><span data-stu-id="88be9-389">Add the following code to the beginning of the **OnStart** and **Run** methods in your role:</span></span>
    
    ```C#
    var freeze = CloudConfigurationManager.GetSetting("Freeze");
    if (freeze != null)
    {
      if (Boolean.Parse(freeze))
      {
        Thread.Sleep(System.Threading.Timeout.Infinite);
      }
    }
    ```
    
  * <span data-ttu-id="88be9-390">Agregue la definición de la opción **Freeze** como un valor booleano a los archivos ServiceDefinition.csdef y ServiceConfiguration.\*.cscfg para el rol y establézcala en **false**.</span><span class="sxs-lookup"><span data-stu-id="88be9-390">Add the definition of the **Freeze** setting as a Boolean value to the ServiceDefinition.csdef and ServiceConfiguration.\*.cscfg files for the role and set it to **false**.</span></span> <span data-ttu-id="88be9-391">Si el rol entra en un modo de reinicio repetido, puede cambiar la opción a **true** para inmovilizar la ejecución del rol y permitir que se intercambie con una versión anterior.</span><span class="sxs-lookup"><span data-stu-id="88be9-391">If the role goes into a repeated restart mode, you can change the setting to **true** to freeze role execution and allow it to be swapped with a previous version.</span></span>

#### <a name="more-information"></a><span data-ttu-id="88be9-392">Más información</span><span class="sxs-lookup"><span data-stu-id="88be9-392">More information</span></span>
* [<span data-ttu-id="88be9-393">Patrón de consolidación de recursos de proceso</span><span class="sxs-lookup"><span data-stu-id="88be9-393">Compute Resource Consolidation Pattern</span></span>](../patterns/compute-resource-consolidation.md)
* [<span data-ttu-id="88be9-394">Introducción al SDK de Azure WebJobs</span><span class="sxs-lookup"><span data-stu-id="88be9-394">Get started with the Azure WebJobs SDK</span></span>](/azure/app-service-web/websites-dotnet-webjobs-sdk-get-started/)


## <a name="partitioning"></a><span data-ttu-id="88be9-395">Creación de particiones</span><span class="sxs-lookup"><span data-stu-id="88be9-395">Partitioning</span></span>
<span data-ttu-id="88be9-396">Si decide incluir tareas en segundo plano dentro de una instancia de proceso existente (por ejemplo, una aplicación web, un rol web, un rol de trabajo existente o una máquina virtual), debe tener en cuenta cómo afectará a los atributos de calidad de la instancia de proceso y la tarea de segundo plano propiamente dicha.</span><span class="sxs-lookup"><span data-stu-id="88be9-396">If you decide to include background tasks within an existing compute instance (such as a web app, web role, existing worker role, or virtual machine), you must consider how this will affect the quality attributes of the compute instance and the background task itself.</span></span> <span data-ttu-id="88be9-397">Estos factores le ayudarán a decidir si las tareas se deben colocalizar con la instancia de proceso existente o si se deben separar en una instancia de proceso independiente:</span><span class="sxs-lookup"><span data-stu-id="88be9-397">These factors will help you to decide whether to colocate the tasks with the existing compute instance or separate them out into a separate compute instance:</span></span>

* <span data-ttu-id="88be9-398">**Disponibilidad**: es posible que las tareas en segundo plano no necesiten tener el mismo nivel de disponibilidad que otras partes de la aplicación, en concreto, la interfaz de usuario y otras partes que están implicadas directamente en la interacción con el usuario.</span><span class="sxs-lookup"><span data-stu-id="88be9-398">**Availability**: Background tasks might not need to have the same level of availability as other parts of the application, in particular the UI and other parts that are directly involved in user interaction.</span></span> <span data-ttu-id="88be9-399">Las tareas en segundo plano podrían ser más tolerantes a la latencia, a los errores de reintento de conexión y a otros factores que afectan a la disponibilidad, ya que las operaciones se pueden poner en cola.</span><span class="sxs-lookup"><span data-stu-id="88be9-399">Background tasks might be more tolerant of latency, retried connection failures, and other factors that affect availability because the operations can be queued.</span></span> <span data-ttu-id="88be9-400">Sin embargo, debe haber capacidad suficiente como para evitar la copia de seguridad de las solicitudes que podrían bloquear las colas y afectar a la aplicación en su totalidad.</span><span class="sxs-lookup"><span data-stu-id="88be9-400">However, there must be sufficient capacity to prevent the backup of requests that could block queues and affect the application as a whole.</span></span>
* <span data-ttu-id="88be9-401">**Escalabilidad**: es probable que las tareas en segundo plano tengan un requisito de escalabilidad diferente al de la interfaz de usuario y las partes interactivas de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="88be9-401">**Scalability**: Background tasks are likely to have a different scalability requirement than the UI and the interactive parts of the application.</span></span> <span data-ttu-id="88be9-402">El escalado de la interfaz de usuario podría ser necesario para satisfacer los picos de demanda, mientras que las tareas en segundo plano pendientes podrían completarse en horarios de menor actividad usando un menor número de instancias de proceso.</span><span class="sxs-lookup"><span data-stu-id="88be9-402">Scaling the UI might be necessary to meet peaks in demand, while outstanding background tasks might be completed during less busy times by a fewer number of compute instances.</span></span>
* <span data-ttu-id="88be9-403">**Resistencia**: el error de una instancia de proceso que hospeda solo tareas en segundo plano podría no afectar gravemente a la aplicación en su totalidad si las solicitudes para estas tareas se pueden poner en cola o posponer hasta que la tarea esté disponible de nuevo.</span><span class="sxs-lookup"><span data-stu-id="88be9-403">**Resiliency**: Failure of a compute instance that just hosts background tasks might not fatally affect the application as a whole if the requests for these tasks can be queued or postponed until the task is available again.</span></span> <span data-ttu-id="88be9-404">Si la instancia de proceso o las tareas se pueden reiniciar dentro de un intervalo adecuado, es posible que los usuarios de la aplicación no se vean afectados.</span><span class="sxs-lookup"><span data-stu-id="88be9-404">If the compute instance and/or tasks can be restarted within an appropriate interval, users of the application might not be affected.</span></span>
* <span data-ttu-id="88be9-405">**Seguridad**: las tareas en segundo plano podrían tener requisitos o restricciones de seguridad distintos de los de la interfaz de usuario u otras partes de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="88be9-405">**Security**: Background tasks might have different security requirements or restrictions than the UI or other parts of the application.</span></span> <span data-ttu-id="88be9-406">Al usar una instancia de proceso independiente, puede especificar un entorno de seguridad diferente para las tareas.</span><span class="sxs-lookup"><span data-stu-id="88be9-406">By using a separate compute instance, you can specify a different security environment for the tasks.</span></span> <span data-ttu-id="88be9-407">También puede usar patrones, como Gatekeeper, para aislar las instancias de proceso de segundo plano de la interfaz de usuario con el fin de maximizar la seguridad y la separación.</span><span class="sxs-lookup"><span data-stu-id="88be9-407">You can also use patterns such as Gatekeeper to isolate the background compute instances from the UI in order to maximize security and separation.</span></span>
* <span data-ttu-id="88be9-408">**Rendimiento**: puede elegir el tipo de instancia de proceso para las tareas de segundo plano de modo que satisfagan específicamente los requisitos de rendimiento de las tareas.</span><span class="sxs-lookup"><span data-stu-id="88be9-408">**Performance**: You can choose the type of compute instance for background tasks to specifically match the performance requirements of the tasks.</span></span> <span data-ttu-id="88be9-409">Esto podría significar el uso de una opción de proceso menos costosa si las tareas no requieren las mismas funcionalidades de procesamiento que las de la interfaz de usuario, o una instancia mayor si requieren recursos y funcionalidades adicionales.</span><span class="sxs-lookup"><span data-stu-id="88be9-409">This might mean using a less expensive compute option if the tasks do not require the same processing capabilities as the UI, or a larger instance if they require additional capacity and resources.</span></span>
* <span data-ttu-id="88be9-410">**Manejabilidad**: las tareas en segundo plano podrían tener un ritmo de desarrollo e implementación diferente del código de aplicación principal o la interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="88be9-410">**Manageability**: Background tasks might have a different development and deployment rhythm from the main application code or the UI.</span></span> <span data-ttu-id="88be9-411">Su implementación en una instancia de proceso independiente puede simplificar las actualizaciones y el control de versiones.</span><span class="sxs-lookup"><span data-stu-id="88be9-411">Deploying them to a separate compute instance can simplify updates and versioning.</span></span>
* <span data-ttu-id="88be9-412">**Costo**: la adición de instancias de proceso para ejecutar tareas en segundo plano aumenta los costos de hospedaje.</span><span class="sxs-lookup"><span data-stu-id="88be9-412">**Cost**: Adding compute instances to execute background tasks increases hosting costs.</span></span> <span data-ttu-id="88be9-413">Debe considerar detenidamente el equilibrio entre la capacidad adicional y estos costos adicionales.</span><span class="sxs-lookup"><span data-stu-id="88be9-413">You should carefully consider the trade-off between additional capacity and these extra costs.</span></span>

<span data-ttu-id="88be9-414">Para más información, consulte [Leader Election Pattern](../patterns/leader-election.md) (Patrón de elección de líder) y [Competing Consumers Pattern](../patterns/competing-consumers.md) (Patrón de consumidores en competencia).</span><span class="sxs-lookup"><span data-stu-id="88be9-414">For more information, see [Leader Election Pattern](../patterns/leader-election.md) and [Competing Consumers Pattern](../patterns/competing-consumers.md).</span></span>

## <a name="conflicts"></a><span data-ttu-id="88be9-415">Conflictos</span><span class="sxs-lookup"><span data-stu-id="88be9-415">Conflicts</span></span>
<span data-ttu-id="88be9-416">Si tiene varias instancias de un trabajo en segundo plano, es posible que compitan entre sí para tener acceso a los recursos y servicios, como las bases de datos y el almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="88be9-416">If you have multiple instances of a background job, it is possible that they will compete for access to resources and services, such as databases and storage.</span></span> <span data-ttu-id="88be9-417">Este acceso simultáneo puede producir contención de recursos, que podría causar conflictos en la disponibilidad de los servicios y en la integridad de los datos en el almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="88be9-417">This concurrent access can result in resource contention, which might cause conflicts in availability of the services and in the integrity of data in storage.</span></span> <span data-ttu-id="88be9-418">Puede resolver la contención de recursos usando un modo de bloqueo pesimista.</span><span class="sxs-lookup"><span data-stu-id="88be9-418">You can resolve resource contention by using a pessimistic locking approach.</span></span> <span data-ttu-id="88be9-419">Esto evita que las instancias de una tarea compitan por el acceso a un servicio o a la corrupción de datos de manera simultánea.</span><span class="sxs-lookup"><span data-stu-id="88be9-419">This prevents competing instances of a task from concurrently accessing a service or corrupting data.</span></span>

<span data-ttu-id="88be9-420">Otro método para resolver conflictos es definir tareas en segundo plano como un singleton, de modo que solo habrá una instancia en ejecución a la vez.</span><span class="sxs-lookup"><span data-stu-id="88be9-420">Another approach to resolve conflicts is to define background tasks as a singleton, so that there is only ever one instance running.</span></span> <span data-ttu-id="88be9-421">Sin embargo, esto elimina las ventajas de confiabilidad y rendimiento que puede proporcionar una configuración de varias instancias.</span><span class="sxs-lookup"><span data-stu-id="88be9-421">However, this eliminates the reliability and performance benefits that a multiple-instance configuration can provide.</span></span> <span data-ttu-id="88be9-422">Esto sucede especialmente si la interfaz de usuario puede proporcionar suficiente trabajo para mantener ocupada más de una tarea en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-422">This is especially true if the UI can supply sufficient work to keep more than one background task busy.</span></span>

<span data-ttu-id="88be9-423">Es fundamental asegurarse de que la tarea en segundo plano pueda reiniciarse automáticamente y que tenga suficiente capacidad como para hacer frente a los picos de demanda.</span><span class="sxs-lookup"><span data-stu-id="88be9-423">It is vital to ensure that the background task can automatically restart and that it has sufficient capacity to cope with peaks in demand.</span></span> <span data-ttu-id="88be9-424">Puede lograrlo mediante la asignación de una instancia de proceso con suficientes recursos, la implementación de un mecanismo de puesta en cola que pueda almacenar las solicitudes de ejecución posterior cuando disminuya la demanda, o usando una combinación de estas técnicas.</span><span class="sxs-lookup"><span data-stu-id="88be9-424">You can achieve this by allocating a compute instance with sufficient resources, by implementing a queueing mechanism that can store requests for later execution when demand decreases, or by using a combination of these techniques.</span></span>

## <a name="coordination"></a><span data-ttu-id="88be9-425">Coordinación</span><span class="sxs-lookup"><span data-stu-id="88be9-425">Coordination</span></span>
<span data-ttu-id="88be9-426">Las tareas en segundo plano podrían ser complejas y podrían requerir la ejecución de varias tareas individuales para generar un resultado o satisfacer todos los requisitos.</span><span class="sxs-lookup"><span data-stu-id="88be9-426">The background tasks might be complex and might require multiple individual tasks to execute to produce a result or to fulfil all the requirements.</span></span> <span data-ttu-id="88be9-427">Es habitual en estos escenarios dividir la tarea en pasos o subtareas discretos más pequeños que varios consumidores pueden ejecutar.</span><span class="sxs-lookup"><span data-stu-id="88be9-427">It is common in these scenarios to divide the task into smaller discreet steps or subtasks that can be executed by multiple consumers.</span></span> <span data-ttu-id="88be9-428">Los trabajos de varios pasos pueden ser más eficaces y más flexibles porque los pasos individuales podrían volver a usarse en varios trabajos.</span><span class="sxs-lookup"><span data-stu-id="88be9-428">Multistep jobs can be more efficient and more flexible because individual steps might be reusable in multiple jobs.</span></span> <span data-ttu-id="88be9-429">También facilitan la adición, eliminación o modificación del orden de los pasos.</span><span class="sxs-lookup"><span data-stu-id="88be9-429">It is also easy to add, remove, or modify the order of the steps.</span></span>

<span data-ttu-id="88be9-430">La coordinación de varias tareas y pasos puede suponer un reto, pero hay tres patrones comunes que puede usar y que le guiarán por el proceso de implementación de una solución:</span><span class="sxs-lookup"><span data-stu-id="88be9-430">Coordinating multiple tasks and steps can be challenging, but there are three common patterns that you can use to guide your implementation of a solution:</span></span>

* <span data-ttu-id="88be9-431">**Descomponer una tarea en varios pasos reutilizables**.</span><span class="sxs-lookup"><span data-stu-id="88be9-431">**Decomposing a task into multiple reusable steps**.</span></span> <span data-ttu-id="88be9-432">Es posible que una aplicación tenga que realizar diversas tareas de complejidad variable en la información que procesa.</span><span class="sxs-lookup"><span data-stu-id="88be9-432">An application might be required to perform a variety of tasks of varying complexity on the information that it processes.</span></span> <span data-ttu-id="88be9-433">Un método sencillo pero inflexible para implementar esta aplicación podría ser realizar este procesamiento como un módulo monolítico.</span><span class="sxs-lookup"><span data-stu-id="88be9-433">A straightforward but inflexible approach to implementing this application might be to perform this processing as a monolithic module.</span></span> <span data-ttu-id="88be9-434">Sin embargo, este método probablemente reducirá las posibilidades de refactorización del código, su optimización o su reutilización si partes del mismo procesamiento se necesitan en otro lugar dentro de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="88be9-434">However, this approach is likely to reduce the opportunities for refactoring the code, optimizing it, or reusing it if parts of the same processing are required elsewhere within the application.</span></span> <span data-ttu-id="88be9-435">Para más información, consulte el artículo sobre el [patrón de canalizaciones y filtros](../patterns/pipes-and-filters.md).</span><span class="sxs-lookup"><span data-stu-id="88be9-435">For more information, see [Pipes and Filters Pattern](../patterns/pipes-and-filters.md).</span></span>
* <span data-ttu-id="88be9-436">**Administrar la ejecución de los pasos de una tarea**.</span><span class="sxs-lookup"><span data-stu-id="88be9-436">**Managing execution of the steps for a task**.</span></span> <span data-ttu-id="88be9-437">Una aplicación podría realizar tareas que forman una serie de pasos (algunos de los cuales podrían invocar servicios remotos o acceder a recursos remotos).</span><span class="sxs-lookup"><span data-stu-id="88be9-437">An application might perform tasks that comprise a number of steps (some of which might invoke remote services or access remote resources).</span></span> <span data-ttu-id="88be9-438">Los pasos individuales podrían ser independientes entre sí, pero están organizados por la lógica de la aplicación que implementa la tarea.</span><span class="sxs-lookup"><span data-stu-id="88be9-438">The individual steps might be independent of each other, but they are orchestrated by the application logic that implements the task.</span></span> <span data-ttu-id="88be9-439">Para más información, consulte el artículo sobre el [patrón de supervisor del agente de Scheduler](../patterns/scheduler-agent-supervisor.md).</span><span class="sxs-lookup"><span data-stu-id="88be9-439">For more information, see [Scheduler Agent Supervisor Pattern](../patterns/scheduler-agent-supervisor.md).</span></span>
* <span data-ttu-id="88be9-440">**Administrar la recuperación de los pasos de una tarea con error**.</span><span class="sxs-lookup"><span data-stu-id="88be9-440">**Managing recovery for task steps that fail**.</span></span> <span data-ttu-id="88be9-441">Una aplicación podría necesitar deshacer el trabajo que se realiza por una serie de pasos (que conjuntamente definen una operación coherente) si uno o varios de los pasos termina en error.</span><span class="sxs-lookup"><span data-stu-id="88be9-441">An application might need to undo the work that is performed by a series of steps (which together define an eventually consistent operation) if one or more of the steps fail.</span></span> <span data-ttu-id="88be9-442">Para más información, consulte el artículo sobre el [patrón de transacción de compensación](../patterns/compensating-transaction.md).</span><span class="sxs-lookup"><span data-stu-id="88be9-442">For more information, see [Compensating Transaction Pattern](../patterns/compensating-transaction.md).</span></span>


## <a name="resiliency-considerations"></a><span data-ttu-id="88be9-443">Consideraciones de resistencia</span><span class="sxs-lookup"><span data-stu-id="88be9-443">Resiliency considerations</span></span>
<span data-ttu-id="88be9-444">Las tareas en segundo plano deben ser resistentes para proporcionar servicios confiables a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="88be9-444">Background tasks must be resilient in order to provide reliable services to the application.</span></span> <span data-ttu-id="88be9-445">Cuando esté planeando y diseñando tareas en segundo plano, tenga en cuenta los siguientes puntos:</span><span class="sxs-lookup"><span data-stu-id="88be9-445">When you are planning and designing background tasks, consider the following points:</span></span>

* <span data-ttu-id="88be9-446">Las tareas en segundo plano deben poder controlar correctamente los reinicios de rol o servicio sin dañar los datos ni introducir incoherencias en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="88be9-446">Background tasks must be able to gracefully handle role or service restarts without corrupting data or introducing inconsistency into the application.</span></span> <span data-ttu-id="88be9-447">Para las tareas de ejecución prolongada o con varios pasos, considere el uso de *puntos de comprobación* guardando el estado de los trabajos en el almacenamiento persistente o como mensajes en una cola, si fuera apropiado.</span><span class="sxs-lookup"><span data-stu-id="88be9-447">For long-running or multistep tasks, consider using *check pointing* by saving the state of jobs in persistent storage, or as messages in a queue if this is appropriate.</span></span> <span data-ttu-id="88be9-448">Por ejemplo, puede conservar la información de estado de un mensaje en una cola y actualizar esta información de estado en incrementos con el progreso de la tarea para que esta se pueda procesar desde el último punto de comprobación correcto conocido, en lugar de reiniciar desde el principio.</span><span class="sxs-lookup"><span data-stu-id="88be9-448">For example, you can persist state information in a message in a queue and incrementally update this state information with the task progress so that the task can be processed from the last known good checkpoint--instead of restarting from the beginning.</span></span> <span data-ttu-id="88be9-449">Al usar las colas de Azure Service Bus, puede usar sesiones de mensajes para habilitar el mismo escenario.</span><span class="sxs-lookup"><span data-stu-id="88be9-449">When using Azure Service Bus queues, you can use message sessions to enable the same scenario.</span></span> <span data-ttu-id="88be9-450">Las sesiones le permiten guardar y recuperar el estado de procesamiento de la aplicación mediante los métodos [SetState](https://docs.microsoft.com/dotnet/api/microsoft.servicebus.messaging.messagesession.setstate?view=azureservicebus-4.0.0) y [GetState](https://docs.microsoft.com/dotnet/api/microsoft.servicebus.messaging.messagesession.getstate?view=azureservicebus-4.0.0).</span><span class="sxs-lookup"><span data-stu-id="88be9-450">Sessions allow you to save and retrieve the application processing state by using the [SetState](https://docs.microsoft.com/dotnet/api/microsoft.servicebus.messaging.messagesession.setstate?view=azureservicebus-4.0.0) and [GetState](https://docs.microsoft.com/dotnet/api/microsoft.servicebus.messaging.messagesession.getstate?view=azureservicebus-4.0.0) methods.</span></span> <span data-ttu-id="88be9-451">Para más información sobre el diseño de procesos y flujos de trabajo confiables de varios pasos, consulte [Scheduler Agent Supervisor Pattern](../patterns/scheduler-agent-supervisor.md)(Patrón de supervisor de agente de programador).</span><span class="sxs-lookup"><span data-stu-id="88be9-451">For more information about designing reliable multistep processes and workflows, see [Scheduler Agent Supervisor Pattern](../patterns/scheduler-agent-supervisor.md).</span></span>
* <span data-ttu-id="88be9-452">Cuando se usan roles web o de trabajo para hospedar varias tareas en segundo plano, diseñe la invalidación del método **Run** para supervisar las tareas detenidas o con errores y reiniciarlas.</span><span class="sxs-lookup"><span data-stu-id="88be9-452">When you use web or worker roles to host multiple background tasks, design your override of the **Run** method to monitor for failed or stalled tasks, and restart them.</span></span> <span data-ttu-id="88be9-453">Cuando esto no sea práctico, y usa un rol de trabajado, obligue el reinicio del rol de trabajo mediante la salida del método **Run** .</span><span class="sxs-lookup"><span data-stu-id="88be9-453">Where this is not practical, and you are using a worker role, force the worker role to restart by exiting from the **Run** method.</span></span>
* <span data-ttu-id="88be9-454">Cuando use las colas para comunicarse con las tareas en segundo plano, las colas pueden actuar como un búfer para almacenar las solicitudes que se envían a las tareas cuando la aplicación se encuentra con una mayor carga que la habitual.</span><span class="sxs-lookup"><span data-stu-id="88be9-454">When you use queues to communicate with background tasks, the queues can act as a buffer to store requests that are sent to the tasks while the application is under higher than usual load.</span></span> <span data-ttu-id="88be9-455">Esto permite que las tareas se pongan al día con la interfaz de usuario durante los períodos de menor actividad.</span><span class="sxs-lookup"><span data-stu-id="88be9-455">This allows the tasks to catch up with the UI during less busy periods.</span></span> <span data-ttu-id="88be9-456">También significa que el reciclaje del rol no bloqueará la interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="88be9-456">It also means that recycling the role will not block the UI.</span></span> <span data-ttu-id="88be9-457">Para más información, consulte [Patrón de equilibrio de carga basado en colas](../patterns/queue-based-load-leveling.md).</span><span class="sxs-lookup"><span data-stu-id="88be9-457">For more information, see [Queue-Based Load Leveling Pattern](../patterns/queue-based-load-leveling.md).</span></span> <span data-ttu-id="88be9-458">Si algunas tareas son más importantes que otras, considere la posibilidad de implementar el [patrón de cola de prioridad](../patterns/priority-queue.md) para asegurarse de que estas tareas se ejecuten antes que las tareas menos importantes.</span><span class="sxs-lookup"><span data-stu-id="88be9-458">If some tasks are more important than others, consider implementing the [Priority Queue Pattern](../patterns/priority-queue.md) to ensure that these tasks run before less important ones.</span></span>
* <span data-ttu-id="88be9-459">Las tareas en segundo plano que procesan los mensajes, o que estos inician, se deben diseñar para controlar las incoherencias, como los mensajes que llegan sin orden, los mensajes que generan un error de forma repetida (con frecuencia denominados *mensajes dudosos*) y los mensajes que se entregan más de una vez.</span><span class="sxs-lookup"><span data-stu-id="88be9-459">Background tasks that are initiated by messages or process messages must be designed to handle inconsistencies, such as messages arriving out of order, messages that repeatedly cause an error (often referred to as *poison messages*), and messages that are delivered more than once.</span></span> <span data-ttu-id="88be9-460">Tenga en cuenta lo siguiente.</span><span class="sxs-lookup"><span data-stu-id="88be9-460">Consider the following:</span></span>
  * <span data-ttu-id="88be9-461">Los mensajes que se deben procesar en un orden específico, tales como los que cambian los datos según su valor de datos existente (por ejemplo, al agregar un valor a un valor existente), podrían no llegar en el orden original en el que se enviaron.</span><span class="sxs-lookup"><span data-stu-id="88be9-461">Messages that must be processed in a specific order, such as those that change data based on the existing data value (for example, adding a value to an existing value), might not arrive in the original order in which they were sent.</span></span> <span data-ttu-id="88be9-462">Como alternativa, los podrían controlar instancias diferentes de una tarea en segundo plano en un orden diferente debido a cargas variables en cada instancia.</span><span class="sxs-lookup"><span data-stu-id="88be9-462">Alternatively, they might be handled by different instances of a background task in a different order due to varying loads on each instance.</span></span> <span data-ttu-id="88be9-463">Los mensajes que se deben procesar en un orden específico deben incluir un número de secuencia, clave o algún otro indicador que las tareas en segundo plano pueden usar para garantizar que se procesan en el orden correcto.</span><span class="sxs-lookup"><span data-stu-id="88be9-463">Messages that must be processed in a specific order should include a sequence number, key, or some other indicator that background tasks can use to ensure that they are processed in the correct order.</span></span> <span data-ttu-id="88be9-464">Si usa Azure Service Bus, puede usar sesiones de mensajes para garantizar el orden de entrega.</span><span class="sxs-lookup"><span data-stu-id="88be9-464">If you are using Azure Service Bus, you can use message sessions to guarantee the order of delivery.</span></span> <span data-ttu-id="88be9-465">Sin embargo, suele ser más eficaz cuando sea posible diseñar el proceso de modo que el orden de los mensajes no sea importante.</span><span class="sxs-lookup"><span data-stu-id="88be9-465">However, it is usually more efficient, where possible, to design the process so that the message order is not important.</span></span>
  * <span data-ttu-id="88be9-466">Normalmente, una tarea en segundo plano inspeccionará los mensajes de la cola, que los oculta temporalmente de los demás consumidores de mensajes.</span><span class="sxs-lookup"><span data-stu-id="88be9-466">Typically, a background task will peek at messages in the queue, which temporarily hides them from other message consumers.</span></span> <span data-ttu-id="88be9-467">A continuación, elimina los mensajes una vez que se hayan procesado correctamente.</span><span class="sxs-lookup"><span data-stu-id="88be9-467">Then it deletes the messages after they have been successfully processed.</span></span> <span data-ttu-id="88be9-468">Si se produce un error en una tarea en segundo plano al procesar un mensaje, ese mensaje volverá a aparecer en la cola después de que expire el tiempo de espera de la inspección.</span><span class="sxs-lookup"><span data-stu-id="88be9-468">If a background task fails when processing a message, that message will reappear on the queue after the peek time-out expires.</span></span> <span data-ttu-id="88be9-469">Se procesará por otra instancia de la tarea o durante el próximo ciclo de procesamiento de esta instancia.</span><span class="sxs-lookup"><span data-stu-id="88be9-469">It will be processed by another instance of the task or during the next processing cycle of this instance.</span></span> <span data-ttu-id="88be9-470">Si el mensaje produce un error sistemáticamente en el consumidor, bloqueará la tarea, la cola y, en última instancia, la aplicación en sí cuando se llene la cola.</span><span class="sxs-lookup"><span data-stu-id="88be9-470">If the message consistently causes an error in the consumer, it will block the task, the queue, and eventually the application itself when the queue becomes full.</span></span> <span data-ttu-id="88be9-471">Por lo tanto, es fundamental detectar y quitar los mensajes dudosos de la cola.</span><span class="sxs-lookup"><span data-stu-id="88be9-471">Therefore, it is vital to detect and remove poison messages from the queue.</span></span> <span data-ttu-id="88be9-472">Usa Azure Service Bus, los mensajes que produzcan un error se pueden mover automática o manualmente a una cola de mensajes fallidos asociada.</span><span class="sxs-lookup"><span data-stu-id="88be9-472">If you are using Azure Service Bus, messages that cause an error can be moved automatically or manually to an associated dead letter queue.</span></span>
  * <span data-ttu-id="88be9-473">Las colas son mecanismos de *al menos una* entrega garantizada, pero podrían entregar el mismo mensaje más de una vez.</span><span class="sxs-lookup"><span data-stu-id="88be9-473">Queues are guaranteed at *least once* delivery mechanisms, but they might deliver the same message more than once.</span></span> <span data-ttu-id="88be9-474">Además, si se produce un error en una tarea en segundo plano después de procesar un mensaje pero antes de su eliminación de la cola, el mensaje estará disponible para nuevo procesamiento.</span><span class="sxs-lookup"><span data-stu-id="88be9-474">In addition, if a background task fails after processing a message but before deleting it from the queue, the message will become available for processing again.</span></span> <span data-ttu-id="88be9-475">Las tareas en segundo plano deben ser idempotentes, lo que significa que el procesamiento del mismo mensaje varias veces no produce un error o incoherencia en los datos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="88be9-475">Background tasks should be idempotent, which means that processing the same message more than once does not cause an error or inconsistency in the application’s data.</span></span> <span data-ttu-id="88be9-476">Algunas operaciones son naturalmente idempotentes, tal como establecer un valor almacenado en un nuevo valor específico.</span><span class="sxs-lookup"><span data-stu-id="88be9-476">Some operations are naturally idempotent, such as setting a stored value to a specific new value.</span></span> <span data-ttu-id="88be9-477">Sin embargo, las operaciones como, por ejemplo, agregar un valor a un valor almacenado existente sin comprobar que el valor almacenado sigue siendo el mismo que cuando se envió originalmente el mensaje, provocarán incoherencias.</span><span class="sxs-lookup"><span data-stu-id="88be9-477">However, operations such as adding a value to an existing stored value without checking that the stored value is still the same as when the message was originally sent will cause inconsistencies.</span></span> <span data-ttu-id="88be9-478">Las colas de Azure Service Bus pueden configurarse para quitar automáticamente los mensajes duplicados.</span><span class="sxs-lookup"><span data-stu-id="88be9-478">Azure Service Bus queues can be configured to automatically remove duplicated messages.</span></span>
  * <span data-ttu-id="88be9-479">Algunos sistemas de mensajería, como las colas de Azure Storage y las colas de Azure Service Bus, admiten una propiedad de recuento de eliminación de la cola que indica el número de veces que se ha leído un mensaje de la cola.</span><span class="sxs-lookup"><span data-stu-id="88be9-479">Some messaging systems, such as Azure storage queues and Azure Service Bus queues, support a de-queue count property that indicates the number of times a message has been read from the queue.</span></span> <span data-ttu-id="88be9-480">Esto puede ser de utilidad en el tratamiento de mensajes dudosos y repetidos.</span><span class="sxs-lookup"><span data-stu-id="88be9-480">This can be useful in handling repeated and poison messages.</span></span> <span data-ttu-id="88be9-481">Para más información, consulte los artículos sobre el [manual de mensajería asincrónica](https://msdn.microsoft.com/library/dn589781.aspx) y [patrones de idempotencia](https://blog.jonathanoliver.com/idempotency-patterns/).</span><span class="sxs-lookup"><span data-stu-id="88be9-481">For more information, see [Asynchronous Messaging Primer](https://msdn.microsoft.com/library/dn589781.aspx) and [Idempotency Patterns](https://blog.jonathanoliver.com/idempotency-patterns/).</span></span>

## <a name="scaling-and-performance-considerations"></a><span data-ttu-id="88be9-482">Consideraciones de escalado y rendimiento</span><span class="sxs-lookup"><span data-stu-id="88be9-482">Scaling and performance considerations</span></span>
<span data-ttu-id="88be9-483">Las tareas en segundo plano deben ofrecer un rendimiento suficiente como para asegurarse de que no bloqueen la aplicación ni provoquen incoherencias debido al funcionamiento diferido cuando el sistema está bajo carga.</span><span class="sxs-lookup"><span data-stu-id="88be9-483">Background tasks must offer sufficient performance to ensure they do not block the application, or cause inconsistencies due to delayed operation when the system is under load.</span></span> <span data-ttu-id="88be9-484">Normalmente, el rendimiento se mejora al escalar las instancias de proceso que hospedan las tareas en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-484">Typically, performance is improved by scaling the compute instances that host the background tasks.</span></span> <span data-ttu-id="88be9-485">Cuando esté planeando y diseñando tareas en segundo plano, tenga en cuenta los siguientes puntos en relación con la escalabilidad y el rendimiento:</span><span class="sxs-lookup"><span data-stu-id="88be9-485">When you are planning and designing background tasks, consider the following points around scalability and performance:</span></span>

* <span data-ttu-id="88be9-486">Azure admite el escalado automático (escalar horizontalmente y reducir horizontalmente) en función de la demanda y carga actuales o según una programación predefinida, para roles web y de trabajo de Web Apps, Cloud Services e implementaciones hospedadas de máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="88be9-486">Azure supports autoscaling (both scaling out and scaling back in) based on current demand and load--or on a predefined schedule, for Web Apps, Cloud Services web and worker roles, and Virtual Machines hosted deployments.</span></span> <span data-ttu-id="88be9-487">Use esta característica para garantizar que la aplicación en su conjunto tiene funcionalidades de rendimiento suficientes a la vez que se minimizan los costos de tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="88be9-487">Use this feature to ensure that the application as a whole has sufficient performance capabilities while minimizing runtime costs.</span></span>
* <span data-ttu-id="88be9-488">En las tareas en segundo plano con una capacidad de rendimiento diferente de las demás partes de una aplicación de Cloud Services (por ejemplo, la interfaz de usuario o los componentes, como la capa de acceso a datos), el hospedaje de las tareas en segundo plano en un rol de trabajo independiente permite que los roles de la interfaz de usuario y de tarea en segundo plano se escalen independientemente para administrar la carga.</span><span class="sxs-lookup"><span data-stu-id="88be9-488">Where background tasks have a different performance capability from the other parts of a Cloud Services application (for example, the UI or components such as the data access layer), hosting the background tasks together in a separate worker role allows the UI and background task roles to scale independently to manage the load.</span></span> <span data-ttu-id="88be9-489">Si varias tareas en segundo plano tienen funcionalidades de rendimiento muy diferentes entre sí, considere la posibilidad de dividirlas en roles de trabajo independientes y escalar cada tipo de rol de forma independiente.</span><span class="sxs-lookup"><span data-stu-id="88be9-489">If multiple background tasks have significantly different performance capabilities from each other, consider dividing them into separate worker roles and scaling each role type independently.</span></span> <span data-ttu-id="88be9-490">Sin embargo, tenga en cuenta que esto puede aumentar los costos de tiempo de ejecución en comparación con la combinación de todas las tareas en menos roles.</span><span class="sxs-lookup"><span data-stu-id="88be9-490">However, note that this might increase runtime costs compared to combining all the tasks into fewer roles.</span></span>
* <span data-ttu-id="88be9-491">Es posible que el simple escalado de los roles no sea suficiente para impedir la pérdida de rendimiento bajo carga.</span><span class="sxs-lookup"><span data-stu-id="88be9-491">Simply scaling the roles might not be sufficient to prevent loss of performance under load.</span></span> <span data-ttu-id="88be9-492">También es posible que necesite escalar las colas de almacenamiento y otros recursos para impedir que un único punto de la cadena de procesamiento general se convierta en un cuello de botella.</span><span class="sxs-lookup"><span data-stu-id="88be9-492">You might also need to scale storage queues and other resources to prevent a single point of the overall processing chain from becoming a bottleneck.</span></span> <span data-ttu-id="88be9-493">Asimismo, considere otras limitaciones, como por ejemplo, el rendimiento máximo de almacenamiento y otros servicios de los que dependen la aplicación y las tareas en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="88be9-493">Also, consider other limitations, such as the maximum throughput of storage and other services that the application and the background tasks rely on.</span></span>
* <span data-ttu-id="88be9-494">Las tareas en segundo plano deben diseñarse para el escalado.</span><span class="sxs-lookup"><span data-stu-id="88be9-494">Background tasks must be designed for scaling.</span></span> <span data-ttu-id="88be9-495">Por ejemplo, debe poder detectar dinámicamente el número de colas de almacenamiento en uso para escuchar en la cola adecuada o enviar mensajes a ella.</span><span class="sxs-lookup"><span data-stu-id="88be9-495">For example, they must be able to dynamically detect the number of storage queues in use in order to listen on or send messages to the appropriate queue.</span></span>
* <span data-ttu-id="88be9-496">De manera predeterminada, los trabajos web se escalan con su instancia asociada de Azure Web Apps.</span><span class="sxs-lookup"><span data-stu-id="88be9-496">By default, WebJobs scale with their associated Azure Web Apps instance.</span></span> <span data-ttu-id="88be9-497">Sin embargo, si quiere que un trabajo web se ejecute solo como una única instancia, puede crear un archivo Settings.job que contenga los datos JSON **{ "is_singleton": true }**.</span><span class="sxs-lookup"><span data-stu-id="88be9-497">However, if you want a WebJob to run as only a single instance, you can create a Settings.job file that contains the JSON data **{ "is_singleton": true }**.</span></span> <span data-ttu-id="88be9-498">Esto obliga a Azure a ejecutar solo una instancia del WebJob, incluso si hay varias instancias de la aplicación web asociada.</span><span class="sxs-lookup"><span data-stu-id="88be9-498">This forces Azure to only run one instance of the WebJob, even if there are multiple instances of the associated web app.</span></span> <span data-ttu-id="88be9-499">Esto puede ser una técnica útil para los trabajos programados que deben ejecutarse como una única instancia.</span><span class="sxs-lookup"><span data-stu-id="88be9-499">This can be a useful technique for scheduled jobs that must run as only a single instance.</span></span>

## <a name="related-patterns"></a><span data-ttu-id="88be9-500">Patrones relacionados</span><span class="sxs-lookup"><span data-stu-id="88be9-500">Related patterns</span></span>
* [<span data-ttu-id="88be9-501">Manual de mensajería asincrónica</span><span class="sxs-lookup"><span data-stu-id="88be9-501">Asynchronous Messaging Primer</span></span>](https://msdn.microsoft.com/library/dn589781.aspx)
* [<span data-ttu-id="88be9-502">Instrucciones de escalado automático</span><span class="sxs-lookup"><span data-stu-id="88be9-502">Autoscaling Guidance</span></span>](https://msdn.microsoft.com/library/dn589774.aspx)
* [<span data-ttu-id="88be9-503">Patrón de transacción de compensación</span><span class="sxs-lookup"><span data-stu-id="88be9-503">Compensating Transaction Pattern</span></span>](../patterns/compensating-transaction.md)
* [<span data-ttu-id="88be9-504">Patrón de consumidores de la competencia</span><span class="sxs-lookup"><span data-stu-id="88be9-504">Competing Consumers Pattern</span></span>](../patterns/competing-consumers.md)
* [<span data-ttu-id="88be9-505">Orientación sobre la creación de particiones de proceso</span><span class="sxs-lookup"><span data-stu-id="88be9-505">Compute Partitioning Guidance</span></span>](https://msdn.microsoft.com/library/dn589773.aspx)
* [<span data-ttu-id="88be9-506">Patrón de consolidación de recursos de proceso</span><span class="sxs-lookup"><span data-stu-id="88be9-506">Compute Resource Consolidation Pattern</span></span>](https://msdn.microsoft.com/library/dn589778.aspx)
* [<span data-ttu-id="88be9-507">Patrón de Gatekeeper</span><span class="sxs-lookup"><span data-stu-id="88be9-507">Gatekeeper Pattern</span></span>](../patterns/gatekeeper.md)
* [<span data-ttu-id="88be9-508">Patrón de elección de líder</span><span class="sxs-lookup"><span data-stu-id="88be9-508">Leader Election Pattern</span></span>](../patterns/leader-election.md)
* [<span data-ttu-id="88be9-509">Patrón de canalizaciones y filtros</span><span class="sxs-lookup"><span data-stu-id="88be9-509">Pipes and Filters Pattern</span></span>](../patterns/pipes-and-filters.md)
* [<span data-ttu-id="88be9-510">Patrón de cola de prioridad</span><span class="sxs-lookup"><span data-stu-id="88be9-510">Priority Queue Pattern</span></span>](../patterns/priority-queue.md)
* [<span data-ttu-id="88be9-511">Patrón de equilibrio de carga basado en colas</span><span class="sxs-lookup"><span data-stu-id="88be9-511">Queue-based Load Leveling Pattern</span></span>](../patterns/queue-based-load-leveling.md)
* [<span data-ttu-id="88be9-512">Patrón de supervisor de agente de programador</span><span class="sxs-lookup"><span data-stu-id="88be9-512">Scheduler Agent Supervisor Pattern</span></span>](../patterns/scheduler-agent-supervisor.md)

## <a name="more-information"></a><span data-ttu-id="88be9-513">Más información</span><span class="sxs-lookup"><span data-stu-id="88be9-513">More information</span></span>
* [<span data-ttu-id="88be9-514">Ejecutar tareas en segundo plano</span><span class="sxs-lookup"><span data-stu-id="88be9-514">Executing Background Tasks</span></span>](https://msdn.microsoft.com/library/ff803365.aspx)
* <span data-ttu-id="88be9-515">[Ciclo de vida del rol de Azure Cloud Services](https://channel9.msdn.com/Series/Windows-Azure-Cloud-Services-Tutorials/Windows-Azure-Cloud-Services-Role-Lifecycle) (vídeo)</span><span class="sxs-lookup"><span data-stu-id="88be9-515">[Azure Cloud Services Role Lifecycle](https://channel9.msdn.com/Series/Windows-Azure-Cloud-Services-Tutorials/Windows-Azure-Cloud-Services-Role-Lifecycle) (video)</span></span>
* [<span data-ttu-id="88be9-516">Qué es el SDK de Azure WebJobs</span><span class="sxs-lookup"><span data-stu-id="88be9-516">What is the Azure WebJobs SDK</span></span>](https://docs.microsoft.com/azure/app-service-web/websites-dotnet-webjobs-sdk)
* [<span data-ttu-id="88be9-517">Ejecución de tareas en segundo plano con WebJobs</span><span class="sxs-lookup"><span data-stu-id="88be9-517">Run Background tasks with WebJobs</span></span>](https://docs.microsoft.com/azure/app-service-web/web-sites-create-web-jobs)
* [<span data-ttu-id="88be9-518">Colas de Azure y colas de Service Bus: comparación y diferencias</span><span class="sxs-lookup"><span data-stu-id="88be9-518">Azure Queues and Service Bus Queues - Compared and Contrasted</span></span>](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted)
* [<span data-ttu-id="88be9-519">Cómo habilitar diagnósticos en un servicio en la nube</span><span class="sxs-lookup"><span data-stu-id="88be9-519">How to Enable Diagnostics in a Cloud Service</span></span>](https://docs.microsoft.com/azure/cloud-services/cloud-services-dotnet-diagnostics)

