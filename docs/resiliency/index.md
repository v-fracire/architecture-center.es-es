---
title: Diseño de aplicaciones resistentes de Azure
description: Cómo crear aplicaciones resistentes de Azure, para alta disponibilidad y recuperación ante desastres.
author: MikeWasson
ms.date: 05/26/2017
ms.custom: resiliency
ms.openlocfilehash: 55e54347953dc9967ab8ccf67490757e1d58e143
ms.sourcegitcommit: b2a4eb132857afa70201e28d662f18458865a48e
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/05/2018
ms.locfileid: "48819217"
---
# <a name="designing-resilient-applications-for-azure"></a><span data-ttu-id="7edbb-103">Diseño de aplicaciones resistentes de Azure</span><span class="sxs-lookup"><span data-stu-id="7edbb-103">Designing resilient applications for Azure</span></span>

<span data-ttu-id="7edbb-104">En un sistema distribuido, se pueden producir errores.</span><span class="sxs-lookup"><span data-stu-id="7edbb-104">In a distributed system, failures will happen.</span></span> <span data-ttu-id="7edbb-105">Pueden producirse errores de hardware.</span><span class="sxs-lookup"><span data-stu-id="7edbb-105">Hardware can fail.</span></span> <span data-ttu-id="7edbb-106">La red puede tener errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="7edbb-106">The network can have transient failures.</span></span> <span data-ttu-id="7edbb-107">En raras ocasiones, todo un servicio o toda una región pueden experimentar interrupciones, pero incluso estas deben planificarse.</span><span class="sxs-lookup"><span data-stu-id="7edbb-107">Rarely, an entire service or region may experience a disruption, but even those must be planned for.</span></span> 

<span data-ttu-id="7edbb-108">Crear una aplicación confiable en la nube es diferente a crear una aplicación confiable en un entorno empresarial.</span><span class="sxs-lookup"><span data-stu-id="7edbb-108">Building a reliable application in the cloud is different than building a reliable application in an enterprise setting.</span></span> <span data-ttu-id="7edbb-109">Si bien históricamente puede haber adquirido hardware de gama superior para escalar verticalmente, en un entorno de nube debe escalar horizontalmente en lugar de verticalmente.</span><span class="sxs-lookup"><span data-stu-id="7edbb-109">While historically you may have purchased higher-end hardware to scale up, in a cloud environment you must scale out instead of scaling up.</span></span> <span data-ttu-id="7edbb-110">Los costos de los entornos de nube se mantienen bajos gracias al uso de hardware básico.</span><span class="sxs-lookup"><span data-stu-id="7edbb-110">Costs for cloud environments are kept low through the use of commodity hardware.</span></span> <span data-ttu-id="7edbb-111">En lugar de centrarse en la prevención de errores y en la optimización del "tiempo medio entre errores", en este nuevo entorno, el enfoque cambia a "tiempo medio para restaurar".</span><span class="sxs-lookup"><span data-stu-id="7edbb-111">Instead of focusing on preventing failures and optimizing "mean time between failures," in this new environment the focus shifts to "mean time to restore."</span></span> <span data-ttu-id="7edbb-112">El objetivo es minimizar el efecto de los errores.</span><span class="sxs-lookup"><span data-stu-id="7edbb-112">The goal is to minimize the effect of a failure.</span></span>

<span data-ttu-id="7edbb-113">En este artículo se introduce a la creación de aplicaciones resistentes en Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="7edbb-113">This article provides an overview of how to build resilient applications in Microsoft Azure.</span></span> <span data-ttu-id="7edbb-114">Se inicia con una definición del término *resistencia* y conceptos relacionados.</span><span class="sxs-lookup"><span data-stu-id="7edbb-114">It starts with a definition of the term *resiliency* and related concepts.</span></span> <span data-ttu-id="7edbb-115">Después se describe un proceso para lograr resistencia, mediante un enfoque estructurado durante la vigencia de una aplicación, desde el diseño y la puesta en marcha hasta la implementación y operaciones.</span><span class="sxs-lookup"><span data-stu-id="7edbb-115">Then it describes a process for achieving resiliency, using a structured approach over the lifetime of an application, from design and implementation to deployment and operations.</span></span>

## <a name="what-is-resiliency"></a><span data-ttu-id="7edbb-116">¿Qué es la resistencia?</span><span class="sxs-lookup"><span data-stu-id="7edbb-116">What is resiliency?</span></span>
<span data-ttu-id="7edbb-117">**Resistencia** es la capacidad de un sistema de recuperarse de los errores y seguir funcionando.</span><span class="sxs-lookup"><span data-stu-id="7edbb-117">**Resiliency** is the ability of a system to recover from failures and continue to function.</span></span> <span data-ttu-id="7edbb-118">No se trata de *evitar* los errores, sino de *responder* a ellos de manera que se evite el tiempo de inactividad o la pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-118">It's not about *avoiding* failures, but *responding* to failures in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="7edbb-119">El objetivo de la resistencia es devolver la aplicación a un estado plenamente operativo después de un error.</span><span class="sxs-lookup"><span data-stu-id="7edbb-119">The goal of resiliency is to return the application to a fully functioning state following a failure.</span></span>

<span data-ttu-id="7edbb-120">Dos aspectos importantes de la resistencia son la alta disponibilidad y la recuperación ante desastres.</span><span class="sxs-lookup"><span data-stu-id="7edbb-120">Two important aspects of resiliency are high availability and disaster recovery.</span></span>

* <span data-ttu-id="7edbb-121">**Alta disponibilidad** (HA) es la capacidad de la aplicación de seguir ejecutándose en un estado correcto, sin tiempo de inactividad relevante.</span><span class="sxs-lookup"><span data-stu-id="7edbb-121">**High availability** (HA) is the ability of the application to continue running in a healthy state, without significant downtime.</span></span> <span data-ttu-id="7edbb-122">Por "estado correcto," queremos decir que la aplicación responde y los usuarios pueden conectarse e interactuar con ella.</span><span class="sxs-lookup"><span data-stu-id="7edbb-122">By "healthy state," we mean the application is responsive, and users can connect to the application and interact with it.</span></span>  
* <span data-ttu-id="7edbb-123">La **recuperación ante desastres** es la capacidad de recuperación de incidentes importantes pero poco frecuentes: errores a gran escala no transitorios, tales como una interrupción del servicio que afecta a toda la región.</span><span class="sxs-lookup"><span data-stu-id="7edbb-123">**Disaster recovery** (DR) is the ability to recover from rare but major incidents: non-transient, wide-scale failures, such as service disruption that affects an entire region.</span></span> <span data-ttu-id="7edbb-124">La recuperación ante desastres incluye la copia de seguridad y el archivado de datos, y puede incluir la intervención manual, como la restauración manual de una base de datos a partir de la copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="7edbb-124">Disaster recovery includes data backup and archiving, and may include manual intervention, such as restoring a database from backup.</span></span>

<span data-ttu-id="7edbb-125">Una manera de pensar en alta disponibilidad frente a la recuperación ante desastres es que esta se inicia cuando el impacto de un error supera la capacidad del diseño de alta disponibilidad de controlarlo.</span><span class="sxs-lookup"><span data-stu-id="7edbb-125">One way to think about HA versus DR is that DR starts when the impact of a fault exceeds the ability of the HA design to handle it.</span></span>  

<span data-ttu-id="7edbb-126">Si va a diseñar la resistencia, debe conocer los requisitos de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="7edbb-126">When you design resiliency, you must understand your availability requirements.</span></span> <span data-ttu-id="7edbb-127">¿Cuánto tiempo de inactividad es aceptable?</span><span class="sxs-lookup"><span data-stu-id="7edbb-127">How much downtime is acceptable?</span></span> <span data-ttu-id="7edbb-128">Depende en parte del costo.</span><span class="sxs-lookup"><span data-stu-id="7edbb-128">This is partly a function of cost.</span></span> <span data-ttu-id="7edbb-129">¿Cuánto le costará el tiempo de inactividad potencial a su negocio?</span><span class="sxs-lookup"><span data-stu-id="7edbb-129">How much will potential downtime cost your business?</span></span> <span data-ttu-id="7edbb-130">¿Cuánto debe invertir para que la aplicación tenga alta disponibilidad?</span><span class="sxs-lookup"><span data-stu-id="7edbb-130">How much should you invest in making the application highly available?</span></span> <span data-ttu-id="7edbb-131">También debe definir lo que significa que la aplicación esté disponible.</span><span class="sxs-lookup"><span data-stu-id="7edbb-131">You also have to define what it means for the application to be available.</span></span> <span data-ttu-id="7edbb-132">Por ejemplo, ¿se considera que la aplicación está "fuera de servicio" si un cliente puede enviar un pedido pero el sistema no puede procesarlo en el período de tiempo normal?</span><span class="sxs-lookup"><span data-stu-id="7edbb-132">For example, is the application "down" if a customer can submit an order but the system cannot process it within the normal timeframe?</span></span> <span data-ttu-id="7edbb-133">También considere la probabilidad de que ocurra un determinado tipo de interrupción y si una estrategia de mitigación es rentable.</span><span class="sxs-lookup"><span data-stu-id="7edbb-133">Also consider the probability of a particular type of outage occurring, and whether a mitigation strategy is cost-effective.</span></span>

<span data-ttu-id="7edbb-134">Otro término común es la **continuidad del negocio**, que consiste en la capacidad de realizar funciones empresariales esenciales durante y después de condiciones adversas, como un desastre natural o un servicio que ha dejado de funcionar.</span><span class="sxs-lookup"><span data-stu-id="7edbb-134">Another common term is **business continuity** (BC), which is the ability to perform essential business functions during and after adverse conditions, such as a natural disaster or a downed service.</span></span> <span data-ttu-id="7edbb-135">La continuidad de negocio cubre toda la operación de la empresa, incluidas las instalaciones físicas, las personas, las comunicaciones, el transporte e IT.</span><span class="sxs-lookup"><span data-stu-id="7edbb-135">BC covers the entire operation of the business, including physical facilities, people, communications, transportation, and IT.</span></span> <span data-ttu-id="7edbb-136">Este artículo se centra en las aplicaciones en la nube, pero el planeamiento de la resistencia debe realizarse en el contexto de los requisitos generales de la continuidad del negocio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-136">This article focuses on cloud applications, but resilience planning must be done in the context of overall BC requirements.</span></span> 

<span data-ttu-id="7edbb-137">Las **copias de seguridad de datos** constituyen una parte fundamental de la recuperación ante desastres.</span><span class="sxs-lookup"><span data-stu-id="7edbb-137">**Data backup** is a critical part of DR.</span></span> <span data-ttu-id="7edbb-138">Si se produce un error en los componentes sin estado de una aplicación, siempre puede implementarlos de nuevo.</span><span class="sxs-lookup"><span data-stu-id="7edbb-138">If the stateless components of an application fail, you can always redeploy them.</span></span> <span data-ttu-id="7edbb-139">Sin embargo, si se pierden los datos, el sistema no podrá volver a un estado estable.</span><span class="sxs-lookup"><span data-stu-id="7edbb-139">But if data is lost, the system can't return to a stable state.</span></span> <span data-ttu-id="7edbb-140">Por tanto, es necesario hacer copias de seguridad, y lo ideal es hacerlo en una región diferente por si se produjera un desastre que afectara a toda una región.</span><span class="sxs-lookup"><span data-stu-id="7edbb-140">Data must be backed up, ideally in a different region in case of a region-wide disaster.</span></span> 

<span data-ttu-id="7edbb-141">Las copias de seguridad no son lo mismo que la **replicación de datos**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-141">Backup is distinct from **data replication**.</span></span> <span data-ttu-id="7edbb-142">La replicación de datos implica copiar datos casi en tiempo real, por lo que el sistema puede conmutar por error a una réplica rápidamente.</span><span class="sxs-lookup"><span data-stu-id="7edbb-142">Data replication involves copying data in near-real-time, so that the system can fail over quickly to a replica.</span></span> <span data-ttu-id="7edbb-143">Muchos sistemas de bases de datos admiten la replicación; por ejemplo, SQL Server es compatible con Grupos de disponibilidad Always On de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="7edbb-143">Many databases systems support replication; for example, SQL Server supports SQL Server Always On Availability Groups.</span></span> <span data-ttu-id="7edbb-144">La replicación de datos puede reducir el tiempo necesario para recuperarse de una interrupción, ya que garantiza que siempre hay una réplica de datos disponible.</span><span class="sxs-lookup"><span data-stu-id="7edbb-144">Data replication can reduce how long it takes to recover from an outage, by ensuring that a replica of the data is always standing by.</span></span> <span data-ttu-id="7edbb-145">Sin embargo, la replicación de datos no sirve de protección frente a los errores humanos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-145">However, data replication won't protect against human error.</span></span> <span data-ttu-id="7edbb-146">Si los datos resultan dañados por un error humano, se copiarán en las réplicas.</span><span class="sxs-lookup"><span data-stu-id="7edbb-146">If data gets corrupted because of human error, the corrupted data just gets copied to the replicas.</span></span> <span data-ttu-id="7edbb-147">Por tanto, necesitará incorporar también las copias de seguridad a largo plazo en la estrategia de recuperación ante desastres.</span><span class="sxs-lookup"><span data-stu-id="7edbb-147">Therefore, you still need to include long-term backup in your DR strategy.</span></span> 

## <a name="process-to-achieve-resiliency"></a><span data-ttu-id="7edbb-148">Proceso para lograr resistencia</span><span class="sxs-lookup"><span data-stu-id="7edbb-148">Process to achieve resiliency</span></span>
<span data-ttu-id="7edbb-149">La resistencia no es un complemento.</span><span class="sxs-lookup"><span data-stu-id="7edbb-149">Resiliency is not an add-on.</span></span> <span data-ttu-id="7edbb-150">Deberá diseñarse en el sistema y aplicarse en la práctica operativa.</span><span class="sxs-lookup"><span data-stu-id="7edbb-150">It must be designed into the system and put into operational practice.</span></span> <span data-ttu-id="7edbb-151">Este es un modelo general para seguir:</span><span class="sxs-lookup"><span data-stu-id="7edbb-151">Here is a general model to follow:</span></span>

1. <span data-ttu-id="7edbb-152">**Defina** sus requisitos de disponibilidad, en función de las necesidades del negocio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-152">**Define** your availability requirements, based on business needs.</span></span>
2. <span data-ttu-id="7edbb-153">**Diseñe** la aplicación para proporcionar resistencia.</span><span class="sxs-lookup"><span data-stu-id="7edbb-153">**Design** the application for resiliency.</span></span> <span data-ttu-id="7edbb-154">Comience con una arquitectura que siga las prácticas comprobadas e identifique los puntos de error posibles en esa arquitectura.</span><span class="sxs-lookup"><span data-stu-id="7edbb-154">Start with an architecture that follows proven practices, and then identify the possible failure points in that architecture.</span></span>
3. <span data-ttu-id="7edbb-155">**Implemente** estrategias para detectar y recuperarse de errores.</span><span class="sxs-lookup"><span data-stu-id="7edbb-155">**Implement** strategies to detect and recover from failures.</span></span> 
4. <span data-ttu-id="7edbb-156">**Pruebe** la implementación simulando errores y desencadene conmutaciones por error forzadas.</span><span class="sxs-lookup"><span data-stu-id="7edbb-156">**Test** the implementation by simulating faults and triggering forced failovers.</span></span> 
5. <span data-ttu-id="7edbb-157">**Implemente** la aplicación en producción mediante un proceso confiable y repetible.</span><span class="sxs-lookup"><span data-stu-id="7edbb-157">**Deploy** the application into production using a reliable, repeatable process.</span></span> 
6. <span data-ttu-id="7edbb-158">**Supervise** la aplicación para detectar errores.</span><span class="sxs-lookup"><span data-stu-id="7edbb-158">**Monitor** the application to detect failures.</span></span> <span data-ttu-id="7edbb-159">Al supervisar el sistema, puede medir el estado de la aplicación y responder a las incidencias en caso necesario.</span><span class="sxs-lookup"><span data-stu-id="7edbb-159">By monitoring the system, you can gauge the health of the application and respond to incidents if necessary.</span></span> 
7. <span data-ttu-id="7edbb-160">**Responda** si existen errores que requieran intervenciones manuales.</span><span class="sxs-lookup"><span data-stu-id="7edbb-160">**Respond** if there are failure that require manual interventions.</span></span>

<span data-ttu-id="7edbb-161">En el resto de este artículo, se describen estos pasos con más detalle.</span><span class="sxs-lookup"><span data-stu-id="7edbb-161">In the remainder of this article, we discuss each of these steps in more detail.</span></span>

## <a name="define-your-availability-requirements"></a><span data-ttu-id="7edbb-162">Definición de sus requisitos de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="7edbb-162">Define your availability requirements</span></span>
<span data-ttu-id="7edbb-163">El planeamiento de la resistencia comienza con los requisitos empresariales.</span><span class="sxs-lookup"><span data-stu-id="7edbb-163">Resiliency planning starts with business requirements.</span></span> <span data-ttu-id="7edbb-164">Estos son algunos enfoques para pensar en resistencia en esos términos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-164">Here are some approaches for thinking about resiliency in those terms.</span></span>

### <a name="decompose-by-workload"></a><span data-ttu-id="7edbb-165">Descomposición por carga de trabajo</span><span class="sxs-lookup"><span data-stu-id="7edbb-165">Decompose by workload</span></span>
<span data-ttu-id="7edbb-166">Muchas soluciones en la nube constan de varias cargas de trabajo de aplicación.</span><span class="sxs-lookup"><span data-stu-id="7edbb-166">Many cloud solutions consist of multiple application workloads.</span></span> <span data-ttu-id="7edbb-167">El término "carga de trabajo" en este contexto significa una funcionalidad discreta o tarea de computación, que se puede separar lógicamente de otras tareas, en términos de requisitos de lógica de negocio y de almacenamiento de datos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-167">The term "workload" in this context means a discrete capability or computing task, which can be logically separated from other tasks, in terms of business logic and data storage requirements.</span></span> <span data-ttu-id="7edbb-168">Por ejemplo, una aplicación de comercio electrónico podría incluir las cargas de trabajo siguientes:</span><span class="sxs-lookup"><span data-stu-id="7edbb-168">For example, an e-commerce app might include the following workloads:</span></span>

* <span data-ttu-id="7edbb-169">Examinar y buscar un catálogo de productos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-169">Browse and search a product catalog.</span></span>
* <span data-ttu-id="7edbb-170">Crear y realizar el seguimiento de pedidos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-170">Create and track orders.</span></span>
* <span data-ttu-id="7edbb-171">Ver recomendaciones.</span><span class="sxs-lookup"><span data-stu-id="7edbb-171">View recommendations.</span></span>

<span data-ttu-id="7edbb-172">Estas cargas de trabajo pueden tener diferentes requisitos de disponibilidad, escalabilidad, coherencia de los datos o recuperación ante desastres, entre otros.</span><span class="sxs-lookup"><span data-stu-id="7edbb-172">These workloads might have different requirements for availability, scalability, data consistency, disaster recovery, and so forth.</span></span> <span data-ttu-id="7edbb-173">De nuevo, son decisiones empresariales.</span><span class="sxs-lookup"><span data-stu-id="7edbb-173">Again, these are business decisions.</span></span>

<span data-ttu-id="7edbb-174">Considere también la posibilidad de patrones de uso.</span><span class="sxs-lookup"><span data-stu-id="7edbb-174">Also consider usage patterns.</span></span> <span data-ttu-id="7edbb-175">¿Hay ciertos períodos críticos en los que el sistema debe estar disponible?</span><span class="sxs-lookup"><span data-stu-id="7edbb-175">Are there certain critical periods when the system must be available?</span></span> <span data-ttu-id="7edbb-176">Por ejemplo, un servicio de declaración de impuestos no puede estar inactivo justo antes de la fecha límite de presentación, un servicio de transmisión de vídeo debe estar activo durante un gran evento deportivo y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="7edbb-176">For example, a tax-filing service can't go down right before the filing deadline, a video streaming service must stay up during a big sports event, and so on.</span></span> <span data-ttu-id="7edbb-177">Durante los períodos críticos, es posible que tenga implementaciones redundantes en varias regiones, por lo que la aplicación puede conmutar por error si se produce un error en una región.</span><span class="sxs-lookup"><span data-stu-id="7edbb-177">During the critical periods, you might have redundant deployments across several regions, so the application could fail over if one region failed.</span></span> <span data-ttu-id="7edbb-178">Sin embargo, una implementación en varias regiones es más costosa, por lo que en los momentos menos críticos, se puede ejecutar la aplicación en una única región.</span><span class="sxs-lookup"><span data-stu-id="7edbb-178">However, a multi-region deployment is more expensive, so during less critical times, you might run the application in a single region.</span></span>

### <a name="rto-and-rpo"></a><span data-ttu-id="7edbb-179">RTO y RPO</span><span class="sxs-lookup"><span data-stu-id="7edbb-179">RTO and RPO</span></span>
<span data-ttu-id="7edbb-180">Dos métricas importantes a tener en cuenta son el objetivo de tiempo de recuperación (RTO) y el objetivo de punto de recuperación (RPO).</span><span class="sxs-lookup"><span data-stu-id="7edbb-180">Two important metrics to consider are the recovery time objective and recovery point objective.</span></span>

* <span data-ttu-id="7edbb-181">**Objetivo de tiempo de recuperación** (RTO) es el tiempo máximo aceptable que una aplicación puede no estar disponible después de un incidente.</span><span class="sxs-lookup"><span data-stu-id="7edbb-181">**Recovery time objective** (RTO) is the maximum acceptable time that an application can be unavailable after an incident.</span></span> <span data-ttu-id="7edbb-182">Si el RTO es de 90 minutos, debe ser capaz de restaurar la aplicación a un estado en ejecución en un plazo de 90 minutos desde el inicio de un desastre.</span><span class="sxs-lookup"><span data-stu-id="7edbb-182">If your RTO is 90 minutes, you must be able to restore the application to a running state within 90 minutes from the start of a disaster.</span></span> <span data-ttu-id="7edbb-183">Si tiene un RTO muy bajo, puede mantener una segunda implementación ejecutándose continuamente en modo de espera, para protegerse contra una interrupción regional.</span><span class="sxs-lookup"><span data-stu-id="7edbb-183">If you have a very low RTO, you might keep a second deployment continually running on standby, to protect against a regional outage.</span></span>

* <span data-ttu-id="7edbb-184">**Objetivo de punto de recuperación** (RPO) es la duración máxima de la pérdida de datos que es aceptable durante un desastre.</span><span class="sxs-lookup"><span data-stu-id="7edbb-184">**Recovery point objective** (RPO) is the maximum duration of data loss that is acceptable during a disaster.</span></span> <span data-ttu-id="7edbb-185">Por ejemplo, si se almacenan datos en una única base de datos, sin replicación en otras bases de datos y se realizan copias de seguridad por hora, se podría perder hasta una hora de datos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-185">For example, if you store data in a single database, with no replication to other databases, and perform hourly backups, you could lose up to an hour of data.</span></span> 

<span data-ttu-id="7edbb-186">RTO y el RPO son requisitos empresariales.</span><span class="sxs-lookup"><span data-stu-id="7edbb-186">RTO and RPO are business requirements.</span></span> <span data-ttu-id="7edbb-187">Llevar a cabo una evaluación de riesgos puede ayudarle a definir el RTO y el RPO de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7edbb-187">Conducting a risk assessment can help you define the application's RTO and RPO.</span></span> <span data-ttu-id="7edbb-188">Otra medida común es el **tiempo medio para recuperación** (MTTR), que es el tiempo medio que se tarda en restaurar la aplicación después de un error.</span><span class="sxs-lookup"><span data-stu-id="7edbb-188">Another common metric is **mean time to recover** (MTTR), which is the average time that it takes to restore the application after a failure.</span></span> <span data-ttu-id="7edbb-189">MTTR es un hecho empírico acerca de un sistema.</span><span class="sxs-lookup"><span data-stu-id="7edbb-189">MTTR is an empirical fact about a system.</span></span> <span data-ttu-id="7edbb-190">Si MTTR excede el RTO, un error en el sistema causará una interrupción inaceptable del negocio, porque no será posible restaurar el sistema dentro del RTO definido.</span><span class="sxs-lookup"><span data-stu-id="7edbb-190">If MTTR exceeds the RTO, then a failure in the system will cause an unacceptable business disruption, because it won't be possible to restore the system within the defined RTO.</span></span> 

### <a name="slas"></a><span data-ttu-id="7edbb-191">SLA</span><span class="sxs-lookup"><span data-stu-id="7edbb-191">SLAs</span></span>
<span data-ttu-id="7edbb-192">En Azure, el [Acuerdo de Nivel de Servicio][sla] explica los compromisos de Microsoft en cuanto a tiempo de actividad y conectividad.</span><span class="sxs-lookup"><span data-stu-id="7edbb-192">In Azure, the [Service Level Agreement][sla] (SLA) describes Microsoft’s commitments for uptime and connectivity.</span></span> <span data-ttu-id="7edbb-193">Si el Acuerdo de Nivel de Servicio para un servicio determinado es del 99,9 %, significa que debe esperar a que el servicio esté disponible un 99,9 % del tiempo.</span><span class="sxs-lookup"><span data-stu-id="7edbb-193">If the SLA for a particular service is 99.9%, it means you should expect the service to be available 99.9% of the time.</span></span>

> [!NOTE]
> <span data-ttu-id="7edbb-194">El Acuerdo de Nivel de Servicio de Azure también incluye disposiciones para obtener un crédito de servicio si no se cumpla el Acuerdo, junto con definiciones específicas de "disponibilidad" para cada servicio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-194">The Azure SLA also includes provisions for obtaining a service credit if the SLA is not met, along with specific definitions of "availability" for each service.</span></span> <span data-ttu-id="7edbb-195">Ese aspecto del Acuerdo de Nivel de Servicio actúa como una directiva de cumplimiento.</span><span class="sxs-lookup"><span data-stu-id="7edbb-195">That aspect of the SLA acts as an enforcement policy.</span></span> 
> 
> 

<span data-ttu-id="7edbb-196">Debe definir sus propios Acuerdos de Nivel de Servicio de destino para cada carga de trabajo de la solución.</span><span class="sxs-lookup"><span data-stu-id="7edbb-196">You should define your own target SLAs for each workload in your solution.</span></span> <span data-ttu-id="7edbb-197">Un Acuerdo de Nivel de Servicio permite evaluar si la arquitectura cumple con los requisitos empresariales.</span><span class="sxs-lookup"><span data-stu-id="7edbb-197">An SLA makes it possible to evaluate whether the architecture meets the business requirements.</span></span> <span data-ttu-id="7edbb-198">Por ejemplo, si una carga de trabajo requiere un tiempo de actividad del 99,99 %, pero depende de un servicio con un Acuerdo de Nivel de Servicio del 99,9 %, ese servicio no puede ser un único punto de error en el sistema.</span><span class="sxs-lookup"><span data-stu-id="7edbb-198">For example, if a workload requires 99.99% uptime, but depends on a service with a 99.9% SLA, that service cannot be a single-point of failure in the system.</span></span> <span data-ttu-id="7edbb-199">Una solución es tener una ruta de reserva en caso de que se produzca un error en el servicio, o bien tomar otras medidas para recuperarse de un error en ese servicio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-199">One remedy is to have a fallback path in case the service fails, or take other measures to recover from a failure in that service.</span></span> 

<span data-ttu-id="7edbb-200">En la tabla siguiente se muestra el tiempo de inactividad acumulativo potencial para varios niveles de Acuerdo de Nivel de Servicio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-200">The following table shows the potential cumulative downtime for various SLA levels.</span></span> 

| <span data-ttu-id="7edbb-201">Contrato de nivel de servicio</span><span class="sxs-lookup"><span data-stu-id="7edbb-201">SLA</span></span> | <span data-ttu-id="7edbb-202">Tiempo de inactividad por semana</span><span class="sxs-lookup"><span data-stu-id="7edbb-202">Downtime per week</span></span> | <span data-ttu-id="7edbb-203">Tiempo de inactividad por mes</span><span class="sxs-lookup"><span data-stu-id="7edbb-203">Downtime per month</span></span> | <span data-ttu-id="7edbb-204">Tiempo de inactividad por año</span><span class="sxs-lookup"><span data-stu-id="7edbb-204">Downtime per year</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="7edbb-205">99%</span><span class="sxs-lookup"><span data-stu-id="7edbb-205">99%</span></span> |<span data-ttu-id="7edbb-206">1,68 horas</span><span class="sxs-lookup"><span data-stu-id="7edbb-206">1.68 hours</span></span> |<span data-ttu-id="7edbb-207">7,2 horas</span><span class="sxs-lookup"><span data-stu-id="7edbb-207">7.2 hours</span></span> |<span data-ttu-id="7edbb-208">3,65 días</span><span class="sxs-lookup"><span data-stu-id="7edbb-208">3.65 days</span></span> |
| <span data-ttu-id="7edbb-209">99,9 %</span><span class="sxs-lookup"><span data-stu-id="7edbb-209">99.9%</span></span> |<span data-ttu-id="7edbb-210">10,1 minutos</span><span class="sxs-lookup"><span data-stu-id="7edbb-210">10.1 minutes</span></span> |<span data-ttu-id="7edbb-211">43,2 minutos</span><span class="sxs-lookup"><span data-stu-id="7edbb-211">43.2 minutes</span></span> |<span data-ttu-id="7edbb-212">8,76 horas</span><span class="sxs-lookup"><span data-stu-id="7edbb-212">8.76 hours</span></span> |
| <span data-ttu-id="7edbb-213">99,95 %</span><span class="sxs-lookup"><span data-stu-id="7edbb-213">99.95%</span></span> |<span data-ttu-id="7edbb-214">5 minutos</span><span class="sxs-lookup"><span data-stu-id="7edbb-214">5 minutes</span></span> |<span data-ttu-id="7edbb-215">21,6 minutos</span><span class="sxs-lookup"><span data-stu-id="7edbb-215">21.6 minutes</span></span> |<span data-ttu-id="7edbb-216">4,38 horas</span><span class="sxs-lookup"><span data-stu-id="7edbb-216">4.38 hours</span></span> |
| <span data-ttu-id="7edbb-217">99,99%</span><span class="sxs-lookup"><span data-stu-id="7edbb-217">99.99%</span></span> |<span data-ttu-id="7edbb-218">1,01 minutos</span><span class="sxs-lookup"><span data-stu-id="7edbb-218">1.01 minutes</span></span> |<span data-ttu-id="7edbb-219">4,32 minutos</span><span class="sxs-lookup"><span data-stu-id="7edbb-219">4.32 minutes</span></span> |<span data-ttu-id="7edbb-220">52,56 minutos</span><span class="sxs-lookup"><span data-stu-id="7edbb-220">52.56 minutes</span></span> |
| <span data-ttu-id="7edbb-221">99,999 %</span><span class="sxs-lookup"><span data-stu-id="7edbb-221">99.999%</span></span> |<span data-ttu-id="7edbb-222">6 segundos</span><span class="sxs-lookup"><span data-stu-id="7edbb-222">6 seconds</span></span> |<span data-ttu-id="7edbb-223">25,9 segundos</span><span class="sxs-lookup"><span data-stu-id="7edbb-223">25.9 seconds</span></span> |<span data-ttu-id="7edbb-224">5,26 minutos</span><span class="sxs-lookup"><span data-stu-id="7edbb-224">5.26 minutes</span></span> |

<span data-ttu-id="7edbb-225">Por supuesto, una mayor disponibilidad es mejor, todo lo demás es igual.</span><span class="sxs-lookup"><span data-stu-id="7edbb-225">Of course, higher availability is better, everything else being equal.</span></span> <span data-ttu-id="7edbb-226">Pero a medida que aspira a tener más números 9, el costo y la complejidad para lograr ese nivel de disponibilidad aumenta.</span><span class="sxs-lookup"><span data-stu-id="7edbb-226">But as you strive for more 9s, the cost and complexity to achieve that level of availability grows.</span></span> <span data-ttu-id="7edbb-227">Un tiempo de actividad del 99,99 % se traduce en unos 5 minutos de tiempo de inactividad total por mes.</span><span class="sxs-lookup"><span data-stu-id="7edbb-227">An uptime of 99.99% translates to about 5 minutes of total downtime per month.</span></span> <span data-ttu-id="7edbb-228">¿Vale la pena la complejidad y el costo adicionales para llegar a cinco 9?</span><span class="sxs-lookup"><span data-stu-id="7edbb-228">Is it worth the additional complexity and cost to reach five 9s?</span></span> <span data-ttu-id="7edbb-229">La respuesta depende de los requisitos del negocio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-229">The answer depends on the business requirements.</span></span> 

<span data-ttu-id="7edbb-230">Estas son algunas otras consideraciones al definir un Acuerdo de Nivel de Servicio:</span><span class="sxs-lookup"><span data-stu-id="7edbb-230">Here are some other considerations when defining an SLA:</span></span>

* <span data-ttu-id="7edbb-231">Para lograr cuatro 9 (99,99 %), probablemente no pueda confiar en una intervención manual para recuperarse de errores.</span><span class="sxs-lookup"><span data-stu-id="7edbb-231">To achieve four 9's (99.99%), you probably can't rely on manual intervention to recover from failures.</span></span> <span data-ttu-id="7edbb-232">La aplicación debe autodiagnosticarse y recuperarse automáticamente.</span><span class="sxs-lookup"><span data-stu-id="7edbb-232">The application must be self-diagnosing and self-healing.</span></span> 
* <span data-ttu-id="7edbb-233">Más allá de cuatro 9, es difícil detectar interrupciones del sistema lo suficientemente rápido como para cumplir con el Acuerdo de Nivel de Servicio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-233">Beyond four 9's, it is challenging to detect outages quickly enough to meet the SLA.</span></span>
* <span data-ttu-id="7edbb-234">Piense en la ventana de tiempo con la que se mide que el Acuerdo de Nivel de Servicio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-234">Think about the time window that your SLA is measured against.</span></span> <span data-ttu-id="7edbb-235">Cuanto menor sea la ventana, más estrictas serán las tolerancias.</span><span class="sxs-lookup"><span data-stu-id="7edbb-235">The smaller the window, the tighter the tolerances.</span></span> <span data-ttu-id="7edbb-236">Probablemente no tenga sentido definir el Acuerdo de Nivel de Servicio en términos de tiempo de actividad a cada hora o a diario.</span><span class="sxs-lookup"><span data-stu-id="7edbb-236">It probably doesn't make sense to define your SLA in terms of hourly or daily uptime.</span></span> 

### <a name="composite-slas"></a><span data-ttu-id="7edbb-237">Acuerdos de Nivel de Servicio compuestos</span><span class="sxs-lookup"><span data-stu-id="7edbb-237">Composite SLAs</span></span>
<span data-ttu-id="7edbb-238">Considere una aplicación web de App Service que escribe en Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="7edbb-238">Consider an App Service web app that writes to Azure SQL Database.</span></span> <span data-ttu-id="7edbb-239">En el momento de redactar este artículo, estos servicios de Azure tienen los siguientes Acuerdos de Nivel de Servicio:</span><span class="sxs-lookup"><span data-stu-id="7edbb-239">At the time of this writing, these Azure services have the following SLAs:</span></span>

* <span data-ttu-id="7edbb-240">App Service Web Apps = 99,95 %</span><span class="sxs-lookup"><span data-stu-id="7edbb-240">App Service Web Apps = 99.95%</span></span>
* <span data-ttu-id="7edbb-241">SQL Database = 99,99 %</span><span class="sxs-lookup"><span data-stu-id="7edbb-241">SQL Database = 99.99%</span></span>

![Acuerdo de Nivel de Servicio compuesto](./images/sla1.png)

<span data-ttu-id="7edbb-243">¿Cuál es el tiempo de inactividad máximo que se esperaría para esta aplicación?</span><span class="sxs-lookup"><span data-stu-id="7edbb-243">What is the maximum downtime you would expect for this application?</span></span> <span data-ttu-id="7edbb-244">Si se produce un error en cualquiera de los servicios, se produce un error en toda la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7edbb-244">If either service fails, the whole application fails.</span></span> <span data-ttu-id="7edbb-245">En general, la probabilidad de que se produzca un error en cada servicio es independiente, por lo que el Acuerdo de Nivel de Servicio compuesto para esta aplicación es del 99,95 % &times; 99,99 % = 99,94 %.</span><span class="sxs-lookup"><span data-stu-id="7edbb-245">In general, the probability of each service failing is independent, so the composite SLA for this application is 99.95% &times; 99.99% = 99.94%.</span></span> <span data-ttu-id="7edbb-246">Esto es menor que los Acuerdos de Nivel de Servicio individuales, lo cual no es sorprendente, porque una aplicación que depende de varios servicios tiene más puntos de error posibles.</span><span class="sxs-lookup"><span data-stu-id="7edbb-246">That's lower than the individual SLAs, which isn't surprising, because an application that relies on multiple services has more potential failure points.</span></span> 

<span data-ttu-id="7edbb-247">Por otra parte, puede mejorar el Acuerdo de Nivel de Servicio compuesto mediante la creación de rutas de reserva independientes.</span><span class="sxs-lookup"><span data-stu-id="7edbb-247">On the other hand, you can improve the composite SLA by creating independent fallback paths.</span></span> <span data-ttu-id="7edbb-248">Por ejemplo, si la instancia de SQL Database no está disponible, coloque las transacciones en una cola para procesarla más adelante.</span><span class="sxs-lookup"><span data-stu-id="7edbb-248">For example, if SQL Database is unavailable, put transactions into a queue, to be processed later.</span></span>

![Acuerdo de Nivel de Servicio compuesto](./images/sla2.png)

<span data-ttu-id="7edbb-250">Con este diseño, la aplicación sigue estando disponible, aunque no pueda conectarse a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-250">With this design, the application is still available even if it can't connect to the database.</span></span> <span data-ttu-id="7edbb-251">Sin embargo, se produce un error si la base de datos y la cola fallan al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="7edbb-251">However, it fails if the database and the queue both fail at the same time.</span></span> <span data-ttu-id="7edbb-252">El porcentaje de tiempo previsto para un error simultáneo es 0,0001 &times; 0,001, por lo que el Acuerdo de Nivel de Servicio compuesto para esta ruta combinada es:</span><span class="sxs-lookup"><span data-stu-id="7edbb-252">The expected percentage of time for a simultaneous failure is 0.0001 &times; 0.001, so the composite SLA for this combined path is:</span></span>  

* <span data-ttu-id="7edbb-253">Base de datos O cola = 1,0 &minus; (0,0001 &times; 0,001) = 99,99999 %</span><span class="sxs-lookup"><span data-stu-id="7edbb-253">Database OR queue = 1.0 &minus; (0.0001 &times; 0.001) = 99.99999%</span></span>

<span data-ttu-id="7edbb-254">El Acuerdo de Nivel de Servicio compuesto total es:</span><span class="sxs-lookup"><span data-stu-id="7edbb-254">The total composite SLA is:</span></span>

* <span data-ttu-id="7edbb-255">Aplicación web Y (base de datos O cola) = 99,95 % &times; 99,99999 % = ~99,95 %</span><span class="sxs-lookup"><span data-stu-id="7edbb-255">Web app AND (database OR queue) = 99.95% &times; 99.99999% = ~99.95%</span></span>

<span data-ttu-id="7edbb-256">Pero este enfoque tiene sus ventajas e inconvenientes.</span><span class="sxs-lookup"><span data-stu-id="7edbb-256">But there are tradeoffs to this approach.</span></span> <span data-ttu-id="7edbb-257">La lógica de aplicación es más compleja, está pagando por la cola y puede haber problemas de coherencia de datos a tener en cuenta.</span><span class="sxs-lookup"><span data-stu-id="7edbb-257">The application logic is more complex, you are paying for the queue, and there may be data consistency issues to consider.</span></span>

<span data-ttu-id="7edbb-258">**Acuerdo de Nivel de Servicio para implementaciones en varias regiones**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-258">**SLA for multi-region deployments**.</span></span> <span data-ttu-id="7edbb-259">Otra técnica de alta disponibilidad consiste en implementar la aplicación en más de una región y usar Azure Traffic Manager para conmutar por error si la aplicación produce un error en una región.</span><span class="sxs-lookup"><span data-stu-id="7edbb-259">Another HA technique is to deploy the application in more than one region, and use Azure Traffic Manager to fail over if the application fails in one region.</span></span> <span data-ttu-id="7edbb-260">Para una implementación de dos regiones, el Acuerdo de Nivel de Servicio compuesto se calcula del siguiente modo.</span><span class="sxs-lookup"><span data-stu-id="7edbb-260">For a two-region deployment, the composite SLA is calculated as follows.</span></span> 

<span data-ttu-id="7edbb-261">Supongamos que *N* es el Acuerdo de Nivel de Servicio compuesto para la aplicación implementada en una región.</span><span class="sxs-lookup"><span data-stu-id="7edbb-261">Let *N* be the composite SLA for the application deployed in one region.</span></span> <span data-ttu-id="7edbb-262">La probabilidad de que la aplicación produzca un error en ambas regiones al mismo tiempo es (1 &minus; N) &times; (1 &minus; N).</span><span class="sxs-lookup"><span data-stu-id="7edbb-262">The expected chance that the application will fail in both regions at the same time is (1 &minus; N) &times; (1 &minus; N).</span></span> <span data-ttu-id="7edbb-263">Por lo tanto,</span><span class="sxs-lookup"><span data-stu-id="7edbb-263">Therefore,</span></span>

* <span data-ttu-id="7edbb-264">Acuerdo de Nivel de Servicio combinado para ambas regiones = 1 &minus; (1 &minus; N)(1 &minus; N) = N + (1 &minus; N)N</span><span class="sxs-lookup"><span data-stu-id="7edbb-264">Combined SLA for both regions = 1 &minus; (1 &minus; N)(1 &minus; N) = N + (1 &minus; N)N</span></span>

<span data-ttu-id="7edbb-265">Por último, debe tener en cuenta el [Acuerdo de Nivel de Servicio para Traffic Manager][tm-sla].</span><span class="sxs-lookup"><span data-stu-id="7edbb-265">Finally, you must factor in the [SLA for Traffic Manager][tm-sla].</span></span> <span data-ttu-id="7edbb-266">En el momento de redactar este artículo, el Acuerdo de Nivel de Servicio del de Traffic Manager es 99,99 %.</span><span class="sxs-lookup"><span data-stu-id="7edbb-266">At the time of this writing, the SLA for Traffic Manager SLA is 99.99%.</span></span>

* <span data-ttu-id="7edbb-267">Acuerdo de Nivel de Servicio compuesto = 99,99 % &times; (Acuerdo de Nivel de Servicio combinado para ambas regiones)</span><span class="sxs-lookup"><span data-stu-id="7edbb-267">Composite SLA = 99.99% &times; (combined SLA for both regions)</span></span>

<span data-ttu-id="7edbb-268">Además, la conmutación por error no es instantánea y puede dar lugar un cierto tiempo de inactividad durante ese momento.</span><span class="sxs-lookup"><span data-stu-id="7edbb-268">Also, failing over is not instantaneous and can result in some downtime during a failover.</span></span> <span data-ttu-id="7edbb-269">Consulte [Supervisión de puntos de conexión y de Traffic Manager][tm-failover].</span><span class="sxs-lookup"><span data-stu-id="7edbb-269">See [Traffic Manager endpoint monitoring and failover][tm-failover].</span></span>

<span data-ttu-id="7edbb-270">El número calculado del Acuerdo de Nivel de Servicio es una base de referencia útil, pero no indica la historia completa sobre la disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="7edbb-270">The calculated SLA number is a useful baseline, but it doesn't tell the whole story about availability.</span></span> <span data-ttu-id="7edbb-271">A menudo, una aplicación puede degradarse correctamente cuando se produce un error en una ruta no crítica.</span><span class="sxs-lookup"><span data-stu-id="7edbb-271">Often, an application can degrade gracefully when a non-critical path fails.</span></span> <span data-ttu-id="7edbb-272">Considere una aplicación que muestre un catálogo de libros.</span><span class="sxs-lookup"><span data-stu-id="7edbb-272">Consider an application that shows a catalog of books.</span></span> <span data-ttu-id="7edbb-273">Si la aplicación no puede recuperar la imagen en miniatura de la portada, puede que muestre una imagen de marcador de posición.</span><span class="sxs-lookup"><span data-stu-id="7edbb-273">If the application can't retrieve the thumbnail image for the cover, it might show a placeholder image.</span></span> <span data-ttu-id="7edbb-274">En ese caso, no obtener la imagen no reduce el tiempo de actividad de la aplicación, aunque afecta a la experiencia del usuario.</span><span class="sxs-lookup"><span data-stu-id="7edbb-274">In that case, failing to get the image does not reduce the application's uptime, although it affects the user experience.</span></span>  

## <a name="design-for-resiliency"></a><span data-ttu-id="7edbb-275">Diseño para lograr resistencia</span><span class="sxs-lookup"><span data-stu-id="7edbb-275">Design for resiliency</span></span>

<span data-ttu-id="7edbb-276">Durante la fase de diseño, se debe realizar un análisis del modo de error (FMA).</span><span class="sxs-lookup"><span data-stu-id="7edbb-276">During the design phase, you should perform a failure mode analysis (FMA).</span></span> <span data-ttu-id="7edbb-277">El objetivo del análisis del modo de error es identificar los posibles puntos de error y definir cómo responderá la aplicación a esos errores.</span><span class="sxs-lookup"><span data-stu-id="7edbb-277">The goal of an FMA is to identify possible points of failure, and define how the application will respond to those failures.</span></span>

* <span data-ttu-id="7edbb-278">¿Cómo detectará la aplicación este tipo de error?</span><span class="sxs-lookup"><span data-stu-id="7edbb-278">How will the application detect this type of failure?</span></span>
* <span data-ttu-id="7edbb-279">¿Cómo responderá la aplicación a este tipo de error?</span><span class="sxs-lookup"><span data-stu-id="7edbb-279">How will the application respond to this type of failure?</span></span>
* <span data-ttu-id="7edbb-280">¿Cómo se va a registrar y supervisar este tipo de error?</span><span class="sxs-lookup"><span data-stu-id="7edbb-280">How will you log and monitor this type of failure?</span></span> 

<span data-ttu-id="7edbb-281">Para más información sobre el proceso de análisis del modo de error, con recomendaciones específicas para Azure, consulte [Azure resiliency guidance: Failure mode analysis][fma] (Guía de resistencia de Azure: análisis del modo de error).</span><span class="sxs-lookup"><span data-stu-id="7edbb-281">For more information about the FMA process, with specific recommendations for Azure, see [Azure resiliency guidance: Failure mode analysis][fma].</span></span>

### <a name="example-of-identifying-failure-modes-and-detection-strategy"></a><span data-ttu-id="7edbb-282">Ejemplo de identificación de modos de error y estrategia de detección</span><span class="sxs-lookup"><span data-stu-id="7edbb-282">Example of identifying failure modes and detection strategy</span></span>
<span data-ttu-id="7edbb-283">**Punto de error:** llamada a una API o servicio web externo.</span><span class="sxs-lookup"><span data-stu-id="7edbb-283">**Failure point:** Call to an external web service / API.</span></span>

| <span data-ttu-id="7edbb-284">Modo de error</span><span class="sxs-lookup"><span data-stu-id="7edbb-284">Failure mode</span></span> | <span data-ttu-id="7edbb-285">Estrategia de detección</span><span class="sxs-lookup"><span data-stu-id="7edbb-285">Detection strategy</span></span> |
| --- | --- |
| <span data-ttu-id="7edbb-286">El servicio no está disponible</span><span class="sxs-lookup"><span data-stu-id="7edbb-286">Service is unavailable</span></span> |<span data-ttu-id="7edbb-287">HTTP 5xx</span><span class="sxs-lookup"><span data-stu-id="7edbb-287">HTTP 5xx</span></span> |
| <span data-ttu-id="7edbb-288">Limitaciones</span><span class="sxs-lookup"><span data-stu-id="7edbb-288">Throttling</span></span> |<span data-ttu-id="7edbb-289">HTTP 429 (Demasiadas solicitudes)</span><span class="sxs-lookup"><span data-stu-id="7edbb-289">HTTP 429 (Too Many Requests)</span></span> |
| <span data-ttu-id="7edbb-290">Autenticación</span><span class="sxs-lookup"><span data-stu-id="7edbb-290">Authentication</span></span> |<span data-ttu-id="7edbb-291">HTTP 401 (No autorizado)</span><span class="sxs-lookup"><span data-stu-id="7edbb-291">HTTP 401 (Unauthorized)</span></span> |
| <span data-ttu-id="7edbb-292">Respuesta lenta</span><span class="sxs-lookup"><span data-stu-id="7edbb-292">Slow response</span></span> |<span data-ttu-id="7edbb-293">Tiempo de espera de la solicitud agotado</span><span class="sxs-lookup"><span data-stu-id="7edbb-293">Request times out</span></span> |


### <a name="redundancy-and-designing-for-failure"></a><span data-ttu-id="7edbb-294">Redundancia y diseño en caso de error</span><span class="sxs-lookup"><span data-stu-id="7edbb-294">Redundancy and designing for failure</span></span>

<span data-ttu-id="7edbb-295">El alcance de los errores puede variar.</span><span class="sxs-lookup"><span data-stu-id="7edbb-295">Failures can vary in the scope of their impact.</span></span> <span data-ttu-id="7edbb-296">Algunos errores de hardware, como un problema en un disco, pueden afectar a un único equipo host.</span><span class="sxs-lookup"><span data-stu-id="7edbb-296">Some hardware failures, such as a failed disk, may affect a single host machine.</span></span> <span data-ttu-id="7edbb-297">Un error en un conmutador de red podría afectar a todo un bastidor del servidor.</span><span class="sxs-lookup"><span data-stu-id="7edbb-297">A failed network switch could affect a whole server rack.</span></span> <span data-ttu-id="7edbb-298">Menos frecuentes son los errores que afectan a todo un centro de datos, como los problemas de alimentación.</span><span class="sxs-lookup"><span data-stu-id="7edbb-298">Less common are failures that disrupt a whole data center, such as loss of power in a data center.</span></span> <span data-ttu-id="7edbb-299">Aún más improbables son los problemas por los que toda una región dejaría de estar disponible.</span><span class="sxs-lookup"><span data-stu-id="7edbb-299">Rarely, an entire region could become unavailable.</span></span>

<span data-ttu-id="7edbb-300">Uno de los mecanismos para conseguir que una aplicación sea resistente es la redundancia.</span><span class="sxs-lookup"><span data-stu-id="7edbb-300">One of the main ways to make an application resilient is through redundancy.</span></span> <span data-ttu-id="7edbb-301">Sin embargo, esta redundancia debe planearse al diseñar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7edbb-301">But you need to plan for this redundancy when you design the application.</span></span> <span data-ttu-id="7edbb-302">Además, el nivel de redundancia necesario dependerá de los requisitos de la compañía: no todas las aplicaciones necesitan tener redundancia entre regiones para protegerse contra una interrupción regional.</span><span class="sxs-lookup"><span data-stu-id="7edbb-302">Also, the level of redundancy that you need depends on your business requirements &mdash; not every application needs redundancy across regions to guard against a regional outage.</span></span> <span data-ttu-id="7edbb-303">En general, hay que buscar el equilibrio, ya que una mayor redundancia y confiabilidad implica una mayor complejidad y unos costos más elevados.</span><span class="sxs-lookup"><span data-stu-id="7edbb-303">In general, there is a tradeoff between greater redundancy and reliability versus higher cost and complexity.</span></span>  

<span data-ttu-id="7edbb-304">Azure dispone de una serie de características que permiten hacer que la aplicación sea redundante sea cual sea el nivel del error, desde los que se producen en una única máquina virtual hasta los que tienen lugar en toda una región.</span><span class="sxs-lookup"><span data-stu-id="7edbb-304">Azure has a number of features to make an application redundant at every level of failure, from an individual VM to an entire region.</span></span> 

![](./images/redundancy.svg)

<span data-ttu-id="7edbb-305">**Una única máquina virtual**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-305">**Single VM**.</span></span> <span data-ttu-id="7edbb-306">Azure proporciona un Acuerdo de Nivel de Servicio de tiempo de actividad para máquinas virtuales individuales.</span><span class="sxs-lookup"><span data-stu-id="7edbb-306">Azure provides an uptime SLA for single VMs.</span></span> <span data-ttu-id="7edbb-307">Aunque se puede conseguir un Acuerdo de Nivel de Servicio mayor ejecutando dos o más máquinas virtuales, una única máquina virtual puede resultar suficientemente confiable con algunas cargas de trabajo.</span><span class="sxs-lookup"><span data-stu-id="7edbb-307">Although you can get a higher SLA by running two or more VMs, a single VM may be reliable enough for some workloads.</span></span> <span data-ttu-id="7edbb-308">En las cargas de trabajo de producción, se recomienda usar dos o más máquinas virtuales para tener redundancia.</span><span class="sxs-lookup"><span data-stu-id="7edbb-308">For production workloads, we recommend using two or more VMs for redundancy.</span></span> 

<span data-ttu-id="7edbb-309">**Conjuntos de disponibilidad**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-309">**Availability sets**.</span></span> <span data-ttu-id="7edbb-310">Para protegerse frente a errores de hardware localizados, como un error en un conmutador de red o un disco, implemente dos o más máquinas virtuales en un conjunto de disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="7edbb-310">To protect against localized hardware failures, such as a disk or network switch failing, deploy two or more VMs in an availability set.</span></span> <span data-ttu-id="7edbb-311">Un conjunto de disponibilidad se compone de dos o más *dominios de error* que comparten una fuente de alimentación y un conmutador de red.</span><span class="sxs-lookup"><span data-stu-id="7edbb-311">An availability set consists of two or more *fault domains* that share a common power source and network switch.</span></span> <span data-ttu-id="7edbb-312">Las máquinas virtuales incluidas en un conjunto de disponibilidad se distribuyen entre los dominios de error, por lo que, si un error de hardware afecta a un dominio de error, el tráfico de la red puede enrutarse a las máquinas virtuales de otros dominios de error.</span><span class="sxs-lookup"><span data-stu-id="7edbb-312">VMs in an availability set are distributed across the fault domains, so if a hardware failure affects one fault domain, network traffic can still be routed the VMs in the other fault domains.</span></span> <span data-ttu-id="7edbb-313">Para más información acerca de los conjuntos disponibilidad, consulte [Administración de la disponibilidad de las máquinas virtuales Windows en Azure](/azure/virtual-machines/windows/manage-availability).</span><span class="sxs-lookup"><span data-stu-id="7edbb-313">For more information about Availability Sets, see [Manage the availability of Windows virtual machines in Azure](/azure/virtual-machines/windows/manage-availability).</span></span>

<span data-ttu-id="7edbb-314">**Zonas de disponibilidad**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-314">**Availability zones**.</span></span>  <span data-ttu-id="7edbb-315">Una zona de disponibilidad es una zona separada físicamente dentro de una región de Azure.</span><span class="sxs-lookup"><span data-stu-id="7edbb-315">An Availability Zone is a physically separate zone within an Azure region.</span></span> <span data-ttu-id="7edbb-316">Cada zona de disponibilidad tiene una fuente de alimentación, una red y un sistema de refrigeración distintos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-316">Each Availability Zone has a distinct power source, network, and cooling.</span></span> <span data-ttu-id="7edbb-317">Cuando las máquinas virtuales están implementadas en diferentes zonas de disponibilidad, es más fácil proteger una aplicación frente a errores que afectan a todo el centro de datos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-317">Deploying VMs across availability zones helps to protect an application against datacenter-wide failures.</span></span> 

<span data-ttu-id="7edbb-318">**Regiones emparejadas**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-318">**Paired regions**.</span></span> <span data-ttu-id="7edbb-319">Para proteger una aplicación frente a una interrupción regional, puede implementar la aplicación en varias regiones y utilizar Azure Traffic Manager para distribuir el tráfico de Internet en las distintas regiones.</span><span class="sxs-lookup"><span data-stu-id="7edbb-319">To protect an application against a regional outage, you can deploy the application across multiple regions, using Azure Traffic Manager to distribute internet traffic to the different regions.</span></span> <span data-ttu-id="7edbb-320">Cada región de Azure está emparejada con otra región.</span><span class="sxs-lookup"><span data-stu-id="7edbb-320">Each Azure region is paired with another region.</span></span> <span data-ttu-id="7edbb-321">Juntas, forman un [par regional](/azure/best-practices-availability-paired-regions).</span><span class="sxs-lookup"><span data-stu-id="7edbb-321">Together, these form a [regional pair](/azure/best-practices-availability-paired-regions).</span></span> <span data-ttu-id="7edbb-322">A excepción del Sur de Brasil, los pares regionales se encuentran en la misma ubicación geográfica para, de este modo, cumplir los requisitos de residencia de datos a efectos de jurisdicción fiscal y aplicación de las leyes.</span><span class="sxs-lookup"><span data-stu-id="7edbb-322">With the exception of Brazil South, regional pairs are located within the same geography in order to meet data residency requirements for tax and law enforcement jurisdiction purposes.</span></span>

<span data-ttu-id="7edbb-323">Si diseña una aplicación para varias regiones, tenga en cuenta que la latencia de red entre regiones es mayor que dentro de una región.</span><span class="sxs-lookup"><span data-stu-id="7edbb-323">When you design a multi-region application, take into account that network latency across regions is higher than within a region.</span></span> <span data-ttu-id="7edbb-324">Por ejemplo, si va a replicar una base de datos para habilitar la conmutación por error, utilice la replicación de datos sincrónica dentro de una misma región y la replicación asincrónica de datos entre diferentes regiones.</span><span class="sxs-lookup"><span data-stu-id="7edbb-324">For example, if you are replicating a database to enable failover, use synchronous data replication within a region, but asynchronous data replication across regions.</span></span>

| &nbsp; | <span data-ttu-id="7edbb-325">Conjunto de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="7edbb-325">Availability Set</span></span> | <span data-ttu-id="7edbb-326">Zona de disponibilidad</span><span class="sxs-lookup"><span data-stu-id="7edbb-326">Availability Zone</span></span> | <span data-ttu-id="7edbb-327">Región emparejada</span><span class="sxs-lookup"><span data-stu-id="7edbb-327">Paired region</span></span> |
|--------|------------------|-------------------|---------------|
| <span data-ttu-id="7edbb-328">Alcance del error</span><span class="sxs-lookup"><span data-stu-id="7edbb-328">Scope of failure</span></span> | <span data-ttu-id="7edbb-329">Bastidor</span><span class="sxs-lookup"><span data-stu-id="7edbb-329">Rack</span></span> | <span data-ttu-id="7edbb-330">Centro de datos</span><span class="sxs-lookup"><span data-stu-id="7edbb-330">Datacenter</span></span> | <span data-ttu-id="7edbb-331">Region</span><span class="sxs-lookup"><span data-stu-id="7edbb-331">Region</span></span> |
| <span data-ttu-id="7edbb-332">Enrutamiento de solicitudes</span><span class="sxs-lookup"><span data-stu-id="7edbb-332">Request routing</span></span> | <span data-ttu-id="7edbb-333">Load Balancer</span><span class="sxs-lookup"><span data-stu-id="7edbb-333">Load Balancer</span></span> | <span data-ttu-id="7edbb-334">Equilibrador de carga entre zonas</span><span class="sxs-lookup"><span data-stu-id="7edbb-334">Cross-zone Load Balancer</span></span> | <span data-ttu-id="7edbb-335">Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="7edbb-335">Traffic Manager</span></span> |
| <span data-ttu-id="7edbb-336">Latencia de red</span><span class="sxs-lookup"><span data-stu-id="7edbb-336">Network latency</span></span> | <span data-ttu-id="7edbb-337">Muy baja</span><span class="sxs-lookup"><span data-stu-id="7edbb-337">Very low</span></span> | <span data-ttu-id="7edbb-338">Bajo</span><span class="sxs-lookup"><span data-stu-id="7edbb-338">Low</span></span> | <span data-ttu-id="7edbb-339">Media-alta</span><span class="sxs-lookup"><span data-stu-id="7edbb-339">Mid to high</span></span> |
| <span data-ttu-id="7edbb-340">Virtual network</span><span class="sxs-lookup"><span data-stu-id="7edbb-340">Virtual network</span></span>  | <span data-ttu-id="7edbb-341">VNet</span><span class="sxs-lookup"><span data-stu-id="7edbb-341">VNet</span></span> | <span data-ttu-id="7edbb-342">VNet</span><span class="sxs-lookup"><span data-stu-id="7edbb-342">VNet</span></span> | <span data-ttu-id="7edbb-343">Emparejamiento de VNet entre regiones</span><span class="sxs-lookup"><span data-stu-id="7edbb-343">Cross-region VNet peering</span></span> |

## <a name="implement-resiliency-strategies"></a><span data-ttu-id="7edbb-344">Implementación de estrategias de resistencia</span><span class="sxs-lookup"><span data-stu-id="7edbb-344">Implement resiliency strategies</span></span>
<span data-ttu-id="7edbb-345">En esta sección se proporciona un estudio de algunas estrategias comunes de resistencia.</span><span class="sxs-lookup"><span data-stu-id="7edbb-345">This section provides a survey of some common resiliency strategies.</span></span> <span data-ttu-id="7edbb-346">La mayoría de ellas no se limitan a una tecnología en particular.</span><span class="sxs-lookup"><span data-stu-id="7edbb-346">Most of these are not limited to a particular technology.</span></span> <span data-ttu-id="7edbb-347">Las descripciones de esta sección resumen la idea general que subyace en cada una de ellas, con vínculos a más información.</span><span class="sxs-lookup"><span data-stu-id="7edbb-347">The descriptions in this section summarize the general idea behind each technique, with links to further reading.</span></span>

<span data-ttu-id="7edbb-348">**Reintente los errores transitorios**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-348">**Retry transient failures**.</span></span> <span data-ttu-id="7edbb-349">Los errores transitorios pueden deberse a una pérdida momentánea de conectividad de red, una conexión de base de datos caída o un tiempo de espera agotado cuando un servicio está ocupado.</span><span class="sxs-lookup"><span data-stu-id="7edbb-349">Transient failures can be caused by momentary loss of network connectivity, a dropped database connection, or a timeout when a service is busy.</span></span> <span data-ttu-id="7edbb-350">A menudo, un error transitorio se puede resolver simplemente con volver a intentar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="7edbb-350">Often, a transient failure can be resolved simply by retrying the request.</span></span> <span data-ttu-id="7edbb-351">Para muchos de los servicios de Azure, el SDK de cliente implementa reintentos automáticos, de manera que es transparente para el autor de la llamada; consulte [Retry service specific guidance][retry-service-specific guidance] (Orientación específica sobre el servicio de reintentos).</span><span class="sxs-lookup"><span data-stu-id="7edbb-351">For many Azure services, the client SDK implements automatic retries, in a way that is transparent to the caller; see [Retry service specific guidance][retry-service-specific guidance].</span></span>

<span data-ttu-id="7edbb-352">Cada reintento se suma a la latencia total.</span><span class="sxs-lookup"><span data-stu-id="7edbb-352">Each retry attempt adds to the total latency.</span></span> <span data-ttu-id="7edbb-353">Además, demasiadas solicitudes con error pueden causar un cuello de botella, ya que las solicitudes pendientes se acumulan en la cola.</span><span class="sxs-lookup"><span data-stu-id="7edbb-353">Also, too many failed requests can cause a bottleneck, as pending requests accumulate in the queue.</span></span> <span data-ttu-id="7edbb-354">Estas solicitudes bloqueadas pueden contener recursos críticos del sistema, tales como la memoria, subprocesos o conexiones de base de datos, entre otros, que pueden causar errores en cascada.</span><span class="sxs-lookup"><span data-stu-id="7edbb-354">These blocked requests might hold critical system resources such as memory, threads, database connections, and so on, which can cause cascading failures.</span></span> <span data-ttu-id="7edbb-355">Para evitar este problema, aumente el retraso entre cada intento de reintento y limite el número total de solicitudes con error.</span><span class="sxs-lookup"><span data-stu-id="7edbb-355">To avoid this, increase the delay between each retry attempt, and limit the total number of failed requests.</span></span> 

![](./images/retry.png)

<span data-ttu-id="7edbb-356">**Equilibre la carga entre instancias**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-356">**Load balance across instances**.</span></span> <span data-ttu-id="7edbb-357">Para ofrecer escalabilidad, una aplicación en la nube debe ser capaz de escalar horizontalmente agregando más instancias.</span><span class="sxs-lookup"><span data-stu-id="7edbb-357">For scalability, a cloud application should be able to scale out by adding more instances.</span></span> <span data-ttu-id="7edbb-358">Este enfoque también mejora la resistencia, ya que los casos con estado incorrecto se pueden quitar de la rotación.</span><span class="sxs-lookup"><span data-stu-id="7edbb-358">This approach also improves resiliency, because unhealthy instances can be removed from rotation.</span></span> <span data-ttu-id="7edbb-359">Por ejemplo: </span><span class="sxs-lookup"><span data-stu-id="7edbb-359">For example:</span></span>

* <span data-ttu-id="7edbb-360">Coloque dos o más máquinas virtuales detrás de un equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="7edbb-360">Put two or more VMs behind a load balancer.</span></span> <span data-ttu-id="7edbb-361">El equilibrador de carga distribuye el tráfico a todas las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="7edbb-361">The load balancer distributes traffic to all the VMs.</span></span> <span data-ttu-id="7edbb-362">Consulte [Run load-balanced VMs for scalability and availability][ra-multi-vm] (Ejecución de máquinas virtuales con equilibrio de carga por escalabilidad y disponibilidad).</span><span class="sxs-lookup"><span data-stu-id="7edbb-362">See [Run load-balanced VMs for scalability and availability][ra-multi-vm].</span></span>
* <span data-ttu-id="7edbb-363">Escale horizontalmente una aplicación de Azure App Service en varias instancias.</span><span class="sxs-lookup"><span data-stu-id="7edbb-363">Scale out an Azure App Service app to multiple instances.</span></span> <span data-ttu-id="7edbb-364">App Service equilibra automáticamente la carga entre instancias.</span><span class="sxs-lookup"><span data-stu-id="7edbb-364">App Service automatically balances load across instances.</span></span> <span data-ttu-id="7edbb-365">Consulte [Basic web application][ra-basic-web] (Aplicación web básica).</span><span class="sxs-lookup"><span data-stu-id="7edbb-365">See [Basic web application][ra-basic-web].</span></span>
* <span data-ttu-id="7edbb-366">Use [Azure Traffic Manager][tm] para distribuir el tráfico a través de un conjunto de puntos de conexión.</span><span class="sxs-lookup"><span data-stu-id="7edbb-366">Use [Azure Traffic Manager][tm] to distribute traffic across a set of endpoints.</span></span>

<span data-ttu-id="7edbb-367">**Replique los datos**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-367">**Replicate data**.</span></span> <span data-ttu-id="7edbb-368">La replicación de datos es una estrategia general para tratar errores no transitorios en un almacén de datos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-368">Replicating data is a general strategy for handling non-transient failures in a data store.</span></span> <span data-ttu-id="7edbb-369">Muchas tecnologías de almacenamiento proporcionan replicación integrada, como Azure SQL Datase y Cosmos DB y Apache Cassandra.</span><span class="sxs-lookup"><span data-stu-id="7edbb-369">Many storage technologies provide built-in replication, including Azure SQL Database, Cosmos DB, and Apache Cassandra.</span></span> <span data-ttu-id="7edbb-370">Es importante tener en cuenta las rutas de lectura y escritura.</span><span class="sxs-lookup"><span data-stu-id="7edbb-370">It's important to consider both the read and write paths.</span></span> <span data-ttu-id="7edbb-371">Según la tecnología de almacenamiento, puede tener varias réplicas de escritura, o una única réplica de escritura y múltiples réplicas de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="7edbb-371">Depending on the storage technology, you might have multiple writable replicas, or a single writable replica and multiple read-only replicas.</span></span> 

<span data-ttu-id="7edbb-372">Para maximizar la disponibilidad, las réplicas pueden colocarse en varias regiones.</span><span class="sxs-lookup"><span data-stu-id="7edbb-372">To maximize availability, replicas can be placed in multiple regions.</span></span> <span data-ttu-id="7edbb-373">Sin embargo, esto aumenta la latencia al replicar los datos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-373">However, this increases the latency when replicating the data.</span></span> <span data-ttu-id="7edbb-374">Por lo general, la replicación entre las regiones se realiza de forma asincrónica, lo que implica un modelo de coherencia final y la posible pérdida de datos si se produce un error en una réplica.</span><span class="sxs-lookup"><span data-stu-id="7edbb-374">Typically, replicating across regions is done asynchronously, which implies an eventual consistency model and potential data loss if a replica fails.</span></span> 

<span data-ttu-id="7edbb-375">**Degrade de manera correcta**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-375">**Degrade gracefully**.</span></span> <span data-ttu-id="7edbb-376">Si se produce un error en un servicio y no hay ninguna ruta de conmutación por error, es posible que la aplicación pueda degradarse correctamente y al mismo tiempo proporcionar una experiencia de usuario aceptable.</span><span class="sxs-lookup"><span data-stu-id="7edbb-376">If a service fails and there is no failover path, the application may be able to degrade gracefully while still providing an acceptable user experience.</span></span> <span data-ttu-id="7edbb-377">Por ejemplo: </span><span class="sxs-lookup"><span data-stu-id="7edbb-377">For example:</span></span>

* <span data-ttu-id="7edbb-378">Coloque un elemento de trabajo en una cola, para su tratamiento posterior.</span><span class="sxs-lookup"><span data-stu-id="7edbb-378">Put a work item on a queue, to be handled later.</span></span> 
* <span data-ttu-id="7edbb-379">Devuelva un valor estimado.</span><span class="sxs-lookup"><span data-stu-id="7edbb-379">Return an estimated value.</span></span>
* <span data-ttu-id="7edbb-380">Use datos almacenados en caché local.</span><span class="sxs-lookup"><span data-stu-id="7edbb-380">Use locally cached data.</span></span> 
* <span data-ttu-id="7edbb-381">Muestre al usuario un mensaje de error.</span><span class="sxs-lookup"><span data-stu-id="7edbb-381">Show the user an error message.</span></span> <span data-ttu-id="7edbb-382">(Esta opción es mejor que dejar que la aplicación deje de responder a las solicitudes).</span><span class="sxs-lookup"><span data-stu-id="7edbb-382">(This option is better than having the application stop responding to requests.)</span></span>

<span data-ttu-id="7edbb-383">**Limitación a usuarios de gran volumen**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-383">**Throttle high-volume users**.</span></span> <span data-ttu-id="7edbb-384">A veces un número reducido de usuarios crea una carga excesiva.</span><span class="sxs-lookup"><span data-stu-id="7edbb-384">Sometimes a small number of users create excessive load.</span></span> <span data-ttu-id="7edbb-385">Que puede tener un impacto en otros usuarios, lo que reduce la disponibilidad general de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7edbb-385">That can have an impact on other users, reducing the overall availability of your application.</span></span>

<span data-ttu-id="7edbb-386">Cuando un solo cliente realiza un número excesivo de solicitudes, la aplicación puede limitar al cliente durante un cierto período de tiempo.</span><span class="sxs-lookup"><span data-stu-id="7edbb-386">When a single client makes an excessive number of requests, the application might throttle the client for a certain period of time.</span></span> <span data-ttu-id="7edbb-387">Durante el período de limitación, la aplicación rechaza algunas o todas las solicitudes de ese cliente (dependiendo de la estrategia exacta de limitación).</span><span class="sxs-lookup"><span data-stu-id="7edbb-387">During the throttling period, the application refuses some or all of the requests from that client (depending on the exact throttling strategy).</span></span> <span data-ttu-id="7edbb-388">El umbral para la limitación puede depender del nivel de servicio del cliente.</span><span class="sxs-lookup"><span data-stu-id="7edbb-388">The threshold for throttling might depend on the customer's service tier.</span></span> 

<span data-ttu-id="7edbb-389">La limitación no implica que el cliente haya actuado necesariamente de forma malintencionada, sino que ha superado su cuota de servicio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-389">Throttling does not imply the client was necessarily acting maliciously, only that it exceeded its service quota.</span></span> <span data-ttu-id="7edbb-390">En algunos casos, un consumidor puede superar sistemáticamente su cuota o por lo demás comportarse incorrectamente.</span><span class="sxs-lookup"><span data-stu-id="7edbb-390">In some cases, a consumer might consistently exceed their quota or otherwise behave badly.</span></span> <span data-ttu-id="7edbb-391">En ese caso, podría ir más lejos y bloquear al usuario.</span><span class="sxs-lookup"><span data-stu-id="7edbb-391">In that case, you might go further and block the user.</span></span> <span data-ttu-id="7edbb-392">Normalmente, esto se hace bloqueando una clave de API o un rango de direcciones IP.</span><span class="sxs-lookup"><span data-stu-id="7edbb-392">Typically, this is done by blocking an API key or an IP address range.</span></span> <span data-ttu-id="7edbb-393">Para más información, consulte [Throttling Pattern][throttling-pattern] (Patrón Throttling).</span><span class="sxs-lookup"><span data-stu-id="7edbb-393">For more information, see [Throttling Pattern][throttling-pattern].</span></span>

<span data-ttu-id="7edbb-394">**Use un interruptor**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-394">**Use a circuit breaker**.</span></span> <span data-ttu-id="7edbb-395">El patrón [Interruptor][circuit-breaker-pattern] puede evitar que una aplicación intente repetidamente realizar una operación que probablemente produzca errores.</span><span class="sxs-lookup"><span data-stu-id="7edbb-395">The [Circuit Breaker][circuit-breaker-pattern] pattern can prevent an application from repeatedly trying an operation that is likely to fail.</span></span> <span data-ttu-id="7edbb-396">El interruptor encapsula las llamadas a un servicio y realiza el seguimiento del número de errores recientes.</span><span class="sxs-lookup"><span data-stu-id="7edbb-396">The circuit breaker wraps calls to a service and tracks the number of recent failures.</span></span> <span data-ttu-id="7edbb-397">Si el número de errores supera un umbral, el interruptor comienza devolviendo un código de error sin llamar al servicio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-397">If the failure count exceeds a threshold, the circuit breaker starts returning an error code without calling the service.</span></span> <span data-ttu-id="7edbb-398">Esto proporciona al servicio el tiempo necesario para recuperarse.</span><span class="sxs-lookup"><span data-stu-id="7edbb-398">This gives the service time to recover.</span></span> 

<span data-ttu-id="7edbb-399">**Use la nivelación de la carga para suavizar picos de tráfico**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-399">**Use load leveling to smooth out spikes in traffic**.</span></span> <span data-ttu-id="7edbb-400">Las aplicaciones pueden experimentar picos repentinos en el tráfico, lo que puede sobrecargar los servicios en el back-end.</span><span class="sxs-lookup"><span data-stu-id="7edbb-400">Applications may experience sudden spikes in traffic, which can overwhelm services on the backend.</span></span> <span data-ttu-id="7edbb-401">Si un servicio back-end no puede responder a las solicitudes con la suficiente rapidez, puede causar que las solicitudes se coloquen en cola (copia de seguridad) o que el servicio limite la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7edbb-401">If a backend service cannot respond to requests quickly enough, it may cause requests to queue (back up), or cause the service to throttle the application.</span></span> <span data-ttu-id="7edbb-402">Para evitar esto, puede utilizar una cola como búfer.</span><span class="sxs-lookup"><span data-stu-id="7edbb-402">To avoid this, you can use a queue as a buffer.</span></span> <span data-ttu-id="7edbb-403">Cuando hay un nuevo elemento de trabajo, en lugar de llamar al servicio de back-end inmediatamente, la aplicación pone en cola un elemento de trabajo para ejecutarlo de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="7edbb-403">When there is a new work item, instead of calling the backend service immediately, the application queues a work item to run asynchronously.</span></span> <span data-ttu-id="7edbb-404">La cola actúa como un búfer que suaviza los picos de carga.</span><span class="sxs-lookup"><span data-stu-id="7edbb-404">The queue acts as a buffer that smooths out peaks in the load.</span></span> <span data-ttu-id="7edbb-405">Para más información, consulte [Queue-Based Load Leveling Pattern][load-leveling-pattern] (Patrón de equilibrio de carga basado en colas).</span><span class="sxs-lookup"><span data-stu-id="7edbb-405">For more information, see [Queue-Based Load Leveling Pattern][load-leveling-pattern].</span></span>

<span data-ttu-id="7edbb-406">**Aislamiento los recursos críticos**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-406">**Isolate critical resources**.</span></span> <span data-ttu-id="7edbb-407">Los errores en un subsistema a veces pueden producirse en cascada, lo que provoca errores en otras partes de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7edbb-407">Failures in one subsystem can sometimes cascade, causing failures in other parts of the application.</span></span> <span data-ttu-id="7edbb-408">Esto puede ocurrir si un error provoca que algunos recursos, como subprocesos o sockets, no se liberen a tiempo, lo que conduce a un agotamiento de los recursos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-408">This can happen if a failure causes some resources, such as threads or sockets, not to get freed in a timely manner, leading to resource exhaustion.</span></span> 

<span data-ttu-id="7edbb-409">Para evitar esto, puede realizar una partición de un sistema en grupos aislados, de modo que un error en una partición no destruya todo el sistema.</span><span class="sxs-lookup"><span data-stu-id="7edbb-409">To avoid this, you can partition a system into isolated groups, so that a failure in one partition does not bring down the entire system.</span></span> <span data-ttu-id="7edbb-410">Esta técnica se denomina a veces, el patrón Bulkhead.</span><span class="sxs-lookup"><span data-stu-id="7edbb-410">This technique is sometimes called the Bulkhead pattern.</span></span>

<span data-ttu-id="7edbb-411">Ejemplos:</span><span class="sxs-lookup"><span data-stu-id="7edbb-411">Examples:</span></span>

* <span data-ttu-id="7edbb-412">Realizar una partición de una base de datos (por ejemplo, por inquilino) y asignar un grupo independiente de instancias del servidor web para cada partición.</span><span class="sxs-lookup"><span data-stu-id="7edbb-412">Partition a database (for example, by tenant) and assign a separate pool of web server instances for each partition.</span></span>  
* <span data-ttu-id="7edbb-413">Usar grupos de subprocesos independientes para aislar las llamadas a servicios diferentes.</span><span class="sxs-lookup"><span data-stu-id="7edbb-413">Use separate thread pools to isolate calls to different services.</span></span> <span data-ttu-id="7edbb-414">Esto ayuda a evitar errores en cascada, si se produce un error en uno de los servicios.</span><span class="sxs-lookup"><span data-stu-id="7edbb-414">This helps to prevent cascading failures if one of the services fails.</span></span> <span data-ttu-id="7edbb-415">Para ver un ejemplo, consulte la [biblioteca Hystrix][hystrix] de Netflix.</span><span class="sxs-lookup"><span data-stu-id="7edbb-415">For an example, see the Netflix [Hystrix library][hystrix].</span></span>
* <span data-ttu-id="7edbb-416">Usar [contenedores][containers] para limitar los recursos disponibles para un subsistema determinado.</span><span class="sxs-lookup"><span data-stu-id="7edbb-416">Use [containers][containers] to limit the resources available to a particular subsystem.</span></span> 

![](./images/bulkhead.png)

<span data-ttu-id="7edbb-417">**Aplique transacciones de compensación**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-417">**Apply compensating transactions**.</span></span> <span data-ttu-id="7edbb-418">Una [transacción de compensación][compensating-transaction-pattern] es una transacción que deshace los efectos de otra transacción completada.</span><span class="sxs-lookup"><span data-stu-id="7edbb-418">A [compensating transaction][compensating-transaction-pattern] is a transaction that undoes the effects of another completed transaction.</span></span> <span data-ttu-id="7edbb-419">En un sistema distribuido, puede ser muy difícil lograr una fuerte coherencia transaccional.</span><span class="sxs-lookup"><span data-stu-id="7edbb-419">In a distributed system, it can be very difficult to achieve strong transactional consistency.</span></span> <span data-ttu-id="7edbb-420">Las transacciones de compensación son una forma de lograr coherencia mediante el uso de una serie de transacciones individuales más pequeñas que pueden deshacerse en cada paso.</span><span class="sxs-lookup"><span data-stu-id="7edbb-420">Compensating transactions are a way to achieve consistency by using a series of smaller, individual transactions that can be undone at each step.</span></span>

<span data-ttu-id="7edbb-421">Por ejemplo, para reservar un viaje, el cliente puede reservar un coche, una habitación de hotel y un vuelo.</span><span class="sxs-lookup"><span data-stu-id="7edbb-421">For example, to book a trip, a customer might reserve a car, a hotel room, and a flight.</span></span> <span data-ttu-id="7edbb-422">Si se produce un error en alguno de estos pasos, fallará toda la operación.</span><span class="sxs-lookup"><span data-stu-id="7edbb-422">If any of these steps fails, the entire operation fails.</span></span> <span data-ttu-id="7edbb-423">En lugar de intentar utilizar una única transacción distribuida para toda la operación, puede definir una transacción de compensación para cada paso.</span><span class="sxs-lookup"><span data-stu-id="7edbb-423">Instead of trying to use a single distributed transaction for the entire operation, you can define a compensating transaction for each step.</span></span> <span data-ttu-id="7edbb-424">Por ejemplo, para anular una reserva de coche, se cancela la reserva.</span><span class="sxs-lookup"><span data-stu-id="7edbb-424">For example, to undo a car reservation, you cancel the reservation.</span></span> <span data-ttu-id="7edbb-425">Para completar toda la operación, un coordinador ejecuta cada paso.</span><span class="sxs-lookup"><span data-stu-id="7edbb-425">In order to complete the whole operation, a coordinator executes each step.</span></span> <span data-ttu-id="7edbb-426">Si se produce un error en algún paso, el coordinador aplica transacciones de compensación para deshacer todos los pasos que se hayan completado.</span><span class="sxs-lookup"><span data-stu-id="7edbb-426">If any step fails, the coordinator applies compensating transactions to undo any steps that were completed.</span></span> 

## <a name="test-for-resiliency"></a><span data-ttu-id="7edbb-427">Pruebas de resistencia</span><span class="sxs-lookup"><span data-stu-id="7edbb-427">Test for resiliency</span></span>
<span data-ttu-id="7edbb-428">Por lo general, no se puede probar la resistencia de la misma manera que se prueba la funcionalidad de la aplicación (al ejecutar pruebas unitarias, por ejemplo).</span><span class="sxs-lookup"><span data-stu-id="7edbb-428">Generally, you can't test resiliency in the same way that you test application functionality (by running unit tests and so on).</span></span> <span data-ttu-id="7edbb-429">En su lugar, debe comprobar cómo se realiza la carga de trabajo de un extremo a otro en condiciones de error que solo se producen de forma intermitente.</span><span class="sxs-lookup"><span data-stu-id="7edbb-429">Instead, you must test how the end-to-end workload performs under failure conditions which only occur intermittently.</span></span>

<span data-ttu-id="7edbb-430">Las pruebas son un proceso iterativo.</span><span class="sxs-lookup"><span data-stu-id="7edbb-430">Testing is an iterative process.</span></span> <span data-ttu-id="7edbb-431">Pruebe la aplicación, mida el resultado, analice y resuelva los errores que se producen, y repita el proceso.</span><span class="sxs-lookup"><span data-stu-id="7edbb-431">Test the application, measure the outcome, analyze and address any failures that result, and repeat the process.</span></span>

<span data-ttu-id="7edbb-432">**Pruebas de inserción de errores**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-432">**Fault injection testing**.</span></span> <span data-ttu-id="7edbb-433">Pruebe la resistencia del sistema durante los errores, ya sea mediante la activación de errores reales o mediante su simulación.</span><span class="sxs-lookup"><span data-stu-id="7edbb-433">Test the resiliency of the system during failures, either by triggering actual failures or by simulating them.</span></span> <span data-ttu-id="7edbb-434">A continuación se presentan algunos escenarios de error comunes para probar:</span><span class="sxs-lookup"><span data-stu-id="7edbb-434">Here are some common failure scenarios to test:</span></span>

* <span data-ttu-id="7edbb-435">Cierre de instancias de máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="7edbb-435">Shut down VM instances.</span></span>
* <span data-ttu-id="7edbb-436">Bloqueo de procesos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-436">Crash processes.</span></span>
* <span data-ttu-id="7edbb-437">Expiración de certificados.</span><span class="sxs-lookup"><span data-stu-id="7edbb-437">Expire certificates.</span></span>
* <span data-ttu-id="7edbb-438">Cambio de claves de acceso.</span><span class="sxs-lookup"><span data-stu-id="7edbb-438">Change access keys.</span></span>
* <span data-ttu-id="7edbb-439">Cierre del servicio DNS en controladores de dominio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-439">Shut down the DNS service on domain controllers.</span></span>
* <span data-ttu-id="7edbb-440">Límite de los recursos del sistema disponibles, como RAM o número de subprocesos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-440">Limit available system resources, such as RAM or number of threads.</span></span>
* <span data-ttu-id="7edbb-441">Desmontaje de discos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-441">Unmount disks.</span></span>
* <span data-ttu-id="7edbb-442">Reimplementación de una máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="7edbb-442">Redeploy a VM.</span></span>

<span data-ttu-id="7edbb-443">Medir los tiempos de recuperación y compruebe que se cumplen los requisitos de negocio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-443">Measure the recovery times and verify that your business requirements are met.</span></span> <span data-ttu-id="7edbb-444">Pruebe también combinaciones de modos de error.</span><span class="sxs-lookup"><span data-stu-id="7edbb-444">Test combinations of failure modes as well.</span></span> <span data-ttu-id="7edbb-445">Asegúrese de que los errores no están en cascada y se traten de forma aislada.</span><span class="sxs-lookup"><span data-stu-id="7edbb-445">Make sure that failures don't cascade, and are handled in an isolated way.</span></span>

<span data-ttu-id="7edbb-446">Este es otro motivo por el cual es importante analizar los posibles puntos de error durante la fase de diseño.</span><span class="sxs-lookup"><span data-stu-id="7edbb-446">This is another reason why it's important to analyze possible failure points during the design phase.</span></span> <span data-ttu-id="7edbb-447">Los resultados de ese análisis deben incluirse en el plan de pruebas.</span><span class="sxs-lookup"><span data-stu-id="7edbb-447">The results of that analysis should be inputs into your test plan.</span></span>

<span data-ttu-id="7edbb-448">**Prueba de carga**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-448">**Load testing**.</span></span> <span data-ttu-id="7edbb-449">La prueba de carga es fundamental para identificar errores que se producen solo bajo carga, como que la base de datos de back-end esté desbordada o que haya una limitación del servicio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-449">Load testing is crucial for identifying failures that only happen under load, such as the backend database being overwhelmed or service throttling.</span></span> <span data-ttu-id="7edbb-450">Realice pruebas de carga máxima, mediante el uso de datos de producción o datos sintéticos que estén lo más cerca posible de los datos de producción.</span><span class="sxs-lookup"><span data-stu-id="7edbb-450">Test for peak load, using production data or synthetic data that is as close to production data as possible.</span></span> <span data-ttu-id="7edbb-451">El objetivo es ver cómo se comporta la aplicación en condiciones reales.</span><span class="sxs-lookup"><span data-stu-id="7edbb-451">The goal is to see how the application behaves under real-world conditions.</span></span>   

## <a name="deploy-using-reliable-processes"></a><span data-ttu-id="7edbb-452">Implementación mediante procesos confiables</span><span class="sxs-lookup"><span data-stu-id="7edbb-452">Deploy using reliable processes</span></span>
<span data-ttu-id="7edbb-453">Una vez que una aplicación se implementa en producción, las actualizaciones son un posible origen de errores.</span><span class="sxs-lookup"><span data-stu-id="7edbb-453">Once an application is deployed to production, updates are a possible source of errors.</span></span> <span data-ttu-id="7edbb-454">En el peor de los casos, una actualización incorrecta puede dar lugar a tiempos de inactividad.</span><span class="sxs-lookup"><span data-stu-id="7edbb-454">In the worst case, a bad update can cause downtime.</span></span> <span data-ttu-id="7edbb-455">Para evitarlo, el proceso de implementación debe ser predecible y repetible.</span><span class="sxs-lookup"><span data-stu-id="7edbb-455">To avoid this, the deployment process must be predictable and repeatable.</span></span> <span data-ttu-id="7edbb-456">La implementación incluye el aprovisionamiento de recursos de Azure, la implementación del código de aplicación y la aplicación de las opciones de configuración.</span><span class="sxs-lookup"><span data-stu-id="7edbb-456">Deployment includes provisioning Azure resources, deploying application code, and applying configuration settings.</span></span> <span data-ttu-id="7edbb-457">Una actualización puede implicar a los tres o a un subconjunto.</span><span class="sxs-lookup"><span data-stu-id="7edbb-457">An update may involve all three, or a subset.</span></span> 

<span data-ttu-id="7edbb-458">El punto fundamental es que las implementaciones manuales son propensas a errores.</span><span class="sxs-lookup"><span data-stu-id="7edbb-458">The crucial point is that manual deployments are prone to error.</span></span> <span data-ttu-id="7edbb-459">Por lo tanto, se recomienda tener un proceso automatizado e idempotente que pueda ejecutar a petición y volver a ejecutarlo si se produce un error.</span><span class="sxs-lookup"><span data-stu-id="7edbb-459">Therefore, it's recommended to have an automated, idempotent process that you can run on demand, and re-run if something fails.</span></span> 

* <span data-ttu-id="7edbb-460">Use plantillas de Azure Resource Manager para automatizar el aprovisionamiento de recursos de Azure.</span><span class="sxs-lookup"><span data-stu-id="7edbb-460">Use Azure Resource Manager templates to automate provisioning of Azure resources.</span></span>
* <span data-ttu-id="7edbb-461">Utilice [Desired State Configuration (DSC) de Azure Automation][dsc] para configurar las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="7edbb-461">Use [Azure Automation Desired State Configuration][dsc] (DSC) to configure VMs.</span></span>
* <span data-ttu-id="7edbb-462">Utilice un proceso de implementación automatizada para el código de aplicación.</span><span class="sxs-lookup"><span data-stu-id="7edbb-462">Use an automated deployment process for application code.</span></span>

<span data-ttu-id="7edbb-463">Dos conceptos relacionados con la implementación resistente son la *infraestructura como código* y la *infraestructura inmutable*.</span><span class="sxs-lookup"><span data-stu-id="7edbb-463">Two concepts related to resilient deployment are *infrastructure as code* and *immutable infrastructure*.</span></span>

* <span data-ttu-id="7edbb-464">La **infraestructura como código** es la práctica de utilizar código para aprovisionar y configurar la infraestructura.</span><span class="sxs-lookup"><span data-stu-id="7edbb-464">**Infrastructure as code** is the practice of using code to provision and configure infrastructure.</span></span> <span data-ttu-id="7edbb-465">La infraestructura como código puede utilizar un enfoque declarativo o un enfoque imperativo (o una combinación de ambos).</span><span class="sxs-lookup"><span data-stu-id="7edbb-465">Infrastructure as code may use a declarative approach or an imperative approach (or a combination of both).</span></span> <span data-ttu-id="7edbb-466">Las plantillas de Resource Manager son un ejemplo de un enfoque declarativo.</span><span class="sxs-lookup"><span data-stu-id="7edbb-466">Resource Manager templates are an example of a declarative approach.</span></span> <span data-ttu-id="7edbb-467">Los scripts de PowerShell son un ejemplo de un enfoque imperativo.</span><span class="sxs-lookup"><span data-stu-id="7edbb-467">PowerShell scripts are an example of an imperative approach.</span></span>
* <span data-ttu-id="7edbb-468">**Infraestructura inmutable** implica que no se debe modificar la infraestructura una vez implementada en producción.</span><span class="sxs-lookup"><span data-stu-id="7edbb-468">**Immutable infrastructure** is the principle that you shouldn’t modify infrastructure after it’s deployed to production.</span></span> <span data-ttu-id="7edbb-469">En caso contrario, puede entrar en un estado donde se han aplicado cambios ad hoc, por lo que resulta difícil saber exactamente qué es lo que ha cambiado y difícil pensar sobre el sistema.</span><span class="sxs-lookup"><span data-stu-id="7edbb-469">Otherwise, you can get into a state where ad hoc changes have been applied, so it's hard to know exactly what changed, and hard to reason about the system.</span></span> 

<span data-ttu-id="7edbb-470">Otra cuestión es cómo poner en marcha una actualización de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7edbb-470">Another question is how to roll out an application update.</span></span> <span data-ttu-id="7edbb-471">Se recomiendan técnicas como la implementación Blue-Green o lanzamientos controlados, que insertan actualizaciones de forma altamente controlada para minimizar los posibles impactos de una implementación incorrecta.</span><span class="sxs-lookup"><span data-stu-id="7edbb-471">We recommend techniques such as blue-green deployment or canary releases, which push updates in highly controlled way to minimize possible impacts from a bad deployment.</span></span>

* <span data-ttu-id="7edbb-472">La [implementación Blue-Green][blue-green] es una técnica en la que se implementa una actualización en un entorno de producción independiente de la aplicación activa.</span><span class="sxs-lookup"><span data-stu-id="7edbb-472">[Blue-green deployment][blue-green] is a technique where an update is deployed into a production environment separate from the live application.</span></span> <span data-ttu-id="7edbb-473">Después de validar la implementación, cambie el enrutamiento de tráfico a la versión actualizada.</span><span class="sxs-lookup"><span data-stu-id="7edbb-473">After you validate the deployment, switch the traffic routing to the updated version.</span></span> <span data-ttu-id="7edbb-474">Por ejemplo, Azure App Service Web Apps lo habilita con espacios de ensayo.</span><span class="sxs-lookup"><span data-stu-id="7edbb-474">For example, Azure App Service Web Apps enables this with staging slots.</span></span>
* <span data-ttu-id="7edbb-475">Los [lanzamientos controlados][canary-release] son similares a las implementaciones Blue-Green.</span><span class="sxs-lookup"><span data-stu-id="7edbb-475">[Canary releases][canary-release] are similar to blue-green deployments.</span></span> <span data-ttu-id="7edbb-476">En lugar de cambiar todo el tráfico a la versión actualizada, se implementa la actualización a un pequeño porcentaje de usuarios, mediante el enrutamiento de una parte del tráfico a la nueva implementación.</span><span class="sxs-lookup"><span data-stu-id="7edbb-476">Instead of switching all traffic to the updated version, you roll out the update to a small percentage of users, by routing a portion of the traffic to the new deployment.</span></span> <span data-ttu-id="7edbb-477">Si hay un problema, retroceda y vuelva a la implementación anterior.</span><span class="sxs-lookup"><span data-stu-id="7edbb-477">If there is a problem, back off and revert to the old deployment.</span></span> <span data-ttu-id="7edbb-478">De lo contrario, enrute más del tráfico a la nueva versión, hasta que se consiga el 100 % del tráfico.</span><span class="sxs-lookup"><span data-stu-id="7edbb-478">Otherwise, route more of the traffic to the new version, until it gets 100% of the traffic.</span></span>

<span data-ttu-id="7edbb-479">Sea cual sea el enfoque que se adopte, asegúrese de que puede volver a la última versión conocida, en caso de que la nueva versión no funcione.</span><span class="sxs-lookup"><span data-stu-id="7edbb-479">Whatever approach you take, make sure that you can roll back to the last-known-good deployment, in case the new version is not functioning.</span></span> <span data-ttu-id="7edbb-480">Además, si se producen errores, los registros de aplicaciones deben indicar qué versión ha causado el error.</span><span class="sxs-lookup"><span data-stu-id="7edbb-480">Also, if errors occur, the application logs must indicate which version caused the error.</span></span> 

## <a name="monitor-to-detect-failures"></a><span data-ttu-id="7edbb-481">Supervisión para detectar errores</span><span class="sxs-lookup"><span data-stu-id="7edbb-481">Monitor to detect failures</span></span>
<span data-ttu-id="7edbb-482">La supervisión y el diagnóstico son fundamentales para proporcionar resistencia.</span><span class="sxs-lookup"><span data-stu-id="7edbb-482">Monitoring and diagnostics are crucial for resiliency.</span></span> <span data-ttu-id="7edbb-483">Si algo va mal, debe saber que se produjo un error y necesita comprender la causa del error.</span><span class="sxs-lookup"><span data-stu-id="7edbb-483">If something fails, you need to know that it failed, and you need insights into the cause of the failure.</span></span> 

<span data-ttu-id="7edbb-484">La supervisión de un sistema distribuido a gran escala plantea un desafío importante.</span><span class="sxs-lookup"><span data-stu-id="7edbb-484">Monitoring a large-scale distributed system poses a significant challenge.</span></span> <span data-ttu-id="7edbb-485">Piense en una aplicación que se ejecuta en unas pocas docenas de máquinas virtuales; no es práctico volver a iniciar sesión en cada máquina virtual, una a la vez, y examine los archivos de registro tratando de solucionar un problema.</span><span class="sxs-lookup"><span data-stu-id="7edbb-485">Think about an application that runs on a few dozen VMs &mdash; it's not practical to log into each VM, one at a time, and look through log files, trying to troubleshoot a problem.</span></span> <span data-ttu-id="7edbb-486">Además, el número de instancias de máquinas virtuales probablemente no es estático.</span><span class="sxs-lookup"><span data-stu-id="7edbb-486">Moreover, the number of VM instances is probably not static.</span></span> <span data-ttu-id="7edbb-487">Las máquinas virtuales se agregan o se quitan a medida que la aplicación se reduce o se escala horizontalmente, y en ocasiones pueden producirse errores en una instancia y necesita ser reaprovisionada.</span><span class="sxs-lookup"><span data-stu-id="7edbb-487">VMs get added and removed as the application scales in and out, and occasionally an instance may fail and need to be reprovisioned.</span></span> <span data-ttu-id="7edbb-488">Además, una aplicación en la nube típica puede utilizar varios almacenes de datos (Azure Storage, SQL Database, Cosmos DB, Redis Cache) y una acción de un único usuario puede abarcar varios subsistemas.</span><span class="sxs-lookup"><span data-stu-id="7edbb-488">In addition, a typical cloud application might use multiple data stores (Azure storage, SQL Database, Cosmos DB, Redis cache), and a single user action may span multiple subsystems.</span></span> 

<span data-ttu-id="7edbb-489">El proceso de supervisión y diagnóstico se puede considerar como una canalización con varias fases distintas:</span><span class="sxs-lookup"><span data-stu-id="7edbb-489">You can think of the monitoring and diagnostics process as a pipeline with several distinct stages:</span></span>

![Acuerdo de Nivel de Servicio compuesto](./images/monitoring.png)

* <span data-ttu-id="7edbb-491">**Instrumentación**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-491">**Instrumentation**.</span></span> <span data-ttu-id="7edbb-492">Los datos sin procesar para la supervisión y el diagnóstico provienen de una variedad de orígenes, incluidos registros de aplicación, registros de servidor web, contadores de rendimiento del sistema operativo, registros de base de datos y diagnóstico integrado en la plataforma Azure.</span><span class="sxs-lookup"><span data-stu-id="7edbb-492">The raw data for monitoring and diagnostics comes from a variety of sources, including application logs, web server logs, OS performance counters, database logs, and diagnostics built into the Azure platform.</span></span> <span data-ttu-id="7edbb-493">La mayoría de los servicios de Azure tienen una característica de diagnóstico que puede usar para determinar la causa de los problemas.</span><span class="sxs-lookup"><span data-stu-id="7edbb-493">Most Azure services have a diagnostics feature that you can use to determine the cause of problems.</span></span>
* <span data-ttu-id="7edbb-494">**Recopilación y almacenamiento**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-494">**Collection and storage**.</span></span> <span data-ttu-id="7edbb-495">Se pueden guardar los datos de instrumentación sin formato en varias ubicaciones y con diversos formatos (por ejemplo, registros de seguimiento de aplicaciones, registros de IIS, contadores de rendimiento).</span><span class="sxs-lookup"><span data-stu-id="7edbb-495">Raw instrumentation data can be held in various locations and with various formats (e.g., application trace logs, IIS logs, performance counters).</span></span> <span data-ttu-id="7edbb-496">Estos orígenes dispares se recopilan, se consolidan y se colocan en un almacenamiento confiable.</span><span class="sxs-lookup"><span data-stu-id="7edbb-496">These disparate sources are collected, consolidated, and put into reliable storage.</span></span>
* <span data-ttu-id="7edbb-497">**Análisis y diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-497">**Analysis and diagnosis**.</span></span> <span data-ttu-id="7edbb-498">Después de consolidar los datos, se pueden analizar para solucionar problemas y proporcionar una visión general del estado de las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="7edbb-498">After the data is consolidated, it can be analyzed to troubleshoot issues and provide an overall view of application health.</span></span>
* <span data-ttu-id="7edbb-499">**Visualización y alertas**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-499">**Visualization and alerts**.</span></span> <span data-ttu-id="7edbb-500">En esta fase, los datos de telemetría se presentan de tal manera que un operador puede detectar rápidamente problemas o tendencias.</span><span class="sxs-lookup"><span data-stu-id="7edbb-500">In this stage, telemetry data is presented in such a way that an operator can quickly notice problems or trends.</span></span> <span data-ttu-id="7edbb-501">En el ejemplo se incluyen paneles o alertas por correo electrónico.</span><span class="sxs-lookup"><span data-stu-id="7edbb-501">Example include dashboards or email alerts.</span></span>  

<span data-ttu-id="7edbb-502">La supervisión no es lo mismo que la detección de errores.</span><span class="sxs-lookup"><span data-stu-id="7edbb-502">Monitoring is not the same as failure detection.</span></span> <span data-ttu-id="7edbb-503">Por ejemplo, la aplicación podría detectar un error transitorio y volver a intentarlo, lo que resultaría en ningún tiempo de inactividad.</span><span class="sxs-lookup"><span data-stu-id="7edbb-503">For example, your application might detect a transient error and retry, resulting in no downtime.</span></span> <span data-ttu-id="7edbb-504">Pero también debe registrar la operación de reintento, para que pueda supervisar la tasa de errores, a fin de obtener una imagen general del estado de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="7edbb-504">But it should also log the retry operation, so that you can monitor the error rate, in order to get an overall picture of application health.</span></span> 

<span data-ttu-id="7edbb-505">Los registros de aplicación constituyen un origen importante de datos de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="7edbb-505">Application logs are an important source of diagnostics data.</span></span> <span data-ttu-id="7edbb-506">Los procedimientos recomendados para el registro de aplicaciones incluyen:</span><span class="sxs-lookup"><span data-stu-id="7edbb-506">Best practices for application logging include:</span></span>

* <span data-ttu-id="7edbb-507">Iniciar sesión en producción.</span><span class="sxs-lookup"><span data-stu-id="7edbb-507">Log in production.</span></span> <span data-ttu-id="7edbb-508">De lo contrario, perderá la perspectiva donde más la necesita.</span><span class="sxs-lookup"><span data-stu-id="7edbb-508">Otherwise, you lose insight where you need it most.</span></span>
* <span data-ttu-id="7edbb-509">Registrar los eventos en los límites del servicio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-509">Log events at service boundaries.</span></span> <span data-ttu-id="7edbb-510">Incluya un identificador de correlación que traspase los límites del servicio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-510">Include a correlation ID that flows across service boundaries.</span></span> <span data-ttu-id="7edbb-511">Si una transacción fluye a través de varios servicios y se produce un error en uno de ellos, el identificador de correlación le ayudará identificar el motivo del error de la transacción.</span><span class="sxs-lookup"><span data-stu-id="7edbb-511">If a transaction flows through multiple services and one of them fails, the correlation ID will help you pinpoint why the transaction failed.</span></span>
* <span data-ttu-id="7edbb-512">Utilizar el registro semántico, también conocido como registro estructurado.</span><span class="sxs-lookup"><span data-stu-id="7edbb-512">Use semantic logging, also known as structured logging.</span></span> <span data-ttu-id="7edbb-513">Los registros no estructurados dificultan la automatización del consumo y el análisis de los datos de registro que se necesitan a escala de nube.</span><span class="sxs-lookup"><span data-stu-id="7edbb-513">Unstructured logs make it hard to automate the consumption and analysis of the log data, which is needed at cloud scale.</span></span>
* <span data-ttu-id="7edbb-514">Usar llamadas asincrónicas.</span><span class="sxs-lookup"><span data-stu-id="7edbb-514">Use asynchronous logging.</span></span> <span data-ttu-id="7edbb-515">De lo contrario, el mismo sistema de registro puede hacer que la aplicación produzca un error causando la copia de seguridad de las solicitudes, ya que se bloquean mientras esperan para escribir un evento de registro.</span><span class="sxs-lookup"><span data-stu-id="7edbb-515">Otherwise, the logging system itself can cause the application to fail by causing requests to back up, as they block while waiting to write a logging event.</span></span>
* <span data-ttu-id="7edbb-516">El registro de aplicaciones no es lo mismo que auditoría.</span><span class="sxs-lookup"><span data-stu-id="7edbb-516">Application logging is not the same as auditing.</span></span> <span data-ttu-id="7edbb-517">La auditoría puede realizarse por motivos de cumplimiento o normativos.</span><span class="sxs-lookup"><span data-stu-id="7edbb-517">Auditing may be done for compliance or regulatory reasons.</span></span> <span data-ttu-id="7edbb-518">Por tanto, los registros de auditoría deben estar completos y no se aconseja quitar ninguno mientras se procesan las transacciones.</span><span class="sxs-lookup"><span data-stu-id="7edbb-518">As such, audit records must be complete, and it's not acceptable to drop any while processing transactions.</span></span> <span data-ttu-id="7edbb-519">Si una aplicación requiere auditoría, esta debe mantenerse separada del registro de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="7edbb-519">If an application requires auditing, this should be kept separate from diagnostics logging.</span></span> 

<span data-ttu-id="7edbb-520">Para más información sobre la supervisión y diagnóstico, consulte la guía [Monitoring and diagnostics][monitoring-guidance] (Supervisión y diagnóstico).</span><span class="sxs-lookup"><span data-stu-id="7edbb-520">For more information about monitoring and diagnostics, see [Monitoring and diagnostics guidance][monitoring-guidance].</span></span>

## <a name="respond-to-failures"></a><span data-ttu-id="7edbb-521">Respuesta a los errores</span><span class="sxs-lookup"><span data-stu-id="7edbb-521">Respond to failures</span></span>
<span data-ttu-id="7edbb-522">Las secciones anteriores se han centrado en las estrategias de recuperación automatizada, que son fundamentales para la alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="7edbb-522">Previous sections have focused on automated recovery strategies, which are critical for high availability.</span></span> <span data-ttu-id="7edbb-523">Sin embargo, a veces es necesaria la intervención manual.</span><span class="sxs-lookup"><span data-stu-id="7edbb-523">However, sometimes manual intervention is needed.</span></span>

* <span data-ttu-id="7edbb-524">**Alertas**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-524">**Alerts**.</span></span> <span data-ttu-id="7edbb-525">Supervise la aplicación para detectar señales de advertencia que puedan requerir una intervención proactiva.</span><span class="sxs-lookup"><span data-stu-id="7edbb-525">Monitor your application for warning signs that may require proactive intervention.</span></span> <span data-ttu-id="7edbb-526">Por ejemplo, si observa que SQL Database o Cosmos DB limitan constantemente la aplicación, es posible que tenga que aumentar la capacidad de la base de datos u optimizar las consultas.</span><span class="sxs-lookup"><span data-stu-id="7edbb-526">For example, if you see that SQL Database or Cosmos DB consistently throttles your application, you might need to increase your database capacity or optimize your queries.</span></span> <span data-ttu-id="7edbb-527">En este ejemplo, aunque la aplicación puede tratar los errores de limitación de forma transparente, la telemetría debería generar una alerta para que se pueda realizar el seguimiento.</span><span class="sxs-lookup"><span data-stu-id="7edbb-527">In this example, even though the application might handle the throttling errors transparently, your telemetry should still raise an alert so that you can follow up.</span></span>  
* <span data-ttu-id="7edbb-528">**Conmutación por error manual**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-528">**Manual failover**.</span></span> <span data-ttu-id="7edbb-529">Algunos sistemas no pueden conmutar por error automáticamente y requieren una conmutación por error manual.</span><span class="sxs-lookup"><span data-stu-id="7edbb-529">Some systems cannot fail over automatically and require a manual failover.</span></span> 
* <span data-ttu-id="7edbb-530">**Pruebas de disponibilidad operativa**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-530">**Operational readiness testing**.</span></span> <span data-ttu-id="7edbb-531">Si la aplicación conmuta por error en una región secundaria, debe realizar una prueba de disponibilidad operativa antes de conmutar por recuperación en la región primaria.</span><span class="sxs-lookup"><span data-stu-id="7edbb-531">If your application fails over to a secondary region, you should perform an operational readiness test before you fail back to the primary region.</span></span> <span data-ttu-id="7edbb-532">La prueba debe comprobar que la región primaria es correcta y que está lista para recibir tráfico de nuevo.</span><span class="sxs-lookup"><span data-stu-id="7edbb-532">The test should verify that the primary region is healthy and ready to receive traffic again.</span></span>
* <span data-ttu-id="7edbb-533">**Comprobación de la coherencia de datos**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-533">**Data consistency check**.</span></span> <span data-ttu-id="7edbb-534">Si se produce un error en un almacén de datos, puede haber incoherencias de datos cuando el almacén vuelve a estar disponible, especialmente si los datos se han replicado.</span><span class="sxs-lookup"><span data-stu-id="7edbb-534">If a failure happens in a data store, there may be data inconsistencies when the store becomes available again, especially if the data was replicated.</span></span> 
* <span data-ttu-id="7edbb-535">**Restauración desde la copia de seguridad**.</span><span class="sxs-lookup"><span data-stu-id="7edbb-535">**Restoring from backup**.</span></span> <span data-ttu-id="7edbb-536">Por ejemplo, si SQL Database experimenta una interrupción regional, puede realizar una restauración geográfica de la base de datos desde la última copia de seguridad.</span><span class="sxs-lookup"><span data-stu-id="7edbb-536">For example, if SQL Database experiences a regional outage, you can geo-restore the database from the latest backup.</span></span>

<span data-ttu-id="7edbb-537">Documente y pruebe el plan de recuperación ante desastres.</span><span class="sxs-lookup"><span data-stu-id="7edbb-537">Document and test your disaster recovery plan.</span></span> <span data-ttu-id="7edbb-538">Evalúe el impacto de negocio de los errores de las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="7edbb-538">Evaluate the business impact of application failures.</span></span> <span data-ttu-id="7edbb-539">Automatice el proceso en la medida de lo posible y documente todos los pasos manuales, como la conmutación por error manual o la restauración de datos de las copias de seguridad.</span><span class="sxs-lookup"><span data-stu-id="7edbb-539">Automate the process as much as possible, and document any manual steps, such as manual failover or data restoration from backups.</span></span> <span data-ttu-id="7edbb-540">Pruebe regularmente el proceso de recuperación ante desastres para validar y mejorar el plan.</span><span class="sxs-lookup"><span data-stu-id="7edbb-540">Regularly test your disaster recovery process to validate and improve the plan.</span></span> 

## <a name="summary"></a><span data-ttu-id="7edbb-541">Resumen</span><span class="sxs-lookup"><span data-stu-id="7edbb-541">Summary</span></span>
<span data-ttu-id="7edbb-542">En este artículo se ha descrito la resistencia desde una perspectiva holística, haciendo hincapié en algunos de los desafíos únicos de la nube.</span><span class="sxs-lookup"><span data-stu-id="7edbb-542">This article discussed resiliency from a holistic perspective, emphasizing some of the unique challenges of the cloud.</span></span> <span data-ttu-id="7edbb-543">Estos incluyen la naturaleza distribuida de la informática en la nube, el uso de hardware básico y la presencia de errores transitorios en la red.</span><span class="sxs-lookup"><span data-stu-id="7edbb-543">These include the distributed nature of cloud computing, the use of commodity hardware, and the presence of transient network faults.</span></span>

<span data-ttu-id="7edbb-544">Estos son los puntos principales que se pueden extraer de este artículo:</span><span class="sxs-lookup"><span data-stu-id="7edbb-544">Here are the major points to take away from this article:</span></span>

* <span data-ttu-id="7edbb-545">La resistencia conduce a una mayor disponibilidad y a un menor tiempo medio para recuperarse de los errores.</span><span class="sxs-lookup"><span data-stu-id="7edbb-545">Resiliency leads to higher availability, and lower mean time to recover from failures.</span></span> 
* <span data-ttu-id="7edbb-546">Alcanzar la resistencia en la nube requiere un conjunto de técnicas diferentes a las soluciones locales tradicionales.</span><span class="sxs-lookup"><span data-stu-id="7edbb-546">Achieving resiliency in the cloud requires a different set of techniques from traditional on-premises solutions.</span></span> 
* <span data-ttu-id="7edbb-547">La resistencia no ocurre por accidente.</span><span class="sxs-lookup"><span data-stu-id="7edbb-547">Resiliency does not happen by accident.</span></span> <span data-ttu-id="7edbb-548">Debe diseñarse e integrarse desde el principio.</span><span class="sxs-lookup"><span data-stu-id="7edbb-548">It must be designed and built in from the start.</span></span>
* <span data-ttu-id="7edbb-549">La resistencia afecta a las partes de la vigencia de la aplicación, desde el planeamiento y codificación a las operaciones.</span><span class="sxs-lookup"><span data-stu-id="7edbb-549">Resiliency touches every part of the application lifecycle, from planning and coding to operations.</span></span>
* <span data-ttu-id="7edbb-550">¡Pruebe y supervise!</span><span class="sxs-lookup"><span data-stu-id="7edbb-550">Test and monitor!</span></span>


<!-- links -->

[blue-green]: https://martinfowler.com/bliki/BlueGreenDeployment.html
[canary-release]: https://martinfowler.com/bliki/CanaryRelease.html
[circuit-breaker-pattern]: https://msdn.microsoft.com/library/dn589784.aspx
[compensating-transaction-pattern]: https://msdn.microsoft.com/library/dn589804.aspx
[containers]: https://en.wikipedia.org/wiki/Operating-system-level_virtualization
[dsc]: /azure/automation/automation-dsc-overview
[contingency-planning-guide]: https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-34r1.pdf
[fma]: failure-mode-analysis.md
[hystrix]: https://medium.com/netflix-techblog/introducing-hystrix-for-resilience-engineering-13531c1ab362
[jmeter]: https://jmeter.apache.org/
[load-leveling-pattern]: ../patterns/queue-based-load-leveling.md
[monitoring-guidance]: ../best-practices/monitoring.md
[ra-basic-web]: ../reference-architectures/app-service-web-app/basic-web-app.md
[ra-multi-vm]: ../reference-architectures/virtual-machines-windows/multi-vm.md
[checklist]: ../checklist/resiliency.md
[retry-pattern]: ../patterns/retry.md
[retry-service-specific guidance]: ../best-practices/retry-service-specific.md
[sla]: https://azure.microsoft.com/support/legal/sla/
[throttling-pattern]: ../patterns/throttling.md
[tm]: https://azure.microsoft.com/services/traffic-manager/
[tm-failover]: /azure/traffic-manager/traffic-manager-monitoring
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager
