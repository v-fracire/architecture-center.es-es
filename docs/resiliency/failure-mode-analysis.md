---
title: Análisis del modo de error
description: Directrices para llevar a cabo un análisis del modo de error para soluciones en la nube basadas en Azure.
author: MikeWasson
ms.date: 05/07/2018
ms.custom: resiliency
pnp.series.title: Design for Resiliency
ms.openlocfilehash: c9a875de7807b50ee1efcd4b1c0b16357cd87f11
ms.sourcegitcommit: dbbf914757b03cdee7a274204f9579fa63d7eed2
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/02/2018
ms.locfileid: "50916641"
---
# <a name="failure-mode-analysis"></a><span data-ttu-id="b2815-103">Análisis del modo de error</span><span class="sxs-lookup"><span data-stu-id="b2815-103">Failure mode analysis</span></span>
[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="b2815-104">El análisis del modo de error (FMA) es un proceso de creación de resistencia en un sistema mediante la identificación de posibles puntos de error en el sistema.</span><span class="sxs-lookup"><span data-stu-id="b2815-104">Failure mode analysis (FMA) is a process for building resiliency into a system, by identifying possible failure points in the system.</span></span> <span data-ttu-id="b2815-105">El FMA debe formar parte de las fases de diseño y arquitectura, de modo que pueda generar una recuperación de errores en el sistema desde el principio.</span><span class="sxs-lookup"><span data-stu-id="b2815-105">The FMA should be part of the architecture and design phases, so that you can build failure recovery into the system from the beginning.</span></span>

<span data-ttu-id="b2815-106">Este es el proceso general para realizar un FMA:</span><span class="sxs-lookup"><span data-stu-id="b2815-106">Here is the general process to conduct an FMA:</span></span>

1. <span data-ttu-id="b2815-107">Identifique todos los componentes del sistema.</span><span class="sxs-lookup"><span data-stu-id="b2815-107">Identify all of the components in the system.</span></span> <span data-ttu-id="b2815-108">Incluya dependencias externas, como proveedores de identidades, servicios de terceros, etc.</span><span class="sxs-lookup"><span data-stu-id="b2815-108">Include external dependencies, such as as identity providers, third-party services, and so on.</span></span>   
2. <span data-ttu-id="b2815-109">Para cada componente, identifique los posibles errores que se puedan producir.</span><span class="sxs-lookup"><span data-stu-id="b2815-109">For each component, identify potential failures that could occur.</span></span> <span data-ttu-id="b2815-110">Un único componente puede tener más de un modo de error.</span><span class="sxs-lookup"><span data-stu-id="b2815-110">A single component may have more than one failure mode.</span></span> <span data-ttu-id="b2815-111">Por ejemplo, debería considerar los errores de lectura y escritura por separado porque el impacto y las posibles mitigaciones serán diferentes.</span><span class="sxs-lookup"><span data-stu-id="b2815-111">For example, you should consider read failures and write failures separately, because the impact and possible mitigations will be different.</span></span>
3. <span data-ttu-id="b2815-112">Clasifique por orden de prioridad cada modo de error según su riesgo general.</span><span class="sxs-lookup"><span data-stu-id="b2815-112">Rate each failure mode according to its overall risk.</span></span> <span data-ttu-id="b2815-113">Tenga en cuenta estos factores:</span><span class="sxs-lookup"><span data-stu-id="b2815-113">Consider these factors:</span></span>  

   * <span data-ttu-id="b2815-114">Cuál es la probabilidad de que se produzca el error.</span><span class="sxs-lookup"><span data-stu-id="b2815-114">What is the likelihood of the failure.</span></span> <span data-ttu-id="b2815-115">¿Es relativamente frecuente?</span><span class="sxs-lookup"><span data-stu-id="b2815-115">Is it relatively common?</span></span> <span data-ttu-id="b2815-116">¿Sumamente raro?</span><span class="sxs-lookup"><span data-stu-id="b2815-116">Extrememly rare?</span></span> <span data-ttu-id="b2815-117">No necesita números exactos, ya que la finalidad es realizar una clasificación por orden de prioridad.</span><span class="sxs-lookup"><span data-stu-id="b2815-117">You don't need exact numbers; the purpose is to help rank the priority.</span></span>
   * <span data-ttu-id="b2815-118">¿Cuál es el impacto en la aplicación, en términos de disponibilidad, pérdida de datos, costo económico e interrupción de la actividad comercial?</span><span class="sxs-lookup"><span data-stu-id="b2815-118">What is the impact on the application, in terms of availability, data loss, monetary cost, and business disruption?</span></span>
4. <span data-ttu-id="b2815-119">Para cada modo de error, determine cómo responderá y se recuperará la aplicación.</span><span class="sxs-lookup"><span data-stu-id="b2815-119">For each failure mode, determine how the application will respond and recover.</span></span> <span data-ttu-id="b2815-120">Tenga en cuenta los inconvenientes en lo relativo al costo y a la complejidad de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="b2815-120">Consider tradeoffs in cost and application complexity.</span></span>   

<span data-ttu-id="b2815-121">Como punto de partida para el proceso FMA, este artículo contiene un catálogo de los posibles modos de error y sus mitigaciones.</span><span class="sxs-lookup"><span data-stu-id="b2815-121">As a starting point for your FMA process, this article contains a catalog of potential failure modes and their mitigations.</span></span> <span data-ttu-id="b2815-122">El catálogo está organizado por tecnología o servicio de Azure, además de una categoría general para el diseño en el nivel de aplicación.</span><span class="sxs-lookup"><span data-stu-id="b2815-122">The catalog is organized by technology or Azure service, plus a general category for application-level design.</span></span> <span data-ttu-id="b2815-123">El catálogo no es exhaustivo pero abarca muchos de los principales servicios de Azure.</span><span class="sxs-lookup"><span data-stu-id="b2815-123">The catalog is not exhaustive, but covers many of the core Azure services.</span></span>

## <a name="app-service"></a><span data-ttu-id="b2815-124">App Service</span><span class="sxs-lookup"><span data-stu-id="b2815-124">App Service</span></span>
### <a name="app-service-app-shuts-down"></a><span data-ttu-id="b2815-125">La aplicación de App Service se cierra.</span><span class="sxs-lookup"><span data-stu-id="b2815-125">App Service app shuts down.</span></span>
<span data-ttu-id="b2815-126">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-126">**Detection**.</span></span> <span data-ttu-id="b2815-127">Causas posibles:</span><span class="sxs-lookup"><span data-stu-id="b2815-127">Possible causes:</span></span>

* <span data-ttu-id="b2815-128">Cierre esperado</span><span class="sxs-lookup"><span data-stu-id="b2815-128">Expected shutdown</span></span>

  * <span data-ttu-id="b2815-129">Un operador cierra la aplicación; por ejemplo, mediante Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="b2815-129">An operator shuts down the application; for example, using the Azure portal.</span></span>
  * <span data-ttu-id="b2815-130">La aplicación se ha descargado porque estaba inactiva.</span><span class="sxs-lookup"><span data-stu-id="b2815-130">The app was unloaded because it was idle.</span></span> <span data-ttu-id="b2815-131">(Solo si el valor `Always On` está deshabilitado).</span><span class="sxs-lookup"><span data-stu-id="b2815-131">(Only if the `Always On` setting is disabled.)</span></span>
* <span data-ttu-id="b2815-132">Cierre inesperado</span><span class="sxs-lookup"><span data-stu-id="b2815-132">Unexpected shutdown</span></span>

  * <span data-ttu-id="b2815-133">La aplicación se bloquea.</span><span class="sxs-lookup"><span data-stu-id="b2815-133">The app crashes.</span></span>
  * <span data-ttu-id="b2815-134">Una instancia de la máquina virtual de App Service deja de estar disponible.</span><span class="sxs-lookup"><span data-stu-id="b2815-134">An App Service VM instance becomes unavailable.</span></span>

<span data-ttu-id="b2815-135">El registro Application_End detectará el cierre del dominio de aplicación (bloqueo del proceso de software) que es la única manera de detectar los cierres del dominio de aplicación.</span><span class="sxs-lookup"><span data-stu-id="b2815-135">Application_End logging will catch the app domain shutdown (soft process crash) and is the only way to catch the application domain shutdowns.</span></span>

<span data-ttu-id="b2815-136">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-136">**Recovery**</span></span>

* <span data-ttu-id="b2815-137">Si se trata de un cierre esperado, utilice el evento de cierre de la aplicación para cerrarla correctamente.</span><span class="sxs-lookup"><span data-stu-id="b2815-137">If the shutdown was expected, use the application's shutdown event to shut down gracefully.</span></span> <span data-ttu-id="b2815-138">Por ejemplo, en ASP.NET, utilice el método `Application_End`.</span><span class="sxs-lookup"><span data-stu-id="b2815-138">For example, in ASP.NET, use the `Application_End` method.</span></span>
* <span data-ttu-id="b2815-139">Si la aplicación se ha descargado mientras estaba inactiva, se reiniciará automáticamente en la siguiente solicitud.</span><span class="sxs-lookup"><span data-stu-id="b2815-139">If the application was unloaded while idle, it is automatically restarted on the next request.</span></span> <span data-ttu-id="b2815-140">No obstante, incurrirá en el costo de "arranque en frío".</span><span class="sxs-lookup"><span data-stu-id="b2815-140">However, you will incur the "cold start" cost.</span></span>
* <span data-ttu-id="b2815-141">Para evitar que la aplicación se descargue mientras está inactiva, habilite el valor `Always On` en la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="b2815-141">To prevent the application from being unloaded while idle, enable the `Always On` setting in the web app.</span></span> <span data-ttu-id="b2815-142">Consulte [Configuración de aplicaciones web en Azure App Service][app-service-configure].</span><span class="sxs-lookup"><span data-stu-id="b2815-142">See [Configure web apps in Azure App Service][app-service-configure].</span></span>
* <span data-ttu-id="b2815-143">Para evitar que un operador cierre la aplicación, establezca un bloqueo de recurso con el nivel `ReadOnly`.</span><span class="sxs-lookup"><span data-stu-id="b2815-143">To prevent an operator from shutting down the app, set a resource lock with `ReadOnly` level.</span></span> <span data-ttu-id="b2815-144">Consulte [Bloqueo de recursos con Azure Resource Manager][rm-locks].</span><span class="sxs-lookup"><span data-stu-id="b2815-144">See [Lock resources with Azure Resource Manager][rm-locks].</span></span>
* <span data-ttu-id="b2815-145">Si la aplicación se bloquea o una máquina virtual de App Service deja de estar disponible, App Service reinicia automáticamente la aplicación.</span><span class="sxs-lookup"><span data-stu-id="b2815-145">If the app crashes or an App Service VM becomes unavailable, App Service automatically restarts the app.</span></span>

<span data-ttu-id="b2815-146">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-146">**Diagnostics**.</span></span> <span data-ttu-id="b2815-147">Registros de aplicaciones y registros de servidor web.</span><span class="sxs-lookup"><span data-stu-id="b2815-147">Application logs and web server logs.</span></span> <span data-ttu-id="b2815-148">Consulte [Habilitación del registro de diagnóstico para aplicaciones web en Azure App Service][app-service-logging].</span><span class="sxs-lookup"><span data-stu-id="b2815-148">See [Enable diagnostics logging for web apps in Azure App Service][app-service-logging].</span></span>

### <a name="a-particular-user-repeatedly-makes-bad-requests-or-overloads-the-system"></a><span data-ttu-id="b2815-149">Un usuario determinado realiza repetidamente solicitudes incorrectas o sobrecarga el sistema.</span><span class="sxs-lookup"><span data-stu-id="b2815-149">A particular user repeatedly makes bad requests or overloads the system.</span></span>
<span data-ttu-id="b2815-150">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-150">**Detection**.</span></span> <span data-ttu-id="b2815-151">Autentique los usuarios e incluya los identificadores de usuario en los registros de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="b2815-151">Authenticate users and include user ID in application logs.</span></span>

<span data-ttu-id="b2815-152">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-152">**Recovery**</span></span>

* <span data-ttu-id="b2815-153">Use [Azure API Management][api-management] para limitar las solicitudes del usuario.</span><span class="sxs-lookup"><span data-stu-id="b2815-153">Use [Azure API Management][api-management] to throttle requests from the user.</span></span> <span data-ttu-id="b2815-154">Consulte [Limitación avanzada de solicitudes con Azure API Management][api-management-throttling]</span><span class="sxs-lookup"><span data-stu-id="b2815-154">See [Advanced request throttling with Azure API Management][api-management-throttling]</span></span>
* <span data-ttu-id="b2815-155">Bloquee el usuario.</span><span class="sxs-lookup"><span data-stu-id="b2815-155">Block the user.</span></span>

<span data-ttu-id="b2815-156">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-156">**Diagnostics**.</span></span> <span data-ttu-id="b2815-157">Registre todas las solicitudes de autenticación.</span><span class="sxs-lookup"><span data-stu-id="b2815-157">Log all authentication requests.</span></span>

### <a name="a-bad-update-was-deployed"></a><span data-ttu-id="b2815-158">Se implementó una actualización incorrecta.</span><span class="sxs-lookup"><span data-stu-id="b2815-158">A bad update was deployed.</span></span>
<span data-ttu-id="b2815-159">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-159">**Detection**.</span></span> <span data-ttu-id="b2815-160">Supervise el mantenimiento de la aplicación mediante Azure Portal (consulte [Supervisión del rendimiento de Azure Web App][app-insights-web-apps]) o bien implemente el [patrón de supervisión de puntos de conexión de mantenimiento][health-endpoint-monitoring-pattern].</span><span class="sxs-lookup"><span data-stu-id="b2815-160">Monitor the application health through the Azure Portal (see [Monitor Azure web app performance][app-insights-web-apps]) or implement the [health endpoint monitoring pattern][health-endpoint-monitoring-pattern].</span></span>

<span data-ttu-id="b2815-161">**Recuperación**.</span><span class="sxs-lookup"><span data-stu-id="b2815-161">**Recovery**.</span></span> <span data-ttu-id="b2815-162">Utilice varias [ranuras de implementación][app-service-slots] y revierta a la última implementación correcta conocida.</span><span class="sxs-lookup"><span data-stu-id="b2815-162">Use multiple [deployment slots][app-service-slots] and roll back to the last-known-good deployment.</span></span> <span data-ttu-id="b2815-163">Para más información, consulte [Basic web application][ra-web-apps-basic] (Aplicación web básica).///</span><span class="sxs-lookup"><span data-stu-id="b2815-163">For more information, see [Basic web application][ra-web-apps-basic].</span></span>

## <a name="azure-active-directory"></a><span data-ttu-id="b2815-164">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="b2815-164">Azure Active Directory</span></span>
### <a name="openid-connect-oidc-authentication-fails"></a><span data-ttu-id="b2815-165">Se produce un error en la autenticación de OpenID Connect (OIDC).</span><span class="sxs-lookup"><span data-stu-id="b2815-165">OpenID Connect (OIDC) authentication fails.</span></span>
<span data-ttu-id="b2815-166">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-166">**Detection**.</span></span> <span data-ttu-id="b2815-167">Los posibles modos de error son:</span><span class="sxs-lookup"><span data-stu-id="b2815-167">Possible failure modes include:</span></span>

1. <span data-ttu-id="b2815-168">Azure AD no está disponible o no está accesible debido a un problema de red.</span><span class="sxs-lookup"><span data-stu-id="b2815-168">Azure AD is not available, or cannot be reached due to a network problem.</span></span> <span data-ttu-id="b2815-169">Se produce un error en el redireccionamiento al punto de conexión de autenticación y el middleware OIDC genera una excepción.</span><span class="sxs-lookup"><span data-stu-id="b2815-169">Redirection to the authentication endpoint fails, and the OIDC middleware throws an exception.</span></span>
2. <span data-ttu-id="b2815-170">El inquilino de Azure AD no existe.</span><span class="sxs-lookup"><span data-stu-id="b2815-170">Azure AD tenant does not exist.</span></span> <span data-ttu-id="b2815-171">El redireccionamiento al punto de conexión de autenticación devuelve un código de error HTTP y el middleware OIDC genera una excepción.</span><span class="sxs-lookup"><span data-stu-id="b2815-171">Redirection to the authentication endpoint returns an HTTP error code, and the OIDC middleware throws an exception.</span></span>
3. <span data-ttu-id="b2815-172">El usuario no se puede autenticar.</span><span class="sxs-lookup"><span data-stu-id="b2815-172">User cannot authenticate.</span></span> <span data-ttu-id="b2815-173">No es necesaria ninguna estrategia de detección; Azure AD controla los errores de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="b2815-173">No detection strategy is necessary; Azure AD handles login failures.</span></span>

<span data-ttu-id="b2815-174">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-174">**Recovery**</span></span>

1. <span data-ttu-id="b2815-175">Detecte las excepciones no controladas en el middleware.</span><span class="sxs-lookup"><span data-stu-id="b2815-175">Catch unhandled exceptions from the middleware.</span></span>
2. <span data-ttu-id="b2815-176">Controle eventos `AuthenticationFailed`.</span><span class="sxs-lookup"><span data-stu-id="b2815-176">Handle `AuthenticationFailed` events.</span></span>
3. <span data-ttu-id="b2815-177">Redireccione al usuario a una página de error.</span><span class="sxs-lookup"><span data-stu-id="b2815-177">Redirect the user to an error page.</span></span>
4. <span data-ttu-id="b2815-178">El usuario lo reintenta.</span><span class="sxs-lookup"><span data-stu-id="b2815-178">User retries.</span></span>

## <a name="azure-search"></a><span data-ttu-id="b2815-179">Azure Search</span><span class="sxs-lookup"><span data-stu-id="b2815-179">Azure Search</span></span>
### <a name="writing-data-to-azure-search-fails"></a><span data-ttu-id="b2815-180">Se produce un error al escribir datos en Azure Search.</span><span class="sxs-lookup"><span data-stu-id="b2815-180">Writing data to Azure Search fails.</span></span>
<span data-ttu-id="b2815-181">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-181">**Detection**.</span></span> <span data-ttu-id="b2815-182">Detecte errores `Microsoft.Rest.Azure.CloudException`.</span><span class="sxs-lookup"><span data-stu-id="b2815-182">Catch `Microsoft.Rest.Azure.CloudException` errors.</span></span>

<span data-ttu-id="b2815-183">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-183">**Recovery**</span></span>

<span data-ttu-id="b2815-184">El [SDK de .NET de Search][search-sdk] realiza reintentos automáticamente después de los errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="b2815-184">The [Search .NET SDK][search-sdk] automatically retries after transient failures.</span></span> <span data-ttu-id="b2815-185">Las excepciones producidas por el cliente SDK deben tratarse como errores no transitorios.</span><span class="sxs-lookup"><span data-stu-id="b2815-185">Any exceptions thrown by the client SDK should be treated as non-transient errors.</span></span>

<span data-ttu-id="b2815-186">La directiva de reintentos predeterminada usa la interrupción exponencial.</span><span class="sxs-lookup"><span data-stu-id="b2815-186">The default retry policy uses exponential back-off.</span></span> <span data-ttu-id="b2815-187">Para utilizar una directiva de reintentos diferente, llame a `SetRetryPolicy` en la clase `SearchIndexClient` o `SearchServiceClient`.</span><span class="sxs-lookup"><span data-stu-id="b2815-187">To use a different retry policy, call `SetRetryPolicy` on the `SearchIndexClient` or `SearchServiceClient` class.</span></span> <span data-ttu-id="b2815-188">Para más información, consulte el artículo sobre [reintentos automáticos][auto-rest-client-retry].</span><span class="sxs-lookup"><span data-stu-id="b2815-188">For more information, see [Automatic Retries][auto-rest-client-retry].</span></span>

<span data-ttu-id="b2815-189">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-189">**Diagnostics**.</span></span> <span data-ttu-id="b2815-190">Utilice [Search Traffic Analytics][search-analytics] (Análisis del tráfico de búsqueda).///</span><span class="sxs-lookup"><span data-stu-id="b2815-190">Use [Search Traffic Analytics][search-analytics].</span></span>

### <a name="reading-data-from-azure-search-fails"></a><span data-ttu-id="b2815-191">Se produce un error al leer datos de Azure Search.</span><span class="sxs-lookup"><span data-stu-id="b2815-191">Reading data from Azure Search fails.</span></span>
<span data-ttu-id="b2815-192">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-192">**Detection**.</span></span> <span data-ttu-id="b2815-193">Detecte errores `Microsoft.Rest.Azure.CloudException`.</span><span class="sxs-lookup"><span data-stu-id="b2815-193">Catch `Microsoft.Rest.Azure.CloudException` errors.</span></span>

<span data-ttu-id="b2815-194">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-194">**Recovery**</span></span>

<span data-ttu-id="b2815-195">El [SDK de .NET de Search][search-sdk] realiza reintentos automáticamente después de los errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="b2815-195">The [Search .NET SDK][search-sdk]  automatically retries after transient failures.</span></span> <span data-ttu-id="b2815-196">Las excepciones producidas por el cliente SDK deben tratarse como errores no transitorios.</span><span class="sxs-lookup"><span data-stu-id="b2815-196">Any exceptions thrown by the client SDK should be treated as non-transient errors.</span></span>

<span data-ttu-id="b2815-197">La directiva de reintentos predeterminada usa la interrupción exponencial.</span><span class="sxs-lookup"><span data-stu-id="b2815-197">The default retry policy uses exponential back-off.</span></span> <span data-ttu-id="b2815-198">Para utilizar una directiva de reintentos diferente, llame a `SetRetryPolicy` en la clase `SearchIndexClient` o `SearchServiceClient`.</span><span class="sxs-lookup"><span data-stu-id="b2815-198">To use a different retry policy, call `SetRetryPolicy` on the `SearchIndexClient` or `SearchServiceClient` class.</span></span> <span data-ttu-id="b2815-199">Para más información, consulte el artículo sobre [reintentos automáticos][auto-rest-client-retry].</span><span class="sxs-lookup"><span data-stu-id="b2815-199">For more information, see [Automatic Retries][auto-rest-client-retry].</span></span>

<span data-ttu-id="b2815-200">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-200">**Diagnostics**.</span></span> <span data-ttu-id="b2815-201">Utilice [Search Traffic Analytics][search-analytics] (Análisis del tráfico de búsqueda).///</span><span class="sxs-lookup"><span data-stu-id="b2815-201">Use [Search Traffic Analytics][search-analytics].</span></span>

## <a name="cassandra"></a><span data-ttu-id="b2815-202">Cassandra</span><span class="sxs-lookup"><span data-stu-id="b2815-202">Cassandra</span></span>
### <a name="reading-or-writing-to-a-node-fails"></a><span data-ttu-id="b2815-203">Se produce un error al leer o escribir en un nodo.</span><span class="sxs-lookup"><span data-stu-id="b2815-203">Reading or writing to a node fails.</span></span>
<span data-ttu-id="b2815-204">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-204">**Detection**.</span></span> <span data-ttu-id="b2815-205">Detecte la excepción.</span><span class="sxs-lookup"><span data-stu-id="b2815-205">Catch the exception.</span></span> <span data-ttu-id="b2815-206">Para clientes. NET, suele ser `System.Web.HttpException`.</span><span class="sxs-lookup"><span data-stu-id="b2815-206">For .NET clients, this will typically be `System.Web.HttpException`.</span></span> <span data-ttu-id="b2815-207">Otros clientes pueden tener otros tipos de excepción.</span><span class="sxs-lookup"><span data-stu-id="b2815-207">Other client may have other exception types.</span></span>  <span data-ttu-id="b2815-208">Para más información, consulte [Cassandra error handling done right](https://www.datastax.com/dev/blog/cassandra-error-handling-done-right) (Correcto control de errores en Cassandra).</span><span class="sxs-lookup"><span data-stu-id="b2815-208">For more information, see [Cassandra error handling done right](https://www.datastax.com/dev/blog/cassandra-error-handling-done-right).</span></span>

<span data-ttu-id="b2815-209">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-209">**Recovery**</span></span>

* <span data-ttu-id="b2815-210">Cada [cliente de Cassandra](https://wiki.apache.org/cassandra/ClientOptions) tiene sus propias directivas y funcionalidades de reintento.</span><span class="sxs-lookup"><span data-stu-id="b2815-210">Each [Cassandra client](https://wiki.apache.org/cassandra/ClientOptions) has its own retry policies and capabilities.</span></span> <span data-ttu-id="b2815-211">Para más información, consulte [Cassandra error handling done right][cassandra-error-handling] (Correcto control de errores en Cassandra).</span><span class="sxs-lookup"><span data-stu-id="b2815-211">For more information, see [Cassandra error handling done right][cassandra-error-handling].</span></span>
* <span data-ttu-id="b2815-212">Use una implementación en modo compatible con bastidor, con nodos de datos distribuidos a través de los dominios de error.</span><span class="sxs-lookup"><span data-stu-id="b2815-212">Use a rack-aware deployment, with data nodes distributed across the fault domains.</span></span>
* <span data-ttu-id="b2815-213">Implemente en varias regiones con coherencia de cuórum local.</span><span class="sxs-lookup"><span data-stu-id="b2815-213">Deploy to multiple regions with local quorum consistency.</span></span> <span data-ttu-id="b2815-214">Si se produce un error no transitorio, conmute por error a otra región.</span><span class="sxs-lookup"><span data-stu-id="b2815-214">If a non-transient failure occurs, fail over to another region.</span></span>

<span data-ttu-id="b2815-215">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-215">**Diagnostics**.</span></span> <span data-ttu-id="b2815-216">Registros de aplicación</span><span class="sxs-lookup"><span data-stu-id="b2815-216">Application logs</span></span>

## <a name="cloud-service"></a><span data-ttu-id="b2815-217">Servicio en la nube</span><span class="sxs-lookup"><span data-stu-id="b2815-217">Cloud Service</span></span>
### <a name="web-or-worker-roles-are-unexpectedlybeing-shut-down"></a><span data-ttu-id="b2815-218">Los roles web o de trabajo se cierran inesperadamente.</span><span class="sxs-lookup"><span data-stu-id="b2815-218">Web or worker roles are unexpectedly being shut down.</span></span>
<span data-ttu-id="b2815-219">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-219">**Detection**.</span></span> <span data-ttu-id="b2815-220">Se desencadena el evento [RoleEnvironment.Stopping][RoleEnvironment.Stopping].</span><span class="sxs-lookup"><span data-stu-id="b2815-220">The [RoleEnvironment.Stopping][RoleEnvironment.Stopping] event is fired.</span></span>

<span data-ttu-id="b2815-221"><strong>Recuperación</strong>.</span><span class="sxs-lookup"><span data-stu-id="b2815-221"><strong>Recovery</strong>.</span></span> <span data-ttu-id="b2815-222">Invalide el método [RoleEntryPoint.OnStop][RoleEntryPoint.OnStop] para limpiar correctamente.</span><span class="sxs-lookup"><span data-stu-id="b2815-222">Override the [RoleEntryPoint.OnStop][RoleEntryPoint.OnStop] method to gracefully clean up.</span></span> <span data-ttu-id="b2815-223">Para más información, consulte [The Right Way to Handle Azure OnStop Events][onstop-events] (Modo correcto de controlar eventos OnStop de Azure)/// (blog).</span><span class="sxs-lookup"><span data-stu-id="b2815-223">For more information, see [The Right Way to Handle Azure OnStop Events][onstop-events] (blog).</span></span>

## <a name="cosmos-db"></a><span data-ttu-id="b2815-224">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="b2815-224">Cosmos DB</span></span> 
### <a name="reading-data-fails"></a><span data-ttu-id="b2815-225">Se produce un error en la lectura de datos.</span><span class="sxs-lookup"><span data-stu-id="b2815-225">Reading data fails.</span></span>
<span data-ttu-id="b2815-226">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-226">**Detection**.</span></span> <span data-ttu-id="b2815-227">Detecte `System.Net.Http.HttpRequestException` o `Microsoft.Azure.Documents.DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="b2815-227">Catch `System.Net.Http.HttpRequestException` or `Microsoft.Azure.Documents.DocumentClientException`.</span></span>

<span data-ttu-id="b2815-228">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-228">**Recovery**</span></span>

* <span data-ttu-id="b2815-229">El SDK vuelve a ejecutar automáticamente los intentos erróneos.</span><span class="sxs-lookup"><span data-stu-id="b2815-229">The SDK automatically retries failed attempts.</span></span> <span data-ttu-id="b2815-230">Para establecer el número de reintentos y el tiempo de espera máximo, configure `ConnectionPolicy.RetryOptions`.</span><span class="sxs-lookup"><span data-stu-id="b2815-230">To set the number of retries and the maximum wait time, configure `ConnectionPolicy.RetryOptions`.</span></span> <span data-ttu-id="b2815-231">Las excepciones que genera el cliente se encuentran más allá de la directiva de reintentos o no son errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="b2815-231">Exceptions that the client raises are either beyond the retry policy or are not transient errors.</span></span>
* <span data-ttu-id="b2815-232">Si Cosmos DB limita el cliente, devuelve un error HTTP 429.</span><span class="sxs-lookup"><span data-stu-id="b2815-232">If Cosmos DB throttles the client, it returns an HTTP 429 error.</span></span> <span data-ttu-id="b2815-233">Compruebe el código de estado en `DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="b2815-233">Check the status code in the `DocumentClientException`.</span></span> <span data-ttu-id="b2815-234">Si recibe el error 429 constantemente, considere la posibilidad de aumentar el valor de rendimiento de la colección.</span><span class="sxs-lookup"><span data-stu-id="b2815-234">If you are getting error 429 consistently, consider increasing the throughput value of the collection.</span></span>
    * <span data-ttu-id="b2815-235">Si está utilizando la API de MongoDB, el servicio devuelve el código de error 16500 durante la limitación.</span><span class="sxs-lookup"><span data-stu-id="b2815-235">If you are using the MongoDB API, the service returns error code 16500 when throttling.</span></span>
* <span data-ttu-id="b2815-236">Replique la base de datos de Cosmos DB en dos o más regiones.</span><span class="sxs-lookup"><span data-stu-id="b2815-236">Replicate the Cosmos DB database across two or more regions.</span></span> <span data-ttu-id="b2815-237">Todas las réplicas son legibles.</span><span class="sxs-lookup"><span data-stu-id="b2815-237">All replicas are readable.</span></span> <span data-ttu-id="b2815-238">Con los SDK de cliente, especifique el parámetro `PreferredLocations`.</span><span class="sxs-lookup"><span data-stu-id="b2815-238">Using the client SDKs, specify the `PreferredLocations` parameter.</span></span> <span data-ttu-id="b2815-239">Se trata de una lista ordenada de las regiones de Azure.</span><span class="sxs-lookup"><span data-stu-id="b2815-239">This is an ordered list of Azure regions.</span></span> <span data-ttu-id="b2815-240">Todas las lecturas se enviarán a la primera región disponible en la lista.</span><span class="sxs-lookup"><span data-stu-id="b2815-240">All reads will be sent to the first available region in the list.</span></span> <span data-ttu-id="b2815-241">Si se produce un error en la solicitud, el cliente intentará las demás regiones en la lista, en orden.</span><span class="sxs-lookup"><span data-stu-id="b2815-241">If the request fails, the client will try the other regions in the list, in order.</span></span> <span data-ttu-id="b2815-242">Para más información, consulte [Configuración de la distribución global de Azure Cosmos DB con la API de SQL][cosmosdb-multi-region].</span><span class="sxs-lookup"><span data-stu-id="b2815-242">For more information, see [How to setup Azure Cosmos DB global distribution using the SQL API][cosmosdb-multi-region].</span></span>

<span data-ttu-id="b2815-243">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-243">**Diagnostics**.</span></span> <span data-ttu-id="b2815-244">Registre todos los errores en el lado cliente.</span><span class="sxs-lookup"><span data-stu-id="b2815-244">Log all errors on the client side.</span></span>

### <a name="writing-data-fails"></a><span data-ttu-id="b2815-245">Se produce un error en la escritura de datos.</span><span class="sxs-lookup"><span data-stu-id="b2815-245">Writing data fails.</span></span>
<span data-ttu-id="b2815-246">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-246">**Detection**.</span></span> <span data-ttu-id="b2815-247">Detecte `System.Net.Http.HttpRequestException` o `Microsoft.Azure.Documents.DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="b2815-247">Catch `System.Net.Http.HttpRequestException` or `Microsoft.Azure.Documents.DocumentClientException`.</span></span>

<span data-ttu-id="b2815-248">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-248">**Recovery**</span></span>

* <span data-ttu-id="b2815-249">El SDK vuelve a ejecutar automáticamente los intentos erróneos.</span><span class="sxs-lookup"><span data-stu-id="b2815-249">The SDK automatically retries failed attempts.</span></span> <span data-ttu-id="b2815-250">Para establecer el número de reintentos y el tiempo de espera máximo, configure `ConnectionPolicy.RetryOptions`.</span><span class="sxs-lookup"><span data-stu-id="b2815-250">To set the number of retries and the maximum wait time, configure `ConnectionPolicy.RetryOptions`.</span></span> <span data-ttu-id="b2815-251">Las excepciones que genera el cliente se encuentran más allá de la directiva de reintentos o no son errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="b2815-251">Exceptions that the client raises are either beyond the retry policy or are not transient errors.</span></span>
* <span data-ttu-id="b2815-252">Si Cosmos DB limita el cliente, devuelve un error HTTP 429.</span><span class="sxs-lookup"><span data-stu-id="b2815-252">If Cosmos DB throttles the client, it returns an HTTP 429 error.</span></span> <span data-ttu-id="b2815-253">Compruebe el código de estado en `DocumentClientException`.</span><span class="sxs-lookup"><span data-stu-id="b2815-253">Check the status code in the `DocumentClientException`.</span></span> <span data-ttu-id="b2815-254">Si recibe el error 429 constantemente, considere la posibilidad de aumentar el valor de rendimiento de la colección.</span><span class="sxs-lookup"><span data-stu-id="b2815-254">If you are getting error 429 consistently, consider increasing the throughput value of the collection.</span></span>
* <span data-ttu-id="b2815-255">Replique la base de datos de Cosmos DB en dos o más regiones.</span><span class="sxs-lookup"><span data-stu-id="b2815-255">Replicate the Cosmos DB database across two or more regions.</span></span> <span data-ttu-id="b2815-256">Si se produce un error en la región primaria, se promoverá otra región para la escritura.</span><span class="sxs-lookup"><span data-stu-id="b2815-256">If the primary region fails, another region will be promoted to write.</span></span> <span data-ttu-id="b2815-257">También puede desencadenar una conmutación por error manualmente.</span><span class="sxs-lookup"><span data-stu-id="b2815-257">You can also trigger a failover manually.</span></span> <span data-ttu-id="b2815-258">El SDK realiza la detección y el enrutamiento automáticos, por lo que el código de la aplicación continúa funcionando después de una conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="b2815-258">The SDK does automatic discovery and routing, so application code continues to work after a failover.</span></span> <span data-ttu-id="b2815-259">Durante el período de conmutación por error (normalmente minutos), las operaciones de escritura tendrán una latencia superior, según va encontrando el SDK la nueva región de escritura.</span><span class="sxs-lookup"><span data-stu-id="b2815-259">During the failover period (typically minutes), write operations will have higher latency, as the SDK finds the new write region.</span></span>
  <span data-ttu-id="b2815-260">Para más información, consulte [Configuración de la distribución global de Azure Cosmos DB con la API de SQL][cosmosdb-multi-region].</span><span class="sxs-lookup"><span data-stu-id="b2815-260">For more information, see [How to setup Azure Cosmos DB global distribution using the SQL API][cosmosdb-multi-region].</span></span>
* <span data-ttu-id="b2815-261">Como acción de reserva, conserve el documento en una cola de copia de seguridad y procese la cola más adelante.</span><span class="sxs-lookup"><span data-stu-id="b2815-261">As a fallback, persist the document to a backup queue, and process the queue later.</span></span>

<span data-ttu-id="b2815-262">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-262">**Diagnostics**.</span></span> <span data-ttu-id="b2815-263">Registre todos los errores en el lado cliente.</span><span class="sxs-lookup"><span data-stu-id="b2815-263">Log all errors on the client side.</span></span>

## <a name="elasticsearch"></a><span data-ttu-id="b2815-264">Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="b2815-264">Elasticsearch</span></span>
### <a name="reading-data-from-elasticsearch-fails"></a><span data-ttu-id="b2815-265">Se produce un error al leer datos de Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="b2815-265">Reading data from Elasticsearch fails.</span></span>
<span data-ttu-id="b2815-266">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-266">**Detection**.</span></span> <span data-ttu-id="b2815-267">Detecte la excepción adecuada para el [cliente de Elasticsearch][elasticsearch-client] que se va a usar.</span><span class="sxs-lookup"><span data-stu-id="b2815-267">Catch the appropriate exception for the particular [Elasticsearch client][elasticsearch-client] being used.</span></span>

<span data-ttu-id="b2815-268">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-268">**Recovery**</span></span>

* <span data-ttu-id="b2815-269">Use un mecanismo de reintento.</span><span class="sxs-lookup"><span data-stu-id="b2815-269">Use a retry mechanism.</span></span> <span data-ttu-id="b2815-270">Cada cliente tiene sus propias directivas de reintento.</span><span class="sxs-lookup"><span data-stu-id="b2815-270">Each client has its own retry policies.</span></span>
* <span data-ttu-id="b2815-271">Implemente varios nodos de Elasticsearch y use la replicación para lograr una alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="b2815-271">Deploy multiple Elasticsearch nodes and use replication for high availability.</span></span>

<span data-ttu-id="b2815-272">Para más información, consulte [Running Elasticsearch on Azure][elasticsearch-azure] (Ejecución de Elasticsearch en Azure)///.</span><span class="sxs-lookup"><span data-stu-id="b2815-272">For more information, see [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

<span data-ttu-id="b2815-273">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-273">**Diagnostics**.</span></span> <span data-ttu-id="b2815-274">Puede usar herramientas de supervisión para Elasticsearch o registrar todos los errores en el lado cliente con la carga.</span><span class="sxs-lookup"><span data-stu-id="b2815-274">You can use monitoring tools for Elasticsearch, or log all errors on the client side with the payload.</span></span> <span data-ttu-id="b2815-275">Consulte la sección "Supervisión" en [Running Elasticsearch on Azure][elasticsearch-azure] (Ejecución de Elasticsearch en Azure)///.</span><span class="sxs-lookup"><span data-stu-id="b2815-275">See the 'Monitoring' section in [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

### <a name="writing-data-to-elasticsearch-fails"></a><span data-ttu-id="b2815-276">Se produce un error al escribir datos en Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="b2815-276">Writing data to Elasticsearch fails.</span></span>
<span data-ttu-id="b2815-277">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-277">**Detection**.</span></span> <span data-ttu-id="b2815-278">Detecte la excepción adecuada para el [cliente de Elasticsearch][elasticsearch-client] que se va a usar.</span><span class="sxs-lookup"><span data-stu-id="b2815-278">Catch the appropriate exception for the particular [Elasticsearch client][elasticsearch-client] being used.</span></span>  

<span data-ttu-id="b2815-279">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-279">**Recovery**</span></span>

* <span data-ttu-id="b2815-280">Use un mecanismo de reintento.</span><span class="sxs-lookup"><span data-stu-id="b2815-280">Use a retry mechanism.</span></span> <span data-ttu-id="b2815-281">Cada cliente tiene sus propias directivas de reintento.</span><span class="sxs-lookup"><span data-stu-id="b2815-281">Each client has its own retry policies.</span></span>
* <span data-ttu-id="b2815-282">Si la aplicación puede tolerar un nivel de coherencia reducido, considere la posibilidad de escribir con el valor `write_consistency` de `quorum`.</span><span class="sxs-lookup"><span data-stu-id="b2815-282">If the application can tolerate a reduced consistency level, consider writing with `write_consistency` setting of `quorum`.</span></span>

<span data-ttu-id="b2815-283">Para más información, consulte [Running Elasticsearch on Azure][elasticsearch-azure] (Ejecución de Elasticsearch en Azure)///.</span><span class="sxs-lookup"><span data-stu-id="b2815-283">For more information, see [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

<span data-ttu-id="b2815-284">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-284">**Diagnostics**.</span></span> <span data-ttu-id="b2815-285">Puede usar herramientas de supervisión para Elasticsearch o registrar todos los errores en el lado cliente con la carga.</span><span class="sxs-lookup"><span data-stu-id="b2815-285">You can use monitoring tools for Elasticsearch, or log all errors on the client side with the payload.</span></span> <span data-ttu-id="b2815-286">Consulte la sección "Supervisión" en [Running Elasticsearch on Azure][elasticsearch-azure] (Ejecución de Elasticsearch en Azure)///.</span><span class="sxs-lookup"><span data-stu-id="b2815-286">See the 'Monitoring' section in [Running Elasticsearch on Azure][elasticsearch-azure].</span></span>

## <a name="queue-storage"></a><span data-ttu-id="b2815-287">Queue Storage</span><span class="sxs-lookup"><span data-stu-id="b2815-287">Queue storage</span></span>
### <a name="writing-a-message-to-azure-queue-storage-fails-consistently"></a><span data-ttu-id="b2815-288">Se produce un error al escribir un mensaje en Azure Queue Storage constantemente.</span><span class="sxs-lookup"><span data-stu-id="b2815-288">Writing a message to Azure Queue storage fails consistently.</span></span>
<span data-ttu-id="b2815-289">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-289">**Detection**.</span></span> <span data-ttu-id="b2815-290">Después de *N* reintentos, todavía se produce un error en la operación de escritura.</span><span class="sxs-lookup"><span data-stu-id="b2815-290">After *N* retry attempts, the write operation still fails.</span></span>

<span data-ttu-id="b2815-291">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-291">**Recovery**</span></span>

* <span data-ttu-id="b2815-292">Almacene los datos en una memoria caché local y reenvíe las escrituras al almacenamiento más adelante, cuando el servicio esté disponible.</span><span class="sxs-lookup"><span data-stu-id="b2815-292">Store the data in a local cache, and forward the writes to storage later, when the service becomes available.</span></span>
* <span data-ttu-id="b2815-293">Cree una cola secundaria y escriba en esa cola si la cola principal no está disponible.</span><span class="sxs-lookup"><span data-stu-id="b2815-293">Create a secondary queue, and write to that queue if the primary queue is unavailable.</span></span>

<span data-ttu-id="b2815-294">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-294">**Diagnostics**.</span></span> <span data-ttu-id="b2815-295">Use [métricas de almacenamiento][storage-metrics].</span><span class="sxs-lookup"><span data-stu-id="b2815-295">Use [storage metrics][storage-metrics].</span></span>

### <a name="the-application-cannot-process-a-particular-message-from-the-queue"></a><span data-ttu-id="b2815-296">La aplicación no puede procesar un mensaje concreto de la cola.</span><span class="sxs-lookup"><span data-stu-id="b2815-296">The application cannot process a particular message from the queue.</span></span>
<span data-ttu-id="b2815-297">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-297">**Detection**.</span></span> <span data-ttu-id="b2815-298">Específica de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="b2815-298">Application specific.</span></span> <span data-ttu-id="b2815-299">Por ejemplo, el mensaje contiene datos no válidos o se produce un error en la lógica de negocios por algún motivo.</span><span class="sxs-lookup"><span data-stu-id="b2815-299">For example, the message contains invalid data, or the business logic fails for some reason.</span></span>

<span data-ttu-id="b2815-300">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-300">**Recovery**</span></span>

<span data-ttu-id="b2815-301">Mueva el mensaje a una cola independiente.</span><span class="sxs-lookup"><span data-stu-id="b2815-301">Move the message to a separate queue.</span></span> <span data-ttu-id="b2815-302">Ejecute un proceso independiente para examinar los mensajes de dicha cola.</span><span class="sxs-lookup"><span data-stu-id="b2815-302">Run a separate process to examine the messages in that queue.</span></span>

<span data-ttu-id="b2815-303">Considere la posibilidad de usar colas de mensajería de Azure Service Bus, lo que proporciona una funcionalidad de [cola de mensajes fallidos][sb-dead-letter-queue] para este propósito.</span><span class="sxs-lookup"><span data-stu-id="b2815-303">Consider using Azure Service Bus Messaging queues, which provides a [dead-letter queue][sb-dead-letter-queue] functionality for this purpose.</span></span>

> [!NOTE]
> <span data-ttu-id="b2815-304">Si usa colas de Storage con WebJobs, el SDK de WebJobs proporciona control de mensajes dudosos integrado.</span><span class="sxs-lookup"><span data-stu-id="b2815-304">If you are using Storage queues with WebJobs, the WebJobs SDK provides built-in poison message handling.</span></span> <span data-ttu-id="b2815-305">Consulte [How to use Azure queue storage with the WebJobs SDK][sb-poison-message] (Uso del almacenamiento de colas de Azure con el SDK de WebJobs)///.</span><span class="sxs-lookup"><span data-stu-id="b2815-305">See [How to use Azure queue storage with the WebJobs SDK][sb-poison-message].</span></span>

<span data-ttu-id="b2815-306">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-306">**Diagnostics**.</span></span> <span data-ttu-id="b2815-307">Utilice el registro de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="b2815-307">Use application logging.</span></span>

## <a name="redis-cache"></a><span data-ttu-id="b2815-308">Redis Cache</span><span class="sxs-lookup"><span data-stu-id="b2815-308">Redis Cache</span></span>
### <a name="reading-from-the-cache-fails"></a><span data-ttu-id="b2815-309">Se produce un error de lectura en la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="b2815-309">Reading from the cache fails.</span></span>
<span data-ttu-id="b2815-310">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-310">**Detection**.</span></span> <span data-ttu-id="b2815-311">Detecte `StackExchange.Redis.RedisConnectionException`.</span><span class="sxs-lookup"><span data-stu-id="b2815-311">Catch `StackExchange.Redis.RedisConnectionException`.</span></span>

<span data-ttu-id="b2815-312">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-312">**Recovery**</span></span>

1. <span data-ttu-id="b2815-313">Reinténtelo con los errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="b2815-313">Retry on transient failures.</span></span> <span data-ttu-id="b2815-314">Azure Redis Cache admite el reintento integrado. Consulte [Directrices de reintento de Azure Redis Cache][redis-retry].</span><span class="sxs-lookup"><span data-stu-id="b2815-314">Azure Redis cache supports built-in retry through See [Redis Cache retry guidelines][redis-retry].</span></span>
2. <span data-ttu-id="b2815-315">Trate los errores no transitorios como un error de caché y recurra al origen de datos original.</span><span class="sxs-lookup"><span data-stu-id="b2815-315">Treat non-transient failures as a cache miss, and fall back to the original data source.</span></span>

<span data-ttu-id="b2815-316">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-316">**Diagnostics**.</span></span> <span data-ttu-id="b2815-317">Utilice [diagnósticos de Redis Cache][redis-monitor].</span><span class="sxs-lookup"><span data-stu-id="b2815-317">Use [Redis Cache diagnostics][redis-monitor].</span></span>

### <a name="writing-to-the-cache-fails"></a><span data-ttu-id="b2815-318">Se produce un error de escritura en la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="b2815-318">Writing to the cache fails.</span></span>
<span data-ttu-id="b2815-319">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-319">**Detection**.</span></span> <span data-ttu-id="b2815-320">Detecte `StackExchange.Redis.RedisConnectionException`.</span><span class="sxs-lookup"><span data-stu-id="b2815-320">Catch `StackExchange.Redis.RedisConnectionException`.</span></span>

<span data-ttu-id="b2815-321">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-321">**Recovery**</span></span>

1. <span data-ttu-id="b2815-322">Reinténtelo con los errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="b2815-322">Retry on transient failures.</span></span> <span data-ttu-id="b2815-323">Azure Redis Cache admite el reintento integrado. Consulte [Directrices de reintento de Azure Redis Cache][redis-retry].</span><span class="sxs-lookup"><span data-stu-id="b2815-323">Azure Redis cache supports built-in retry through See [Redis Cache retry guidelines][redis-retry].</span></span>
2. <span data-ttu-id="b2815-324">Si el error no es transitorio, podrá omitirlo y permitir que otras transacciones escriban en la memoria caché más adelante.</span><span class="sxs-lookup"><span data-stu-id="b2815-324">If the error is non-transient, ignore it and let other transactions write to the cache later.</span></span>

<span data-ttu-id="b2815-325">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-325">**Diagnostics**.</span></span> <span data-ttu-id="b2815-326">Utilice [diagnósticos de Redis Cache][redis-monitor].</span><span class="sxs-lookup"><span data-stu-id="b2815-326">Use [Redis Cache diagnostics][redis-monitor].</span></span>

## <a name="sql-database"></a><span data-ttu-id="b2815-327">SQL Database</span><span class="sxs-lookup"><span data-stu-id="b2815-327">SQL Database</span></span>
### <a name="cannot-connect-to-the-database-in-the-primary-region"></a><span data-ttu-id="b2815-328">No se puede conectar a la base de datos en la región primaria.</span><span class="sxs-lookup"><span data-stu-id="b2815-328">Cannot connect to the database in the primary region.</span></span>
<span data-ttu-id="b2815-329">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-329">**Detection**.</span></span> <span data-ttu-id="b2815-330">Se produce un error de conexión.</span><span class="sxs-lookup"><span data-stu-id="b2815-330">Connection fails.</span></span>

<span data-ttu-id="b2815-331">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-331">**Recovery**</span></span>

<span data-ttu-id="b2815-332">Requisito previo: la base de datos debe configurarse para una replicación geográfica activa.</span><span class="sxs-lookup"><span data-stu-id="b2815-332">Prerequisite: The database must be configured for active geo-replication.</span></span> <span data-ttu-id="b2815-333">Consulte [Replicación geográfica activa para SQL Database][sql-db-replication].</span><span class="sxs-lookup"><span data-stu-id="b2815-333">See [SQL Database Active Geo-Replication][sql-db-replication].</span></span>

* <span data-ttu-id="b2815-334">Para consultas, lea desde una réplica secundaria.</span><span class="sxs-lookup"><span data-stu-id="b2815-334">For queries, read from a secondary replica.</span></span>
* <span data-ttu-id="b2815-335">Para inserciones y actualizaciones, conmute por error manualmente a una réplica secundaria.</span><span class="sxs-lookup"><span data-stu-id="b2815-335">For inserts and updates, manually fail over to a secondary replica.</span></span> <span data-ttu-id="b2815-336">Consulte [Inicio de una conmutación por error planeada o no planeada para Azure SQL Database][sql-db-failover].</span><span class="sxs-lookup"><span data-stu-id="b2815-336">See [Initiate a planned or unplanned failover for Azure SQL Database][sql-db-failover].</span></span>

<span data-ttu-id="b2815-337">La réplica usa una cadena de conexión diferente, por lo que deberá actualizar la cadena de conexión en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="b2815-337">The replica uses a different connection string, so you will need to update the connection string in your application.</span></span>

### <a name="client-runs-out-of-connections-in-the-connection-pool"></a><span data-ttu-id="b2815-338">El cliente se ha quedado sin conexiones en el grupo de conexiones.</span><span class="sxs-lookup"><span data-stu-id="b2815-338">Client runs out of connections in the connection pool.</span></span>
<span data-ttu-id="b2815-339">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-339">**Detection**.</span></span> <span data-ttu-id="b2815-340">Detecte errores `System.InvalidOperationException`.</span><span class="sxs-lookup"><span data-stu-id="b2815-340">Catch `System.InvalidOperationException` errors.</span></span>

<span data-ttu-id="b2815-341">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-341">**Recovery**</span></span>

* <span data-ttu-id="b2815-342">Vuelva a intentar la operación.</span><span class="sxs-lookup"><span data-stu-id="b2815-342">Retry the operation.</span></span>
* <span data-ttu-id="b2815-343">Como plan de mitigación, aísle los grupos de conexiones para cada caso de uso, a fin de que un solo caso de uso no pueda dominar todas las conexiones.</span><span class="sxs-lookup"><span data-stu-id="b2815-343">As a mitigation plan, isolate the connection pools for each use case, so that one use case can't dominate all the connections.</span></span>
* <span data-ttu-id="b2815-344">Aumente el número máximo de conexiones.</span><span class="sxs-lookup"><span data-stu-id="b2815-344">Increase the maximum connection pools.</span></span>

<span data-ttu-id="b2815-345">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-345">**Diagnostics**.</span></span> <span data-ttu-id="b2815-346">Registros de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="b2815-346">Application logs.</span></span>

### <a name="database-connection-limit-is-reached"></a><span data-ttu-id="b2815-347">Se alcanzó el límite de conexiones de base de datos.</span><span class="sxs-lookup"><span data-stu-id="b2815-347">Database connection limit is reached.</span></span>
<span data-ttu-id="b2815-348">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-348">**Detection**.</span></span> <span data-ttu-id="b2815-349">Azure SQL Database limita el número de trabajos, inicios de sesión y sesiones simultáneos.</span><span class="sxs-lookup"><span data-stu-id="b2815-349">Azure SQL Database limits the number of concurrent workers, logins, and sessions.</span></span> <span data-ttu-id="b2815-350">Los límites dependen del nivel de servicio.</span><span class="sxs-lookup"><span data-stu-id="b2815-350">The limits depend on the service tier.</span></span> <span data-ttu-id="b2815-351">Para más información, consulte [Límites de recursos de Azure SQL Database][sql-db-limits].</span><span class="sxs-lookup"><span data-stu-id="b2815-351">For more information, see [Azure SQL Database resource limits][sql-db-limits].</span></span>

<span data-ttu-id="b2815-352">Para detectar estos errores, detecte `System.Data.SqlClient.SqlException` y compruebe el valor de `SqlException.Number` para el código de error SQL.</span><span class="sxs-lookup"><span data-stu-id="b2815-352">To detect these errors, catch `System.Data.SqlClient.SqlException` and check the value of `SqlException.Number` for the SQL error code.</span></span> <span data-ttu-id="b2815-353">Para ver una lista de códigos de error relevantes, consulte [Códigos de error para las aplicaciones cliente de SQL Database: errores de conexión de bases de datos y otros problemas][sql-db-errors].</span><span class="sxs-lookup"><span data-stu-id="b2815-353">For a list of relevant error codes, see [SQL error codes for SQL Database client applications: Database connection error and other issues][sql-db-errors].</span></span>

<span data-ttu-id="b2815-354">**Recuperación**.</span><span class="sxs-lookup"><span data-stu-id="b2815-354">**Recovery**.</span></span> <span data-ttu-id="b2815-355">Estos errores se consideran transitorios por lo que al reintentarlo, es posible que se resuelva el problema.</span><span class="sxs-lookup"><span data-stu-id="b2815-355">These errors are considered transient, so retrying may resolve the issue.</span></span> <span data-ttu-id="b2815-356">Si se producen constantemente estos errores, considere la posibilidad de escalar la base de datos.</span><span class="sxs-lookup"><span data-stu-id="b2815-356">If you consistently hit these errors, consider scaling the database.</span></span>

<span data-ttu-id="b2815-357">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-357">**Diagnostics**.</span></span> <span data-ttu-id="b2815-358">- La consulta [sys.event_log][sys.event_log] devuelve las conexiones realizadas correctamente, los errores de conexión y los interbloqueos.</span><span class="sxs-lookup"><span data-stu-id="b2815-358">- The [sys.event_log][sys.event_log] query returns successful database connections, connection failures, and deadlocks.</span></span>

* <span data-ttu-id="b2815-359">Cree una [regla de alertas][azure-alerts] para conexiones erróneas.</span><span class="sxs-lookup"><span data-stu-id="b2815-359">Create an [alert rule][azure-alerts] for failed connections.</span></span>
* <span data-ttu-id="b2815-360">Habilite la [auditoría de SQL Database][sql-db-audit] y compruebe si hay inicios de sesión erróneos.</span><span class="sxs-lookup"><span data-stu-id="b2815-360">Enable [SQL Database auditing][sql-db-audit] and check for failed logins.</span></span>

## <a name="service-bus-messaging"></a><span data-ttu-id="b2815-361">Mensajería de Service Bus</span><span class="sxs-lookup"><span data-stu-id="b2815-361">Service Bus Messaging</span></span>
### <a name="reading-a-message-from-a-service-bus-queue-fails"></a><span data-ttu-id="b2815-362">Se produce un error al leer un mensaje de una cola de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="b2815-362">Reading a message from a Service Bus queue fails.</span></span>
<span data-ttu-id="b2815-363">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-363">**Detection**.</span></span> <span data-ttu-id="b2815-364">Detecte excepciones desde el cliente SDK.</span><span class="sxs-lookup"><span data-stu-id="b2815-364">Catch exceptions from the client SDK.</span></span> <span data-ttu-id="b2815-365">La clase base para las excepciones de Service Bus es [MessagingException][sb-messagingexception-class].</span><span class="sxs-lookup"><span data-stu-id="b2815-365">The base class for Service Bus exceptions is [MessagingException][sb-messagingexception-class].</span></span> <span data-ttu-id="b2815-366">Si el error es transitorio, la propiedad `IsTransient` es true.</span><span class="sxs-lookup"><span data-stu-id="b2815-366">If the error is transient, the `IsTransient` property is true.</span></span>

<span data-ttu-id="b2815-367">Para más información, consulte [Excepciones de mensajería de Service Bus][sb-messaging-exceptions].</span><span class="sxs-lookup"><span data-stu-id="b2815-367">For more information, see [Service Bus messaging exceptions][sb-messaging-exceptions].</span></span>

<span data-ttu-id="b2815-368">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-368">**Recovery**</span></span>

1. <span data-ttu-id="b2815-369">Reinténtelo con los errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="b2815-369">Retry on transient failures.</span></span> <span data-ttu-id="b2815-370">Consulte [Directrices de reintento de Service Bus][sb-retry].</span><span class="sxs-lookup"><span data-stu-id="b2815-370">See [Service Bus retry guidelines][sb-retry].</span></span>
2. <span data-ttu-id="b2815-371">Los mensajes que no se pueden entregar a cualquier receptor se colocan en una *cola de mensajes fallidos*.</span><span class="sxs-lookup"><span data-stu-id="b2815-371">Messages that cannot be delivered to any receiver are placed in a *dead-letter queue*.</span></span> <span data-ttu-id="b2815-372">Use esta cola para ver qué mensajes no se pudieron recibir.</span><span class="sxs-lookup"><span data-stu-id="b2815-372">Use this queue to see which messages could not be received.</span></span> <span data-ttu-id="b2815-373">No hay limpieza automática de la cola de mensajes fallidos.</span><span class="sxs-lookup"><span data-stu-id="b2815-373">There is no automatic cleanup of the dead-letter queue.</span></span> <span data-ttu-id="b2815-374">Los mensajes permanecen allí hasta que los recupere explícitamente.</span><span class="sxs-lookup"><span data-stu-id="b2815-374">Messages remain there until you explicitly retrieve them.</span></span> <span data-ttu-id="b2815-375">Consulte [Información general de colas de mensajes fallidos de Service Bus][sb-dead-letter-queue].</span><span class="sxs-lookup"><span data-stu-id="b2815-375">See [Overview of Service Bus dead-letter queues][sb-dead-letter-queue].</span></span>

### <a name="writing-a-message-to-a-service-bus-queue-fails"></a><span data-ttu-id="b2815-376">Se produce un error al escribir un mensaje en una cola de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="b2815-376">Writing a message to a Service Bus queue fails.</span></span>
<span data-ttu-id="b2815-377">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-377">**Detection**.</span></span> <span data-ttu-id="b2815-378">Detecte excepciones desde el cliente SDK.</span><span class="sxs-lookup"><span data-stu-id="b2815-378">Catch exceptions from the client SDK.</span></span> <span data-ttu-id="b2815-379">La clase base para las excepciones de Service Bus es [MessagingException][sb-messagingexception-class].</span><span class="sxs-lookup"><span data-stu-id="b2815-379">The base class for Service Bus exceptions is [MessagingException][sb-messagingexception-class].</span></span> <span data-ttu-id="b2815-380">Si el error es transitorio, la propiedad `IsTransient` es true.</span><span class="sxs-lookup"><span data-stu-id="b2815-380">If the error is transient, the `IsTransient` property is true.</span></span>

<span data-ttu-id="b2815-381">Para más información, consulte [Excepciones de mensajería de Service Bus][sb-messaging-exceptions].</span><span class="sxs-lookup"><span data-stu-id="b2815-381">For more information, see [Service Bus messaging exceptions][sb-messaging-exceptions].</span></span>

<span data-ttu-id="b2815-382">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-382">**Recovery**</span></span>

1. <span data-ttu-id="b2815-383">El cliente de Service Bus realiza reintentos automáticamente tras los errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="b2815-383">The Service Bus client automatically retries after transient errors.</span></span> <span data-ttu-id="b2815-384">De forma predeterminada, usa la interrupción exponencial.</span><span class="sxs-lookup"><span data-stu-id="b2815-384">By default, it uses exponential back-off.</span></span> <span data-ttu-id="b2815-385">Tras el período de tiempo de expiración máximo o el número máximo de reintentos, el cliente genera una excepción.</span><span class="sxs-lookup"><span data-stu-id="b2815-385">After the maximum retry count or maximum timeout period, the client throws an exception.</span></span> <span data-ttu-id="b2815-386">Para más información, consulte [Directrices de reintento de Service Bus][sb-retry].</span><span class="sxs-lookup"><span data-stu-id="b2815-386">For more information, see [Service Bus retry guidelines][sb-retry].</span></span>
2. <span data-ttu-id="b2815-387">Si se supera la cuota de cola, el cliente genera [QuotaExceededException][QuotaExceededException].</span><span class="sxs-lookup"><span data-stu-id="b2815-387">If the queue quota is exceeded, the client throws [QuotaExceededException][QuotaExceededException].</span></span> <span data-ttu-id="b2815-388">El mensaje de excepción proporciona más detalles.</span><span class="sxs-lookup"><span data-stu-id="b2815-388">The exception message gives more details.</span></span> <span data-ttu-id="b2815-389">Purgue algunos mensajes de la cola antes de reintentarlo y considere la posibilidad de usar el patrón Circuit Breaker para evitar reintentos continuos mientras se supera la cuota.</span><span class="sxs-lookup"><span data-stu-id="b2815-389">Drain some messages from the queue before retrying, and consider using the Circuit Breaker pattern to avoid continued retries while the quota is exceeded.</span></span> <span data-ttu-id="b2815-390">Además, asegúrese de que la propiedad [BrokeredMessage.TimeToLive] no esté establecida demasiado alta.</span><span class="sxs-lookup"><span data-stu-id="b2815-390">Also, make sure the [BrokeredMessage.TimeToLive] property is not set too high.</span></span>
3. <span data-ttu-id="b2815-391">Dentro de una región, se puede mejorar la resistencia mediante [temas o colas con particiones][sb-partition].</span><span class="sxs-lookup"><span data-stu-id="b2815-391">Within a region, resiliency can be improved by using [partitioned queues or topics][sb-partition].</span></span> <span data-ttu-id="b2815-392">Se asigna una cola o un tema sin particiones a un almacén de mensajería.</span><span class="sxs-lookup"><span data-stu-id="b2815-392">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="b2815-393">Si este almacén de mensajería no está disponible, se producirá un error en todas las operaciones de esa cola o tema.</span><span class="sxs-lookup"><span data-stu-id="b2815-393">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span> <span data-ttu-id="b2815-394">Una cola o tema con particiones está particionado entre varios almacenes de mensajería.</span><span class="sxs-lookup"><span data-stu-id="b2815-394">A partitioned queue or topic is partitioned across multiple messaging stores.</span></span>
4. <span data-ttu-id="b2815-395">Para proporcionar una resistencia adicional, cree dos espacios de nombres de Service Bus en diferentes regiones y replique los mensajes.</span><span class="sxs-lookup"><span data-stu-id="b2815-395">For additional resiliency, create two Service Bus namespaces in different regions, and replicate the messages.</span></span> <span data-ttu-id="b2815-396">Puede usar una replicación activa o pasiva.</span><span class="sxs-lookup"><span data-stu-id="b2815-396">You can use either active replication or passive replication.</span></span>

   * <span data-ttu-id="b2815-397">Replicación activa: el cliente envía todos los mensajes a ambas colas.</span><span class="sxs-lookup"><span data-stu-id="b2815-397">Active replication: The client sends every message to both queues.</span></span> <span data-ttu-id="b2815-398">El receptor escucha en ambas colas.</span><span class="sxs-lookup"><span data-stu-id="b2815-398">The receiver listens on both queues.</span></span> <span data-ttu-id="b2815-399">Etiquete los mensajes con un identificador único, para que el cliente pueda descartar los mensajes duplicados.</span><span class="sxs-lookup"><span data-stu-id="b2815-399">Tag messages with a unique identifier, so the client can discard duplicate messages.</span></span>
   * <span data-ttu-id="b2815-400">Replicación pasiva: el cliente envía el mensaje a una cola.</span><span class="sxs-lookup"><span data-stu-id="b2815-400">Passive replication: The client sends the message to one queue.</span></span> <span data-ttu-id="b2815-401">Si se produce un error, el cliente recurre a la otra cola.</span><span class="sxs-lookup"><span data-stu-id="b2815-401">If there is an error, the client falls back to the other queue.</span></span> <span data-ttu-id="b2815-402">El receptor escucha en ambas colas.</span><span class="sxs-lookup"><span data-stu-id="b2815-402">The receiver listens on both queues.</span></span> <span data-ttu-id="b2815-403">Este enfoque reduce el número de mensajes duplicados que se envían.</span><span class="sxs-lookup"><span data-stu-id="b2815-403">This approach reduces the number of duplicate messages that are sent.</span></span> <span data-ttu-id="b2815-404">Sin embargo, el receptor todavía debe controlar los mensajes duplicados.</span><span class="sxs-lookup"><span data-stu-id="b2815-404">However, the receiver must still handle duplicate messages.</span></span>

     <span data-ttu-id="b2815-405">Para más información, consulte [GeoReplication sample][sb-georeplication-sample] (Muestra de georeplicación) y [Procedimientos recomendados para aislar aplicaciones ante desastres e interrupciones de Service Bus](/azure/service-bus-messaging/service-bus-outages-disasters/).</span><span class="sxs-lookup"><span data-stu-id="b2815-405">For more information, see [GeoReplication sample][sb-georeplication-sample] and [Best practices for insulating applications against Service Bus outages and disasters](/azure/service-bus-messaging/service-bus-outages-disasters/).</span></span>

### <a name="duplicate-message"></a><span data-ttu-id="b2815-406">Mensaje duplicado.</span><span class="sxs-lookup"><span data-stu-id="b2815-406">Duplicate message.</span></span>
<span data-ttu-id="b2815-407">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-407">**Detection**.</span></span> <span data-ttu-id="b2815-408">Examine las propiedades `MessageId` y `DeliveryCount` del mensaje.</span><span class="sxs-lookup"><span data-stu-id="b2815-408">Examine the `MessageId` and `DeliveryCount` properties of the message.</span></span>

<span data-ttu-id="b2815-409">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-409">**Recovery**</span></span>

* <span data-ttu-id="b2815-410">Si es posible, diseñe las operaciones de procesamiento de mensajes para que sean idempotentes.</span><span class="sxs-lookup"><span data-stu-id="b2815-410">If possible, design your message processing operations to be idempotent.</span></span> <span data-ttu-id="b2815-411">En caso contrario, almacene identificadores de mensaje de los mensajes que ya se han procesado y compruebe el identificador antes de procesar un mensaje.</span><span class="sxs-lookup"><span data-stu-id="b2815-411">Otherwise, store message IDs of messages that are already processed, and check the ID before processing a message.</span></span>
* <span data-ttu-id="b2815-412">Habilite la detección de duplicados, mediante la creación de la cola con `RequiresDuplicateDetection` establecido en true.</span><span class="sxs-lookup"><span data-stu-id="b2815-412">Enable duplicate detection, by creating the queue with `RequiresDuplicateDetection` set to true.</span></span> <span data-ttu-id="b2815-413">Con este valor, Service Bus elimina automáticamente cualquier mensaje que se envíe con el mismo `MessageId` que un mensaje anterior.</span><span class="sxs-lookup"><span data-stu-id="b2815-413">With this setting, Service Bus automatically deletes any message that is sent with the same `MessageId` as a previous message.</span></span>  <span data-ttu-id="b2815-414">Tenga en cuenta lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="b2815-414">Note the following:</span></span>

  * <span data-ttu-id="b2815-415">Este valor impide que se pongan en la cola mensajes duplicados.</span><span class="sxs-lookup"><span data-stu-id="b2815-415">This setting prevents duplicate messages from being put into the queue.</span></span> <span data-ttu-id="b2815-416">No impide que un receptor procese el mismo mensaje más de una vez.</span><span class="sxs-lookup"><span data-stu-id="b2815-416">It doesn't prevent a receiver from processing the same message more than once.</span></span>
  * <span data-ttu-id="b2815-417">La detección de duplicados tiene un período de tiempo.</span><span class="sxs-lookup"><span data-stu-id="b2815-417">Duplicate detection has a time window.</span></span> <span data-ttu-id="b2815-418">Si se envía un duplicado más allá de este período, no se detectará.</span><span class="sxs-lookup"><span data-stu-id="b2815-418">If a duplicate is sent beyond this window, it won't be detected.</span></span>

<span data-ttu-id="b2815-419">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-419">**Diagnostics**.</span></span> <span data-ttu-id="b2815-420">Registre mensajes duplicados.</span><span class="sxs-lookup"><span data-stu-id="b2815-420">Log duplicated messages.</span></span>

### <a name="the-application-cannot-process-a-particular-message-from-the-queue"></a><span data-ttu-id="b2815-421">La aplicación no puede procesar un mensaje concreto de la cola.</span><span class="sxs-lookup"><span data-stu-id="b2815-421">The application cannot process a particular message from the queue.</span></span>
<span data-ttu-id="b2815-422">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-422">**Detection**.</span></span> <span data-ttu-id="b2815-423">Específica de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="b2815-423">Application specific.</span></span> <span data-ttu-id="b2815-424">Por ejemplo, el mensaje contiene datos no válidos o se produce un error en la lógica de negocios por algún motivo.</span><span class="sxs-lookup"><span data-stu-id="b2815-424">For example, the message contains invalid data, or the business logic fails for some reason.</span></span>

<span data-ttu-id="b2815-425">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-425">**Recovery**</span></span>

<span data-ttu-id="b2815-426">Hay dos modos de error que se deben tener en cuenta.</span><span class="sxs-lookup"><span data-stu-id="b2815-426">There are two failure modes to consider.</span></span>

* <span data-ttu-id="b2815-427">El receptor detecta el error.</span><span class="sxs-lookup"><span data-stu-id="b2815-427">The receiver detects the failure.</span></span> <span data-ttu-id="b2815-428">En este caso, mueva el mensaje a la cola de mensajes fallidos.</span><span class="sxs-lookup"><span data-stu-id="b2815-428">In this case, move the message to the dead-letter queue.</span></span> <span data-ttu-id="b2815-429">Posteriormente, ejecute un proceso independiente para examinar los mensajes de la cola de mensajes fallidos.</span><span class="sxs-lookup"><span data-stu-id="b2815-429">Later, run a separate process to examine the messages in the dead-letter queue.</span></span>
* <span data-ttu-id="b2815-430">Se produce un error en el receptor en medio del procesamiento del mensaje &mdash; por ejemplo, debido a una excepción no controlada.</span><span class="sxs-lookup"><span data-stu-id="b2815-430">The receiver fails in the middle of processing the message &mdash; for example, due to an unhandled exception.</span></span> <span data-ttu-id="b2815-431">Para controlar este caso, utilice el modo `PeekLock`.</span><span class="sxs-lookup"><span data-stu-id="b2815-431">To handle this case, use `PeekLock` mode.</span></span> <span data-ttu-id="b2815-432">En este modo, si expira el bloqueo, el mensaje pasa a estar disponible para otros receptores.</span><span class="sxs-lookup"><span data-stu-id="b2815-432">In this mode, if the lock expires, the message becomes available to other receivers.</span></span> <span data-ttu-id="b2815-433">Si el mensaje supera el número máximo de entregas o el período de vida, el mensaje se mueve automáticamente a la cola de mensajes fallidos.</span><span class="sxs-lookup"><span data-stu-id="b2815-433">If the message exceeds the maximum delivery count or the time-to-live, the message is automatically moved to the dead-letter queue.</span></span>

<span data-ttu-id="b2815-434">Para más información, consulte [Información general de colas de mensajes fallidos de Service Bus][sb-dead-letter-queue].</span><span class="sxs-lookup"><span data-stu-id="b2815-434">For more information, see [Overview of Service Bus dead-letter queues][sb-dead-letter-queue].</span></span>

<span data-ttu-id="b2815-435">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-435">**Diagnostics**.</span></span> <span data-ttu-id="b2815-436">Siempre que la aplicación mueva un mensaje a la cola de mensajes fallidos, escribe un evento en los registros de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="b2815-436">Whenever the application moves a message to the dead-letter queue, write an event to the application logs.</span></span>

## <a name="service-fabric"></a><span data-ttu-id="b2815-437">Service Fabric</span><span class="sxs-lookup"><span data-stu-id="b2815-437">Service Fabric</span></span>
### <a name="a-request-to-a-service-fails"></a><span data-ttu-id="b2815-438">Se produce un error en una solicitud a un servicio.</span><span class="sxs-lookup"><span data-stu-id="b2815-438">A request to a service fails.</span></span>
<span data-ttu-id="b2815-439">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-439">**Detection**.</span></span> <span data-ttu-id="b2815-440">El servicio devuelve un error.</span><span class="sxs-lookup"><span data-stu-id="b2815-440">The service returns an error.</span></span>

<span data-ttu-id="b2815-441">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-441">**Recovery**</span></span>

* <span data-ttu-id="b2815-442">Busque de nuevo un proxy (`ServiceProxy` o `ActorProxy`) y vuelva a llamar al método de servicio/actor.</span><span class="sxs-lookup"><span data-stu-id="b2815-442">Locate a proxy again (`ServiceProxy` or `ActorProxy`) and call the service/actor method again.</span></span>
* <span data-ttu-id="b2815-443">**Servicio con estado**.</span><span class="sxs-lookup"><span data-stu-id="b2815-443">**Stateful service**.</span></span> <span data-ttu-id="b2815-444">Encapsule las operaciones en colecciones confiables en una transacción.</span><span class="sxs-lookup"><span data-stu-id="b2815-444">Wrap operations on reliable collections in a transaction.</span></span> <span data-ttu-id="b2815-445">Si se produce un error, se revertirá la transacción.</span><span class="sxs-lookup"><span data-stu-id="b2815-445">If there is an error, the transaction will be rolled back.</span></span> <span data-ttu-id="b2815-446">La solicitud, si se extrae de una cola, se procesará de nuevo.</span><span class="sxs-lookup"><span data-stu-id="b2815-446">The request, if pulled from a queue, will be processed again.</span></span>
* <span data-ttu-id="b2815-447">**Servicio sin estado**.</span><span class="sxs-lookup"><span data-stu-id="b2815-447">**Stateless service**.</span></span> <span data-ttu-id="b2815-448">Si el servicio conserva los datos en un almacén externo, todas las operaciones deben ser idempotentes.</span><span class="sxs-lookup"><span data-stu-id="b2815-448">If the service persists data to an external store, all operations need to be idempotent.</span></span>

<span data-ttu-id="b2815-449">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-449">**Diagnostics**.</span></span> <span data-ttu-id="b2815-450">Registro de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="b2815-450">Application log</span></span>

### <a name="service-fabric-node-is-shut-down"></a><span data-ttu-id="b2815-451">El nodo de Service Fabric se cierra.</span><span class="sxs-lookup"><span data-stu-id="b2815-451">Service Fabric node is shut down.</span></span>
<span data-ttu-id="b2815-452">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-452">**Detection**.</span></span> <span data-ttu-id="b2815-453">Se pasa un token de cancelación para el método `RunAsync` del servicio.</span><span class="sxs-lookup"><span data-stu-id="b2815-453">A cancellation token is passed to the service's `RunAsync` method.</span></span> <span data-ttu-id="b2815-454">Service Fabric cancela la tarea antes de cerrar el nodo.</span><span class="sxs-lookup"><span data-stu-id="b2815-454">Service Fabric cancels the task before shutting down the node.</span></span>

<span data-ttu-id="b2815-455">**Recuperación**.</span><span class="sxs-lookup"><span data-stu-id="b2815-455">**Recovery**.</span></span> <span data-ttu-id="b2815-456">Use el token de cancelación para detectar el cierre.</span><span class="sxs-lookup"><span data-stu-id="b2815-456">Use the cancellation token to detect shutdown.</span></span> <span data-ttu-id="b2815-457">Cuando Service Fabric solicita la cancelación, finalice cualquier trabajo y salga de  `RunAsync` tan pronto como sea posible.</span><span class="sxs-lookup"><span data-stu-id="b2815-457">When Service Fabric requests cancellation, finish any work and exit `RunAsync` as quickly as possible.</span></span>

<span data-ttu-id="b2815-458">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-458">**Diagnostics**.</span></span> <span data-ttu-id="b2815-459">Registros de aplicación</span><span class="sxs-lookup"><span data-stu-id="b2815-459">Application logs</span></span>

## <a name="storage"></a><span data-ttu-id="b2815-460">Storage</span><span class="sxs-lookup"><span data-stu-id="b2815-460">Storage</span></span>
### <a name="writing-data-to-azure-storage-fails"></a><span data-ttu-id="b2815-461">Se produce un error al escribir datos en Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="b2815-461">Writing data to Azure Storage fails</span></span>
<span data-ttu-id="b2815-462">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-462">**Detection**.</span></span> <span data-ttu-id="b2815-463">El cliente recibe mensajes de error al escribir.</span><span class="sxs-lookup"><span data-stu-id="b2815-463">The client receives errors when writing.</span></span>

<span data-ttu-id="b2815-464">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-464">**Recovery**</span></span>

1. <span data-ttu-id="b2815-465">Reintente la operación para recuperarse de errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="b2815-465">Retry the operation, to recover from transient failures.</span></span> <span data-ttu-id="b2815-466">La [directiva de reintentos][Storage.RetryPolicies] en el SDK de cliente trata esto automáticamente.</span><span class="sxs-lookup"><span data-stu-id="b2815-466">The [retry policy][Storage.RetryPolicies] in the client SDK handles this automatically.</span></span>
2. <span data-ttu-id="b2815-467">Implemente el patrón Circuit Breaker para evitar sobrecargar el almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="b2815-467">Implement the Circuit Breaker pattern to avoid overwhelming storage.</span></span>
3. <span data-ttu-id="b2815-468">Si se produce un error en N reintentos, realice una acción de reserva correcta.</span><span class="sxs-lookup"><span data-stu-id="b2815-468">If N retry attempts fail, perform a graceful fallback.</span></span> <span data-ttu-id="b2815-469">Por ejemplo: </span><span class="sxs-lookup"><span data-stu-id="b2815-469">For example:</span></span>

   * <span data-ttu-id="b2815-470">Almacene los datos en una memoria caché local y reenvíe las escrituras al almacenamiento más adelante, cuando el servicio esté disponible.</span><span class="sxs-lookup"><span data-stu-id="b2815-470">Store the data in a local cache, and forward the writes to storage later, when the service becomes available.</span></span>
   * <span data-ttu-id="b2815-471">Si la acción de escritura se encontraba en un ámbito transaccional, compense la transacción.</span><span class="sxs-lookup"><span data-stu-id="b2815-471">If the write action was in a transactional scope, compensate the transaction.</span></span>

<span data-ttu-id="b2815-472">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-472">**Diagnostics**.</span></span> <span data-ttu-id="b2815-473">Use [métricas de almacenamiento][storage-metrics].</span><span class="sxs-lookup"><span data-stu-id="b2815-473">Use [storage metrics][storage-metrics].</span></span>

### <a name="reading-data-from-azure-storage-fails"></a><span data-ttu-id="b2815-474">Se produce un error al leer datos de Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="b2815-474">Reading data from Azure Storage fails.</span></span>
<span data-ttu-id="b2815-475">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-475">**Detection**.</span></span> <span data-ttu-id="b2815-476">El cliente recibe mensajes de error al leer.</span><span class="sxs-lookup"><span data-stu-id="b2815-476">The client receives errors when reading.</span></span>

<span data-ttu-id="b2815-477">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-477">**Recovery**</span></span>

1. <span data-ttu-id="b2815-478">Reintente la operación para recuperarse de errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="b2815-478">Retry the operation, to recover from transient failures.</span></span> <span data-ttu-id="b2815-479">La [directiva de reintentos][Storage.RetryPolicies] en el SDK de cliente trata esto automáticamente.</span><span class="sxs-lookup"><span data-stu-id="b2815-479">The [retry policy][Storage.RetryPolicies] in the client SDK handles this automatically.</span></span>
2. <span data-ttu-id="b2815-480">Para el almacenamiento de RA-GRS, si se produce un error en la lectura desde el punto de conexión principal, intente leer desde el punto de conexión secundario.</span><span class="sxs-lookup"><span data-stu-id="b2815-480">For RA-GRS storage, if reading from the primary endpoint fails, try reading from the secondary endpoint.</span></span> <span data-ttu-id="b2815-481">El SDK de cliente trata esto automáticamente.</span><span class="sxs-lookup"><span data-stu-id="b2815-481">The client SDK can handle this automatically.</span></span> <span data-ttu-id="b2815-482">Consulte el artículo sobre [replicación de Azure Storage][storage-replication].</span><span class="sxs-lookup"><span data-stu-id="b2815-482">See [Azure Storage replication][storage-replication].</span></span>
3. <span data-ttu-id="b2815-483">Si se produce un error en *N* reintentos, realice una acción de reserva para ejecutar una degradación correcta.</span><span class="sxs-lookup"><span data-stu-id="b2815-483">If *N* retry attempts fail, take a fallback action to degrade gracefully.</span></span> <span data-ttu-id="b2815-484">Por ejemplo, si una imagen de producto no se puede recuperar desde el almacenamiento, muestre una imagen de marcador de posición genérica.</span><span class="sxs-lookup"><span data-stu-id="b2815-484">For example, if a product image can't be retrieved from storage, show a generic placeholder image.</span></span>

<span data-ttu-id="b2815-485">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-485">**Diagnostics**.</span></span> <span data-ttu-id="b2815-486">Use [métricas de almacenamiento][storage-metrics].</span><span class="sxs-lookup"><span data-stu-id="b2815-486">Use [storage metrics][storage-metrics].</span></span>

## <a name="virtual-machine"></a><span data-ttu-id="b2815-487">Máquina virtual</span><span class="sxs-lookup"><span data-stu-id="b2815-487">Virtual Machine</span></span>
### <a name="connection-to-a-backend-vm-fails"></a><span data-ttu-id="b2815-488">Se produce un error en la conexión a una máquina virtual de back-end.</span><span class="sxs-lookup"><span data-stu-id="b2815-488">Connection to a backend VM fails.</span></span>
<span data-ttu-id="b2815-489">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-489">**Detection**.</span></span> <span data-ttu-id="b2815-490">Errores de conexión de red.</span><span class="sxs-lookup"><span data-stu-id="b2815-490">Network connection errors.</span></span>

<span data-ttu-id="b2815-491">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-491">**Recovery**</span></span>

* <span data-ttu-id="b2815-492">Implemente al menos dos máquinas virtuales de back-end en un conjunto de disponibilidad, detrás de un equilibrador de carga.</span><span class="sxs-lookup"><span data-stu-id="b2815-492">Deploy at least two backend VMs in an availability set, behind a load balancer.</span></span>
* <span data-ttu-id="b2815-493">Si el error de conexión es transitorio, a veces TCP reintentará enviar correctamente el mensaje.</span><span class="sxs-lookup"><span data-stu-id="b2815-493">If the connection error is transient, sometimes TCP will successfully retry sending the message.</span></span>
* <span data-ttu-id="b2815-494">Implemente una directiva de reintentos en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="b2815-494">Implement a retry policy in the application.</span></span>
* <span data-ttu-id="b2815-495">Para errores persistentes o no transitorios, implemente el patrón [Circuit Breaker][circuit-breaker].</span><span class="sxs-lookup"><span data-stu-id="b2815-495">For persistent or non-transient errors, implement the [Circuit Breaker][circuit-breaker] pattern.</span></span>
* <span data-ttu-id="b2815-496">Si la máquina virtual que realiza la llamada supera el límite de salida de la red, se llenará la cola de salida.</span><span class="sxs-lookup"><span data-stu-id="b2815-496">If the calling VM exceeds its network egress limit, the outbound queue will fill up.</span></span> <span data-ttu-id="b2815-497">Si la cola de salida está constantemente llena, considere la posibilidad de un escalado horizontal.</span><span class="sxs-lookup"><span data-stu-id="b2815-497">If the outbound queue is consistently full, consider scaling out.</span></span>

<span data-ttu-id="b2815-498">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-498">**Diagnostics**.</span></span> <span data-ttu-id="b2815-499">Registre eventos en los límites del servicio.</span><span class="sxs-lookup"><span data-stu-id="b2815-499">Log events at service boundaries.</span></span>

### <a name="vm-instance-becomes-unavailable-or-unhealthy"></a><span data-ttu-id="b2815-500">Una instancia de la máquina virtual de App Service ha dejado de estar disponible o no tiene mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="b2815-500">VM instance becomes unavailable or unhealthy.</span></span>
<span data-ttu-id="b2815-501">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-501">**Detection**.</span></span> <span data-ttu-id="b2815-502">Configure un [sondeo de mantenimiento][lb-probe] de una instancia de Load Balancer que indique si la instancia de la máquina virtual tiene mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="b2815-502">Configure a Load Balancer [health probe][lb-probe] that signals whether the VM instance is healthy.</span></span> <span data-ttu-id="b2815-503">El sondeo debe comprobar si las funciones críticas están respondiendo correctamente.</span><span class="sxs-lookup"><span data-stu-id="b2815-503">The probe should check whether critical functions are responding correctly.</span></span>

<span data-ttu-id="b2815-504">**Recuperación**.</span><span class="sxs-lookup"><span data-stu-id="b2815-504">**Recovery**.</span></span> <span data-ttu-id="b2815-505">Para cada capa de aplicación, colocar varias instancias de máquina virtual en el mismo conjunto de disponibilidad y colocar un equilibrador de carga delante de las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="b2815-505">For each application tier, put multiple VM instances into the same availability set, and place a load balancer in front of the VMs.</span></span> <span data-ttu-id="b2815-506">Cuando un sondeo de mantenimiento no responde, la instancia de Load Balancer deja de enviar nuevas conexiones a la instancia sin mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="b2815-506">If the health probe fails, the Load Balancer stops sending new connections to the unhealthy instance.</span></span>

<span data-ttu-id="b2815-507">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-507">**Diagnostics**.</span></span> <span data-ttu-id="b2815-508">- Use [análisis de registros][lb-monitor] de Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="b2815-508">- Use Load Balancer [log analytics][lb-monitor].</span></span>

* <span data-ttu-id="b2815-509">Configure el sistema de supervisión para controlar todos los puntos de conexión de supervisión de mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="b2815-509">Configure your monitoring system to monitor all of the health monitoring endpoints.</span></span>

### <a name="operator-accidentally-shuts-down-a-vm"></a><span data-ttu-id="b2815-510">Un operador cierra accidentalmente una máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="b2815-510">Operator accidentally shuts down a VM.</span></span>
<span data-ttu-id="b2815-511">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-511">**Detection**.</span></span> <span data-ttu-id="b2815-512">N/D</span><span class="sxs-lookup"><span data-stu-id="b2815-512">N/A</span></span>

<span data-ttu-id="b2815-513">**Recuperación**.</span><span class="sxs-lookup"><span data-stu-id="b2815-513">**Recovery**.</span></span> <span data-ttu-id="b2815-514">Establezca un bloqueo de recurso con el nivel `ReadOnly`.</span><span class="sxs-lookup"><span data-stu-id="b2815-514">Set a resource lock with `ReadOnly` level.</span></span> <span data-ttu-id="b2815-515">Consulte [Bloqueo de recursos con Azure Resource Manager][rm-locks].</span><span class="sxs-lookup"><span data-stu-id="b2815-515">See [Lock resources with Azure Resource Manager][rm-locks].</span></span>

<span data-ttu-id="b2815-516">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-516">**Diagnostics**.</span></span> <span data-ttu-id="b2815-517">Utilice [Registros de actividad de Azure][azure-activity-logs].</span><span class="sxs-lookup"><span data-stu-id="b2815-517">Use [Azure Activity Logs][azure-activity-logs].</span></span>

## <a name="webjobs"></a><span data-ttu-id="b2815-518">Trabajos web</span><span class="sxs-lookup"><span data-stu-id="b2815-518">WebJobs</span></span>
### <a name="continuous-job-stops-running-when-the-scm-host-is-idle"></a><span data-ttu-id="b2815-519">El trabajo continuo deja de ejecutarse cuando el host SCM está inactivo.</span><span class="sxs-lookup"><span data-stu-id="b2815-519">Continuous job stops running when the SCM host is idle.</span></span>
<span data-ttu-id="b2815-520">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-520">**Detection**.</span></span> <span data-ttu-id="b2815-521">Pase un token de cancelación a la función de WebJob.</span><span class="sxs-lookup"><span data-stu-id="b2815-521">Pass a cancellation token to the WebJob function.</span></span> <span data-ttu-id="b2815-522">Para más información, consulte el [cierre correcto][web-jobs-shutdown].</span><span class="sxs-lookup"><span data-stu-id="b2815-522">For more information, see [Graceful shutdown][web-jobs-shutdown].</span></span>

<span data-ttu-id="b2815-523">**Recuperación**.</span><span class="sxs-lookup"><span data-stu-id="b2815-523">**Recovery**.</span></span> <span data-ttu-id="b2815-524">Habilite el valor `Always On` en la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="b2815-524">Enable the `Always On` setting in the web app.</span></span> <span data-ttu-id="b2815-525">Para más información, consulte [Ejecución de tareas en segundo plano con WebJobs][web-jobs].</span><span class="sxs-lookup"><span data-stu-id="b2815-525">For more information, see [Run Background tasks with WebJobs][web-jobs].</span></span>

## <a name="application-design"></a><span data-ttu-id="b2815-526">Diseño de aplicación</span><span class="sxs-lookup"><span data-stu-id="b2815-526">Application design</span></span>
### <a name="application-cant-handle-a-spike-in-incoming-requests"></a><span data-ttu-id="b2815-527">La aplicación no puede controlar un pico en las solicitudes entrantes.</span><span class="sxs-lookup"><span data-stu-id="b2815-527">Application can't handle a spike in incoming requests.</span></span>
<span data-ttu-id="b2815-528">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-528">**Detection**.</span></span> <span data-ttu-id="b2815-529">Depende de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="b2815-529">Depends on the application.</span></span> <span data-ttu-id="b2815-530">Síntomas típicos:</span><span class="sxs-lookup"><span data-stu-id="b2815-530">Typical symptoms:</span></span>

* <span data-ttu-id="b2815-531">El sitio web comienza a devolver códigos de error HTTP 5xx.</span><span class="sxs-lookup"><span data-stu-id="b2815-531">The website starts returning HTTP 5xx error codes.</span></span>
* <span data-ttu-id="b2815-532">Los servicios dependientes, como base de datos o almacenamiento, comienzan a limitar las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="b2815-532">Dependent services, such as database or storage, start to throttle requests.</span></span> <span data-ttu-id="b2815-533">Busque errores HTTP, como HTTP 429 (demasiadas solicitudes), en función del servicio.</span><span class="sxs-lookup"><span data-stu-id="b2815-533">Look for HTTP errors such as HTTP 429 (Too Many Requests), depending on the service.</span></span>
* <span data-ttu-id="b2815-534">La longitud de la cola HTTP aumenta.</span><span class="sxs-lookup"><span data-stu-id="b2815-534">HTTP queue length grows.</span></span>

<span data-ttu-id="b2815-535">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-535">**Recovery**</span></span>

* <span data-ttu-id="b2815-536">Escale horizontalmente para controlar el aumento de la carga.</span><span class="sxs-lookup"><span data-stu-id="b2815-536">Scale out to handle increased load.</span></span>
* <span data-ttu-id="b2815-537">Mitigue los errores para evitar que unos errores en cascada interrumpan toda la aplicación.</span><span class="sxs-lookup"><span data-stu-id="b2815-537">Mitigate failures to avoid having cascading failures disrupt the entire application.</span></span> <span data-ttu-id="b2815-538">Entre las estrategias de mitigación se incluyen:</span><span class="sxs-lookup"><span data-stu-id="b2815-538">Mitigation strategies include:</span></span>

  * <span data-ttu-id="b2815-539">Implemente el [patrón Throttling][throttling-pattern] para evitar sobrecargar los sistemas back-end.</span><span class="sxs-lookup"><span data-stu-id="b2815-539">Implement the [Throttling Pattern][throttling-pattern] to avoid overwhelming backend systems.</span></span>
  * <span data-ttu-id="b2815-540">Use [Queue-Based Load Leveling][queue-based-load-leveling] para almacenar en búfer las solicitudes y procesarlas a un ritmo adecuado.</span><span class="sxs-lookup"><span data-stu-id="b2815-540">Use [queue-based load leveling][queue-based-load-leveling] to buffer requests and process them at an appropriate pace.</span></span>
  * <span data-ttu-id="b2815-541">Dé prioridad a determinados clientes.</span><span class="sxs-lookup"><span data-stu-id="b2815-541">Prioritize certain clients.</span></span> <span data-ttu-id="b2815-542">Por ejemplo, si la aplicación tiene planes de tarifa gratuitos y de pago, limite los clientes del plan de tarifa gratuito, pero no los de pago.</span><span class="sxs-lookup"><span data-stu-id="b2815-542">For example, if the application has free and paid tiers, throttle customers on the free tier, but not paid customers.</span></span> <span data-ttu-id="b2815-543">Consulte [Patrón de cola de prioridad][priority-queue-pattern].</span><span class="sxs-lookup"><span data-stu-id="b2815-543">See [Priority queue pattern][priority-queue-pattern].</span></span>

<span data-ttu-id="b2815-544">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-544">**Diagnostics**.</span></span> <span data-ttu-id="b2815-545">Use el [registro de diagnóstico de App Service][app-service-logging].</span><span class="sxs-lookup"><span data-stu-id="b2815-545">Use [App Service diagnostic logging][app-service-logging].</span></span> <span data-ttu-id="b2815-546">Utilice un servicio como [Azure Log Analytics][azure-log-analytics], [Application Insights][app-insights] o [New Relic][new-relic] para que le ayuden a comprender los registros de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="b2815-546">Use a service such as [Azure Log Analytics][azure-log-analytics], [Application Insights][app-insights], or [New Relic][new-relic] to help understand the diagnostic logs.</span></span>

### <a name="one-of-the-operations-in-a-workflow-or-distributed-transaction-fails"></a><span data-ttu-id="b2815-547">Se produce un error en una de las operaciones en un flujo de trabajo o una transacción distribuida.</span><span class="sxs-lookup"><span data-stu-id="b2815-547">One of the operations in a workflow or distributed transaction fails.</span></span>
<span data-ttu-id="b2815-548">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-548">**Detection**.</span></span> <span data-ttu-id="b2815-549">Después de *N* reintentos, sigue produciendo un error.</span><span class="sxs-lookup"><span data-stu-id="b2815-549">After *N* retry attempts, it still fails.</span></span>

<span data-ttu-id="b2815-550">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-550">**Recovery**</span></span>

* <span data-ttu-id="b2815-551">Como plan de mitigación, implemente el patrón [Scheduler Agent Supervisor][scheduler-agent-supervisor] para administrar todo el flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="b2815-551">As a mitigation plan, implement the [Scheduler Agent Supervisor][scheduler-agent-supervisor] pattern to manage the entire workflow.</span></span>
* <span data-ttu-id="b2815-552">No lo intente de nuevo en los tiempos de expiración.</span><span class="sxs-lookup"><span data-stu-id="b2815-552">Don't retry on timeouts.</span></span> <span data-ttu-id="b2815-553">Hay una tasa de éxito baja para este error.</span><span class="sxs-lookup"><span data-stu-id="b2815-553">There is a low success rate for this error.</span></span>
* <span data-ttu-id="b2815-554">Ponga el trabajo en la cola para volver a intentarlo más tarde.</span><span class="sxs-lookup"><span data-stu-id="b2815-554">Queue work, in order to retry later.</span></span>

<span data-ttu-id="b2815-555">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-555">**Diagnostics**.</span></span> <span data-ttu-id="b2815-556">Inicie sesión en todas las operaciones (correctas y erróneas), incluidas las acciones de compensación.</span><span class="sxs-lookup"><span data-stu-id="b2815-556">Log all operations (successful and failed), including compensating actions.</span></span> <span data-ttu-id="b2815-557">Utilice los identificadores de correlación para que pueda realizar un seguimiento de todas las operaciones dentro de la misma transacción.</span><span class="sxs-lookup"><span data-stu-id="b2815-557">Use correlation IDs, so that you can track all operations within the same transaction.</span></span>

### <a name="a-call-to-a-remote-service-fails"></a><span data-ttu-id="b2815-558">Se produce un error en una llamada a un servicio remoto.</span><span class="sxs-lookup"><span data-stu-id="b2815-558">A call to a remote service fails.</span></span>
<span data-ttu-id="b2815-559">**Detección**.</span><span class="sxs-lookup"><span data-stu-id="b2815-559">**Detection**.</span></span> <span data-ttu-id="b2815-560">Código de error HTTP.</span><span class="sxs-lookup"><span data-stu-id="b2815-560">HTTP error code.</span></span>

<span data-ttu-id="b2815-561">**Recuperación**</span><span class="sxs-lookup"><span data-stu-id="b2815-561">**Recovery**</span></span>

1. <span data-ttu-id="b2815-562">Reinténtelo con los errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="b2815-562">Retry on transient failures.</span></span>
2. <span data-ttu-id="b2815-563">Si se produce un error en la llamada después de *N* reintentos, realice una acción de reserva.</span><span class="sxs-lookup"><span data-stu-id="b2815-563">If the call fails after *N* attempts, take a fallback action.</span></span> <span data-ttu-id="b2815-564">(Específica de la aplicación).</span><span class="sxs-lookup"><span data-stu-id="b2815-564">(Application specific.)</span></span>
3. <span data-ttu-id="b2815-565">Implemente el [patrón Circuit Breaker][circuit-breaker] para evitar errores en cascada.</span><span class="sxs-lookup"><span data-stu-id="b2815-565">Implement the [Circuit Breaker pattern][circuit-breaker] to avoid cascading failures.</span></span>

<span data-ttu-id="b2815-566">**Diagnóstico**.</span><span class="sxs-lookup"><span data-stu-id="b2815-566">**Diagnostics**.</span></span> <span data-ttu-id="b2815-567">Registre todos los errores de llamadas remotas.</span><span class="sxs-lookup"><span data-stu-id="b2815-567">Log all remote call failures.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b2815-568">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="b2815-568">Next steps</span></span>
<span data-ttu-id="b2815-569">Para más información sobre el proceso FMA, consulte [Resilience by design for cloud services][resilience-by-design-pdf] [Resistencia mediante diseño para servicios en la nube] (descarga de PDF).</span><span class="sxs-lookup"><span data-stu-id="b2815-569">For more information about the FMA process, see [Resilience by design for cloud services][resilience-by-design-pdf] (PDF download).</span></span>

<!-- links -->

[api-management]: https://azure.microsoft.com/documentation/services/api-management/
[api-management-throttling]: /azure/api-management/api-management-sample-flexible-throttling/
[app-insights]: /azure/application-insights/app-insights-overview/
[app-insights-web-apps]: /azure/application-insights/app-insights-azure-web-apps/
[app-service-configure]: /azure/app-service-web/web-sites-configure/
[app-service-logging]: /azure/app-service-web/web-sites-enable-diagnostic-log/
[app-service-slots]: /azure/app-service-web/web-sites-staged-publishing/
[auto-rest-client-retry]: https://github.com/Azure/autorest/tree/master/docs
[azure-activity-logs]: /azure/monitoring-and-diagnostics/monitoring-overview-activity-logs/
[azure-alerts]: /azure/monitoring-and-diagnostics/insights-alerts-portal/
[azure-log-analytics]: /azure/log-analytics/log-analytics-overview/
[BrokeredMessage.TimeToLive]: https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.timetolive.aspx
[cassandra-error-handling]: https://www.datastax.com/dev/blog/cassandra-error-handling-done-right
[circuit-breaker]: https://msdn.microsoft.com/library/dn589784.aspx
[cosmosdb-multi-region]: /azure/cosmos-db/tutorial-global-distribution-sql-api
[elasticsearch-azure]: ../elasticsearch/index.md
[elasticsearch-client]: https://www.elastic.co/guide/en/elasticsearch/client/index.html
[health-endpoint-monitoring-pattern]: https://msdn.microsoft.com/library/dn589789.aspx
[onstop-events]: https://azure.microsoft.com/blog/the-right-way-to-handle-azure-onstop-events/
[lb-monitor]: /azure/load-balancer/load-balancer-monitor-log/
[lb-probe]: /azure/load-balancer/load-balancer-custom-probe-overview/#learn-about-the-types-of-probes
[new-relic]: https://newrelic.com/
[priority-queue-pattern]: https://msdn.microsoft.com/library/dn589794.aspx
[queue-based-load-leveling]: https://msdn.microsoft.com/library/dn589783.aspx
[QuotaExceededException]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.quotaexceededexception.aspx
[ra-web-apps-basic]: ../reference-architectures/app-service-web-app/basic-web-app.md
[redis-monitor]: /azure/redis-cache/cache-how-to-monitor/
[redis-retry]: ../best-practices/retry-service-specific.md#azure-redis-cache
[resilience-by-design-pdf]: https://download.microsoft.com/download/D/8/C/D8C599A4-4E8A-49BF-80EE-FE35F49B914D/Resilience_by_Design_for_Cloud_Services_White_Paper.pdf
[RoleEntryPoint.OnStop]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx
[RoleEnvironment.Stopping]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx
[rm-locks]: /azure/azure-resource-manager/resource-group-lock-resources/
[sb-dead-letter-queue]: /azure/service-bus-messaging/service-bus-dead-letter-queues/
[sb-georeplication-sample]: https://github.com/Azure-Samples/azure-servicebus-messaging-samples/tree/master/GeoReplication
[sb-messagingexception-class]: https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingexception.aspx
[sb-messaging-exceptions]: /azure/service-bus-messaging/service-bus-messaging-exceptions/
[sb-outages]: /azure/service-bus-messaging/service-bus-outages-disasters/#protecting-queues-and-topics-against-datacenter-outages-or-disasters
[sb-partition]: /azure/service-bus-messaging/service-bus-partitioning/
[sb-poison-message]: /azure/app-service-web/websites-dotnet-webjobs-sdk-storage-queues-how-to/#poison
[sb-retry]: ../best-practices/retry-service-specific.md#service-bus
[search-sdk]: https://msdn.microsoft.com/library/dn951165.aspx
[scheduler-agent-supervisor]: https://msdn.microsoft.com/library/dn589780.aspx
[search-analytics]: /azure/search/search-traffic-analytics/
[sql-db-audit]: /azure/sql-database/sql-database-auditing-get-started/
[sql-db-errors]: /azure/sql-database/sql-database-develop-error-messages/#resource-governance-errors
[sql-db-failover]: /azure/sql-database/sql-database-geo-replication-failover-portal/
[sql-db-limits]: /azure/sql-database/sql-database-resource-limits/
[sql-db-replication]: /azure/sql-database/sql-database-geo-replication-overview/
[storage-metrics]: https://msdn.microsoft.com/library/dn782843.aspx
[storage-replication]: /azure/storage/storage-redundancy/
[Storage.RetryPolicies]: https://msdn.microsoft.com/library/microsoft.windowsazure.storage.retrypolicies.aspx
[sys.event_log]: https://msdn.microsoft.com/library/dn270018.aspx
[throttling-pattern]: https://msdn.microsoft.com/library/dn589798.aspx
[web-jobs]: /azure/app-service-web/web-sites-create-web-jobs/
[web-jobs-shutdown]: /azure/app-service-web/websites-dotnet-webjobs-sdk-storage-queues-how-to/#graceful
