---
title: Puntuación en tiempo real de Scikit-Learn y de los modelos de aprendizaje profundo de Python en Azure
description: Esta arquitectura de referencia muestra cómo implementar modelos de Python como servicios web en Azure para realizar predicciones en tiempo real.
author: njray
ms.date: 11/09/2018
ms.openlocfilehash: ff385e232c69e46b0afc6b15e73983bd856b9b2b
ms.sourcegitcommit: e7e0e0282fa93f0063da3b57128ade395a9c1ef9
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 12/05/2018
ms.locfileid: "52902586"
---
# <a name="real-time-scoring-of-python-scikit-learn-and-deep-learning-models-on-azure"></a><span data-ttu-id="1c9d6-103">Puntuación en tiempo real de Scikit-Learn y de los modelos de aprendizaje profundo de Python en Azure</span><span class="sxs-lookup"><span data-stu-id="1c9d6-103">Real-time scoring of Python Scikit-Learn and Deep Learning Models on Azure</span></span>

<span data-ttu-id="1c9d6-104">Esta arquitectura de referencia muestra cómo implementar modelos de Python como servicios web para realizar predicciones en tiempo real.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-104">This reference architecture shows how to deploy Python models as web services to make real-time predictions.</span></span> <span data-ttu-id="1c9d6-105">Se tratan dos escenarios: la implementación de modelos de Python normales y los requisitos específicos de la implementación de modelos de aprendizaje profundo.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-105">Two scenarios are covered: deploying regular Python models, and the specific requirements of deploying deep learning models.</span></span> <span data-ttu-id="1c9d6-106">Ambos escenarios utilizan la arquitectura que se muestra.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-106">Both scenarios use the architecture shown.</span></span>

<span data-ttu-id="1c9d6-107">En GitHub hay disponibles dos implementaciones de referencia para esta arquitectura, una para los [modelos de Python normales][github-python] y otra para los [modelos de aprendizaje profundo][github-dl].</span><span class="sxs-lookup"><span data-stu-id="1c9d6-107">Two reference implementations for this architecture are available on GitHub, one for [regular Python models][github-python] and one for [deep learning models][github-dl].</span></span>

![](./_images/python-model-architecture.png)

## <a name="scenarios"></a><span data-ttu-id="1c9d6-108">Escenarios</span><span class="sxs-lookup"><span data-stu-id="1c9d6-108">Scenarios</span></span>

<span data-ttu-id="1c9d6-109">Las implementaciones de referencia muestran dos escenarios que usan esta arquitectura.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-109">The reference implementations demonstrate two scenarios using this architecture.</span></span>

<span data-ttu-id="1c9d6-110">**Escenario 1: Coincidencia de preguntas frecuentes**.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-110">**Scenario 1: FAQ matching**.</span></span> <span data-ttu-id="1c9d6-111">En este escenario se muestra cómo implementar un modelo de coincidencia de preguntas frecuentes (P+F) coincidencia de modelo como un servicio web para proporcionar predicciones para las preguntas de los usuarios.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-111">This scenario shows how to deploy a frequently asked questions (FAQ) matching model as a web service to provide predictions for user questions.</span></span> <span data-ttu-id="1c9d6-112">En este escenario, en el diagrama de la arquitectura, "Input Data" hace referencia a las cadenas de texto que contienen las preguntas del usuario que coinciden con una lista de preguntas frecuentes.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-112">For this scenario, "Input Data" in the architecture diagram refers to text strings containing user questions to match with a list of FAQs.</span></span> <span data-ttu-id="1c9d6-113">Este escenario está diseñado para la biblioteca de aprendizaje automático [scikit-learn][scikit] de Python, pero se puede generalizar a cualquier escenario que use modelos de Python para realizar predicciones en tiempo real.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-113">This scenario is designed for the [scikit-learn][scikit] machine learning library for Python, but can be generalized to any scenario that uses Python models to make real-time predictions.</span></span>

<span data-ttu-id="1c9d6-114">Este escenario utiliza un subconjunto de datos de preguntas de Stack Overflow que incluye las preguntas originales etiquetadas como JavaScript, sus preguntas duplicadas y sus respuestas.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-114">This scenario uses a subset of Stack Overflow question data that includes original questions tagged as JavaScript, their duplicate questions, and their answers.</span></span> <span data-ttu-id="1c9d6-115">Entrena a una canalización de scikit-learn para predecir la probabilidad de coincidencia de una pregunta duplicada con cada una de las respuestas originales.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-115">It trains a scikit-learn pipeline to predict the match probability of a duplicate question with each of the original questions.</span></span> <span data-ttu-id="1c9d6-116">Dichas predicciones se realizan en tiempo real mediante un punto de conexión de API REST.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-116">These predictions are made in real time using a REST API  endpoint.</span></span>

<span data-ttu-id="1c9d6-117">Este es el flujo de la aplicación para esta arquitectura:</span><span class="sxs-lookup"><span data-stu-id="1c9d6-117">The application flow for this architecture is as follows:</span></span>

1.  <span data-ttu-id="1c9d6-118">El cliente envía una solicitud POST HTTP con los datos de la pregunta codificados.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-118">The client sends an HTTP POST request with the encoded question data.</span></span>

2.  <span data-ttu-id="1c9d6-119">La aplicación Flask extrae la pregunta de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-119">The Flask app extracts the question from the request.</span></span>

3.  <span data-ttu-id="1c9d6-120">La pregunta se envía al modelo de canalización de scikit-learn para obtener información acerca de sus características y puntuación.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-120">The question is sent to the scikit-learn pipeline model for featurization and scoring.</span></span>

4.  <span data-ttu-id="1c9d6-121">Las preguntas más frecuentes coincidentes con sus puntuaciones se canalizan a un objeto JSON y se devuelven al cliente.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-121">The matching FAQ questions with their scores are piped into a JSON object and returned to the client.</span></span>

<span data-ttu-id="1c9d6-122">Esta es una captura de pantalla de la aplicación de ejemplo que consume los resultados:</span><span class="sxs-lookup"><span data-stu-id="1c9d6-122">Here is a screenshot of the example app that consumes the results:</span></span>

![](./_images/python-faq-matches.png)

<span data-ttu-id="1c9d6-123">**Escenario 2: Clasificación de imágenes.**</span><span class="sxs-lookup"><span data-stu-id="1c9d6-123">**Scenario 2: Image classification.**</span></span> <span data-ttu-id="1c9d6-124">En este escenario se muestra cómo implementar un modelo de red neuronal convolucional (CNN) como un servicio web para proporcionar predicciones en imágenes.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-124">This scenario shows how to deploy a Convolutional Neural Network (CNN) model as a web service to provide predictions on images.</span></span> <span data-ttu-id="1c9d6-125">Para este escenario, en el diagrama de la arquitectura, "Input Data" hace referencia a los archivos de imagen.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-125">For this scenario, "Input Data" in the architecture diagram refers to image files.</span></span> <span data-ttu-id="1c9d6-126">Los CNN son muy eficaces en Computer Vision para tareas como la clasificación de imágenes y la detección de objetos.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-126">CNNs are very effective in computer vision for tasks such as image classification and object detection.</span></span> <span data-ttu-id="1c9d6-127">Este escenario está diseñado para los marcos TensorFlow, Keras (con el back-end de TensorFlow) y PyTorch.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-127">This scenario is designed for the frameworks TensorFlow, Keras (with the TensorFlow back end), and PyTorch.</span></span> <span data-ttu-id="1c9d6-128">Sin embargo, puede ser válido para cualquier escenario que use modelos de aprendizaje profundo para realizar predicciones en tiempo real.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-128">However, it can be generalized to any scenario that uses deep learning models to make real-time predictions.</span></span>

<span data-ttu-id="1c9d6-129">Este escenario usa un modelo previamente entrenado ResNet-152 entrenado en el conjunto de datos ImageNet - 1K (1000 clases) para predecir a qué categoría (consulte la ilustración siguiente) pertenece una imagen.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-129">This scenario uses a pre-trained ResNet-152 model trained on ImageNet-1K (1,000 classes) dataset to predict which category (see figure below) an image belongs to.</span></span> <span data-ttu-id="1c9d6-130">Dichas predicciones se realizan en tiempo real mediante un punto de conexión de API REST.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-130">These predictions are made in real time using a REST API endpoint.</span></span>

![](./_images/python-example-predictions.png)

<span data-ttu-id="1c9d6-131">Este es el flujo de la aplicación para el modelo de aprendizaje profundo:</span><span class="sxs-lookup"><span data-stu-id="1c9d6-131">The application flow for the deep learning model is as follows:</span></span>

1.  <span data-ttu-id="1c9d6-132">El cliente envía una solicitud POST HTTP con los datos de la imagen codificados.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-132">The client sends an HTTP POST request with the encoded image data.</span></span>

2.  <span data-ttu-id="1c9d6-133">La aplicación Flask extrae la imagen de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-133">The Flask app extracts the image from the request.</span></span>

3.  <span data-ttu-id="1c9d6-134">La imagen se preprocesa y se envía al modelo para su puntuación.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-134">The image is preprocessed and sent to the model for scoring.</span></span>

4.  <span data-ttu-id="1c9d6-135">El resultado de dicha puntuación se canaliza a un objeto JSON y devuelve al cliente.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-135">The scoring result is piped into a JSON object and returned to the client.</span></span>

## <a name="architecture"></a><span data-ttu-id="1c9d6-136">Arquitectura</span><span class="sxs-lookup"><span data-stu-id="1c9d6-136">Architecture</span></span>

<span data-ttu-id="1c9d6-137">Esta arquitectura consta de los siguientes componentes.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-137">This architecture consists of the following components.</span></span>

<span data-ttu-id="1c9d6-138">**[Máquina virtual][vm]** (VM).</span><span class="sxs-lookup"><span data-stu-id="1c9d6-138">**[Virtual machine][vm]** (VM).</span></span> <span data-ttu-id="1c9d6-139">La máquina virtual se muestra como ejemplo de dispositivo &mdash; local o en la nube &mdash; que puede enviar una solicitud HTTP.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-139">The VM is shown as an example of a device &mdash; local or in the cloud &mdash; that can send an HTTP request.</span></span>

<span data-ttu-id="1c9d6-140">**[Azure Kubernetes Service][aks]** (AKS) se usa para implementar la aplicación en un clúster de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-140">**[Azure Kubernetes Service][aks]** (AKS) is used to deploy the application on a Kubernetes cluster.</span></span> <span data-ttu-id="1c9d6-141">AKS simplifica la implementación y las operaciones de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-141">AKS simplifies the deployment and operations of Kubernetes.</span></span> <span data-ttu-id="1c9d6-142">El clúster se puede configurar mediante máquinas virtuales de solo CPU para los modelos de Python normales o máquinas virtuales con GPU habilitado para modelos de aprendizaje profundo.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-142">The cluster can be configured using CPU-only VMs for regular Python models or GPU-enabled VMs for deep learning models.</span></span>

<span data-ttu-id="1c9d6-143">**[Equilibrador de carga][lb]**.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-143">**[Load balancer][lb]**.</span></span> <span data-ttu-id="1c9d6-144">Un equilibrador de carga, aprovisionado por AKS, se utiliza para exponer el servicio externamente.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-144">A load balancer, provisioned by AKS, is used to expose the service externally.</span></span> <span data-ttu-id="1c9d6-145">El tráfico del equilibrador de carga se dirige a los pods de back-end.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-145">Traffic from the load balancer is directed to the back-end pods.</span></span>

<span data-ttu-id="1c9d6-146">**[Docker Hub][docker]** se usa para almacenar la imagen de Docker que se implementa en un clúster de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-146">**[Docker Hub][docker]** is used to store the Docker image that is deployed on Kubernetes cluster.</span></span> <span data-ttu-id="1c9d6-147">Docker Hub se eligió para esta arquitectura porque es fácil de usar y porque es el repositorio de imágenes predeterminado para los usuarios de Docker.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-147">Docker Hub was chosen for this architecture because it's easy to use and is the default image repository for Docker users.</span></span> <span data-ttu-id="1c9d6-148">[Azure Container Registry][acr] también se puede usar para esta arquitectura.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-148">[Azure Container Registry][acr] can also be used for this architecture.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="1c9d6-149">Consideraciones sobre rendimiento</span><span class="sxs-lookup"><span data-stu-id="1c9d6-149">Performance considerations</span></span>

<span data-ttu-id="1c9d6-150">Para las arquitecturas de puntuación en tiempo real, el rendimiento de la capacidad de proceso se convierte en una consideración dominante.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-150">For real-time scoring architectures, throughput performance becomes a dominant consideration.</span></span> <span data-ttu-id="1c9d6-151">En el caso de los modelos de Python normales, se suele aceptar que las CPU son suficientes para controlar la carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-151">For regular Python models, it's generally accepted that CPUs are sufficient to handle the workload.</span></span> 

<span data-ttu-id="1c9d6-152">Sin embargo, en el caso de las cargas de trabajo de aprendizaje profundo, cuando la velocidad es un cuello de botella, las GPU suelen proporcionar mayor [rendimiento][gpus-vs-cpus] que las CPU.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-152">However for deep learning workloads, when speed is a bottleneck, GPUs generally provide better [performance][gpus-vs-cpus] compared to CPUs.</span></span> <span data-ttu-id="1c9d6-153">Para igualar el rendimiento de la GPU mediante el uso de varias CPU, normalmente se necesita un clúster con un gran número de CPU.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-153">To match GPU performance using CPUs, a cluster with large number of CPUs is usually needed.</span></span>

<span data-ttu-id="1c9d6-154">Puede utilizar CPU para esta arquitectura en cualquier escenario, pero para los modelos de aprendizaje profundo, las GPU proporcionan valores de capacidad de proceso considerablemente superiores en comparación con un clúster de CPU cuyo costo sea parecido.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-154">You can use CPUs for this architecture in either scenario, but for deep learning models, GPUs provide significantly higher throughput values compared to a CPU cluster of similar cost.</span></span> <span data-ttu-id="1c9d6-155">AKS admite el uso de GPU, que es una ventaja de usar AKS para esta arquitectura.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-155">AKS supports the use of GPUs, which is one advantage of using AKS for this architecture.</span></span> <span data-ttu-id="1c9d6-156">Además, las implementaciones de aprendizaje profundo suelen usar modelos con un gran número de parámetros.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-156">Also, deep learning deployments typically use models with a high number of parameters.</span></span> <span data-ttu-id="1c9d6-157">El uso de GPU evita la contención de recursos entre el modelo y el servicio web, lo que es un problema en las implementaciones de solo CPU.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-157">Using GPUs prevents contention for resources between the model and the web service, which is an issue in CPU-only deployments.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="1c9d6-158">Consideraciones sobre escalabilidad</span><span class="sxs-lookup"><span data-stu-id="1c9d6-158">Scalability considerations</span></span>

<span data-ttu-id="1c9d6-159">En el caso de los modelos de Python normales, donde el clúster de AKS se aprovisiona con máquinas virtuales que solo tienen CPU, tenga cuidado al [escalar horizontalmente el número de pods][manually-scale-pods].</span><span class="sxs-lookup"><span data-stu-id="1c9d6-159">For regular Python models, where AKS cluster is provisioned with CPU-only VMs, take care when [scaling out the number of pods][manually-scale-pods].</span></span> <span data-ttu-id="1c9d6-160">El objetivo es usar completamente el clúster.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-160">The goal is to fully utilize the cluster.</span></span> <span data-ttu-id="1c9d6-161">El escalado depende de las solicitudes de CPU y de los límites definidos para los pods.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-161">Scaling depends on the CPU requests and limits defined for the pods.</span></span> <span data-ttu-id="1c9d6-162">Kubernetes también admite el [escalado automático][autoscale-pods] de los pods para ajustar el número de pods en una implementación en función del uso de la CPU o de otras métricas.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-162">Kubernetes also supports [autoscaling][autoscale-pods] of the pods to adjust the number of pods in a deployment depending on CPU utilization or other select metrics.</span></span> <span data-ttu-id="1c9d6-163">El [escalador automático de clúster][autoscaler] (en versión preliminar) puede escalar nodos de agente en función de los pods que haya pendientes.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-163">The [cluster autoscaler][autoscaler] (in preview) can scale agent nodes based on pending pods.</span></span>

<span data-ttu-id="1c9d6-164">En los escenarios de aprendizaje profundo, mediante el uso de máquinas con GPU habilitadas, los límites de recursos en los pods son tales que se una GPU asigna a un pod.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-164">For deep learning scenarios, using GPU-enabled VMs, resource limits on pods are such that one GPU is assigned to one pod.</span></span> <span data-ttu-id="1c9d6-165">En función del tipo de máquina virtual utilizada, debe [escalar los nodos del clúster][scale-cluster] para satisfacer la demanda del servicio.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-165">Depending on the type of VM used, you must [scale the nodes of the cluster][scale-cluster] to meet the demand for the service.</span></span> <span data-ttu-id="1c9d6-166">Esto es algo que se puede hacer fácilmente mediante la CLI de Azure y kubectl.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-166">You can do this easily using the Azure CLI and kubectl.</span></span>

## <a name="monitoring-and-logging-considerations"></a><span data-ttu-id="1c9d6-167">Consideraciones acerca de la supervisión y el registro</span><span class="sxs-lookup"><span data-stu-id="1c9d6-167">Monitoring and logging considerations</span></span>

### <a name="aks-monitoring"></a><span data-ttu-id="1c9d6-168">Supervisión de AKS</span><span class="sxs-lookup"><span data-stu-id="1c9d6-168">AKS monitoring</span></span>

<span data-ttu-id="1c9d6-169">Para ver el rendimiento de AKS, use la característica [Azure Monitor para contenedores][monitor-containers].</span><span class="sxs-lookup"><span data-stu-id="1c9d6-169">For visibility into AKS performance, use the [Azure Monitor for containers][monitor-containers] feature.</span></span> <span data-ttu-id="1c9d6-170">Dicha característica recopila métricas del procesador y de la memoria procedentes de los controladores, los nodos y los contenedores disponibles en Kubernetes mediante Metrics API.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-170">It collects memory and processor metrics from controllers, nodes, and containers that are available in Kubernetes through the Metrics API.</span></span>

<span data-ttu-id="1c9d6-171">Al implementar la aplicación, supervise el clúster de AKS para asegurarse de que funciona según lo previsto, todos los nodos están operativos y se ejecutan todos los pods.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-171">While deploying your application, monitor the AKS cluster to make sure it's working as expected, all the nodes are operational, and all pods are running.</span></span> <span data-ttu-id="1c9d6-172">Aunque puede usar la herramienta de línea de comandos [kubectl][kubectl] para recuperar el estado de los pods, Kubernetes también incluye un panel web para la supervisión básica del estado y la administración del clúster.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-172">Although you can use the [kubectl][kubectl] command-line tool to retrieve pod status, Kubernetes also includes a web dashboard for basic monitoring of the cluster status and management.</span></span>

![](./_images/python-kubernetes-dashboard.png)

<span data-ttu-id="1c9d6-173">Para ver el estado general del clúster y de los nodos, vaya a la sección **Nodes** (Nodos) del panel de Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-173">To see the overall state of the cluster and nodes, go to the **Nodes** section of the Kubernetes dashboard.</span></span> <span data-ttu-id="1c9d6-174">Si un nodo está inactivo o se ha producido un error, puede mostrar los registros de errores de esa página.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-174">If a node is inactive or has failed, you can display the error logs from that page.</span></span> <span data-ttu-id="1c9d6-175">De forma similar, vaya a las secciones **Pods** y **Deployments** (Implementaciones) para obtener información acerca del número de pods y del estado de la implementación.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-175">Similarly, go to the **Pods** and **Deployments** sections for information about the number of pods and status of your deployment.</span></span>

### <a name="aks-logs"></a><span data-ttu-id="1c9d6-176">Registros de AKS</span><span class="sxs-lookup"><span data-stu-id="1c9d6-176">AKS logs</span></span> 

<span data-ttu-id="1c9d6-177">AKS registra automáticamente todos los stdout y stderr en los registros de los pods del clúster.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-177">AKS automatically logs all stdout/stderr to the logs of the pods in the cluster.</span></span> <span data-ttu-id="1c9d6-178">Use kubectl para verlos, así como los eventos y registros a nivel de nodo.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-178">Use kubectl to see these and also node-level events and logs.</span></span> <span data-ttu-id="1c9d6-179">Para más información, consulte los pasos de implementación.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-179">For details, see the deployment steps.</span></span>

<span data-ttu-id="1c9d6-180">Use [Azure Monitor para contenedores][monitor-containers] para recopilar métricas y registros a través de una versión en contenedores del agente de Log Analytics para Linux, que se almacena en el área de trabajo de Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-180">Use [Azure Monitor for containers][monitor-containers] to collect metrics and logs through a containerized version of the Log Analytics agent for Linux, which is stored in your Log Analytics workspace.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="1c9d6-181">Consideraciones sobre la seguridad</span><span class="sxs-lookup"><span data-stu-id="1c9d6-181">Security considerations</span></span>

<span data-ttu-id="1c9d6-182">Use [Azure Security Center][security-center] para obtener una visión central del estado de la seguridad de sus recursos en Azure.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-182">Use [Azure Security Center][security-center] to get a central view of the security state of your Azure resources.</span></span> <span data-ttu-id="1c9d6-183">Security Center supervisa los posibles problemas de seguridad y proporciona una imagen completa del estado de seguridad de su implementación, aunque no monitoriza los nodos de agente de AKS.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-183">Security Center monitors potential security issues and provides a comprehensive picture of the security health of your deployment, although it doesn't monitor AKS agent nodes.</span></span> <span data-ttu-id="1c9d6-184">El Centro de seguridad se configura por cada suscripción de Azure.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-184">Security Center is configured per Azure subscription.</span></span> <span data-ttu-id="1c9d6-185">Habilite la colección de datos de seguridad que se describe en [Guía de inicio rápido: incorporación de su suscripción de Azure al nivel Estándar de Security Center][get-started].</span><span class="sxs-lookup"><span data-stu-id="1c9d6-185">Enable security data collection as described in [Onboard your Azure subscription to Security Center Standard][get-started].</span></span> <span data-ttu-id="1c9d6-186">Una vez que habilite la recolección, el Centro de seguridad busca automáticamente las VM creadas en esa suscripción.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-186">When data collection is enabled, Security Center automatically scans any VMs created under that subscription.</span></span>

<span data-ttu-id="1c9d6-187">**Operaciones**.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-187">**Operations**.</span></span> <span data-ttu-id="1c9d6-188">Para iniciar sesión en un clúster de AKS mediante el token de autenticación de Azure Active Directory (Azure AD), configurar AKS para usar Azure AD para la [autenticación del usuario][aad-auth].</span><span class="sxs-lookup"><span data-stu-id="1c9d6-188">To sign in to an AKS cluster using your Azure Active Directory (Azure AD) authentication token, configure AKS to use Azure AD for [user authentication][aad-auth].</span></span> <span data-ttu-id="1c9d6-189">Los administradores del clúster también pueden configurar el control de acceso basado en roles (RBAC) de Kubernetes en función de la identidad de los usuarios o su pertenencia a un grupo del directorio.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-189">Cluster administrators can also configure Kubernetes role-based access control (RBAC) based on a user's identity or directory group membership.</span></span>

<span data-ttu-id="1c9d6-190">Utilice [RBAC][rbac] para controlar el acceso a los recursos de Azure que implemente.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-190">Use [RBAC][rbac] to control access to the Azure resources that you deploy.</span></span> <span data-ttu-id="1c9d6-191">RBAC le permite asignar roles de autorización a los miembros de su equipo de DevOps.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-191">RBAC lets you assign authorization roles to members of your DevOps team.</span></span> <span data-ttu-id="1c9d6-192">Un usuario se puede asignar a varios roles y es posible crear roles personalizados para una especificación aún más detallada de los [permisos].</span><span class="sxs-lookup"><span data-stu-id="1c9d6-192">A user can be assigned to multiple roles, and you can create custom roles for even more fine-grained [permissions].</span></span>

<span data-ttu-id="1c9d6-193">**HTTPS**.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-193">**HTTPS**.</span></span> <span data-ttu-id="1c9d6-194">Como procedimiento recomendado de seguridad, la aplicación debe exigir HTTPS y redirigir las solicitudes HTTP.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-194">As a security best practice, the application should enforce HTTPS and redirect HTTP requests.</span></span> <span data-ttu-id="1c9d6-195">Use un [controlador de entrada][ingress-controller] para implementar un proxy inverso que termina SSL y redirige las solicitudes HTTP.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-195">Use an [ingress controller][ingress-controller] to deploy a reverse proxy that terminates SSL and redirects HTTP requests.</span></span> <span data-ttu-id="1c9d6-196">Para más información, consulte [Creación de un controlador de entrada HTTPS en Azure Kubernetes Service (AKS)][https-ingress].</span><span class="sxs-lookup"><span data-stu-id="1c9d6-196">For more information, see [Create an HTTPS ingress controller on Azure Kubernetes Service (AKS)][https-ingress].</span></span>

<span data-ttu-id="1c9d6-197">**Autenticación**.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-197">**Authentication**.</span></span> <span data-ttu-id="1c9d6-198">Esta solución no restringe el acceso a los puntos de conexión.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-198">This solution doesn't restrict access to the endpoints.</span></span> <span data-ttu-id="1c9d6-199">Para implementar la arquitectura en un entorno empresarial, proteja los puntos de conexión a través de claves de API y agregue algún tipo de autenticación de usuario a la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-199">To deploy the architecture in an enterprise setting, secure the endpoints through API keys and add some form of user authentication to the client application.</span></span>

<span data-ttu-id="1c9d6-200">**Container registry**.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-200">**Container registry**.</span></span> <span data-ttu-id="1c9d6-201">Esta solución usa un registro público para almacenar la imagen de Docker.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-201">This solution uses a public registry to store the Docker image.</span></span> <span data-ttu-id="1c9d6-202">Tanto el código del que depende la aplicación como el modelo se encuentran en esta imagen.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-202">The code that the application depends on, and the model, are contained within this image.</span></span> <span data-ttu-id="1c9d6-203">Las aplicaciones empresariales deben usar un registro privado como ayuda para protegerse de la ejecución de código malintencionado y para que la información del contenedor no corra peligro.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-203">Enterprise applications should use a private registry to help guard against running malicious code and to help keep the information inside the container from being compromised.</span></span>

<span data-ttu-id="1c9d6-204">**DDoS Protection**.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-204">**DDoS protection**.</span></span> <span data-ttu-id="1c9d6-205">Considere la posibilidad de habilitar el [estándar de protección contra DDoS][ddos].</span><span class="sxs-lookup"><span data-stu-id="1c9d6-205">Consider enabling [DDoS Protection Standard][ddos].</span></span> <span data-ttu-id="1c9d6-206">Aunque el servicio DDoS Protection básico se habilita como parte de la plataforma Azure, DDoS Protection Estándar proporciona funcionalidades de mitigación de riesgos ajustadas específicamente a los recursos de las redes virtuales de Azure.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-206">Although basic DDoS protection is enabled as part of the Azure platform, DDoS Protection Standard provides mitigation capabilities that are tuned specifically to Azure virtual network resources.</span></span>

<span data-ttu-id="1c9d6-207">**Registro**.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-207">**Logging**.</span></span> <span data-ttu-id="1c9d6-208">Use los procedimientos recomendados antes de almacenar datos de registro, como limpiar las contraseñas de usuario y otra información que podría utilizarse para cometer fraudes de seguridad.</span><span class="sxs-lookup"><span data-stu-id="1c9d6-208">Use best practices before storing log data, such as scrubbing user passwords and other information that could be used to commit security fraud.</span></span>

## <a name="deployment"></a><span data-ttu-id="1c9d6-209">Implementación</span><span class="sxs-lookup"><span data-stu-id="1c9d6-209">Deployment</span></span>

<span data-ttu-id="1c9d6-210">Para implementar esta arquitectura de referencia, siga los pasos descritos en el repositorio de GitHub:</span><span class="sxs-lookup"><span data-stu-id="1c9d6-210">To deploy this reference architecture, follow the steps described in the GitHub repos:</span></span> 

  - <span data-ttu-id="1c9d6-211">[Modelos de Python normales][github-python]</span><span class="sxs-lookup"><span data-stu-id="1c9d6-211">[Regular Python models][github-python]</span></span>
  - <span data-ttu-id="1c9d6-212">[Modelos de aprendizaje profundo][github-dl]</span><span class="sxs-lookup"><span data-stu-id="1c9d6-212">[Deep learning models][github-dl]</span></span>

[aad-auth]: /azure/aks/aad-integration
[acr]: /azure/container-registry/
[something]: https://kubernetes.io/docs/reference/access-authn-authz/authentication/
[aks]: /azure/aks/intro-kubernetes
[autoscaler]: /azure/aks/autoscaler
[autoscale-pods]: /azure/aks/tutorial-kubernetes-scale#autoscale-pods
[azcopy]: /azure/storage/common/storage-use-azcopy-linux
[ddos]: /azure/virtual-network/ddos-protection-overview
[docker]: https://hub.docker.com/
[get-started]: /azure/security-center/security-center-get-started
[github-python]: https://github.com/Azure/MLAKSDeployment
[github-dl]: https://github.com/Microsoft/AKSDeploymentTutorial
[gpus-vs-cpus]: https://azure.microsoft.com/en-us/blog/gpus-vs-cpus-for-deployment-of-deep-learning-models/
[https-ingress]: /azure/aks/ingress-tls
[ingress-controller]: https://kubernetes.io/docs/concepts/services-networking/ingress/
[kubectl]: https://kubernetes.io/docs/tasks/tools/install-kubectl/
[lb]: /azure/load-balancer/load-balancer-overview
[manually-scale-pods]: /azure/aks/tutorial-kubernetes-scale#manually-scale-pods
[monitor-containers]: /azure/monitoring/monitoring-container-insights-overview
[permisos]: /azure/aks/concepts-identity
[permissions]: /azure/aks/concepts-identity
[rbac]: /azure/active-directory/role-based-access-control-what-is
[scale-cluster]: /azure/aks/scale-cluster
[scikit]: https://pypi.org/project/scikit-learn/
[security-center]: /azure/security-center/security-center-intro
[vm]: /azure/virtual-machines/

